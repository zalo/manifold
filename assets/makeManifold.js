import"./modulepreload-polyfill.js";import{Q as te,h as j,n as ae,b as Z,E as Te,c as er,I as Mt,a as Zt,d as kt,T as ti,S as Ee,L as ut,i as he,v as ni,e as ri,t as ii,f as De,s as si,_ as oi,r as ai,g as ci,w as ui,z as li}from"./gltf-io.js";import{M as fi}from"./manifold.js";const di=0,hi=0,pi=0,xi=2,gi=0,_i=163,mi=166,Ti=0,yi=2,wi=1,bi=64,Ei=0;class Ii{constructor(){this.vkFormat=Ei,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=di,this.levels=[],this.dataFormatDescriptor=[{vendorId:pi,descriptorType:hi,descriptorBlockSize:0,versionNumber:xi,colorModel:gi,colorPrimaries:wi,transferFunction:yi,flags:Ti,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class tt{constructor(e,t,n,r){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=r,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian),t=this._dataView.getUint32(this._offset+4,this._littleEndian),n=e+2**32*t;return this._offset+=8,n}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t=0){const n=this._offset;let r=0;for(;this._dataView.getUint8(this._offset)!==t&&r<e;)r++,this._offset++;return r<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,r)}}const le=[171,75,84,88,32,50,48,187,13,10,26,10];function bn(i){return typeof TextDecoder<"u"?new TextDecoder().decode(i):Buffer.from(i).toString("utf8")}function Rt(i){const e=new Uint8Array(i.buffer,i.byteOffset,le.length);if(e[0]!==le[0]||e[1]!==le[1]||e[2]!==le[2]||e[3]!==le[3]||e[4]!==le[4]||e[5]!==le[5]||e[6]!==le[6]||e[7]!==le[7]||e[8]!==le[8]||e[9]!==le[9]||e[10]!==le[10]||e[11]!==le[11])throw new Error("Missing KTX 2.0 identifier.");const t=new Ii,n=17*Uint32Array.BYTES_PER_ELEMENT,r=new tt(i,le.length,n,!0);t.vkFormat=r._nextUint32(),t.typeSize=r._nextUint32(),t.pixelWidth=r._nextUint32(),t.pixelHeight=r._nextUint32(),t.pixelDepth=r._nextUint32(),t.layerCount=r._nextUint32(),t.faceCount=r._nextUint32();const o=r._nextUint32();t.supercompressionScheme=r._nextUint32();const s=r._nextUint32(),a=r._nextUint32(),f=r._nextUint32(),d=r._nextUint32(),p=r._nextUint64(),m=r._nextUint64(),w=o*3*8,b=new tt(i,le.length+n,w,!0);for(let F=0;F<o;F++)t.levels.push({levelData:new Uint8Array(i.buffer,i.byteOffset+b._nextUint64(),b._nextUint64()),uncompressedByteLength:b._nextUint64()});const l=new tt(i,s,a,!0),_={vendorId:l._skip(4)._nextUint16(),descriptorType:l._nextUint16(),versionNumber:l._nextUint16(),descriptorBlockSize:l._nextUint16(),colorModel:l._nextUint8(),colorPrimaries:l._nextUint8(),transferFunction:l._nextUint8(),flags:l._nextUint8(),texelBlockDimension:[l._nextUint8(),l._nextUint8(),l._nextUint8(),l._nextUint8()],bytesPlane:[l._nextUint8(),l._nextUint8(),l._nextUint8(),l._nextUint8(),l._nextUint8(),l._nextUint8(),l._nextUint8(),l._nextUint8()],samples:[]},c=6,u=4,x=(_.descriptorBlockSize/4-c)/u;for(let F=0;F<x;F++){const ie={bitOffset:l._nextUint16(),bitLength:l._nextUint8(),channelType:l._nextUint8(),samplePosition:[l._nextUint8(),l._nextUint8(),l._nextUint8(),l._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};ie.channelType&bi?(ie.sampleLower=l._nextInt32(),ie.sampleUpper=l._nextInt32()):(ie.sampleLower=l._nextUint32(),ie.sampleUpper=l._nextUint32()),_.samples[F]=ie}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(_);const g=new tt(i,f,d,!0);for(;g._offset<d;){const F=g._nextUint32(),ie=g._scan(F),$=bn(ie);if(t.keyValue[$]=g._nextUint8Array(F-ie.byteLength-1),$.match(/^ktx/i)){const se=bn(t.keyValue[$]);t.keyValue[$]=se.substring(0,se.lastIndexOf("\0"))}const H=F%4?4-F%4:0;g._skip(H)}if(m<=0)return t;const h=new tt(i,p,m,!0),E=h._nextUint16(),y=h._nextUint16(),T=h._nextUint32(),N=h._nextUint32(),O=h._nextUint32(),R=h._nextUint32(),v=[];for(let F=0;F<o;F++)v.push({imageFlags:h._nextUint32(),rgbSliceByteOffset:h._nextUint32(),rgbSliceByteLength:h._nextUint32(),alphaSliceByteOffset:h._nextUint32(),alphaSliceByteLength:h._nextUint32()});const I=p+h._offset,C=I+T,B=C+N,z=B+O,U=new Uint8Array(i.buffer,i.byteOffset+I,T),W=new Uint8Array(i.buffer,i.byteOffset+C,N),de=new Uint8Array(i.buffer,i.byteOffset+B,O),ne=new Uint8Array(i.buffer,i.byteOffset+z,R);return t.globalData={endpointCount:E,selectorCount:y,imageDescs:v,endpointsData:U,selectorsData:W,tablesData:de,extendedData:ne},t}const Yt="EXT_mesh_gpu_instancing",Ct="EXT_meshopt_compression",tr="KHR_draco_mesh_compression",Qt="KHR_lights_punctual",Jt="KHR_materials_anisotropy",en="KHR_materials_clearcoat",tn="KHR_materials_emissive_strength",nn="KHR_materials_ior",rn="KHR_materials_iridescence",sn="KHR_materials_pbrSpecularGlossiness",on="KHR_materials_sheen",an="KHR_materials_specular",cn="KHR_materials_transmission",un="KHR_materials_unlit",ln="KHR_materials_volume",$e="KHR_materials_variants",fn="KHR_texture_transform",mt="KHR_xmp_json_ld",Ut="INSTANCE_ATTRIBUTE";let nr=class extends ae{init(){this.extensionName=Yt,this.propertyType="InstancedMesh",this.parentTypes=[j.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:Ut})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}};nr.EXTENSION_NAME=Yt;const Me=Yt;let rr=class extends Z{constructor(...e){super(...e),this.extensionName=Me,this.provideTypes=[j.NODE],this.prewriteTypes=[j.ACCESSOR]}createInstancedMesh(){return new nr(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach((t,n)=>{if(!t.extensions||!t.extensions[Me])return;const r=t.extensions[Me],o=this.createInstancedMesh();for(const s in r.attributes)o.setAttribute(s,e.accessors[r.attributes[s]]);e.nodes[n].setExtension(Me,o)}),this}prewrite(e){e.accessorUsageGroupedByParent.add(Ut);for(const t of this.properties)for(const n of t.listAttributes())e.addAccessorToUsageGroup(n,Ut);return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listNodes().forEach(n=>{const r=n.getExtension(Me);if(r){const o=e.nodeIndexMap.get(n),s=t.json.nodes[o],a={attributes:{}};r.listSemantics().forEach(f=>{const d=r.getAttribute(f);a.attributes[f]=e.accessorIndexMap.get(d)}),s.extensions=s.extensions||{},s.extensions[Me]=a}}),this}};function Re(){return Re=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},Re.apply(this,arguments)}var at,qe,Q;rr.EXTENSION_NAME=Me,function(i){i.QUANTIZE="quantize",i.FILTER="filter"}(at||(at={})),function(i){i.ATTRIBUTES="ATTRIBUTES",i.TRIANGLES="TRIANGLES",i.INDICES="INDICES"}(qe||(qe={})),function(i){i.NONE="NONE",i.OCTAHEDRAL="OCTAHEDRAL",i.QUATERNION="QUATERNION",i.EXPONENTIAL="EXPONENTIAL"}(Q||(Q={}));const{BYTE:vi,SHORT:En,FLOAT:Ri}=te.ComponentType,{encodeNormalizedInt:In,decodeNormalizedInt:Nt}=ut;function Ni(i,e,t,n){const{filter:r,bits:o}=n,s={array:i.getArray(),byteStride:i.getElementSize()*i.getComponentSize(),componentType:i.getComponentType(),normalized:i.getNormalized()};if(t!==qe.ATTRIBUTES)return s;if(r!==Q.NONE){let a=i.getNormalized()?function(f){const d=f.getComponentType(),p=f.getArray(),m=new Float32Array(p.length);for(let w=0;w<p.length;w++)m[w]=Nt(p[w],d);return m}(i):new Float32Array(s.array);switch(r){case Q.EXPONENTIAL:s.byteStride=4*i.getElementSize(),s.componentType=Ri,s.normalized=!1,s.array=e.encodeFilterExp(a,i.getCount(),s.byteStride,o);break;case Q.OCTAHEDRAL:s.byteStride=o>8?8:4,s.componentType=o>8?En:vi,s.normalized=!0,a=i.getElementSize()===3?function(f){const d=new Float32Array(4*f.length/3);for(let p=0,m=f.length/3;p<m;p++)d[4*p]=f[3*p],d[4*p+1]=f[3*p+1],d[4*p+2]=f[3*p+2];return d}(a):a,s.array=e.encodeFilterOct(a,i.getCount(),s.byteStride,o);break;case Q.QUATERNION:s.byteStride=8,s.componentType=En,s.normalized=!0,s.array=e.encodeFilterQuat(a,i.getCount(),s.byteStride,o);break;default:throw new Error("Invalid filter.")}s.min=i.getMin([]),s.max=i.getMax([]),i.getNormalized()&&(s.min=s.min.map(f=>Nt(f,i.getComponentType())),s.max=s.max.map(f=>Nt(f,i.getComponentType()))),s.normalized&&(s.min=s.min.map(f=>In(f,s.componentType)),s.max=s.max.map(f=>In(f,s.componentType)))}else s.byteStride%4&&(s.array=function(a,f){const d=Te.padNumber(a.BYTES_PER_ELEMENT*f)/a.BYTES_PER_ELEMENT,p=new a.constructor(a.length/f*d);for(let m=0;m*f<a.length;m++)for(let w=0;w<f;w++)p[m*d+w]=a[m*f+w];return p}(s.array,i.getElementSize()),s.byteStride=s.array.byteLength/i.getCount());return s}function Ai(i,e){return e===Mt.BufferViewUsage.ELEMENT_ARRAY_BUFFER?i.listParents().some(t=>t instanceof kt&&t.getMode()===kt.Mode.TRIANGLES)?qe.TRIANGLES:qe.INDICES:qe.ATTRIBUTES}function Si(i,e){const t=e.getGraph().listParentEdges(i).filter(n=>!(n.getParent()instanceof ni));for(const n of t){const r=n.getName(),o=n.getAttributes().key||"",s=n.getParent().propertyType===j.PRIMITIVE_TARGET;if(r==="indices")return{filter:Q.NONE};if(r==="attributes"){if(o==="POSITION")return{filter:Q.NONE};if(o==="TEXCOORD_0")return{filter:Q.NONE};if(o.startsWith("JOINTS_"))return{filter:Q.NONE};if(o.startsWith("WEIGHTS_"))return{filter:Q.NONE};if(o==="NORMAL"||o==="TANGENT")return s?{filter:Q.NONE}:{filter:Q.OCTAHEDRAL,bits:8}}if(r==="output"){const a=ir(i);return a==="rotation"?{filter:Q.QUATERNION,bits:16}:a==="translation"||a==="scale"?{filter:Q.EXPONENTIAL,bits:12}:{filter:Q.NONE}}if(r==="input")return{filter:Q.NONE};if(r==="inverseBindMatrices")return{filter:Q.NONE}}return{filter:Q.NONE}}function ir(i){for(const e of i.listParents())if(e instanceof ri){for(const t of e.listParents())if(t instanceof ii)return t.getTargetPath()}return null}const fe=Ct,vn={method:at.QUANTIZE};let Ot=class extends Z{constructor(...e){super(...e),this.extensionName=fe,this.prereadTypes=[j.BUFFER,j.PRIMITIVE],this.prewriteTypes=[j.BUFFER,j.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=vn,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,t){return e==="meshopt.decoder"&&(this._decoder=t),e==="meshopt.encoder"&&(this._encoder=t),this}setEncoderOptions(e){return this._encoderOptions=Re({},vn,e),this}preread(e,t){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${fe}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${fe}]: Missing WASM support.`)}return t===j.BUFFER?this._prereadBuffers(e):t===j.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach((n,r)=>{if(!n.extensions||!n.extensions[fe])return;const o=n.extensions[fe],s=o.byteOffset||0,a=o.byteLength||0,f=o.count,d=o.byteStride,p=new Uint8Array(f*d),m=t.json.buffers[o.buffer],w=Te.toView(m.uri?t.resources[m.uri]:t.resources[er],s,a);this._decoder.decodeGltfBuffer(p,f,d,w,o.mode,o.filter),e.bufferViews[r]=p})}_prereadPrimitives(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach(n=>{var r;n.extensions&&n.extensions[fe]&&(r=t.json.buffers[n.buffer]).extensions&&r.extensions[Ct]&&r.extensions[Ct].fallback&&this._decoderFallbackBufferMap.set(e.buffers[n.buffer],e.buffers[n.extensions[fe].buffer])})}read(e){if(!this.isRequired())return this;for(const[t,n]of this._decoderFallbackBufferMap){for(const r of t.listParents())r instanceof te&&r.swap(t,n);t.dispose()}return this}prewrite(e,t){return t===j.ACCESSOR?this._prewriteAccessors(e):t===j.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const t=e.jsonDoc.json,n=this._encoder,r=this._encoderOptions,o=this.document.createBuffer(),s=this.document.getRoot().listBuffers().indexOf(o);this._encoderFallbackBuffer=o,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const a of this.document.getRoot().listAccessors()){if(ir(a)==="weights"||a.getSparse())continue;const f=e.getAccessorUsage(a),d=Ai(a,f),p=r.method===at.FILTER?Si(a,this.document):{filter:Q.NONE},m=Ni(a,n,d,p),{array:w,byteStride:b}=m,l=a.getBuffer();if(!l)throw new Error(`${fe}: Missing buffer for accessor.`);const _=this.document.getRoot().listBuffers().indexOf(l),c=[f,d,p.filter,b,_].join(":");let u=this._encoderBufferViews[c],x=this._encoderBufferViewData[c],g=this._encoderBufferViewAccessors[c];u&&x||(g=this._encoderBufferViewAccessors[c]=[],x=this._encoderBufferViewData[c]=[],u=this._encoderBufferViews[c]={buffer:s,target:Mt.USAGE_TO_TARGET[f],byteOffset:0,byteLength:0,byteStride:f===Mt.BufferViewUsage.ARRAY_BUFFER?b:void 0,extensions:{[fe]:{buffer:_,byteOffset:0,byteLength:0,mode:d,filter:p.filter!==Q.NONE?p.filter:void 0,byteStride:b,count:0}}});const h=e.createAccessorDef(a);h.componentType=m.componentType,h.normalized=m.normalized,h.byteOffset=u.byteLength,h.min&&m.min&&(h.min=m.min),h.max&&m.max&&(h.max=m.max),e.accessorIndexMap.set(a,t.accessors.length),t.accessors.push(h),g.push(h),x.push(new Uint8Array(w.buffer,w.byteOffset,w.byteLength)),u.byteLength+=w.byteLength,u.extensions.EXT_meshopt_compression.count+=a.getCount()}}_prewriteBuffers(e){const t=this._encoder;for(const n in this._encoderBufferViews){const r=this._encoderBufferViews[n],o=this._encoderBufferViewData[n],s=this.document.getRoot().listBuffers()[r.extensions[fe].buffer],a=e.otherBufferViews.get(s)||[],{count:f,byteStride:d,mode:p}=r.extensions[fe],m=Te.concat(o),w=t.encodeGltfBuffer(m,f,d,p),b=Te.pad(w);r.extensions[fe].byteLength=w.byteLength,o.length=0,o.push(b),a.push(b),e.otherBufferViews.set(s,a)}}write(e){let t=0;for(const s in this._encoderBufferViews){const a=this._encoderBufferViews[s],f=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[s][0]),d=this._encoderBufferViewAccessors[s];for(const w of d)w.bufferView=f;const p=e.jsonDoc.json.bufferViews[f],m=p.byteOffset||0;Object.assign(p,a),p.byteOffset=t,p.extensions[fe].byteOffset=m,t+=Te.padNumber(a.byteLength)}const n=this._encoderFallbackBuffer,r=e.bufferIndexMap.get(n),o=e.jsonDoc.json.buffers[r];return o.byteLength=t,o.extensions={[fe]:{fallback:!0}},n.dispose(),this}};Ot.EXTENSION_NAME=fe,Ot.EncoderMethod=at;const rt="EXT_texture_avif";let Di=class{match(e){return e.length>=12&&Te.decodeText(e.slice(4,12))==="ftypavif"}getSize(e){if(!this.match(e))return null;const t=new DataView(e.buffer,e.byteOffset,e.byteLength);let n=Rn(t,0);if(!n)return null;let r=n.end;for(;n=Rn(t,r);)if(n.type==="meta")r=n.start+4;else if(n.type==="iprp"||n.type==="ipco")r=n.start;else{if(n.type==="ispe")return[t.getUint32(n.start+4),t.getUint32(n.start+8)];if(n.type==="mdat")break;r=n.end}return null}getChannels(e){return 4}},sr=class extends Z{constructor(...e){super(...e),this.extensionName=rt,this.prereadTypes=[j.TEXTURE]}static register(){Zt.registerFormat("image/avif",new Di)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(t=>{t.extensions&&t.extensions[rt]&&(t.source=t.extensions[rt].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/avif"){const r=e.imageIndexMap.get(n);(t.json.textures||[]).forEach(o=>{o.source===r&&(o.extensions=o.extensions||{},o.extensions[rt]={source:o.source},delete o.source)})}}),this}};function Rn(i,e){if(i.byteLength<4+e)return null;const t=i.getUint32(e);return i.byteLength<t+e||t<8?null:{type:Te.decodeText(new Uint8Array(i.buffer,i.byteOffset+e+4,4)),start:e+8,end:e+t}}sr.EXTENSION_NAME=rt;const it="EXT_texture_webp";let Mi=class{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const t=Te.decodeText(e.slice(0,4)),n=Te.decodeText(e.slice(8,12));if(t!=="RIFF"||n!=="WEBP")return null;const r=new DataView(e.buffer,e.byteOffset);let o=12;for(;o<r.byteLength;){const s=Te.decodeText(new Uint8Array([r.getUint8(o),r.getUint8(o+1),r.getUint8(o+2),r.getUint8(o+3)])),a=r.getUint32(o+4,!0);if(s==="VP8 ")return[16383&r.getInt16(o+14,!0),16383&r.getInt16(o+16,!0)];if(s==="VP8L"){const f=r.getUint8(o+9),d=r.getUint8(o+10),p=r.getUint8(o+11);return[1+((63&d)<<8|f),1+((15&r.getUint8(o+12))<<10|p<<2|(192&d)>>6)]}o+=8+a+a%2}return null}getChannels(e){return 4}},or=class extends Z{constructor(...e){super(...e),this.extensionName=it,this.prereadTypes=[j.TEXTURE]}static register(){Zt.registerFormat("image/webp",new Mi)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(t=>{t.extensions&&t.extensions[it]&&(t.source=t.extensions[it].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/webp"){const r=e.imageIndexMap.get(n);(t.json.textures||[]).forEach(o=>{o.source===r&&(o.extensions=o.extensions||{},o.extensions[it]={source:o.source},delete o.source)})}}),this}};or.EXTENSION_NAME=it;const Nn=tr;let re,ar,cr,xe;function ki(i,e){const t=new re.DecoderBuffer;try{if(t.Init(e,e.length),i.GetEncodedGeometryType(t)!==re.TRIANGULAR_MESH)throw new Error(`[${Nn}] Unknown geometry type.`);const n=new re.Mesh;if(!i.DecodeBufferToMesh(t,n).ok()||n.ptr===0)throw new Error(`[${Nn}] Decoding failure.`);return n}finally{re.destroy(t)}}function Ci(i,e){const t=3*e.num_faces();let n,r;if(e.num_points()<=65534){const o=t*Uint16Array.BYTES_PER_ELEMENT;n=re._malloc(o),i.GetTrianglesUInt16Array(e,o,n),r=new Uint16Array(re.HEAPU16.buffer,n,t).slice()}else{const o=t*Uint32Array.BYTES_PER_ELEMENT;n=re._malloc(o),i.GetTrianglesUInt32Array(e,o,n),r=new Uint32Array(re.HEAPU32.buffer,n,t).slice()}return re._free(n),r}function Ui(i,e,t,n){const r=cr[n.componentType],o=ar[n.componentType],s=t.num_components(),a=e.num_points()*s,f=a*o.BYTES_PER_ELEMENT,d=re._malloc(f);i.GetAttributeDataArrayForAllPoints(e,t,r,f,d);const p=new o(re.HEAPF32.buffer,d,a).slice();return re._free(d),p}var ct,ge;(function(i){i[i.EDGEBREAKER=1]="EDGEBREAKER",i[i.SEQUENTIAL=0]="SEQUENTIAL"})(ct||(ct={})),function(i){i.POSITION="POSITION",i.NORMAL="NORMAL",i.COLOR="COLOR",i.TEX_COORD="TEX_COORD",i.GENERIC="GENERIC"}(ge||(ge={}));const ur={[ge.POSITION]:14,[ge.NORMAL]:10,[ge.COLOR]:8,[ge.TEX_COORD]:12,[ge.GENERIC]:12},An={decodeSpeed:5,encodeSpeed:5,method:ct.EDGEBREAKER,quantizationBits:ur,quantizationVolume:"mesh"};function Oi(i,e=An){const t=Re({},An,e);t.quantizationBits=Re({},ur,e.quantizationBits);const n=new xe.MeshBuilder,r=new xe.Mesh,o=new xe.ExpertEncoder(r),s={},a=new xe.DracoInt8Array,f=i.listTargets().length>0;let d=!1;for(const _ of i.listSemantics()){const c=i.getAttribute(_);if(c.getSparse()){d=!0;continue}const u=Fi(_),x=Bi(n,c.getComponentType(),r,xe[u],c.getCount(),c.getElementSize(),c.getArray());if(x===-1)throw new Error(`Error compressing "${_}" attribute.`);if(s[_]=x,t.quantizationVolume==="mesh"||_!=="POSITION")o.SetAttributeQuantization(x,t.quantizationBits[u]);else{if(typeof t.quantizationVolume!="object")throw new Error("Invalid quantization volume state.");{const{quantizationVolume:g}=t,h=Math.max(g.max[0]-g.min[0],g.max[1]-g.min[1],g.max[2]-g.min[2]);o.SetAttributeExplicitQuantization(x,t.quantizationBits[u],c.getElementSize(),g.min,h)}}}const p=i.getIndices();if(!p)throw new Ft("Primitive must have indices.");n.AddFacesToMesh(r,p.getCount()/3,p.getArray()),o.SetSpeedOptions(t.encodeSpeed,t.decodeSpeed),o.SetTrackEncodedProperties(!0),o.SetEncodingMethod(t.method===ct.SEQUENTIAL||f||d?xe.MESH_SEQUENTIAL_ENCODING:xe.MESH_EDGEBREAKER_ENCODING);const m=o.EncodeToDracoBuffer(!(f||d),a);if(m<=0)throw new Ft("Error applying Draco compression.");const w=new Uint8Array(m);for(let _=0;_<m;++_)w[_]=a.GetValue(_);const b=o.GetNumberOfEncodedPoints(),l=3*o.GetNumberOfEncodedFaces();return xe.destroy(a),xe.destroy(r),xe.destroy(n),xe.destroy(o),{numVertices:b,numIndices:l,data:w,attributeIDs:s}}function Fi(i){return i==="POSITION"?ge.POSITION:i==="NORMAL"?ge.NORMAL:i.startsWith("COLOR_")?ge.COLOR:i.startsWith("TEXCOORD_")?ge.TEX_COORD:ge.GENERIC}function Bi(i,e,t,n,r,o,s){switch(e){case te.ComponentType.UNSIGNED_BYTE:return i.AddUInt8Attribute(t,n,r,o,s);case te.ComponentType.BYTE:return i.AddInt8Attribute(t,n,r,o,s);case te.ComponentType.UNSIGNED_SHORT:return i.AddUInt16Attribute(t,n,r,o,s);case te.ComponentType.SHORT:return i.AddInt16Attribute(t,n,r,o,s);case te.ComponentType.UNSIGNED_INT:return i.AddUInt32Attribute(t,n,r,o,s);case te.ComponentType.FLOAT:return i.AddFloatAttribute(t,n,r,o,s);default:throw new Error(`Unexpected component type, "${e}".`)}}class Ft extends Error{}const Y=tr;class Bt extends Z{constructor(...e){super(...e),this.extensionName=Y,this.prereadTypes=[j.PRIMITIVE],this.prewriteTypes=[j.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,t){return e==="draco3d.decoder"&&(this._decoderModule=t,re=this._decoderModule,ar={[te.ComponentType.FLOAT]:Float32Array,[te.ComponentType.UNSIGNED_INT]:Uint32Array,[te.ComponentType.UNSIGNED_SHORT]:Uint16Array,[te.ComponentType.UNSIGNED_BYTE]:Uint8Array,[te.ComponentType.SHORT]:Int16Array,[te.ComponentType.BYTE]:Int8Array},cr={[te.ComponentType.FLOAT]:re.DT_FLOAT32,[te.ComponentType.UNSIGNED_INT]:re.DT_UINT32,[te.ComponentType.UNSIGNED_SHORT]:re.DT_UINT16,[te.ComponentType.UNSIGNED_BYTE]:re.DT_UINT8,[te.ComponentType.SHORT]:re.DT_INT16,[te.ComponentType.BYTE]:re.DT_INT8}),e==="draco3d.encoder"&&(this._encoderModule=t,xe=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${Y}] Please install extension dependency, "draco3d.decoder".`);const t=this.document.getLogger(),n=e.jsonDoc,r=new Map;try{const o=n.json.meshes||[];for(const s of o)for(const a of s.primitives){if(!a.extensions||!a.extensions[Y])continue;const f=a.extensions[Y];let[d,p]=r.get(f.bufferView)||[];if(!p||!d){const m=n.json.bufferViews[f.bufferView],w=n.json.buffers[m.buffer],b=Te.toView(w.uri?n.resources[w.uri]:n.resources[er],m.byteOffset||0,m.byteLength);d=new this._decoderModule.Decoder,p=ki(d,b),r.set(f.bufferView,[d,p]),t.debug(`[${Y}] Decompressed ${b.byteLength} bytes.`)}for(const m in a.attributes){const w=e.jsonDoc.json.accessors[a.attributes[m]],b=d.GetAttributeByUniqueId(p,f.attributes[m]),l=Ui(d,p,b,w);e.accessors[a.attributes[m]].setArray(l)}a.indices!==void 0&&e.accessors[a.indices].setArray(Ci(d,p))}}finally{for(const[o,s]of Array.from(r.values()))this._decoderModule.destroy(o),this._decoderModule.destroy(s)}return this}read(e){return this}prewrite(e,t){if(!this._encoderModule)throw new Error(`[${Y}] Please install extension dependency, "draco3d.encoder".`);const n=this.document.getLogger();n.debug(`[${Y}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const r=function(a){const f=a.getLogger(),d=new Set,p=new Set;for(const c of a.getRoot().listMeshes())for(const u of c.listPrimitives())u.getIndices()?u.getMode()!==kt.Mode.TRIANGLES?(p.add(u),f.warn(`[${Y}] Skipping Draco compression on non-TRIANGLES primitive.`)):d.add(u):(p.add(u),f.warn(`[${Y}] Skipping Draco compression on non-indexed primitive.`));const m=a.getRoot().listAccessors(),w=new Map;for(let c=0;c<m.length;c++)w.set(m[c],c);const b=new Map,l=new Set,_=new Map;for(const c of Array.from(d)){let u=Sn(c,w);if(l.has(u))_.set(c,u);else{if(b.has(c.getIndices())){const x=c.getIndices(),g=x.clone();w.set(g,a.getRoot().listAccessors().length-1),c.swap(x,g)}for(const x of c.listAttributes())if(b.has(x)){const g=x.clone();w.set(g,a.getRoot().listAccessors().length-1),c.swap(x,g)}u=Sn(c,w),l.add(u),_.set(c,u),b.set(c.getIndices(),u);for(const x of c.listAttributes())b.set(x,u)}}for(const c of Array.from(b.keys())){const u=new Set(c.listParents().map(x=>x.propertyType));if(u.size!==2||!u.has(j.PRIMITIVE)||!u.has(j.ROOT))throw new Error(`[${Y}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const c of Array.from(d)){const u=_.get(c),x=c.getIndices();if(b.get(x)!==u||c.listAttributes().some(g=>b.get(g)!==u))throw new Error(`[${Y}] Draco primitives must share all, or no, accessors.`)}for(const c of Array.from(p)){const u=c.getIndices();if(b.has(u)||c.listAttributes().some(x=>b.has(x)))throw new Error(`[${Y}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return _}(this.document),o=new Map;let s="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?n.warn(`[${Y}]: quantizationVolume=scene requires exactly 1 scene.`):s=ti(this.document.getRoot().listScenes().pop()));for(const a of Array.from(r.keys())){const f=r.get(a);if(!f)throw new Error("Unexpected primitive.");if(o.has(f)){o.set(f,o.get(f));continue}const d=a.getIndices(),p=e.jsonDoc.json.accessors;let m;try{m=Oi(a,Re({},this._encoderOptions,{quantizationVolume:s}))}catch(l){if(l instanceof Ft){n.warn(`[${Y}]: ${l.message} Skipping primitive compression.`);continue}throw l}o.set(f,m);const w=e.createAccessorDef(d);w.count=m.numIndices,e.accessorIndexMap.set(d,p.length),p.push(w);for(const l of a.listSemantics()){const _=a.getAttribute(l);if(m.attributeIDs[l]===void 0)continue;const c=e.createAccessorDef(_);c.count=m.numVertices,e.accessorIndexMap.set(_,p.length),p.push(c)}const b=a.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(b)||e.otherBufferViews.set(b,[]),e.otherBufferViews.get(b).push(m.data)}return n.debug(`[${Y}] Compressed ${r.size} primitives.`),e.extensionData[Y]={primitiveHashMap:r,primitiveEncodingMap:o},this}write(e){const t=e.extensionData[Y];for(const n of this.document.getRoot().listMeshes()){const r=e.jsonDoc.json.meshes[e.meshIndexMap.get(n)];for(let o=0;o<n.listPrimitives().length;o++){const s=n.listPrimitives()[o],a=r.primitives[o],f=t.primitiveHashMap.get(s);if(!f)continue;const d=t.primitiveEncodingMap.get(f);d&&(a.extensions=a.extensions||{},a.extensions[Y]={bufferView:e.otherBufferViewsIndexMap.get(d.data),attributes:d.attributeIDs})}}if(!t.primitiveHashMap.size){const n=e.jsonDoc.json;n.extensionsUsed=(n.extensionsUsed||[]).filter(r=>r!==Y),n.extensionsRequired=(n.extensionsRequired||[]).filter(r=>r!==Y)}return this}}function Sn(i,e){const t=[],n=i.getIndices();t.push(e.get(n));for(const r of i.listAttributes())t.push(e.get(r));return t.sort().join("|")}Bt.EXTENSION_NAME=Y,Bt.EncoderMethod=ct;let Tt=class lr extends ae{init(){this.extensionName=Qt,this.propertyType="Light",this.parentTypes=[j.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:lr.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return Ee.factorToHex(this.getColor())}setColorHex(e){const t=this.getColor().slice();return Ee.hexToFactor(e,t),this.setColor(t)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}};Tt.EXTENSION_NAME=Qt,Tt.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const we=Qt;let fr=class extends Z{constructor(...e){super(...e),this.extensionName=we}createLight(e=""){return new Tt(this.document.getGraph(),e)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[we])return this;const n=(t.json.extensions[we].lights||[]).map(r=>{var o,s;const a=this.createLight().setName(r.name||"").setType(r.type);return r.color!==void 0&&a.setColor(r.color),r.intensity!==void 0&&a.setIntensity(r.intensity),r.range!==void 0&&a.setRange(r.range),((o=r.spot)==null?void 0:o.innerConeAngle)!==void 0&&a.setInnerConeAngle(r.spot.innerConeAngle),((s=r.spot)==null?void 0:s.outerConeAngle)!==void 0&&a.setOuterConeAngle(r.spot.outerConeAngle),a});return t.json.nodes.forEach((r,o)=>{r.extensions&&r.extensions[we]&&e.nodes[o].setExtension(we,n[r.extensions[we].light])}),this}write(e){const t=e.jsonDoc;if(this.properties.size===0)return this;const n=[],r=new Map;for(const o of this.properties){const s=o,a={type:s.getType()};ut.eq(s.getColor(),[1,1,1])||(a.color=s.getColor()),s.getIntensity()!==1&&(a.intensity=s.getIntensity()),s.getRange()!=null&&(a.range=s.getRange()),s.getName()&&(a.name=s.getName()),s.getType()===Tt.Type.SPOT&&(a.spot={innerConeAngle:s.getInnerConeAngle(),outerConeAngle:s.getOuterConeAngle()}),n.push(a),r.set(s,n.length-1)}return this.document.getRoot().listNodes().forEach(o=>{const s=o.getExtension(we);if(s){const a=e.nodeIndexMap.get(o),f=t.json.nodes[a];f.extensions=f.extensions||{},f.extensions[we]={light:r.get(s)}}}),t.json.extensions=t.json.extensions||{},t.json.extensions[we]={lights:n},this}};fr.EXTENSION_NAME=we;const{R:Li,G:ji,B:zi}=De;class dr extends ae{init(){this.extensionName=Jt,this.propertyType="Anisotropy",this.parentTypes=[j.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new he(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(e){return this.set("anisotropyStrength",e)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(e){return this.set("anisotropyRotation",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:Li|ji|zi})}}dr.EXTENSION_NAME=Jt;const ke=Jt;class hr extends Z{constructor(...e){super(...e),this.extensionName=ke}createAnisotropy(){return new dr(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((r,o)=>{if(r.extensions&&r.extensions[ke]){const s=this.createAnisotropy();e.materials[o].setExtension(ke,s);const a=r.extensions[ke];if(a.anisotropyStrength!==void 0&&s.setAnisotropyStrength(a.anisotropyStrength),a.anisotropyRotation!==void 0&&s.setAnisotropyRotation(a.anisotropyRotation),a.anisotropyTexture!==void 0){const f=a.anisotropyTexture;s.setAnisotropyTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getAnisotropyTextureInfo(),f)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(ke);if(r){const o=e.materialIndexMap.get(n),s=t.json.materials[o];s.extensions=s.extensions||{};const a=s.extensions[ke]={};if(r.getAnisotropyStrength()>0&&(a.anisotropyStrength=r.getAnisotropyStrength()),r.getAnisotropyRotation()!==0&&(a.anisotropyRotation=r.getAnisotropyRotation()),r.getAnisotropyTexture()){const f=r.getAnisotropyTexture(),d=r.getAnisotropyTextureInfo();a.anisotropyTexture=e.createTextureInfoDef(f,d)}}}),this}}hr.EXTENSION_NAME=ke;const{R:Dn,G:Mn,B:Pi}=De;class pr extends ae{init(){this.extensionName=en,this.propertyType="Clearcoat",this.parentTypes=[j.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new he(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new he(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new he(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:Dn})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:Mn})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:Dn|Mn|Pi})}}pr.EXTENSION_NAME=en;const Ce=en;class xr extends Z{constructor(...e){super(...e),this.extensionName=Ce}createClearcoat(){return new pr(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((r,o)=>{if(r.extensions&&r.extensions[Ce]){const s=this.createClearcoat();e.materials[o].setExtension(Ce,s);const a=r.extensions[Ce];if(a.clearcoatFactor!==void 0&&s.setClearcoatFactor(a.clearcoatFactor),a.clearcoatRoughnessFactor!==void 0&&s.setClearcoatRoughnessFactor(a.clearcoatRoughnessFactor),a.clearcoatTexture!==void 0){const f=a.clearcoatTexture;s.setClearcoatTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getClearcoatTextureInfo(),f)}if(a.clearcoatRoughnessTexture!==void 0){const f=a.clearcoatRoughnessTexture;s.setClearcoatRoughnessTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getClearcoatRoughnessTextureInfo(),f)}if(a.clearcoatNormalTexture!==void 0){const f=a.clearcoatNormalTexture;s.setClearcoatNormalTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getClearcoatNormalTextureInfo(),f),f.scale!==void 0&&s.setClearcoatNormalScale(f.scale)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(Ce);if(r){const o=e.materialIndexMap.get(n),s=t.json.materials[o];s.extensions=s.extensions||{};const a=s.extensions[Ce]={clearcoatFactor:r.getClearcoatFactor(),clearcoatRoughnessFactor:r.getClearcoatRoughnessFactor()};if(r.getClearcoatTexture()){const f=r.getClearcoatTexture(),d=r.getClearcoatTextureInfo();a.clearcoatTexture=e.createTextureInfoDef(f,d)}if(r.getClearcoatRoughnessTexture()){const f=r.getClearcoatRoughnessTexture(),d=r.getClearcoatRoughnessTextureInfo();a.clearcoatRoughnessTexture=e.createTextureInfoDef(f,d)}if(r.getClearcoatNormalTexture()){const f=r.getClearcoatNormalTexture(),d=r.getClearcoatNormalTextureInfo();a.clearcoatNormalTexture=e.createTextureInfoDef(f,d),r.getClearcoatNormalScale()!==1&&(a.clearcoatNormalTexture.scale=r.getClearcoatNormalScale())}}}),this}}xr.EXTENSION_NAME=Ce;class gr extends ae{init(){this.extensionName=tn,this.propertyType="EmissiveStrength",this.parentTypes=[j.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}gr.EXTENSION_NAME=tn;const Ue=tn;class _r extends Z{constructor(...e){super(...e),this.extensionName=Ue}createEmissiveStrength(){return new gr(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,n)=>{if(t.extensions&&t.extensions[Ue]){const r=this.createEmissiveStrength();e.materials[n].setExtension(Ue,r);const o=t.extensions[Ue];o.emissiveStrength!==void 0&&r.setEmissiveStrength(o.emissiveStrength)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(Ue);if(r){const o=e.materialIndexMap.get(n),s=t.json.materials[o];s.extensions=s.extensions||{},s.extensions[Ue]={emissiveStrength:r.getEmissiveStrength()}}}),this}}_r.EXTENSION_NAME=Ue;class mr extends ae{init(){this.extensionName=nn,this.propertyType="IOR",this.parentTypes=[j.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}mr.EXTENSION_NAME=nn;const Oe=nn;class Tr extends Z{constructor(...e){super(...e),this.extensionName=Oe}createIOR(){return new mr(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,n)=>{if(t.extensions&&t.extensions[Oe]){const r=this.createIOR();e.materials[n].setExtension(Oe,r);const o=t.extensions[Oe];o.ior!==void 0&&r.setIOR(o.ior)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(Oe);if(r){const o=e.materialIndexMap.get(n),s=t.json.materials[o];s.extensions=s.extensions||{},s.extensions[Oe]={ior:r.getIOR()}}}),this}}Tr.EXTENSION_NAME=Oe;const{R:Gi,G:$i}=De;class yr extends ae{init(){this.extensionName=rn,this.propertyType="Iridescence",this.parentTypes=[j.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new he(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new he(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:Gi})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:$i})}}yr.EXTENSION_NAME=rn;const Fe=rn;class wr extends Z{constructor(...e){super(...e),this.extensionName=Fe}createIridescence(){return new yr(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((r,o)=>{if(r.extensions&&r.extensions[Fe]){const s=this.createIridescence();e.materials[o].setExtension(Fe,s);const a=r.extensions[Fe];if(a.iridescenceFactor!==void 0&&s.setIridescenceFactor(a.iridescenceFactor),a.iridescenceIor!==void 0&&s.setIridescenceIOR(a.iridescenceIor),a.iridescenceThicknessMinimum!==void 0&&s.setIridescenceThicknessMinimum(a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&s.setIridescenceThicknessMaximum(a.iridescenceThicknessMaximum),a.iridescenceTexture!==void 0){const f=a.iridescenceTexture;s.setIridescenceTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getIridescenceTextureInfo(),f)}if(a.iridescenceThicknessTexture!==void 0){const f=a.iridescenceThicknessTexture;s.setIridescenceThicknessTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getIridescenceThicknessTextureInfo(),f)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(Fe);if(r){const o=e.materialIndexMap.get(n),s=t.json.materials[o];s.extensions=s.extensions||{};const a=s.extensions[Fe]={};if(r.getIridescenceFactor()>0&&(a.iridescenceFactor=r.getIridescenceFactor()),r.getIridescenceIOR()!==1.3&&(a.iridescenceIor=r.getIridescenceIOR()),r.getIridescenceThicknessMinimum()!==100&&(a.iridescenceThicknessMinimum=r.getIridescenceThicknessMinimum()),r.getIridescenceThicknessMaximum()!==400&&(a.iridescenceThicknessMaximum=r.getIridescenceThicknessMaximum()),r.getIridescenceTexture()){const f=r.getIridescenceTexture(),d=r.getIridescenceTextureInfo();a.iridescenceTexture=e.createTextureInfoDef(f,d)}if(r.getIridescenceThicknessTexture()){const f=r.getIridescenceThicknessTexture(),d=r.getIridescenceThicknessTextureInfo();a.iridescenceThicknessTexture=e.createTextureInfoDef(f,d)}}}),this}}wr.EXTENSION_NAME=Fe;const{R:kn,G:Cn,B:Un,A:On}=De;class br extends ae{init(){this.extensionName=sn,this.propertyType="PBRSpecularGlossiness",this.parentTypes=[j.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new he(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new he(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return Ee.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const t=this.getDiffuseFactor().slice();return this.setDiffuseFactor(Ee.hexToFactor(e,t))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:kn|Cn|Un|On,isColor:!0})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:kn|Cn|Un|On})}}br.EXTENSION_NAME=sn;const Be=sn;class Er extends Z{constructor(...e){super(...e),this.extensionName=Be}createPBRSpecularGlossiness(){return new br(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((r,o)=>{if(r.extensions&&r.extensions[Be]){const s=this.createPBRSpecularGlossiness();e.materials[o].setExtension(Be,s);const a=r.extensions[Be];if(a.diffuseFactor!==void 0&&s.setDiffuseFactor(a.diffuseFactor),a.specularFactor!==void 0&&s.setSpecularFactor(a.specularFactor),a.glossinessFactor!==void 0&&s.setGlossinessFactor(a.glossinessFactor),a.diffuseTexture!==void 0){const f=a.diffuseTexture;s.setDiffuseTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getDiffuseTextureInfo(),f)}if(a.specularGlossinessTexture!==void 0){const f=a.specularGlossinessTexture;s.setSpecularGlossinessTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getSpecularGlossinessTextureInfo(),f)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(Be);if(r){const o=e.materialIndexMap.get(n),s=t.json.materials[o];s.extensions=s.extensions||{};const a=s.extensions[Be]={diffuseFactor:r.getDiffuseFactor(),specularFactor:r.getSpecularFactor(),glossinessFactor:r.getGlossinessFactor()};if(r.getDiffuseTexture()){const f=r.getDiffuseTexture(),d=r.getDiffuseTextureInfo();a.diffuseTexture=e.createTextureInfoDef(f,d)}if(r.getSpecularGlossinessTexture()){const f=r.getSpecularGlossinessTexture(),d=r.getSpecularGlossinessTextureInfo();a.specularGlossinessTexture=e.createTextureInfoDef(f,d)}}}),this}}Er.EXTENSION_NAME=Be;const{R:Vi,G:Hi,B:Xi,A:Wi}=De;class Ir extends ae{init(){this.extensionName=on,this.propertyType="Sheen",this.parentTypes=[j.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new he(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new he(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return Ee.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const t=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",Ee.hexToFactor(e,t))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:Vi|Hi|Xi,isColor:!0})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:Wi})}}Ir.EXTENSION_NAME=on;const Le=on;class vr extends Z{constructor(...e){super(...e),this.extensionName=Le}createSheen(){return new Ir(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((r,o)=>{if(r.extensions&&r.extensions[Le]){const s=this.createSheen();e.materials[o].setExtension(Le,s);const a=r.extensions[Le];if(a.sheenColorFactor!==void 0&&s.setSheenColorFactor(a.sheenColorFactor),a.sheenRoughnessFactor!==void 0&&s.setSheenRoughnessFactor(a.sheenRoughnessFactor),a.sheenColorTexture!==void 0){const f=a.sheenColorTexture;s.setSheenColorTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getSheenColorTextureInfo(),f)}if(a.sheenRoughnessTexture!==void 0){const f=a.sheenRoughnessTexture;s.setSheenRoughnessTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getSheenRoughnessTextureInfo(),f)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(Le);if(r){const o=e.materialIndexMap.get(n),s=t.json.materials[o];s.extensions=s.extensions||{};const a=s.extensions[Le]={sheenColorFactor:r.getSheenColorFactor(),sheenRoughnessFactor:r.getSheenRoughnessFactor()};if(r.getSheenColorTexture()){const f=r.getSheenColorTexture(),d=r.getSheenColorTextureInfo();a.sheenColorTexture=e.createTextureInfoDef(f,d)}if(r.getSheenRoughnessTexture()){const f=r.getSheenRoughnessTexture(),d=r.getSheenRoughnessTextureInfo();a.sheenRoughnessTexture=e.createTextureInfoDef(f,d)}}}),this}}vr.EXTENSION_NAME=Le;const{R:Ki,G:qi,B:Zi,A:Yi}=De;class Rr extends ae{init(){this.extensionName=an,this.propertyType="Specular",this.parentTypes=[j.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new he(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new he(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return Ee.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const t=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",Ee.hexToFactor(e,t))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:Yi})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:Ki|qi|Zi,isColor:!0})}}Rr.EXTENSION_NAME=an;const je=an;class Nr extends Z{constructor(...e){super(...e),this.extensionName=je}createSpecular(){return new Rr(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((r,o)=>{if(r.extensions&&r.extensions[je]){const s=this.createSpecular();e.materials[o].setExtension(je,s);const a=r.extensions[je];if(a.specularFactor!==void 0&&s.setSpecularFactor(a.specularFactor),a.specularColorFactor!==void 0&&s.setSpecularColorFactor(a.specularColorFactor),a.specularTexture!==void 0){const f=a.specularTexture;s.setSpecularTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getSpecularTextureInfo(),f)}if(a.specularColorTexture!==void 0){const f=a.specularColorTexture;s.setSpecularColorTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getSpecularColorTextureInfo(),f)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(je);if(r){const o=e.materialIndexMap.get(n),s=t.json.materials[o];s.extensions=s.extensions||{};const a=s.extensions[je]={};if(r.getSpecularFactor()!==1&&(a.specularFactor=r.getSpecularFactor()),ut.eq(r.getSpecularColorFactor(),[1,1,1])||(a.specularColorFactor=r.getSpecularColorFactor()),r.getSpecularTexture()){const f=r.getSpecularTexture(),d=r.getSpecularTextureInfo();a.specularTexture=e.createTextureInfoDef(f,d)}if(r.getSpecularColorTexture()){const f=r.getSpecularColorTexture(),d=r.getSpecularColorTextureInfo();a.specularColorTexture=e.createTextureInfoDef(f,d)}}}),this}}Nr.EXTENSION_NAME=je;const{R:Qi}=De;class Ar extends ae{init(){this.extensionName=cn,this.propertyType="Transmission",this.parentTypes=[j.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new he(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:Qi})}}Ar.EXTENSION_NAME=cn;const ze=cn;class Sr extends Z{constructor(...e){super(...e),this.extensionName=ze}createTransmission(){return new Ar(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((r,o)=>{if(r.extensions&&r.extensions[ze]){const s=this.createTransmission();e.materials[o].setExtension(ze,s);const a=r.extensions[ze];if(a.transmissionFactor!==void 0&&s.setTransmissionFactor(a.transmissionFactor),a.transmissionTexture!==void 0){const f=a.transmissionTexture;s.setTransmissionTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getTransmissionTextureInfo(),f)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(ze);if(r){const o=e.materialIndexMap.get(n),s=t.json.materials[o];s.extensions=s.extensions||{};const a=s.extensions[ze]={transmissionFactor:r.getTransmissionFactor()};if(r.getTransmissionTexture()){const f=r.getTransmissionTexture(),d=r.getTransmissionTextureInfo();a.transmissionTexture=e.createTextureInfoDef(f,d)}}}),this}}Sr.EXTENSION_NAME=ze;class Dr extends ae{init(){this.extensionName=un,this.propertyType="Unlit",this.parentTypes=[j.MATERIAL]}}Dr.EXTENSION_NAME=un;const We=un;class Mr extends Z{constructor(...e){super(...e),this.extensionName=We}createUnlit(){return new Dr(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,n)=>{t.extensions&&t.extensions[We]&&e.materials[n].setExtension(We,this.createUnlit())}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{if(n.getExtension(We)){const r=e.materialIndexMap.get(n),o=t.json.materials[r];o.extensions=o.extensions||{},o.extensions[We]={}}}),this}}Mr.EXTENSION_NAME=We;class kr extends ae{init(){this.extensionName=$e,this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}kr.EXTENSION_NAME=$e;class Cr extends ae{init(){this.extensionName=$e,this.propertyType="MappingList",this.parentTypes=[j.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}Cr.EXTENSION_NAME=$e;class Lt extends ae{init(){this.extensionName=$e,this.propertyType="Variant",this.parentTypes=["MappingList"]}}Lt.EXTENSION_NAME=$e;const be=$e;class Ur extends Z{constructor(...e){super(...e),this.extensionName=be}createMappingList(){return new Cr(this.document.getGraph())}createVariant(e=""){return new Lt(this.document.getGraph(),e)}createMapping(){return new kr(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof Lt)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[be])return this;const n=(t.json.extensions[be].variants||[]).map(r=>this.createVariant().setName(r.name||""));return(t.json.meshes||[]).forEach((r,o)=>{const s=e.meshes[o];(r.primitives||[]).forEach((a,f)=>{if(!a.extensions||!a.extensions[be])return;const d=this.createMappingList(),p=a.extensions[be];for(const m of p.mappings){const w=this.createMapping();m.material!==void 0&&w.setMaterial(e.materials[m.material]);for(const b of m.variants||[])w.addVariant(n[b]);d.addMapping(w)}s.listPrimitives()[f].setExtension(be,d)})}),this}write(e){const t=e.jsonDoc,n=this.listVariants();if(!n.length)return this;const r=[],o=new Map;for(const s of n)o.set(s,r.length),r.push(e.createPropertyDef(s));for(const s of this.document.getRoot().listMeshes()){const a=e.meshIndexMap.get(s);s.listPrimitives().forEach((f,d)=>{const p=f.getExtension(be);if(!p)return;const m=e.jsonDoc.json.meshes[a].primitives[d],w=p.listMappings().map(b=>{const l=e.createPropertyDef(b),_=b.getMaterial();return _&&(l.material=e.materialIndexMap.get(_)),l.variants=b.listVariants().map(c=>o.get(c)),l});m.extensions=m.extensions||{},m.extensions[be]={mappings:w}})}return t.json.extensions=t.json.extensions||{},t.json.extensions[be]={variants:r},this}}Ur.EXTENSION_NAME=be;const{G:Ji}=De;class Or extends ae{init(){this.extensionName=ln,this.propertyType="Volume",this.parentTypes=[j.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new he(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:Ji})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return Ee.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const t=this.getAttenuationColor().slice();return this.set("attenuationColor",Ee.hexToFactor(e,t))}}Or.EXTENSION_NAME=ln;const Pe=ln;class Fr extends Z{constructor(...e){super(...e),this.extensionName=Pe}createVolume(){return new Or(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((r,o)=>{if(r.extensions&&r.extensions[Pe]){const s=this.createVolume();e.materials[o].setExtension(Pe,s);const a=r.extensions[Pe];if(a.thicknessFactor!==void 0&&s.setThicknessFactor(a.thicknessFactor),a.attenuationDistance!==void 0&&s.setAttenuationDistance(a.attenuationDistance),a.attenuationColor!==void 0&&s.setAttenuationColor(a.attenuationColor),a.thicknessTexture!==void 0){const f=a.thicknessTexture;s.setThicknessTexture(e.textures[n[f.index].source]),e.setTextureInfo(s.getThicknessTextureInfo(),f)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(Pe);if(r){const o=e.materialIndexMap.get(n),s=t.json.materials[o];s.extensions=s.extensions||{};const a=s.extensions[Pe]={};if(r.getThicknessFactor()>0&&(a.thicknessFactor=r.getThicknessFactor()),Number.isFinite(r.getAttenuationDistance())&&(a.attenuationDistance=r.getAttenuationDistance()),ut.eq(r.getAttenuationColor(),[1,1,1])||(a.attenuationColor=r.getAttenuationColor()),r.getThicknessTexture()){const f=r.getThicknessTexture(),d=r.getThicknessTextureInfo();a.thicknessTexture=e.createTextureInfoDef(f,d)}}}),this}}Fr.EXTENSION_NAME=Pe;const Br="KHR_mesh_quantization";class Lr extends Z{constructor(...e){super(...e),this.extensionName=Br}read(e){return this}write(e){return this}}Lr.EXTENSION_NAME=Br;const st="KHR_texture_basisu";class es{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const t=Rt(e);return[t.pixelWidth,t.pixelHeight]}getChannels(e){const t=Rt(e).dataFormatDescriptor[0];if(t.colorModel===_i)return t.samples.length===2&&(15&t.samples[1].channelType)==15?4:3;if(t.colorModel===mi)return(15&t.samples[0].channelType)==3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${t.colorModel}".`)}getVRAMByteLength(e){const t=Rt(e),n=this.getChannels(e)>3;let r=0;for(let o=0;o<t.levels.length;o++){const s=t.levels[o];r+=s.uncompressedByteLength?s.uncompressedByteLength:Math.max(1,Math.floor(t.pixelWidth/Math.pow(2,o)))/4*(Math.max(1,Math.floor(t.pixelHeight/Math.pow(2,o)))/4)*(n?16:8)}return r}}class jr extends Z{constructor(...e){super(...e),this.extensionName=st,this.prereadTypes=[j.TEXTURE]}static register(){Zt.registerFormat("image/ktx2",new es)}preread(e){return e.jsonDoc.json.textures.forEach(t=>{t.extensions&&t.extensions[st]&&(t.source=t.extensions[st].source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/ktx2"){const r=e.imageIndexMap.get(n);t.json.textures.forEach(o=>{o.source===r&&(o.extensions=o.extensions||{},o.extensions[st]={source:o.source},delete o.source)})}}),this}}jr.EXTENSION_NAME=st;class zr extends ae{init(){this.extensionName=fn,this.propertyType="Transform",this.parentTypes=[j.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}zr.EXTENSION_NAME=fn;const Ge=fn;class Pr extends Z{constructor(...e){super(...e),this.extensionName=Ge}createTransform(){return new zr(this.document.getGraph())}read(e){for(const[t,n]of Array.from(e.textureInfos.entries())){if(!n.extensions||!n.extensions[Ge])continue;const r=this.createTransform(),o=n.extensions[Ge];o.offset!==void 0&&r.setOffset(o.offset),o.rotation!==void 0&&r.setRotation(o.rotation),o.scale!==void 0&&r.setScale(o.scale),o.texCoord!==void 0&&r.setTexCoord(o.texCoord),t.setExtension(Ge,r)}return this}write(e){const t=Array.from(e.textureInfoDefMap.entries());for(const[n,r]of t){const o=n.getExtension(Ge);if(!o)continue;r.extensions=r.extensions||{};const s={},a=ut.eq;a(o.getOffset(),[0,0])||(s.offset=o.getOffset()),o.getRotation()!==0&&(s.rotation=o.getRotation()),a(o.getScale(),[1,1])||(s.scale=o.getScale()),o.getTexCoord()!=null&&(s.texCoord=o.getTexCoord()),r.extensions[Ge]=s}return this}}Pr.EXTENSION_NAME=Ge;const ts=[j.ROOT,j.SCENE,j.NODE,j.MESH,j.MATERIAL,j.TEXTURE,j.ANIMATION];class Gr extends ae{init(){this.extensionName=mt,this.propertyType="Packet",this.parentTypes=ts}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",Re({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const t=this.get("properties");return e in t?t[e]:null}setProperty(e,t){this._assertContext(e);const n=Re({},this.get("properties"));return t?n[e]=t:delete n[e],this.set("properties",n)}toJSONLD(){return Re({"@context":At(this.get("context"))},At(this.get("properties")))}fromJSONLD(e){const t=(e=At(e))["@context"];return t&&this.set("context",t),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`${mt}: Missing context for term, "${e}".`)}}function At(i){return JSON.parse(JSON.stringify(i))}Gr.EXTENSION_NAME=mt;const Ie=mt;class $r extends Z{constructor(...e){super(...e),this.extensionName=Ie}createPacket(){return new Gr(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var t;const n=(t=e.jsonDoc.json.extensions)==null?void 0:t[Ie];if(!n||!n.packets)return this;const r=e.jsonDoc.json,o=this.document.getRoot(),s=n.packets.map(d=>this.createPacket().fromJSONLD(d)),a=[[r.asset],r.scenes,r.nodes,r.meshes,r.materials,r.images,r.animations],f=[[o],o.listScenes(),o.listNodes(),o.listMeshes(),o.listMaterials(),o.listTextures(),o.listAnimations()];for(let d=0;d<a.length;d++){const p=a[d]||[];for(let m=0;m<p.length;m++){const w=p[m];w.extensions&&w.extensions[Ie]&&f[d][m].setExtension(Ie,s[w.extensions[Ie].packet])}}return this}write(e){const{json:t}=e.jsonDoc,n=[];for(const r of this.properties){n.push(r.toJSONLD());for(const o of r.listParents()){let s;switch(o.propertyType){case j.ROOT:s=t.asset;break;case j.SCENE:s=t.scenes[e.sceneIndexMap.get(o)];break;case j.NODE:s=t.nodes[e.nodeIndexMap.get(o)];break;case j.MESH:s=t.meshes[e.meshIndexMap.get(o)];break;case j.MATERIAL:s=t.materials[e.materialIndexMap.get(o)];break;case j.TEXTURE:s=t.images[e.imageIndexMap.get(o)];break;case j.ANIMATION:s=t.animations[e.animationIndexMap.get(o)];break;default:s=null,this.document.getLogger().warn(`[${Ie}]: Unsupported parent property, "${o.propertyType}"`)}s&&(s.extensions=s.extensions||{},s.extensions[Ie]={packet:n.length-1})}}return n.length>0&&(t.extensions=t.extensions||{},t.extensions[Ie]={packets:n}),this}}$r.EXTENSION_NAME=Ie;const Vr=[Bt,fr,hr,xr,_r,Tr,wr,Er,Nr,vr,Sr,Mr,Ur,Fr,Lr,jr,Pr,$r];[...Vr];var Fn=[0,1,2,3,4,4,5,5,6,6,6,6,7,7,7,7,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,0,0,16,17,18,18,19,19,20,20,20,20,21,21,21,21,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29];function q(){var i=this;function e(t,n){var r=0;do r|=1&t,t>>>=1,r<<=1;while(--n>0);return r>>>1}i.build_tree=function(t){var n,r,o,s=i.dyn_tree,a=i.stat_desc.static_tree,f=i.stat_desc.elems,d=-1;for(t.heap_len=0,t.heap_max=573,n=0;n<f;n++)s[2*n]!==0?(t.heap[++t.heap_len]=d=n,t.depth[n]=0):s[2*n+1]=0;for(;t.heap_len<2;)s[2*(o=t.heap[++t.heap_len]=d<2?++d:0)]=1,t.depth[o]=0,t.opt_len--,a&&(t.static_len-=a[2*o+1]);for(i.max_code=d,n=Math.floor(t.heap_len/2);n>=1;n--)t.pqdownheap(s,n);o=f;do n=t.heap[1],t.heap[1]=t.heap[t.heap_len--],t.pqdownheap(s,1),r=t.heap[1],t.heap[--t.heap_max]=n,t.heap[--t.heap_max]=r,s[2*o]=s[2*n]+s[2*r],t.depth[o]=Math.max(t.depth[n],t.depth[r])+1,s[2*n+1]=s[2*r+1]=o,t.heap[1]=o++,t.pqdownheap(s,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(p){var m,w,b,l,_,c,u=i.dyn_tree,x=i.stat_desc.static_tree,g=i.stat_desc.extra_bits,h=i.stat_desc.extra_base,E=i.stat_desc.max_length,y=0;for(l=0;l<=15;l++)p.bl_count[l]=0;for(u[2*p.heap[p.heap_max]+1]=0,m=p.heap_max+1;m<573;m++)(l=u[2*u[2*(w=p.heap[m])+1]+1]+1)>E&&(l=E,y++),u[2*w+1]=l,w>i.max_code||(p.bl_count[l]++,_=0,w>=h&&(_=g[w-h]),p.opt_len+=(c=u[2*w])*(l+_),x&&(p.static_len+=c*(x[2*w+1]+_)));if(y!==0){do{for(l=E-1;p.bl_count[l]===0;)l--;p.bl_count[l]--,p.bl_count[l+1]+=2,p.bl_count[E]--,y-=2}while(y>0);for(l=E;l!==0;l--)for(w=p.bl_count[l];w!==0;)(b=p.heap[--m])>i.max_code||(u[2*b+1]!=l&&(p.opt_len+=(l-u[2*b+1])*u[2*b],u[2*b+1]=l),w--)}}(t),function(p,m,w){var b,l,_,c=[],u=0;for(b=1;b<=15;b++)c[b]=u=u+w[b-1]<<1;for(l=0;l<=m;l++)(_=p[2*l+1])!==0&&(p[2*l]=e(c[_]++,_))}(s,i.max_code,t.bl_count)}}function ce(i,e,t,n,r){var o=this;o.static_tree=i,o.extra_bits=e,o.extra_base=t,o.elems=n,o.max_length=r}function ye(i,e,t,n,r){var o=this;o.good_length=i,o.max_lazy=e,o.nice_length=t,o.max_chain=n,o.func=r}q._length_code=[0,1,2,3,4,5,6,7,8,8,9,9,10,10,11,11,12,12,12,12,13,13,13,13,14,14,14,14,15,15,15,15,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28],q.base_length=[0,1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56,64,80,96,112,128,160,192,224,0],q.base_dist=[0,1,2,3,4,6,8,12,16,24,32,48,64,96,128,192,256,384,512,768,1024,1536,2048,3072,4096,6144,8192,12288,16384,24576],q.d_code=function(i){return i<256?Fn[i]:Fn[256+(i>>>7)]},q.extra_lbits=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],q.extra_dbits=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],q.extra_blbits=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],q.bl_order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],ce.static_ltree=[12,8,140,8,76,8,204,8,44,8,172,8,108,8,236,8,28,8,156,8,92,8,220,8,60,8,188,8,124,8,252,8,2,8,130,8,66,8,194,8,34,8,162,8,98,8,226,8,18,8,146,8,82,8,210,8,50,8,178,8,114,8,242,8,10,8,138,8,74,8,202,8,42,8,170,8,106,8,234,8,26,8,154,8,90,8,218,8,58,8,186,8,122,8,250,8,6,8,134,8,70,8,198,8,38,8,166,8,102,8,230,8,22,8,150,8,86,8,214,8,54,8,182,8,118,8,246,8,14,8,142,8,78,8,206,8,46,8,174,8,110,8,238,8,30,8,158,8,94,8,222,8,62,8,190,8,126,8,254,8,1,8,129,8,65,8,193,8,33,8,161,8,97,8,225,8,17,8,145,8,81,8,209,8,49,8,177,8,113,8,241,8,9,8,137,8,73,8,201,8,41,8,169,8,105,8,233,8,25,8,153,8,89,8,217,8,57,8,185,8,121,8,249,8,5,8,133,8,69,8,197,8,37,8,165,8,101,8,229,8,21,8,149,8,85,8,213,8,53,8,181,8,117,8,245,8,13,8,141,8,77,8,205,8,45,8,173,8,109,8,237,8,29,8,157,8,93,8,221,8,61,8,189,8,125,8,253,8,19,9,275,9,147,9,403,9,83,9,339,9,211,9,467,9,51,9,307,9,179,9,435,9,115,9,371,9,243,9,499,9,11,9,267,9,139,9,395,9,75,9,331,9,203,9,459,9,43,9,299,9,171,9,427,9,107,9,363,9,235,9,491,9,27,9,283,9,155,9,411,9,91,9,347,9,219,9,475,9,59,9,315,9,187,9,443,9,123,9,379,9,251,9,507,9,7,9,263,9,135,9,391,9,71,9,327,9,199,9,455,9,39,9,295,9,167,9,423,9,103,9,359,9,231,9,487,9,23,9,279,9,151,9,407,9,87,9,343,9,215,9,471,9,55,9,311,9,183,9,439,9,119,9,375,9,247,9,503,9,15,9,271,9,143,9,399,9,79,9,335,9,207,9,463,9,47,9,303,9,175,9,431,9,111,9,367,9,239,9,495,9,31,9,287,9,159,9,415,9,95,9,351,9,223,9,479,9,63,9,319,9,191,9,447,9,127,9,383,9,255,9,511,9,0,7,64,7,32,7,96,7,16,7,80,7,48,7,112,7,8,7,72,7,40,7,104,7,24,7,88,7,56,7,120,7,4,7,68,7,36,7,100,7,20,7,84,7,52,7,116,7,3,8,131,8,67,8,195,8,35,8,163,8,99,8,227,8],ce.static_dtree=[0,5,16,5,8,5,24,5,4,5,20,5,12,5,28,5,2,5,18,5,10,5,26,5,6,5,22,5,14,5,30,5,1,5,17,5,9,5,25,5,5,5,21,5,13,5,29,5,3,5,19,5,11,5,27,5,7,5,23,5],ce.static_l_desc=new ce(ce.static_ltree,q.extra_lbits,257,286,15),ce.static_d_desc=new ce(ce.static_dtree,q.extra_dbits,0,30,15),ce.static_bl_desc=new ce(null,q.extra_blbits,0,19,7);var me=[new ye(0,0,0,0,0),new ye(4,4,8,4,1),new ye(4,5,16,8,1),new ye(4,6,32,32,1),new ye(4,4,16,16,2),new ye(8,16,32,32,2),new ye(8,16,128,128,2),new ye(8,32,128,256,2),new ye(32,128,258,1024,2),new ye(32,258,258,4096,2)],lt=["need dictionary","stream end","","","stream error","data error","","buffer error","",""];function Bn(i,e,t,n){var r=i[2*e],o=i[2*t];return r<o||r==o&&n[e]<=n[t]}function ns(){var i,e,t,n,r,o,s,a,f,d,p,m,w,b,l,_,c,u,x,g,h,E,y,T,N,O,R,v,I,C,B,z,U,W,de,ne,F,ie,$,H,se,P=this,Ye=new q,Qe=new q,It=new q;function pn(){var D;for(D=0;D<286;D++)B[2*D]=0;for(D=0;D<30;D++)z[2*D]=0;for(D=0;D<19;D++)U[2*D]=0;B[512]=1,P.opt_len=P.static_len=0,ne=ie=0}function xn(D,A){var k,M,S=-1,L=D[1],G=0,V=7,X=4;for(L===0&&(V=138,X=3),D[2*(A+1)+1]=65535,k=0;k<=A;k++)M=L,L=D[2*(k+1)+1],++G<V&&M==L||(G<X?U[2*M]+=G:M!==0?(M!=S&&U[2*M]++,U[32]++):G<=10?U[34]++:U[36]++,G=0,S=M,L===0?(V=138,X=3):M==L?(V=6,X=3):(V=7,X=4))}function Ve(D){P.pending_buf[P.pending++]=D}function Je(D){Ve(255&D),Ve(D>>>8&255)}function ue(D,A){var k,M=A;se>16-M?(Je(H|=(k=D)<<se&65535),H=k>>>16-se,se+=M-16):(H|=D<<se&65535,se+=M)}function _e(D,A){var k=2*D;ue(65535&A[k],65535&A[k+1])}function gn(D,A){var k,M,S=-1,L=D[1],G=0,V=7,X=4;for(L===0&&(V=138,X=3),k=0;k<=A;k++)if(M=L,L=D[2*(k+1)+1],!(++G<V&&M==L)){if(G<X)do _e(M,U);while(--G!=0);else M!==0?(M!=S&&(_e(M,U),G--),_e(16,U),ue(G-3,2)):G<=10?(_e(17,U),ue(G-3,3)):(_e(18,U),ue(G-11,7));G=0,S=M,L===0?(V=138,X=3):M==L?(V=6,X=3):(V=7,X=4)}}function _n(){se==16?(Je(H),H=0,se=0):se>=8&&(Ve(255&H),H>>>=8,se-=8)}function et(D,A){var k,M,S;if(P.pending_buf[F+2*ne]=D>>>8&255,P.pending_buf[F+2*ne+1]=255&D,P.pending_buf[W+ne]=255&A,ne++,D===0?B[2*A]++:(ie++,D--,B[2*(q._length_code[A]+256+1)]++,z[2*q.d_code(D)]++),(8191&ne)==0&&R>2){for(k=8*ne,M=h-c,S=0;S<30;S++)k+=z[2*S]*(5+q.extra_dbits[S]);if(k>>>=3,ie<Math.floor(ne/2)&&k<Math.floor(M/2))return!0}return ne==de-1}function mn(D,A){var k,M,S,L,G=0;if(ne!==0)do k=P.pending_buf[F+2*G]<<8&65280|255&P.pending_buf[F+2*G+1],M=255&P.pending_buf[W+G],G++,k===0?_e(M,D):(_e((S=q._length_code[M])+256+1,D),(L=q.extra_lbits[S])!==0&&ue(M-=q.base_length[S],L),k--,_e(S=q.d_code(k),A),(L=q.extra_dbits[S])!==0&&ue(k-=q.base_dist[S],L));while(G<ne);_e(256,D),$=D[513]}function Tn(){se>8?Je(H):se>0&&Ve(255&H),H=0,se=0}function yn(D,A,k){ue(0+(k?1:0),3),function(M,S,L){Tn(),$=8,Je(S),Je(~S),P.pending_buf.set(a.subarray(M,M+S),P.pending),P.pending+=S}(D,A)}function Ne(D){(function(A,k,M){var S,L,G=0;R>0?(Ye.build_tree(P),Qe.build_tree(P),G=function(){var V;for(xn(B,Ye.max_code),xn(z,Qe.max_code),It.build_tree(P),V=18;V>=3&&U[2*q.bl_order[V]+1]===0;V--);return P.opt_len+=3*(V+1)+5+5+4,V}(),(L=P.static_len+3+7>>>3)<=(S=P.opt_len+3+7>>>3)&&(S=L)):S=L=k+5,k+4<=S&&A!=-1?yn(A,k,M):L==S?(ue(2+(M?1:0),3),mn(ce.static_ltree,ce.static_dtree)):(ue(4+(M?1:0),3),function(V,X,J){var ee;for(ue(V-257,5),ue(X-1,5),ue(J-4,4),ee=0;ee<J;ee++)ue(U[2*q.bl_order[ee]+1],3);gn(B,V-1),gn(z,X-1)}(Ye.max_code+1,Qe.max_code+1,G+1),mn(B,z)),pn(),M&&Tn()})(c>=0?c:-1,h-c,D),c=h,i.flush_pending()}function vt(){var D,A,k,M;do{if((M=f-y-h)==0&&h===0&&y===0)M=r;else if(M==-1)M--;else if(h>=r+r-262){a.set(a.subarray(r,r+r),0),E-=r,h-=r,c-=r,k=D=w;do A=65535&p[--k],p[k]=A>=r?A-r:0;while(--D!=0);k=D=r;do A=65535&d[--k],d[k]=A>=r?A-r:0;while(--D!=0);M+=r}if(i.avail_in===0)return;D=i.read_buf(a,h+y,M),(y+=D)>=3&&(m=((m=255&a[h])<<_^255&a[h+1])&l)}while(y<262&&i.avail_in!==0)}function wn(D){var A,k,M=N,S=h,L=T,G=h>r-262?h-(r-262):0,V=C,X=s,J=h+258,ee=a[S+L-1],Ae=a[S+L];T>=I&&(M>>=2),V>y&&(V=y);do if(a[(A=D)+L]==Ae&&a[A+L-1]==ee&&a[A]==a[S]&&a[++A]==a[S+1]){S+=2,A++;do;while(a[++S]==a[++A]&&a[++S]==a[++A]&&a[++S]==a[++A]&&a[++S]==a[++A]&&a[++S]==a[++A]&&a[++S]==a[++A]&&a[++S]==a[++A]&&a[++S]==a[++A]&&S<J);if(k=258-(J-S),S=J-258,k>L){if(E=D,L=k,k>=V)break;ee=a[S+L-1],Ae=a[S+L]}}while((D=65535&d[D&X])>G&&--M!=0);return L<=y?L:y}P.depth=[],P.bl_count=[],P.heap=[],B=[],z=[],U=[],P.pqdownheap=function(D,A){for(var k=P.heap,M=k[A],S=A<<1;S<=P.heap_len&&(S<P.heap_len&&Bn(D,k[S+1],k[S],P.depth)&&S++,!Bn(D,M,k[S],P.depth));)k[A]=k[S],A=S,S<<=1;k[A]=M},P.deflateInit=function(D,A,k,M,S,L){return M||(M=8),S||(S=8),L||(L=0),D.msg=null,A==-1&&(A=6),S<1||S>9||M!=8||k<9||k>15||A<0||A>9||L<0||L>2?-2:(D.dstate=P,s=(r=1<<(o=k))-1,l=(w=1<<(b=S+7))-1,_=Math.floor((b+3-1)/3),a=new Uint8Array(2*r),d=[],p=[],de=1<<S+6,P.pending_buf=new Uint8Array(4*de),t=4*de,F=Math.floor(de/2),W=3*de,R=A,v=L,function(G){return G.total_in=G.total_out=0,G.msg=null,P.pending=0,P.pending_out=0,e=113,n=0,Ye.dyn_tree=B,Ye.stat_desc=ce.static_l_desc,Qe.dyn_tree=z,Qe.stat_desc=ce.static_d_desc,It.dyn_tree=U,It.stat_desc=ce.static_bl_desc,H=0,se=0,$=8,pn(),function(){var V;for(f=2*r,p[w-1]=0,V=0;V<w-1;V++)p[V]=0;O=me[R].max_lazy,I=me[R].good_length,C=me[R].nice_length,N=me[R].max_chain,h=0,c=0,y=0,u=T=2,g=0,m=0}(),0}(D))},P.deflateEnd=function(){return e!=42&&e!=113&&e!=666?-2:(P.pending_buf=null,p=null,d=null,a=null,P.dstate=null,e==113?-3:0)},P.deflateParams=function(D,A,k){var M=0;return A==-1&&(A=6),A<0||A>9||k<0||k>2?-2:(me[R].func!=me[A].func&&D.total_in!==0&&(M=D.deflate(1)),R!=A&&(O=me[R=A].max_lazy,I=me[R].good_length,C=me[R].nice_length,N=me[R].max_chain),v=k,M)},P.deflateSetDictionary=function(D,A,k){var M,S=k,L=0;if(!A||e!=42)return-2;if(S<3)return 0;for(S>r-262&&(L=k-(S=r-262)),a.set(A.subarray(L,L+S),0),h=S,c=S,m=((m=255&a[0])<<_^255&a[1])&l,M=0;M<=S-3;M++)d[M&s]=p[m=(m<<_^255&a[M+2])&l],p[m]=M;return 0},P.deflate=function(D,A){var k,M,S,L,G,V;if(A>4||A<0)return-2;if(!D.next_out||!D.next_in&&D.avail_in!==0||e==666&&A!=4)return D.msg=lt[4],-2;if(D.avail_out===0)return D.msg=lt[7],-5;if(i=D,L=n,n=A,e==42&&(M=8+(o-8<<4)<<8,(S=(R-1&255)>>1)>3&&(S=3),M|=S<<6,h!==0&&(M|=32),e=113,Ve((V=M+=31-M%31)>>8&255),Ve(255&V)),P.pending!==0){if(i.flush_pending(),i.avail_out===0)return n=-1,0}else if(i.avail_in===0&&A<=L&&A!=4)return i.msg=lt[7],-5;if(e==666&&i.avail_in!==0)return D.msg=lt[7],-5;if(i.avail_in!==0||y!==0||A!=0&&e!=666){switch(G=-1,me[R].func){case 0:G=function(X){var J,ee=65535;for(ee>t-5&&(ee=t-5);;){if(y<=1){if(vt(),y===0&&X==0)return 0;if(y===0)break}if(h+=y,y=0,J=c+ee,(h===0||h>=J)&&(y=h-J,h=J,Ne(!1),i.avail_out===0)||h-c>=r-262&&(Ne(!1),i.avail_out===0))return 0}return Ne(X==4),i.avail_out===0?X==4?2:0:X==4?3:1}(A);break;case 1:G=function(X){for(var J,ee=0;;){if(y<262){if(vt(),y<262&&X==0)return 0;if(y===0)break}if(y>=3&&(ee=65535&p[m=(m<<_^255&a[h+2])&l],d[h&s]=p[m],p[m]=h),ee!==0&&(h-ee&65535)<=r-262&&v!=2&&(u=wn(ee)),u>=3)if(J=et(h-E,u-3),y-=u,u<=O&&y>=3){u--;do h++,ee=65535&p[m=(m<<_^255&a[h+2])&l],d[h&s]=p[m],p[m]=h;while(--u!=0);h++}else h+=u,u=0,m=((m=255&a[h])<<_^255&a[h+1])&l;else J=et(0,255&a[h]),y--,h++;if(J&&(Ne(!1),i.avail_out===0))return 0}return Ne(X==4),i.avail_out===0?X==4?2:0:X==4?3:1}(A);break;case 2:G=function(X){for(var J,ee,Ae=0;;){if(y<262){if(vt(),y<262&&X==0)return 0;if(y===0)break}if(y>=3&&(Ae=65535&p[m=(m<<_^255&a[h+2])&l],d[h&s]=p[m],p[m]=h),T=u,x=E,u=2,Ae!==0&&T<O&&(h-Ae&65535)<=r-262&&(v!=2&&(u=wn(Ae)),u<=5&&(v==1||u==3&&h-E>4096)&&(u=2)),T>=3&&u<=T){ee=h+y-3,J=et(h-1-x,T-3),y-=T-1,T-=2;do++h<=ee&&(Ae=65535&p[m=(m<<_^255&a[h+2])&l],d[h&s]=p[m],p[m]=h);while(--T!=0);if(g=0,u=2,h++,J&&(Ne(!1),i.avail_out===0))return 0}else if(g!==0){if((J=et(0,255&a[h-1]))&&Ne(!1),h++,y--,i.avail_out===0)return 0}else g=1,h++,y--}return g!==0&&(J=et(0,255&a[h-1]),g=0),Ne(X==4),i.avail_out===0?X==4?2:0:X==4?3:1}(A)}if(G!=2&&G!=3||(e=666),G==0||G==2)return i.avail_out===0&&(n=-1),0;if(G==1){if(A==1)ue(2,3),_e(256,ce.static_ltree),_n(),1+$+10-se<9&&(ue(2,3),_e(256,ce.static_ltree),_n()),$=7;else if(yn(0,0,!1),A==3)for(k=0;k<w;k++)p[k]=0;if(i.flush_pending(),i.avail_out===0)return n=-1,0}}return A!=4?0:1}}function Hr(){var i=this;i.next_in_index=0,i.next_out_index=0,i.avail_in=0,i.total_in=0,i.avail_out=0,i.total_out=0}function Xr(i){var e=new Hr,t=512,n=new Uint8Array(t),r=i?i.level:-1;r===void 0&&(r=-1),e.deflateInit(r),e.next_out=n,this.append=function(o,s){var a,f=[],d=0,p=0,m=0;if(o.length){e.next_in_index=0,e.next_in=o,e.avail_in=o.length;do{if(e.next_out_index=0,e.avail_out=t,e.deflate(0)!=0)throw new Error("deflating: "+e.msg);e.next_out_index&&f.push(e.next_out_index==t?new Uint8Array(n):new Uint8Array(n.subarray(0,e.next_out_index))),m+=e.next_out_index,s&&e.next_in_index>0&&e.next_in_index!=d&&(s(e.next_in_index),d=e.next_in_index)}while(e.avail_in>0||e.avail_out===0);return a=new Uint8Array(m),f.forEach(function(w){a.set(w,p),p+=w.length}),a}},this.flush=function(){var o,s,a=[],f=0,d=0;do{if(e.next_out_index=0,e.avail_out=t,(o=e.deflate(4))!=1&&o!=0)throw new Error("deflating: "+e.msg);t-e.avail_out>0&&a.push(new Uint8Array(n.subarray(0,e.next_out_index))),d+=e.next_out_index}while(e.avail_in>0||e.avail_out===0);return e.deflateEnd(),s=new Uint8Array(d),a.forEach(function(p){s.set(p,f),f+=p.length}),s}}Hr.prototype={deflateInit:function(i,e){var t=this;return t.dstate=new ns,e||(e=15),t.dstate.deflateInit(t,i,e)},deflate:function(i){var e=this;return e.dstate?e.dstate.deflate(e,i):-2},deflateEnd:function(){var i=this;if(!i.dstate)return-2;var e=i.dstate.deflateEnd();return i.dstate=null,e},deflateParams:function(i,e){var t=this;return t.dstate?t.dstate.deflateParams(t,i,e):-2},deflateSetDictionary:function(i,e){var t=this;return t.dstate?t.dstate.deflateSetDictionary(t,i,e):-2},read_buf:function(i,e,t){var n=this,r=n.avail_in;return r>t&&(r=t),r===0?0:(n.avail_in-=r,i.set(n.next_in.subarray(n.next_in_index,n.next_in_index+r),e),n.next_in_index+=r,n.total_in+=r,r)},flush_pending:function(){var i=this,e=i.dstate.pending;e>i.avail_out&&(e=i.avail_out),e!==0&&(i.next_out.set(i.dstate.pending_buf.subarray(i.dstate.pending_out,i.dstate.pending_out+e),i.next_out_index),i.next_out_index+=e,i.dstate.pending_out+=e,i.total_out+=e,i.avail_out-=e,i.dstate.pending-=e,i.dstate.pending===0&&(i.dstate.pending_out=0))}},self._zipjs_Deflater=Xr;var pe=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],rs=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],is=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],ss=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],os=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],as=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],cs=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];function jt(){var i,e,t,n,r,o;function s(f,d,p,m,w,b,l,_,c,u,x){var g,h,E,y,T,N,O,R,v,I,C,B,z,U,W;I=0,T=p;do t[f[d+I]]++,I++,T--;while(T!==0);if(t[0]==p)return l[0]=-1,_[0]=0,0;for(R=_[0],N=1;N<=15&&t[N]===0;N++);for(O=N,R<N&&(R=N),T=15;T!==0&&t[T]===0;T--);for(E=T,R>T&&(R=T),_[0]=R,U=1<<N;N<T;N++,U<<=1)if((U-=t[N])<0)return-3;if((U-=t[T])<0)return-3;for(t[T]+=U,o[1]=N=0,I=1,z=2;--T!=0;)o[z]=N+=t[I],z++,I++;T=0,I=0;do(N=f[d+I])!==0&&(x[o[N]++]=T),I++;while(++T<p);for(p=o[E],o[0]=T=0,I=0,y=-1,B=-R,r[0]=0,C=0,W=0;O<=E;O++)for(g=t[O];g--!=0;){for(;O>B+R;){if(y++,W=(W=E-(B+=R))>R?R:W,(h=1<<(N=O-B))>g+1&&(h-=g+1,z=O,N<W))for(;++N<W&&!((h<<=1)<=t[++z]);)h-=t[z];if(u[0]+(W=1<<N)>1440)return-3;r[y]=C=u[0],u[0]+=W,y!==0?(o[y]=T,n[0]=N,n[1]=R,n[2]=C-r[y-1]-(N=T>>>B-R),c.set(n,3*(r[y-1]+N))):l[0]=C}for(n[1]=O-B,I>=p?n[0]=192:x[I]<m?(n[0]=x[I]<256?0:96,n[2]=x[I++]):(n[0]=b[x[I]-m]+16+64,n[2]=w[x[I++]-m]),h=1<<O-B,N=T>>>B;N<W;N+=h)c.set(n,3*(C+N));for(N=1<<O-1;T&N;N>>>=1)T^=N;for(T^=N,v=(1<<B)-1;(T&v)!=o[y];)y--,v=(1<<(B-=R))-1}return U!==0&&E!=1?-5:0}function a(f){var d;for(i||(i=[],e=[],t=new Int32Array(16),n=[],r=new Int32Array(15),o=new Int32Array(16)),e.length<f&&(e=[]),d=0;d<f;d++)e[d]=0;for(d=0;d<16;d++)t[d]=0;for(d=0;d<3;d++)n[d]=0;r.set(t.subarray(0,15),0),o.set(t.subarray(0,16),0)}this.inflate_trees_bits=function(f,d,p,m,w){var b;return a(19),i[0]=0,(b=s(f,0,19,19,null,null,p,d,m,i,e))==-3?w.msg="oversubscribed dynamic bit lengths tree":b!=-5&&d[0]!==0||(w.msg="incomplete dynamic bit lengths tree",b=-3),b},this.inflate_trees_dynamic=function(f,d,p,m,w,b,l,_,c){var u;return a(288),i[0]=0,(u=s(p,0,f,257,ss,os,b,m,_,i,e))!=0||m[0]===0?(u==-3?c.msg="oversubscribed literal/length tree":u!=-4&&(c.msg="incomplete literal/length tree",u=-3),u):(a(288),(u=s(p,f,d,0,as,cs,l,w,_,i,e))!=0||w[0]===0&&f>257?(u==-3?c.msg="oversubscribed distance tree":u==-5?(c.msg="incomplete distance tree",u=-3):u!=-4&&(c.msg="empty distance tree with lengths",u=-3),u):0)}}function us(){var i,e,t,n,r=this,o=0,s=0,a=0,f=0,d=0,p=0,m=0,w=0,b=0,l=0;function _(c,u,x,g,h,E,y,T){var N,O,R,v,I,C,B,z,U,W,de,ne,F,ie,$,H;B=T.next_in_index,z=T.avail_in,I=y.bitb,C=y.bitk,W=(U=y.write)<y.read?y.read-U-1:y.end-U,de=pe[c],ne=pe[u];do{for(;C<20;)z--,I|=(255&T.read_byte(B++))<<C,C+=8;if((v=(O=x)[H=3*((R=g)+(N=I&de))])!==0)for(;;){if(I>>=O[H+1],C-=O[H+1],(16&v)!=0){for(F=O[H+2]+(I&pe[v&=15]),I>>=v,C-=v;C<15;)z--,I|=(255&T.read_byte(B++))<<C,C+=8;for(v=(O=h)[H=3*((R=E)+(N=I&ne))];;){if(I>>=O[H+1],C-=O[H+1],(16&v)!=0){for(v&=15;C<v;)z--,I|=(255&T.read_byte(B++))<<C,C+=8;if(ie=O[H+2]+(I&pe[v]),I>>=v,C-=v,W-=F,U>=ie)U-($=U-ie)>0&&2>U-$?(y.window[U++]=y.window[$++],y.window[U++]=y.window[$++],F-=2):(y.window.set(y.window.subarray($,$+2),U),U+=2,$+=2,F-=2);else{$=U-ie;do $+=y.end;while($<0);if(F>(v=y.end-$)){if(F-=v,U-$>0&&v>U-$)do y.window[U++]=y.window[$++];while(--v!=0);else y.window.set(y.window.subarray($,$+v),U),U+=v,$+=v,v=0;$=0}}if(U-$>0&&F>U-$)do y.window[U++]=y.window[$++];while(--F!=0);else y.window.set(y.window.subarray($,$+F),U),U+=F,$+=F,F=0;break}if(64&v)return T.msg="invalid distance code",z+=F=C>>3<(F=T.avail_in-z)?C>>3:F,B-=F,C-=F<<3,y.bitb=I,y.bitk=C,T.avail_in=z,T.total_in+=B-T.next_in_index,T.next_in_index=B,y.write=U,-3;N+=O[H+2],v=O[H=3*(R+(N+=I&pe[v]))]}break}if(64&v)return 32&v?(z+=F=C>>3<(F=T.avail_in-z)?C>>3:F,B-=F,C-=F<<3,y.bitb=I,y.bitk=C,T.avail_in=z,T.total_in+=B-T.next_in_index,T.next_in_index=B,y.write=U,1):(T.msg="invalid literal/length code",z+=F=C>>3<(F=T.avail_in-z)?C>>3:F,B-=F,C-=F<<3,y.bitb=I,y.bitk=C,T.avail_in=z,T.total_in+=B-T.next_in_index,T.next_in_index=B,y.write=U,-3);if(N+=O[H+2],(v=O[H=3*(R+(N+=I&pe[v]))])===0){I>>=O[H+1],C-=O[H+1],y.window[U++]=O[H+2],W--;break}}else I>>=O[H+1],C-=O[H+1],y.window[U++]=O[H+2],W--}while(W>=258&&z>=10);return z+=F=C>>3<(F=T.avail_in-z)?C>>3:F,B-=F,C-=F<<3,y.bitb=I,y.bitk=C,T.avail_in=z,T.total_in+=B-T.next_in_index,T.next_in_index=B,y.write=U,0}r.init=function(c,u,x,g,h,E){i=0,m=c,w=u,t=x,b=g,n=h,l=E,e=null},r.proc=function(c,u,x){var g,h,E,y,T,N,O,R=0,v=0,I=0;for(I=u.next_in_index,y=u.avail_in,R=c.bitb,v=c.bitk,N=(T=c.write)<c.read?c.read-T-1:c.end-T;;)switch(i){case 0:if(N>=258&&y>=10&&(c.bitb=R,c.bitk=v,u.avail_in=y,u.total_in+=I-u.next_in_index,u.next_in_index=I,c.write=T,x=_(m,w,t,b,n,l,c,u),I=u.next_in_index,y=u.avail_in,R=c.bitb,v=c.bitk,N=(T=c.write)<c.read?c.read-T-1:c.end-T,x!=0)){i=x==1?7:9;break}a=m,e=t,s=b,i=1;case 1:for(g=a;v<g;){if(y===0)return c.bitb=R,c.bitk=v,u.avail_in=y,u.total_in+=I-u.next_in_index,u.next_in_index=I,c.write=T,c.inflate_flush(u,x);x=0,y--,R|=(255&u.read_byte(I++))<<v,v+=8}if(R>>>=e[1+(h=3*(s+(R&pe[g])))],v-=e[h+1],(E=e[h])===0){f=e[h+2],i=6;break}if(16&E){d=15&E,o=e[h+2],i=2;break}if(!(64&E)){a=E,s=h/3+e[h+2];break}if(32&E){i=7;break}return i=9,u.msg="invalid literal/length code",x=-3,c.bitb=R,c.bitk=v,u.avail_in=y,u.total_in+=I-u.next_in_index,u.next_in_index=I,c.write=T,c.inflate_flush(u,x);case 2:for(g=d;v<g;){if(y===0)return c.bitb=R,c.bitk=v,u.avail_in=y,u.total_in+=I-u.next_in_index,u.next_in_index=I,c.write=T,c.inflate_flush(u,x);x=0,y--,R|=(255&u.read_byte(I++))<<v,v+=8}o+=R&pe[g],R>>=g,v-=g,a=w,e=n,s=l,i=3;case 3:for(g=a;v<g;){if(y===0)return c.bitb=R,c.bitk=v,u.avail_in=y,u.total_in+=I-u.next_in_index,u.next_in_index=I,c.write=T,c.inflate_flush(u,x);x=0,y--,R|=(255&u.read_byte(I++))<<v,v+=8}if(R>>=e[1+(h=3*(s+(R&pe[g])))],v-=e[h+1],(16&(E=e[h]))!=0){d=15&E,p=e[h+2],i=4;break}if(!(64&E)){a=E,s=h/3+e[h+2];break}return i=9,u.msg="invalid distance code",x=-3,c.bitb=R,c.bitk=v,u.avail_in=y,u.total_in+=I-u.next_in_index,u.next_in_index=I,c.write=T,c.inflate_flush(u,x);case 4:for(g=d;v<g;){if(y===0)return c.bitb=R,c.bitk=v,u.avail_in=y,u.total_in+=I-u.next_in_index,u.next_in_index=I,c.write=T,c.inflate_flush(u,x);x=0,y--,R|=(255&u.read_byte(I++))<<v,v+=8}p+=R&pe[g],R>>=g,v-=g,i=5;case 5:for(O=T-p;O<0;)O+=c.end;for(;o!==0;){if(N===0&&(T==c.end&&c.read!==0&&(N=(T=0)<c.read?c.read-T-1:c.end-T),N===0&&(c.write=T,x=c.inflate_flush(u,x),N=(T=c.write)<c.read?c.read-T-1:c.end-T,T==c.end&&c.read!==0&&(N=(T=0)<c.read?c.read-T-1:c.end-T),N===0)))return c.bitb=R,c.bitk=v,u.avail_in=y,u.total_in+=I-u.next_in_index,u.next_in_index=I,c.write=T,c.inflate_flush(u,x);c.window[T++]=c.window[O++],N--,O==c.end&&(O=0),o--}i=0;break;case 6:if(N===0&&(T==c.end&&c.read!==0&&(N=(T=0)<c.read?c.read-T-1:c.end-T),N===0&&(c.write=T,x=c.inflate_flush(u,x),N=(T=c.write)<c.read?c.read-T-1:c.end-T,T==c.end&&c.read!==0&&(N=(T=0)<c.read?c.read-T-1:c.end-T),N===0)))return c.bitb=R,c.bitk=v,u.avail_in=y,u.total_in+=I-u.next_in_index,u.next_in_index=I,c.write=T,c.inflate_flush(u,x);x=0,c.window[T++]=f,N--,i=0;break;case 7:if(v>7&&(v-=8,y++,I--),c.write=T,x=c.inflate_flush(u,x),N=(T=c.write)<c.read?c.read-T-1:c.end-T,c.read!=c.write)return c.bitb=R,c.bitk=v,u.avail_in=y,u.total_in+=I-u.next_in_index,u.next_in_index=I,c.write=T,c.inflate_flush(u,x);i=8;case 8:return x=1,c.bitb=R,c.bitk=v,u.avail_in=y,u.total_in+=I-u.next_in_index,u.next_in_index=I,c.write=T,c.inflate_flush(u,x);case 9:return x=-3,c.bitb=R,c.bitk=v,u.avail_in=y,u.total_in+=I-u.next_in_index,u.next_in_index=I,c.write=T,c.inflate_flush(u,x);default:return x=-2,c.bitb=R,c.bitk=v,u.avail_in=y,u.total_in+=I-u.next_in_index,u.next_in_index=I,c.write=T,c.inflate_flush(u,x)}},r.free=function(){}}jt.inflate_trees_fixed=function(i,e,t,n){return i[0]=9,e[0]=5,t[0]=rs,n[0]=is,0};var Ln=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function ls(i,e){var t,n=this,r=0,o=0,s=0,a=0,f=[0],d=[0],p=new us,m=0,w=new Int32Array(4320),b=new jt;n.bitk=0,n.bitb=0,n.window=new Uint8Array(e),n.end=e,n.read=0,n.write=0,n.reset=function(l,_){_&&(_[0]=0),r==6&&p.free(l),r=0,n.bitk=0,n.bitb=0,n.read=n.write=0},n.reset(i,null),n.inflate_flush=function(l,_){var c,u,x;return u=l.next_out_index,(c=((x=n.read)<=n.write?n.write:n.end)-x)>l.avail_out&&(c=l.avail_out),c!==0&&_==-5&&(_=0),l.avail_out-=c,l.total_out+=c,l.next_out.set(n.window.subarray(x,x+c),u),u+=c,(x+=c)==n.end&&(x=0,n.write==n.end&&(n.write=0),(c=n.write-x)>l.avail_out&&(c=l.avail_out),c!==0&&_==-5&&(_=0),l.avail_out-=c,l.total_out+=c,l.next_out.set(n.window.subarray(x,x+c),u),u+=c,x+=c),l.next_out_index=u,n.read=x,_},n.proc=function(l,_){var c,u,x,g,h,E,y,T;for(g=l.next_in_index,h=l.avail_in,u=n.bitb,x=n.bitk,y=(E=n.write)<n.read?n.read-E-1:n.end-E;;)switch(r){case 0:for(;x<3;){if(h===0)return n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,_);_=0,h--,u|=(255&l.read_byte(g++))<<x,x+=8}switch(m=1&(c=7&u),c>>>1){case 0:u>>>=3,u>>>=c=7&(x-=3),x-=c,r=1;break;case 1:var N=[],O=[],R=[[]],v=[[]];jt.inflate_trees_fixed(N,O,R,v),p.init(N[0],O[0],R[0],0,v[0],0),u>>>=3,x-=3,r=6;break;case 2:u>>>=3,x-=3,r=3;break;case 3:return u>>>=3,x-=3,r=9,l.msg="invalid block type",_=-3,n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,_)}break;case 1:for(;x<32;){if(h===0)return n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,_);_=0,h--,u|=(255&l.read_byte(g++))<<x,x+=8}if((~u>>>16&65535)!=(65535&u))return r=9,l.msg="invalid stored block lengths",_=-3,n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,_);o=65535&u,u=x=0,r=o!==0?2:m!==0?7:0;break;case 2:if(h===0||y===0&&(E==n.end&&n.read!==0&&(y=(E=0)<n.read?n.read-E-1:n.end-E),y===0&&(n.write=E,_=n.inflate_flush(l,_),y=(E=n.write)<n.read?n.read-E-1:n.end-E,E==n.end&&n.read!==0&&(y=(E=0)<n.read?n.read-E-1:n.end-E),y===0)))return n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,_);if(_=0,(c=o)>h&&(c=h),c>y&&(c=y),n.window.set(l.read_buf(g,c),E),g+=c,h-=c,E+=c,y-=c,(o-=c)!=0)break;r=m!==0?7:0;break;case 3:for(;x<14;){if(h===0)return n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,_);_=0,h--,u|=(255&l.read_byte(g++))<<x,x+=8}if(s=c=16383&u,(31&c)>29||(c>>5&31)>29)return r=9,l.msg="too many length or distance symbols",_=-3,n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,_);if(c=258+(31&c)+(c>>5&31),!t||t.length<c)t=[];else for(T=0;T<c;T++)t[T]=0;u>>>=14,x-=14,a=0,r=4;case 4:for(;a<4+(s>>>10);){for(;x<3;){if(h===0)return n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,_);_=0,h--,u|=(255&l.read_byte(g++))<<x,x+=8}t[Ln[a++]]=7&u,u>>>=3,x-=3}for(;a<19;)t[Ln[a++]]=0;if(f[0]=7,(c=b.inflate_trees_bits(t,f,d,w,l))!=0)return(_=c)==-3&&(t=null,r=9),n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,_);a=0,r=5;case 5:for(;!(a>=258+(31&(c=s))+(c>>5&31));){var I,C;for(c=f[0];x<c;){if(h===0)return n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,_);_=0,h--,u|=(255&l.read_byte(g++))<<x,x+=8}if((C=w[3*(d[0]+(u&pe[c=w[3*(d[0]+(u&pe[c]))+1]]))+2])<16)u>>>=c,x-=c,t[a++]=C;else{for(T=C==18?7:C-14,I=C==18?11:3;x<c+T;){if(h===0)return n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,_);_=0,h--,u|=(255&l.read_byte(g++))<<x,x+=8}if(x-=c,I+=(u>>>=c)&pe[T],u>>>=T,x-=T,(T=a)+I>258+(31&(c=s))+(c>>5&31)||C==16&&T<1)return t=null,r=9,l.msg="invalid bit length repeat",_=-3,n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,_);C=C==16?t[T-1]:0;do t[T++]=C;while(--I!=0);a=T}}d[0]=-1;var B=[],z=[],U=[],W=[];if(B[0]=9,z[0]=6,(c=b.inflate_trees_dynamic(257+(31&(c=s)),1+(c>>5&31),t,B,z,U,W,w,l))!=0)return c==-3&&(t=null,r=9),_=c,n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,_);p.init(B[0],z[0],w,U[0],w,W[0]),r=6;case 6:if(n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,(_=p.proc(n,l,_))!=1)return n.inflate_flush(l,_);if(_=0,p.free(l),g=l.next_in_index,h=l.avail_in,u=n.bitb,x=n.bitk,y=(E=n.write)<n.read?n.read-E-1:n.end-E,m===0){r=0;break}r=7;case 7:if(n.write=E,_=n.inflate_flush(l,_),y=(E=n.write)<n.read?n.read-E-1:n.end-E,n.read!=n.write)return n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,_);r=8;case 8:return _=1,n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,_);case 9:return _=-3,n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,_);default:return _=-2,n.bitb=u,n.bitk=x,l.avail_in=h,l.total_in+=g-l.next_in_index,l.next_in_index=g,n.write=E,n.inflate_flush(l,_)}},n.free=function(l){n.reset(l,null),n.window=null,w=null},n.set_dictionary=function(l,_,c){n.window.set(l.subarray(_,_+c),0),n.read=n.write=c},n.sync_point=function(){return r==1?1:0}}var fs=[0,0,255,255];function ds(){var i=this;function e(t){return t&&t.istate?(t.total_in=t.total_out=0,t.msg=null,t.istate.mode=7,t.istate.blocks.reset(t,null),0):-2}i.mode=0,i.method=0,i.was=[0],i.need=0,i.marker=0,i.wbits=0,i.inflateEnd=function(t){return i.blocks&&i.blocks.free(t),i.blocks=null,0},i.inflateInit=function(t,n){return t.msg=null,i.blocks=null,n<8||n>15?(i.inflateEnd(t),-2):(i.wbits=n,t.istate.blocks=new ls(t,1<<n),e(t),0)},i.inflate=function(t,n){var r,o;if(!t||!t.istate||!t.next_in)return-2;for(n=n==4?-5:0,r=-5;;)switch(t.istate.mode){case 0:if(t.avail_in===0)return r;if(r=n,t.avail_in--,t.total_in++,(15&(t.istate.method=t.read_byte(t.next_in_index++)))!=8){t.istate.mode=13,t.msg="unknown compression method",t.istate.marker=5;break}if(8+(t.istate.method>>4)>t.istate.wbits){t.istate.mode=13,t.msg="invalid window size",t.istate.marker=5;break}t.istate.mode=1;case 1:if(t.avail_in===0)return r;if(r=n,t.avail_in--,t.total_in++,o=255&t.read_byte(t.next_in_index++),((t.istate.method<<8)+o)%31!=0){t.istate.mode=13,t.msg="incorrect header check",t.istate.marker=5;break}if(!(32&o)){t.istate.mode=7;break}t.istate.mode=2;case 2:if(t.avail_in===0)return r;r=n,t.avail_in--,t.total_in++,t.istate.need=(255&t.read_byte(t.next_in_index++))<<24&4278190080,t.istate.mode=3;case 3:if(t.avail_in===0)return r;r=n,t.avail_in--,t.total_in++,t.istate.need+=(255&t.read_byte(t.next_in_index++))<<16&16711680,t.istate.mode=4;case 4:if(t.avail_in===0)return r;r=n,t.avail_in--,t.total_in++,t.istate.need+=(255&t.read_byte(t.next_in_index++))<<8&65280,t.istate.mode=5;case 5:return t.avail_in===0?r:(r=n,t.avail_in--,t.total_in++,t.istate.need+=255&t.read_byte(t.next_in_index++),t.istate.mode=6,2);case 6:return t.istate.mode=13,t.msg="need dictionary",t.istate.marker=0,-2;case 7:if((r=t.istate.blocks.proc(t,r))==-3){t.istate.mode=13,t.istate.marker=0;break}if(r==0&&(r=n),r!=1)return r;r=n,t.istate.blocks.reset(t,t.istate.was),t.istate.mode=12;case 12:return 1;case 13:return-3;default:return-2}},i.inflateSetDictionary=function(t,n,r){var o=0,s=r;return t&&t.istate&&t.istate.mode==6?(s>=1<<t.istate.wbits&&(o=r-(s=(1<<t.istate.wbits)-1)),t.istate.blocks.set_dictionary(n,o,s),t.istate.mode=7,0):-2},i.inflateSync=function(t){var n,r,o,s,a;if(!t||!t.istate)return-2;if(t.istate.mode!=13&&(t.istate.mode=13,t.istate.marker=0),(n=t.avail_in)===0)return-5;for(r=t.next_in_index,o=t.istate.marker;n!==0&&o<4;)t.read_byte(r)==fs[o]?o++:o=t.read_byte(r)!==0?0:4-o,r++,n--;return t.total_in+=r-t.next_in_index,t.next_in_index=r,t.avail_in=n,t.istate.marker=o,o!=4?-3:(s=t.total_in,a=t.total_out,e(t),t.total_in=s,t.total_out=a,t.istate.mode=7,0)},i.inflateSyncPoint=function(t){return t&&t.istate&&t.istate.blocks?t.istate.blocks.sync_point():-2}}function Wr(){}function Kr(){var i=new Wr,e=new Uint8Array(512),t=!1;i.inflateInit(),i.next_out=e,this.append=function(n,r){var o,s,a=[],f=0,d=0,p=0;if(n.length!==0){i.next_in_index=0,i.next_in=n,i.avail_in=n.length;do{if(i.next_out_index=0,i.avail_out=512,i.avail_in!==0||t||(i.next_in_index=0,t=!0),o=i.inflate(0),t&&o===-5){if(i.avail_in!==0)throw new Error("inflating: bad input")}else if(o!==0&&o!==1)throw new Error("inflating: "+i.msg);if((t||o===1)&&i.avail_in===n.length)throw new Error("inflating: bad input");i.next_out_index&&a.push(i.next_out_index===512?new Uint8Array(e):new Uint8Array(e.subarray(0,i.next_out_index))),p+=i.next_out_index,r&&i.next_in_index>0&&i.next_in_index!=f&&(r(i.next_in_index),f=i.next_in_index)}while(i.avail_in>0||i.avail_out===0);return s=new Uint8Array(p),a.forEach(function(m){s.set(m,d),d+=m.length}),s}},this.flush=function(){i.inflateEnd()}}Wr.prototype={inflateInit:function(i){var e=this;return e.istate=new ds,i||(i=15),e.istate.inflateInit(e,i)},inflate:function(i){var e=this;return e.istate?e.istate.inflate(e,i):-2},inflateEnd:function(){var i=this;if(!i.istate)return-2;var e=i.istate.inflateEnd(i);return i.istate=null,e},inflateSync:function(){var i=this;return i.istate?i.istate.inflateSync(i):-2},inflateSetDictionary:function(i,e){var t=this;return t.istate?t.istate.inflateSetDictionary(t,i,e):-2},read_byte:function(i){return this.next_in.subarray(i,i+1)[0]},read_buf:function(i,e){return this.next_in.subarray(i,i+e)}},self._zipjs_Inflater=Kr;var dn,nt="File format is not recognized.",jn="Error while reading zip file.";try{dn=new Blob([new DataView(new ArrayBuffer(0))]).size===0}catch{}function dt(){this.crc=-1}function zt(){}function Se(i,e){var t,n;return t=new ArrayBuffer(i),n=new Uint8Array(t),e&&n.set(e,0),{buffer:t,array:n,view:new DataView(t)}}function ht(){}function Pt(i){var e,t=this;t.size=0,t.init=function(n,r){var o=new Blob([i],{type:"text/plain"});(e=new yt(o)).init(function(){t.size=e.size,n()},r)},t.readUint8Array=function(n,r,o,s){e.readUint8Array(n,r,o,s)}}function Gt(i){var e,t=this;t.size=0,t.init=function(n){for(var r=i.length;i.charAt(r-1)=="=";)r--;e=i.indexOf(",")+1,t.size=Math.floor(.75*(r-e)),n()},t.readUint8Array=function(n,r,o){var s,a=Se(r),f=4*Math.floor(n/3),d=4*Math.ceil((n+r)/3),p=self.atob(i.substring(f+e,d+e)),m=n-3*Math.floor(f/4);for(s=m;s<m+r;s++)a.array[s-m]=p.charCodeAt(s);o(a.array)}}function yt(i){var e=this;e.size=0,e.init=function(t){e.size=i.size,t()},e.readUint8Array=function(t,n,r,o){var s=new FileReader;s.onload=function(a){r(new Uint8Array(a.target.result))},s.onerror=o;try{s.readAsArrayBuffer(function(a,f,d){if(f<0||d<0||f+d>a.size)throw new RangeError("offset:"+f+", length:"+d+", size:"+a.size);return a.slice?a.slice(f,f+d):a.webkitSlice?a.webkitSlice(f,f+d):a.mozSlice?a.mozSlice(f,f+d):a.msSlice?a.msSlice(f,f+d):void 0}(i,t,n))}catch(a){o(a)}}}function ot(){}function $t(i){var e,t=this;t.init=function(n){e=new Blob([],{type:"text/plain"}),n()},t.writeUint8Array=function(n,r){e=new Blob([e,dn?n:n.buffer],{type:"text/plain"}),r()},t.getData=function(n,r){var o=new FileReader;o.onload=function(s){n(s.target.result)},o.onerror=r,o.readAsText(e,i)}}function Vt(i){var e=this,t="",n="";e.init=function(r){t+="data:"+(i||"")+";base64,",r()},e.writeUint8Array=function(r,o){var s,a=n.length,f=n;for(n="",s=0;s<3*Math.floor((a+r.length)/3)-a;s++)f+=String.fromCharCode(r[s]);for(;s<r.length;s++)n+=String.fromCharCode(r[s]);f.length>2?t+=self.btoa(f):n=f,o()},e.getData=function(r){r(t+self.btoa(n))}}function Ht(i){var e,t=this;t.init=function(n){e=new Blob([],{type:i}),n()},t.writeUint8Array=function(n,r){e=new Blob([e,dn?n:n.buffer],{type:i}),r()},t.getData=function(n){n(e)}}function Xt(i,e,t,n,r,o,s,a,f,d){var p,m,w,b=0,l=e.sn;function _(){i.removeEventListener("message",c,!1),a(m,w)}function c(x){var g=x.data,h=g.data,E=g.error;if(E)return E.toString=function(){return"Error: "+this.message},void f(E);if(g.sn===l)switch(typeof g.codecTime=="number"&&(i.codecTime+=g.codecTime),typeof g.crcTime=="number"&&(i.crcTime+=g.crcTime),g.type){case"append":h?(m+=h.length,n.writeUint8Array(h,function(){u()},d)):u();break;case"flush":w=g.crc,h?(m+=h.length,n.writeUint8Array(h,function(){_()},d)):_();break;case"progress":s&&s(p+g.loaded,o);break;case"importScripts":case"newTask":case"echo":break;default:console.warn("zip.js:launchWorkerProcess: unknown message: ",g)}}function u(){(p=524288*b)<=o?t.readUint8Array(r+p,Math.min(524288,o-p),function(x){s&&s(p,o);var g=p===0?e:{sn:l};g.type="append",g.data=x;try{i.postMessage(g,[x.buffer])}catch{i.postMessage(g)}b++},f):i.postMessage({sn:l,type:"flush"})}m=0,i.addEventListener("message",c,!1),u()}function Wt(i,e,t,n,r,o,s,a,f,d){var p,m=0,w=0,b=o==="input",l=o==="output",_=new dt;(function c(){var u;if((p=524288*m)<r)e.readUint8Array(n+p,Math.min(524288,r-p),function(x){var g;try{g=i.append(x,function(h){s&&s(p+h,r)})}catch(h){return void f(h)}g?(w+=g.length,t.writeUint8Array(g,function(){m++,setTimeout(c,1)},d),l&&_.append(g)):(m++,setTimeout(c,1)),b&&_.append(x),s&&s(p,r)},f);else{try{u=i.flush()}catch(x){return void f(x)}u?(l&&_.append(u),w+=u.length,t.writeUint8Array(u,function(){a(w,_.get())},d)):a(w,_.get())}})()}function zn(i,e,t,n,r,o,s,a,f,d,p){var m="input";K.useWebWorkers&&s?Xt(i,{sn:e,codecClass:"_zipjs_NOOP",crcType:m},t,n,r,o,f,a,d,p):Wt(new zt,t,n,r,o,m,f,a,d,p)}function Pn(i){var e,t,n="",r=["Ç","ü","é","â","ä","à","å","ç","ê","ë","è","ï","î","ì","Ä","Å","É","æ","Æ","ô","ö","ò","û","ù","ÿ","Ö","Ü","ø","£","Ø","×","ƒ","á","í","ó","ú","ñ","Ñ","ª","º","¿","®","¬","½","¼","¡","«","»","_","_","_","¦","¦","Á","Â","À","©","¦","¦","+","+","¢","¥","+","+","-","-","+","-","+","ã","Ã","+","+","-","-","¦","-","+","¤","ð","Ð","Ê","Ë","È","i","Í","Î","Ï","+","+","_","_","¦","Ì","_","Ó","ß","Ô","Ò","õ","Õ","µ","þ","Þ","Ú","Û","Ù","ý","Ý","¯","´","­","±","_","¾","¶","§","÷","¸","°","¨","·","¹","³","²","_"," "];for(e=0;e<i.length;e++)n+=(t=255&i.charCodeAt(e))>127?r[t-128]:String.fromCharCode(t);return n}function Gn(i){return decodeURIComponent(escape(i))}function $n(i){var e,t="";for(e=0;e<i.length;e++)t+=String.fromCharCode(i[e]);return t}function Vn(i,e,t,n,r){i.version=e.view.getUint16(t,!0),i.bitFlag=e.view.getUint16(t+2,!0),i.compressionMethod=e.view.getUint16(t+4,!0),i.lastModDateRaw=e.view.getUint32(t+6,!0),i.lastModDate=function(o){var s=(4294901760&o)>>16,a=65535&o;try{return new Date(1980+((65024&s)>>9),((480&s)>>5)-1,31&s,(63488&a)>>11,(2016&a)>>5,2*(31&a),0)}catch{}}(i.lastModDateRaw),(1&i.bitFlag)!=1?((n||(8&i.bitFlag)!=8)&&(i.crc32=e.view.getUint32(t+10,!0),i.compressedSize=e.view.getUint32(t+14,!0),i.uncompressedSize=e.view.getUint32(t+18,!0)),i.compressedSize!==4294967295&&i.uncompressedSize!==4294967295?(i.filenameLength=e.view.getUint16(t+22,!0),i.extraFieldLength=e.view.getUint16(t+24,!0)):r("File is using Zip64 (4gb+ file size).")):r("File contains encrypted entry.")}function Hn(i){return unescape(encodeURIComponent(i))}function Xn(i){var e,t=[];for(e=0;e<i.length;e++)t.push(i.charCodeAt(e));return t}dt.prototype.append=function(i){for(var e=0|this.crc,t=this.table,n=0,r=0|i.length;n<r;n++)e=e>>>8^t[255&(e^i[n])];this.crc=e},dt.prototype.get=function(){return~this.crc},dt.prototype.table=function(){var i,e,t,n=[];for(i=0;i<256;i++){for(t=i,e=0;e<8;e++)1&t?t=t>>>1^3988292384:t>>>=1;n[i]=t}return n}(),zt.prototype.append=function(i,e){return i},zt.prototype.flush=function(){},(Pt.prototype=new ht).constructor=Pt,(Gt.prototype=new ht).constructor=Gt,(yt.prototype=new ht).constructor=yt,ot.prototype.getData=function(i){i(this.data)},($t.prototype=new ot).constructor=$t,(Vt.prototype=new ot).constructor=Vt,(Ht.prototype=new ot).constructor=Ht;var hs={deflater:["z-worker.js","deflate.js"],inflater:["z-worker.js","inflate.js"]};function Wn(i,e,t){if(K.workerScripts===null||K.workerScriptsPath===null){var n,r,o;if(K.workerScripts){if(n=K.workerScripts[i],!Array.isArray(n))return void t(new Error("zip.workerScripts."+i+" is not an array!"));r=n,o=document.createElement("a"),n=r.map(function(f){return o.href=f,o.href})}else(n=hs[i].slice(0))[0]=(K.workerScriptsPath||"")+n[0];var s=new Worker(n[0]);s.codecTime=s.crcTime=0,s.postMessage({type:"importScripts",scripts:n.slice(1)}),s.addEventListener("message",function f(d){var p=d.data;if(p.error)return s.terminate(),void t(p.error);p.type==="importScripts"&&(s.removeEventListener("message",f),s.removeEventListener("error",a),e(s))}),s.addEventListener("error",a)}else t(new Error("Either zip.workerScripts or zip.workerScriptsPath may be set, not both."));function a(f){s.terminate(),t(f)}}function Kn(i){console.error(i)}const K={Reader:ht,Writer:ot,BlobReader:yt,Data64URIReader:Gt,TextReader:Pt,BlobWriter:Ht,Data64URIWriter:Vt,TextWriter:$t,createReader:function(i,e,t){i.init(function(){(function(n,r,o){var s=0;function a(){}a.prototype.getData=function(d,p,m,w){var b=this;function l(u,x){w&&!function(g){var h=Se(4);return h.view.setUint32(0,g),b.crc32==h.view.getUint32(0)}(x)?o("CRC failed."):d.getData(function(g){p(g)})}function _(u){o(u||"Error while reading file data.")}function c(u){o(u||"Error while writing file data.")}n.readUint8Array(b.offset,30,function(u){var x,g=Se(u.length,u);g.view.getUint32(0)==1347093252?(Vn(b,g,4,!1,o),x=b.offset+30+b.filenameLength+b.extraFieldLength,d.init(function(){b.compressionMethod===0?zn(b._worker,s++,n,d,x,b.compressedSize,w,l,m,_,c):function(h,E,y,T,N,O,R,v,I,C,B){var z=R?"output":"none";K.useWebWorkers?Xt(h,{sn:E,codecClass:"_zipjs_Inflater",crcType:z},y,T,N,O,I,v,C,B):Wt(new Kr,y,T,N,O,z,I,v,C,B)}(b._worker,s++,n,d,x,b.compressedSize,w,l,m,_,c)},c)):o(nt)},_)};var f={getEntries:function(d){var p=this._worker;(function(m){function w(b,l){n.readUint8Array(n.size-b,b,function(_){for(var c=_.length-22;c>=0;c--)if(_[c]===80&&_[c+1]===75&&_[c+2]===5&&_[c+3]===6)return void m(new DataView(_.buffer,c,22));l()},function(){o(jn)})}n.size<22?o(nt):w(22,function(){w(Math.min(65558,n.size),function(){o(nt)})})})(function(m){var w,b;w=m.getUint32(16,!0),b=m.getUint16(8,!0),w<0||w>=n.size?o(nt):n.readUint8Array(w,n.size-w,function(l){var _,c,u,x,g=0,h=[],E=Se(l.length,l);for(_=0;_<b;_++){if((c=new a)._worker=p,E.view.getUint32(g)!=1347092738)return void o(nt);Vn(c,E,g+6,!0,o),c.commentLength=E.view.getUint16(g+32,!0),c.directory=(16&E.view.getUint8(g+38))==16,c.offset=E.view.getUint32(g+42,!0),u=$n(E.array.subarray(g+46,g+46+c.filenameLength)),c.filename=(2048&c.bitFlag)==2048?Gn(u):Pn(u),c.directory||c.filename.charAt(c.filename.length-1)!="/"||(c.directory=!0),x=$n(E.array.subarray(g+46+c.filenameLength+c.extraFieldLength,g+46+c.filenameLength+c.extraFieldLength+c.commentLength)),c.comment=(2048&c.bitFlag)==2048?Gn(x):Pn(x),h.push(c),g+=46+c.filenameLength+c.extraFieldLength+c.commentLength}d(h)},function(){o(jn)})})},close:function(d){this._worker&&(this._worker.terminate(),this._worker=null),d&&d()},_worker:null};K.useWebWorkers?Wn("inflater",function(d){f._worker=d,r(f)},function(d){o(d)}):r(f)})(i,e,t)},t=t||Kn)},createWriter:function(i,e,t,n){n=!!n,i.init(function(){(function(r,o,s,a){var f={},d=[],p=0,m=0;function w(_){s(_||"Error while writing zip file.")}function b(_){s(_||"Error while reading file data.")}var l={add:function(_,c,u,x,g){var h,E,y,T=this._worker;function N(R,v){var I=Se(16);p+=R||0,I.view.setUint32(0,1347094280),v!==void 0&&(h.view.setUint32(10,v,!0),I.view.setUint32(4,v,!0)),c&&(I.view.setUint32(8,R,!0),h.view.setUint32(14,R,!0),I.view.setUint32(12,c.size,!0),h.view.setUint32(18,c.size,!0)),r.writeUint8Array(I.array,function(){p+=16,u()},w)}function O(){var R;g=g||{},_=_.trim(),g.directory&&_.charAt(_.length-1)!="/"&&(_+="/"),f.hasOwnProperty(_)?s("File already exists."):(E=Xn(Hn(_)),d.push(_),y=g.lastModDate||new Date,h=Se(26),f[_]={headerArray:h.array,directory:g.directory,filename:E,offset:p,comment:Xn(Hn(g.comment||""))},h.view.setUint32(0,335546376),g.version&&h.view.setUint8(0,g.version),a||g.level===0||g.directory||h.view.setUint16(4,2048),h.view.setUint16(6,(y.getHours()<<6|y.getMinutes())<<5|y.getSeconds()/2,!0),h.view.setUint16(8,(y.getFullYear()-1980<<4|y.getMonth()+1)<<5|y.getDate(),!0),h.view.setUint16(22,E.length,!0),(R=Se(30+E.length)).view.setUint32(0,1347093252),R.array.set(h.array,4),R.array.set(E,30),p+=R.array.length,r.writeUint8Array(R.array,function(){c?a||g.level===0?zn(T,m++,c,r,0,c.size,!0,N,x,b,w):function(v,I,C,B,z,U,W,de,ne){var F="input";K.useWebWorkers?Xt(v,{sn:I,options:{level:z},codecClass:"_zipjs_Deflater",crcType:F},C,B,0,C.size,W,U,de,ne):Wt(new Xr,C,B,0,C.size,F,W,U,de,ne)}(T,m++,c,r,g.level,N,x,b,w):N()},w))}c?c.init(O,b):O()},close:function(_){this._worker&&(this._worker.terminate(),this._worker=null);var c,u,x,g=0,h=0;for(u=0;u<d.length;u++)g+=46+(x=f[d[u]]).filename.length+x.comment.length;for(c=Se(g+22),u=0;u<d.length;u++)x=f[d[u]],c.view.setUint32(h,1347092738),c.view.setUint16(h+4,5120),c.array.set(x.headerArray,h+6),c.view.setUint16(h+32,x.comment.length,!0),x.directory&&c.view.setUint8(h+38,16),c.view.setUint32(h+42,x.offset,!0),c.array.set(x.filename,h+46),c.array.set(x.comment,h+46+x.filename.length),h+=46+x.filename.length+x.comment.length;c.view.setUint32(h,1347093766),c.view.setUint16(h+8,d.length,!0),c.view.setUint16(h+10,d.length,!0),c.view.setUint32(h+12,g,!0),c.view.setUint32(h+16,p,!0),r.writeUint8Array(c.array,function(){r.getData(_)},w)},_worker:null};K.useWebWorkers?Wn("deflater",function(_){l._worker=_,o(l)},function(_){s(_)}):o(l)})(i,e,t,n)},t=t||Kn)},useWebWorkers:!0,workerScriptsPath:null,workerScripts:null};var He,oe,St=K.TextWriter,pt=K.BlobWriter,Dt=K.Data64URIWriter,qn=K.TextReader,Kt=K.BlobReader,Zn=K.Data64URIReader,ps=K.createReader,xs=K.createWriter;function ft(i){var e,t=this;t.size=0,t.init=function(n){t.size=i.uncompressedSize,n()},t.readUint8Array=function(n,r,o,s){(function(a){t.data?a():i.getData(new pt,function(f){t.data=f,e=new Kt(f),a()},null,t.checkCrc32)})(function(){e.readUint8Array(n,r,o,s)})}}function Yn(i){var e=0;return function t(n){e+=n.uncompressedSize||0,n.children.forEach(t)}(i),e}function qt(i,e,t){var n=0;function r(){++n<i.children.length?o(i.children[n]):e()}function o(s){s.directory?qt(s,r,t):(s.reader=new s.Reader(s.data,t),s.reader.init(function(){s.uncompressedSize=s.reader.size,r()}))}i.children.length?o(i.children[n]):e()}function Qn(i){var e=i.parent.children;e.forEach(function(t,n){t.id==i.id&&e.splice(n,1)})}function xt(i){i.entries=[],i.root=new Ze(i)}function Xe(i,e,t,n){if(i.directory)return n?new Ze(i.fs,e,t,i):new wt(i.fs,e,t,i);throw"Parent entry is not a directory."}function Ke(){}function wt(i,e,t,n){var r=this;Ke.prototype.init.call(r,i,e,t,n),r.Reader=t.Reader,r.Writer=t.Writer,r.data=t.data,t.getData&&(r.getData=t.getData)}function Ze(i,e,t,n){Ke.prototype.init.call(this,i,e,t,n),this.directory=!0}function qr(){xt(this)}(ft.prototype=new K.Reader).constructor=ft,ft.prototype.checkCrc32=!1,(Ke.prototype={init:function(i,e,t,n){var r=this;if(i.root&&n&&n.getChildByName(e))throw"Entry filename already exists.";t||(t={}),r.fs=i,r.name=e,r.id=i.entries.length,r.parent=n,r.children=[],r.zipVersion=t.zipVersion||20,r.uncompressedSize=0,i.entries.push(r),n&&r.parent.children.push(r)},getFileEntry:function(i,e,t,n,r){var o=this;qt(o,function(){(function(s,a,f,d,p,m,w){var b=0;a.directory?function l(_,c,u,x,g,h){var E=0;(function y(){var T=c.children[E];T?function(N){function O(R){b+=N.uncompressedSize||0,l(R,N,function(){E++,y()},x,g,h)}N.directory?_.getDirectory(N.name,{create:!0},O,g):_.getFile(N.name,{create:!0},function(R){N.getData(new K.FileWriter(R,K.getMimeType(N.name)),O,function(v){x&&x(b+v,h)},w)},g)}(T):u()})()}(s,a,f,d,p,m):a.getData(new K.FileWriter(s,K.getMimeType(a.name)),f,d,w)})(i,o,e,t,n,Yn(o),r)},n)},moveTo:function(i){var e=this;if(!i.directory)throw"Target entry is not a directory.";if(i.isDescendantOf(e))throw"Entry is a ancestor of target entry.";if(e!=i){if(i.getChildByName(e.name))throw"Entry filename already exists.";Qn(e),e.parent=i,i.children.push(e)}},getFullname:function(){for(var i=this.name,e=this.parent;e;)i=(e.name?e.name+"/":"")+i,e=e.parent;return i},isDescendantOf:function(i){for(var e=this.parent;e&&e.id!=i.id;)e=e.parent;return!!e}}).constructor=Ke,wt.prototype=He=new Ke,He.constructor=wt,He.getData=function(i,e,t,n){var r=this;!i||i.constructor==r.Writer&&r.data?e(r.data):(r.reader||(r.reader=new r.Reader(r.data,n)),r.reader.init(function(){i.init(function(){(function(o,s,a,f,d){var p=0;(function m(){var w=524288*p;f&&f(w,o.size),w<o.size?o.readUint8Array(w,Math.min(524288,o.size-w),function(b){s.writeUint8Array(new Uint8Array(b),function(){p++,m()})},d):s.getData(a)})()})(r.reader,i,e,t,n)},n)}))},He.getText=function(i,e,t,n){this.getData(new St(n),i,e,t)},He.getBlob=function(i,e,t,n){this.getData(new pt(i),e,t,n)},He.getData64URI=function(i,e,t,n){this.getData(new Dt(i),e,t,n)},Ze.prototype=oe=new Ke,oe.constructor=Ze,oe.addDirectory=function(i){return Xe(this,i,null,!0)},oe.addText=function(i,e){return Xe(this,i,{data:e,Reader:qn,Writer:St})},oe.addBlob=function(i,e){return Xe(this,i,{data:e,Reader:Kt,Writer:pt})},oe.addData64URI=function(i,e){return Xe(this,i,{data:e,Reader:Zn,Writer:Dt})},oe.addFileEntry=function(i,e,t){(function(n,r,o,s){r.isDirectory?function a(f,d,p){(function(m,w){m.isDirectory&&m.createReader().readEntries(w),m.isFile&&w([])})(d,function(m){var w=0;(function b(){var l=m[w];l?function(_){function c(u){a(u,_,function(){w++,b()})}_.isDirectory&&c(f.addDirectory(_.name)),_.isFile&&_.file(function(u){var x=f.addBlob(_.name,u);x.uncompressedSize=u.size,c(x)},s)}(l):p()})()})}(n,r,o):r.file(function(a){n.addBlob(r.name,a),o()},s)})(this,i,e,t)},oe.addData=function(i,e){return Xe(this,i,e)},oe.importBlob=function(i,e,t){this.importZip(new Kt(i),e,t)},oe.importText=function(i,e,t){this.importZip(new qn(i),e,t)},oe.importData64URI=function(i,e,t){this.importZip(new Zn(i),e,t)},oe.exportBlob=function(i,e,t){this.exportZip(new pt("application/zip"),i,e,t)},oe.exportText=function(i,e,t){this.exportZip(new St,i,e,t)},oe.exportFileEntry=function(i,e,t,n){this.exportZip(new K.FileWriter(i,"application/zip"),e,t,n)},oe.exportData64URI=function(i,e,t){this.exportZip(new Dt("application/zip"),i,e,t)},oe.importZip=function(i,e,t){var n=this;ps(i,function(r){r.getEntries(function(o){o.forEach(function(s){var a=n,f=s.filename.split("/"),d=f.pop();f.forEach(function(p){a=a.getChildByName(p)||new Ze(n.fs,p,null,a)}),s.directory||Xe(a,d,{data:s,Reader:ft})}),e()})},t)},oe.exportZip=function(i,e,t,n){var r=this;qt(r,function(){xs(i,function(o){(function(s,a,f,d,p){var m=0;(function w(b,l,_,c,u){var x=0;(function g(){var h=l.children[x];h?b.add(h.getFullname(),h.reader,function(){m+=h.uncompressedSize||0,w(b,h,function(){x++,g()},c,u)},function(E){c&&c(m+E,u)},{directory:h.directory,version:h.zipVersion}):_()})()})(s,a,f,d,p)})(o,r,function(){o.close(e)},t,Yn(r))},n)},n)},oe.getChildByName=function(i){var e,t;for(e=0;e<this.children.length;e++)if((t=this.children[e]).name==i)return t},qr.prototype={remove:function(i){Qn(i),this.entries[i.id]=null},find:function(i){var e,t=i.split("/"),n=this.root;for(e=0;n&&e<t.length;e++)n=n.getChildByName(t[e]);return n},getById:function(i){return this.entries[i]},importBlob:function(i,e,t){xt(this),this.root.importBlob(i,e,t)},importText:function(i,e,t){xt(this),this.root.importText(i,e,t)},importData64URI:function(i,e,t){xt(this),this.root.importData64URI(i,e,t)},exportBlob:function(i,e,t){this.root.exportBlob(i,e,t)},exportText:function(i,e,t){this.root.exportText(i,e,t)},exportFileEntry:function(i,e,t,n){this.root.exportFileEntry(i,e,t,n)},exportData64URI:function(i,e,t){this.root.exportData64URI(i,e,t)}},K.getMimeType=function(){return"application/octet-stream"};var gs={FS:qr,ZipDirectoryEntry:Ze,ZipFileEntry:wt};K.useWebWorkers=!1;var _s=function(){function i(t,n){this.el=t,this.inputEl=n,this.listeners={drop:[],dropstart:[],droperror:[]},this._onDragover=this._onDragover.bind(this),this._onDrop=this._onDrop.bind(this),this._onSelect=this._onSelect.bind(this),t.addEventListener("dragover",this._onDragover,!1),t.addEventListener("drop",this._onDrop,!1),n.addEventListener("change",this._onSelect)}var e=i.prototype;return e.on=function(t,n){return this.listeners[t].push(n),this},e._emit=function(t,n){return this.listeners[t].forEach(function(r){return r(n)}),this},e.destroy=function(){var t=this.el,n=this.inputEl;t.removeEventListener("dragover",this._onDragover,!1),t.removeEventListener("drop",this._onDrop,!1),n.removeEventListener("change",this._onSelect),delete this.el,delete this.inputEl,delete this.listeners},e._onDrop=function(t){t.stopPropagation(),t.preventDefault(),this._emit("dropstart");var n=Array.from(t.dataTransfer.files||[]),r=Array.from(t.dataTransfer.items||[]);if(n.length!==0||r.length!==0)if(r.length>0){var o=r.map(function(s){return s.webkitGetAsEntry()}).filter(function(s){return s!==null});o.length>0&&(o[0].name.match(/\.zip$/)?this._loadZip(r[0].getAsFile()):this._loadNextEntry(new Map,o))}else n.length===1&&n[0].name.match(/\.zip$/)&&this._loadZip(n[0]),this._emit("drop",{files:new Map(n.map(function(s){return[s.name,s]}))});else this._fail("Required drag-and-drop APIs are not supported in this browser.")},e._onDragover=function(t){t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy"},e._onSelect=function(t){this._emit("dropstart");var n=[].slice.call(this.inputEl.files);if(n.length===1&&this._isZip(n[0]))this._loadZip(n[0]);else{var r=new Map;n.forEach(function(o){return r.set(o.webkitRelativePath||o.name,o)}),this._emit("drop",{files:r})}},e._loadNextEntry=function(t,n){var r=this,o=n.pop();if(o)if(o.isFile)o.file(function(a){t.set(o.fullPath,a),r._loadNextEntry(t,n)},function(){return console.error("Could not load file: %s",o.fullPath)});else if(o.isDirectory){var s=o.createReader();s.readEntries(function a(f){f.length?(n=n.concat(f),s.readEntries(a)):r._loadNextEntry(t,n)})}else console.warn("Unknown asset type: "+o.fullPath),this._loadNextEntry(t,n);else this._emit("drop",{files:t})},e._loadZip=function(t){var n=this,r=[],o=new Map,s=new gs.FS,a=function f(d){d.directory?d.children.forEach(f):d.name[0]!=="."&&r.push(new Promise(function(p){d.getData(new K.BlobWriter,function(m){m.name=d.name,o.set(d.getFullname(),m),p()})}))};s.importBlob(t,function(){a(s.root),Promise.all(r).then(function(){n._emit("drop",{files:o,archive:t})})})},e._isZip=function(t){return t.type==="application/zip"||t.name.match(/\.zip$/)},e._fail=function(t){this._emit("droperror",{message:t})},i}();const hn=si(new oi);hn.registerExtensions(Vr);const Zr=await fi();Zr.setup();const{Manifold:Jn,Mesh:ms}=Zr,Yr=document.querySelector("model-viewer"),Ts=document.querySelector("#input"),Qr=document.querySelector("#download"),ve=document.querySelector("#viewFinal"),ys=new _s(Yr,Ts);let gt=null,bt=null,_t=!0,Et=!1;ys.on("drop",async({files:i})=>{for(const[e,t]of i)if(t.name.toLowerCase().match(/\.(gltf|glb)$/)){URL.revokeObjectURL(gt),gt=URL.createObjectURL(t),await ws(await bs(gt)),Jr();break}});function Jr(){_t?(ve.checked=!0,ve.disabled=!0):Et?(ve.checked=!1,ve.disabled=!1):(ve.checked=!1,ve.disabled=!0),ei()}ve.onclick=ei;function ei(){Yr.src=ve.checked?bt:gt,Qr.disabled=!ve.checked}Qr.onclick=function(){const i=document.createElement("a");i.download="manifold.glb",i.href=bt,i.click()};async function ws(i){if(URL.revokeObjectURL(bt),!Et)return;const e=await hn.writeBinary(i),t=new Blob([e],{type:"application/octet-stream"});bt=URL.createObjectURL(t)}async function bs(i){_t=!1,Et=!1,Jr(),_t=!0;const e=await hn.read(i),t=e.getRoot().listNodes();for(const n of t){const r=n.getMesh();if(!r)continue;const o=ai(r);o.mesh.runOriginalID=[];const s=new Map,a=o.runProperties.length,f=Jn.reserveIDs(a);for(let p=0;p<a;++p)o.mesh.runOriginalID.push(f+p),s.set(f+p,o.runProperties[p]);const d=new ms(o.mesh);ci(r),d.merge();try{const p=Jn(d);n.setMesh(ui(e,p.getMesh(),s)),p.delete(),Et=!0}catch(p){console.log(r.getName(),p),_t=!1}}return await e.transform(li()),e}
