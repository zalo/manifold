import"./modulepreload-polyfill.js";import{s as b,_ as I,j as y,M as L,k,r as v,g as B,w as D,z as O}from"./gltf-io.js";import{M as S}from"./manifold.js";const p=b(new I),t=new y,g=await S();g.setup();const{Manifold:l,Mesh:U}=g,f=new Map;async function w(e){const c=[],a=await p.read(e);await a.transform(L());const m=a.getRoot().listNodes(),r=[];for(const o of m){k(o);const s=v(o.getMesh());s.mesh.runOriginalID=[];const i=s.runProperties.length,u=l.reserveIDs(i);for(let n=0;n<i;++n)s.mesh.runOriginalID.push(u+n),r.push(u+n),f.set(u+n,s.runProperties[n]);c.push(l(new U(s.mesh)))}const R=t.getRoot().listMaterials().length;t.merge(a),t.getRoot().listScenes().forEach(o=>o.dispose()),t.getRoot().listBuffers().forEach(o=>o.dispose()),t.getRoot().listAccessors().forEach(o=>o.dispose());for(const[o,s]of r.entries()){const i=t.getRoot().listMaterials()[R+o];f.get(s).material=i}return l.union(c)}const j=await w("/models/space.glb"),E=await w("/models/moon.glb"),h=t.createNode();t.createScene().addChild(h);function M(e){N(l[e](j,E))}document.querySelector("select").onchange=function(e){M(e.target.value)};M("difference");const q=document.querySelector("model-viewer");let d=null;const z=document.querySelector("#download");z.onclick=function(){const e=document.createElement("a");e.download="manifold.glb",e.href=d,e.click()};async function N(e){const c=e.rotate([-90,0,0]).getMesh();B(h.getMesh());const a=D(t,c,f);h.setMesh(a),await t.transform(O());const m=await p.writeBinary(t),r=new Blob([m],{type:"application/octet-stream"});URL.revokeObjectURL(d),d=URL.createObjectURL(r),q.src=d}
