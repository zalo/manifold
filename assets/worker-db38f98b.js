class Us{constructor(){this._listeners={}}addEventListener(e,r){const n=this._listeners;return n[e]===void 0&&(n[e]=[]),n[e].indexOf(r)===-1&&n[e].push(r),this}removeEventListener(e,r){if(this._listeners===void 0)return this;const s=this._listeners[e];if(s!==void 0){const a=s.indexOf(r);a!==-1&&s.splice(a,1)}return this}dispatchEvent(e){if(this._listeners===void 0)return this;const n=this._listeners[e.type];if(n!==void 0){const s=n.slice(0);for(let a=0,c=s.length;a<c;a++)s[a].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class yr extends Us{constructor(e,r,n,s={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=r,this._child=n,this._attributes=s,!r.isOnGraph(n))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class Ph extends Us{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map(r=>r.getParent())}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map(r=>r.getChild())}disconnectParents(e,r){let n=this.listParentEdges(e);return r&&(n=n.filter(s=>r(s.getParent()))),n.forEach(s=>s.dispose()),this}createEdge(e,r,n,s){return this._registerEdge(new yr(e,r,n,s))}_registerEdge(e){this._edges.add(e);const r=e.getParent();this._parentEdges.has(r)||this._parentEdges.set(r,new Set),this._parentEdges.get(r).add(e);const n=e.getChild();return this._childEdges.has(n)||this._childEdges.set(n,new Set),this._childEdges.get(n).add(e),e.addEventListener("dispose",()=>this._removeEdge(e)),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function zr(){return zr=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},zr.apply(this,arguments)}function Es(t){return t instanceof yr}function kr(t){return Array.isArray(t)&&t[0]instanceof yr}function Ur(t){return!!(Uh(t)&&kh(t)instanceof yr)}function kh(t){for(const e in t)return t[e]}function Uh(t){return!!t&&Object.getPrototypeOf(t)===Object.prototype}const we=Symbol("attributes"),pr=Symbol("immutableKeys");class Ls extends Us{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[we]=void 0,this[pr]=void 0,this.graph=e,this[pr]=new Set,this[we]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),r={};for(const n in e){const s=e[n];if(s instanceof Ls){const a=this.graph.createEdge(n,this,s);a.addEventListener("dispose",()=>s.dispose()),this[pr].add(n),r[n]=a}else r[n]=s}return r}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,r){for(const n in this[we]){const s=this[we][n];if(Es(s)){const a=s;a.getChild()===e&&this.setRef(n,r,a.getAttributes())}else if(kr(s)){const c=s.find(f=>f.getChild()===e);if(c){const f=c.getAttributes();this.removeRef(n,e).addRef(n,r,f)}}else if(Ur(s)){const a=s;for(const c in a){const f=a[c];f.getChild()===e&&this.setRefMap(n,c,r,f.getAttributes())}}}return this}get(e){return this[we][e]}set(e,r){return this[we][e]=r,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const r=this[we][e];return r?r.getChild():null}setRef(e,r,n){if(this[pr].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const s=this[we][e];if(s&&s.dispose(),!r)return this;const a=this.graph.createEdge(e,this,r,n);return a.addEventListener("dispose",()=>{delete this[we][e],this.dispatchEvent({type:"change",attribute:e})}),this[we][e]=a,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[we][e].map(n=>n.getChild())}addRef(e,r,n){const s=this.graph.createEdge(e,this,r,n),a=this[we][e];return a.push(s),s.addEventListener("dispose",()=>{let c;for(;(c=a.indexOf(s))!==-1;)a.splice(c,1);this.dispatchEvent({type:"change",attribute:e})}),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,r){return this[we][e].filter(a=>a.getChild()===r).forEach(a=>a.dispose()),this}listRefMapKeys(e){return Object.keys(this[we][e])}listRefMapValues(e){return Object.values(this[we][e]).map(r=>r.getChild())}getRefMap(e,r){const n=this[we][e];return n[r]?n[r].getChild():null}setRefMap(e,r,n,s){const a=this[we][e],c=a[r];if(c&&c.dispose(),!n)return this;s=Object.assign(s||{},{key:r});const f=this.graph.createEdge(e,this,n,zr({},s,{key:r}));return f.addEventListener("dispose",()=>{delete a[r],this.dispatchEvent({type:"change",attribute:e,key:r})}),a[r]=f,this.dispatchEvent({type:"change",attribute:e,key:r})}dispatchEvent(e){return super.dispatchEvent(zr({},e,{target:this})),this.graph.dispatchEvent(zr({},e,{target:this,type:`node:${e.type}`})),this}}const $a="v3.8.0",xr="@glb.bin";var J,Cn,tt,dt,Qt;(function(t){t.ACCESSOR="Accessor",t.ANIMATION="Animation",t.ANIMATION_CHANNEL="AnimationChannel",t.ANIMATION_SAMPLER="AnimationSampler",t.BUFFER="Buffer",t.CAMERA="Camera",t.MATERIAL="Material",t.MESH="Mesh",t.PRIMITIVE="Primitive",t.PRIMITIVE_TARGET="PrimitiveTarget",t.NODE="Node",t.ROOT="Root",t.SCENE="Scene",t.SKIN="Skin",t.TEXTURE="Texture",t.TEXTURE_INFO="TextureInfo"})(J||(J={})),function(t){t.INTERLEAVED="interleaved",t.SEPARATE="separate"}(Cn||(Cn={})),function(t){t.ARRAY_BUFFER="ARRAY_BUFFER",t.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",t.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",t.OTHER="OTHER",t.SPARSE="SPARSE"}(tt||(tt={})),function(t){t[t.R=4096]="R",t[t.G=256]="G",t[t.B=16]="B",t[t.A=1]="A"}(dt||(dt={})),function(t){t.GLTF="GLTF",t.GLB="GLB"}(Qt||(Qt={}));const Nn={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};var xn,ws=typeof Float32Array<"u"?Float32Array:Array;function ds(t){return Math.hypot(t[0],t[1],t[2])}function Lh(t,e,r){var n=e[0],s=e[1],a=e[2],c=r[3]*n+r[7]*s+r[11]*a+r[15];return t[0]=(r[0]*n+r[4]*s+r[8]*a+r[12])/(c=c||1),t[1]=(r[1]*n+r[5]*s+r[9]*a+r[13])/c,t[2]=(r[2]*n+r[6]*s+r[10]*a+r[14])/c,t}function jh(t){const e={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},r=t.propertyType===J.NODE?[t]:t.listChildren();for(const n of r)n.traverse(s=>{const a=s.getMesh();if(!a)return;const c=Bh(a,s.getWorldMatrix());Ms(c.min,e),Ms(c.max,e)});return e}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),xn=new ws(3),ws!=Float32Array&&(xn[0]=0,xn[1]=0,xn[2]=0);function Bh(t,e){const r={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const n of t.listPrimitives()){const s=n.getAttribute("POSITION");if(!s)continue;let a=[0,0,0],c=[0,0,0];for(let f=0;f<s.getCount();f++)a=s.getElement(f,a),c=Lh(c,a,e),Ms(c,r)}return r}function Ms(t,e){for(let r=0;r<3;r++)e.min[r]=Math.min(t[r],e.min[r]),e.max[r]=Math.max(t[r],e.max[r])}class le{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const r=atob(e.split(",")[1]),n=new Uint8Array(r.length);for(let s=0;s<r.length;s++)n[s]=r.charCodeAt(s);return n}{const r=e.split(",")[1],n=e.indexOf("base64")>=0;return Buffer.from(r,n?"base64":"utf8")}}static encodeText(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Buffer.from(e)}static decodeText(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Buffer.from(e).toString("utf8")}static concat(e){let r=0;for(const a of e)r+=a.byteLength;const n=new Uint8Array(r);let s=0;for(const a of e)n.set(a,s),s+=a.byteLength;return n}static pad(e,r=0){const n=this.padNumber(e.byteLength);if(n===e.byteLength)return e;const s=new Uint8Array(n);if(s.set(e),r!==0)for(let a=e.byteLength;a<n;a++)s[a]=r;return s}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,r){if(e===r)return!0;if(e.byteLength!==r.byteLength)return!1;let n=e.byteLength;for(;n--;)if(e[n]!==r[n])return!1;return!0}static toView(e,r=0,n=1/0){return new Uint8Array(e.buffer,e.byteOffset+r,Math.min(e.byteLength,n))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}let Ke=class{static hexToFactor(e,r){e=Math.floor(e);const n=r;return n[0]=(e>>16&255)/255,n[1]=(e>>8&255)/255,n[2]=(255&e)/255,this.convertSRGBToLinear(r,r)}static factorToHex(e){const r=[...e],[n,s,a]=this.convertLinearToSRGB(e,r);return 255*n<<16^255*s<<8^255*a<<0}static convertSRGBToLinear(e,r){const n=e,s=r;for(let a=0;a<3;a++)s[a]=n[a]<.04045?.0773993808*n[a]:Math.pow(.9478672986*n[a]+.0521327014,2.4);return r}static convertLinearToSRGB(e,r){const n=e,s=r;for(let a=0;a<3;a++)s[a]=n[a]<.0031308?12.92*n[a]:1.055*Math.pow(n[a],.41666)-.055;return r}},Pa=class ka{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const r=new DataView(e.buffer,e.byteOffset);return le.decodeText(e.slice(12,16))===ka.PNG_FRIED_CHUNK_NAME?[r.getUint32(32,!1),r.getUint32(36,!1)]:[r.getUint32(16,!1),r.getUint32(20,!1)]}getChannels(e){return 4}};Pa.PNG_FRIED_CHUNK_NAME="CgBI";let xt=class{static registerFormat(e,r){this.impls[e]=r}static getMimeType(e){for(const r in this.impls)if(this.impls[r].match(e))return r;return null}static getSize(e,r){return this.impls[r]?this.impls[r].getSize(e):null}static getChannels(e,r){return this.impls[r]?this.impls[r].getChannels(e):null}static getVRAMByteLength(e,r){if(!this.impls[r])return null;if(this.impls[r].getVRAMByteLength)return this.impls[r].getVRAMByteLength(e);let n=0;const s=this.getSize(e,r);if(!s)return null;for(;s[0]>1||s[1]>1;)n+=s[0]*s[1]*4,s[0]=Math.max(Math.floor(s[0]/2),1),s[1]=Math.max(Math.floor(s[1]/2),1);return n+=4,n}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":e?`image/${e}`:""}};function Vh(t,e){if(e>t.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(t.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return t}xt.impls={"image/jpeg":new class{match(t){return t.length>=3&&t[0]===255&&t[1]===216&&t[2]===255}getSize(t){let e,r,n=new DataView(t.buffer,t.byteOffset+4);for(;n.byteLength;){if(e=n.getUint16(0,!1),Vh(n,e),r=n.getUint8(e+1),r===192||r===193||r===194)return[n.getUint16(e+7,!1),n.getUint16(e+5,!1)];n=new DataView(t.buffer,n.byteOffset+e+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(t){return 3}},"image/png":new Pa};let Tr=class{static basename(e){const r=e.split(/[\\/]/).pop();return r.substring(0,r.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const r=e.match(/data:(image\/\w+)/)[1];return xt.mimeTypeToExtension(r)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}};function sa(t){return Object.prototype.toString.call(t)==="[object Object]"}function Jt(t){if(sa(t)===!1)return!1;const e=t.constructor;if(e===void 0)return!0;const r=e.prototype;return sa(r)!==!1&&Object.prototype.hasOwnProperty.call(r,"isPrototypeOf")!==!1}var ps,_s;(function(t){t[t.SILENT=4]="SILENT",t[t.ERROR=3]="ERROR",t[t.WARN=2]="WARN",t[t.INFO=1]="INFO",t[t.DEBUG=0]="DEBUG"})(_s||(_s={}));let er=class Lr{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=Lr.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=Lr.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=Lr.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=Lr.Verbosity.ERROR&&console.error(e)}};function zh(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],T=e[8],E=e[9],R=e[10],A=e[11],N=e[12],m=e[13],C=e[14],x=e[15],_=r[0],b=r[1],O=r[2],P=r[3];return t[0]=_*n+b*f+O*T+P*N,t[1]=_*s+b*h+O*E+P*m,t[2]=_*a+b*d+O*R+P*C,t[3]=_*c+b*g+O*A+P*x,t[4]=(_=r[4])*n+(b=r[5])*f+(O=r[6])*T+(P=r[7])*N,t[5]=_*s+b*h+O*E+P*m,t[6]=_*a+b*d+O*R+P*C,t[7]=_*c+b*g+O*A+P*x,t[8]=(_=r[8])*n+(b=r[9])*f+(O=r[10])*T+(P=r[11])*N,t[9]=_*s+b*h+O*E+P*m,t[10]=_*a+b*d+O*R+P*C,t[11]=_*c+b*g+O*A+P*x,t[12]=(_=r[12])*n+(b=r[13])*f+(O=r[14])*T+(P=r[15])*N,t[13]=_*s+b*h+O*E+P*m,t[14]=_*a+b*d+O*R+P*C,t[15]=_*c+b*g+O*A+P*x,t}ps=er,er.Verbosity=_s,er.DEFAULT_INSTANCE=new ps(ps.Verbosity.INFO);let Ne=class Rs{static identity(e){return e}static eq(e,r,n=1e-5){if(e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(Math.abs(e[s]-r[s])>n)return!1;return!0}static decodeNormalizedInt(e,r){switch(r){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static denormalize(e,r){return Rs.decodeNormalizedInt(e,r)}static encodeNormalizedInt(e,r){switch(r){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static normalize(e,r){return Rs.encodeNormalizedInt(e,r)}static decompose(e,r,n,s){let a=ds([e[0],e[1],e[2]]);const c=ds([e[4],e[5],e[6]]),f=ds([e[8],e[9],e[10]]);var h,d,g,T,E,R,A,N,m,C,x,_,b,O,P,z,L;((d=(h=e)[0])*(A=h[5])-(g=h[1])*(R=h[4]))*((_=h[10])*(L=h[15])-(b=h[11])*(z=h[14]))-(d*(N=h[6])-(T=h[2])*R)*((x=h[9])*L-b*(P=h[13]))+(d*(m=h[7])-(E=h[3])*R)*(x*z-_*P)+(g*N-T*A)*((C=h[8])*L-b*(O=h[12]))-(g*m-E*A)*(C*z-_*O)+(T*m-E*N)*(C*P-x*O)<0&&(a=-a),r[0]=e[12],r[1]=e[13],r[2]=e[14];const k=e.slice(),W=1/a,j=1/c,Y=1/f;k[0]*=W,k[1]*=W,k[2]*=W,k[4]*=j,k[5]*=j,k[6]*=j,k[8]*=Y,k[9]*=Y,k[10]*=Y,function(H,B){var G=new ws(3);(function(It,Ye){var rt=Ye[4],ct=Ye[5],ir=Ye[6],Mr=Ye[8],ar=Ye[9],Qe=Ye[10];It[0]=Math.hypot(Ye[0],Ye[1],Ye[2]),It[1]=Math.hypot(rt,ct,ir),It[2]=Math.hypot(Mr,ar,Qe)})(G,B);var Q=1/G[0],oe=1/G[1],ve=1/G[2],ye=B[0]*Q,me=B[1]*oe,Te=B[2]*ve,Me=B[4]*Q,Pe=B[5]*oe,be=B[6]*ve,Ce=B[8]*Q,Ze=B[9]*oe,ot=B[10]*ve,St=ye+Pe+ot,Ae=0;St>0?(Ae=2*Math.sqrt(St+1),H[3]=.25*Ae,H[0]=(be-Ze)/Ae,H[1]=(Ce-Te)/Ae,H[2]=(me-Me)/Ae):ye>Pe&&ye>ot?(Ae=2*Math.sqrt(1+ye-Pe-ot),H[3]=(be-Ze)/Ae,H[0]=.25*Ae,H[1]=(me+Me)/Ae,H[2]=(Ce+Te)/Ae):Pe>ot?(Ae=2*Math.sqrt(1+Pe-ye-ot),H[3]=(Ce-Te)/Ae,H[0]=(me+Me)/Ae,H[1]=.25*Ae,H[2]=(be+Ze)/Ae):(Ae=2*Math.sqrt(1+ot-ye-Pe),H[3]=(me-Me)/Ae,H[0]=(Ce+Te)/Ae,H[1]=(be+Ze)/Ae,H[2]=.25*Ae)}(n,k),s[0]=a,s[1]=c,s[2]=f}static compose(e,r,n,s){const a=s,c=r[0],f=r[1],h=r[2],d=r[3],g=c+c,T=f+f,E=h+h,R=c*g,A=c*T,N=c*E,m=f*T,C=f*E,x=h*E,_=d*g,b=d*T,O=d*E,P=n[0],z=n[1],L=n[2];return a[0]=(1-(m+x))*P,a[1]=(A+O)*P,a[2]=(N-b)*P,a[3]=0,a[4]=(A-O)*z,a[5]=(1-(R+x))*z,a[6]=(C+_)*z,a[7]=0,a[8]=(N+b)*L,a[9]=(C-_)*L,a[10]=(1-(R+m))*L,a[11]=0,a[12]=e[0],a[13]=e[1],a[14]=e[2],a[15]=1,a}};function Gh(t,e){if(!!t!=!!e)return!1;const r=t.getChild(),n=e.getChild();return r===n||r.equals(n)}function Hh(t,e){if(!!t!=!!e||t.length!==e.length)return!1;for(let r=0;r<t.length;r++){const n=t[r],s=e[r];if(n.getChild()!==s.getChild()&&!n.getChild().equals(s.getChild()))return!1}return!0}function qh(t,e){if(!!t!=!!e)return!1;const r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(const s in t){const a=t[s],c=e[s];if(!!a!=!!c)return!1;const f=a.getChild(),h=c.getChild();if(f!==h&&!f.equals(h))return!1}return!0}function Ua(t,e){if(t===e)return!0;if(!!t!=!!e||!t||!e||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function La(t,e){if(t===e)return!0;if(!!t!=!!e)return!1;if(!Jt(t)||!Jt(e))return t===e;const r=t,n=e;let s,a=0,c=0;for(s in r)a++;for(s in n)c++;if(a!==c)return!1;for(s in r){const f=r[s],h=n[s];if(On(f)&&On(h)){if(!Ua(f,h))return!1}else if(Jt(f)&&Jt(h)){if(!La(f,h))return!1}else if(f!==h)return!1}return!0}function On(t){return Array.isArray(t)||ArrayBuffer.isView(t)}const ia=new Set,Wh=function(){let t="";for(let e=0;e<6;e++)t+="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ".charAt(Math.floor(42*Math.random()));return t},Xh=function(){for(let t=0;t<999;t++){const e=Wh();if(!ia.has(e))return ia.add(e),e}return""},aa="https://null.example";let Gr=class{static dirname(e){const r=e.lastIndexOf("/");return r===-1?"./":e.substring(0,r+1)}static basename(e){return Tr.basename(new URL(e,aa).pathname)}static extension(e){return Tr.extension(new URL(e,aa).pathname)}static resolve(e,r){if(!this.isRelativePath(r))return r;const n=e.split("/"),s=r.split("/");n.pop();for(let a=0;a<s.length;a++)s[a]!=="."&&(s[a]===".."?n.pop():n.push(s[a]));return n.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}};Gr.DEFAULT_INIT={},Gr.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const At=t=>t,Yh=new Set;let js=class extends Ls{constructor(e,r=""){super(e),this[we].name=r,this.init(),this.dispatchEvent({type:"create"})}getGraph(){return this.graph}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}set(e,r){return Array.isArray(r)&&(r=r.slice()),super.set(e,r)}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new this.constructor(this.graph).copy(this,At)}copy(e,r=At){for(const n in this[we]){const s=this[we][n];if(s instanceof yr)this[pr].has(n)||s.dispose();else if(kr(s))for(const a of s)a.dispose();else if(Ur(s))for(const a in s)s[a].dispose()}for(const n in e[we]){const s=this[we][n],a=e[we][n];if(a instanceof yr)this[pr].has(n)?s.getChild().copy(r(a.getChild()),r):this.setRef(n,r(a.getChild()),a.getAttributes());else if(kr(a))for(const c of a)this.addRef(n,r(c.getChild()),c.getAttributes());else if(Ur(a))for(const c in a){const f=a[c];this.setRefMap(n,c,r(f.getChild()),f.getAttributes())}else this[we][n]=Jt(a)?JSON.parse(JSON.stringify(a)):Array.isArray(a)||a instanceof ArrayBuffer||ArrayBuffer.isView(a)?a.slice():a}return this}equals(e,r=Yh){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const n in this[we]){if(r.has(n))continue;const s=this[we][n],a=e[we][n];if(Es(s)||Es(a)){if(!Gh(s,a))return!1}else if(kr(s)||kr(a)){if(!Hh(s,a))return!1}else if(Ur(s)||Ur(a)){if(!qh(s,a))return!1}else if(Jt(s)||Jt(a)){if(!La(s,a))return!1}else if(On(s)||On(a)){if(!Ua(s,a))return!1}else if(s!==a)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}},Xe=class extends js{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,r){return r&&r.t(this),this.setRefMap("extensions",e,r)}listExtensions(){return this.listRefMapValues("extensions")}},re=class Se extends Xe{constructor(...e){super(...e),this.i=Ne.identity,this.o=Ne.identity}init(){this.propertyType=J.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:Se.Type.SCALAR,componentType:Se.ComponentType.FLOAT,normalized:!1,sparse:!1,buffer:null})}copy(e,r=At){return super.copy(e,r),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case Se.Type.SCALAR:return 1;case Se.Type.VEC2:return 2;case Se.Type.VEC3:return 3;case Se.Type.VEC4:case Se.Type.MAT2:return 4;case Se.Type.MAT3:return 9;case Se.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case Se.ComponentType.BYTE:case Se.ComponentType.UNSIGNED_BYTE:return 1;case Se.ComponentType.SHORT:case Se.ComponentType.UNSIGNED_SHORT:return 2;case Se.ComponentType.UNSIGNED_INT:case Se.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const r=this.getElementSize();this.getMin(e);for(let n=0;n<r;n++)e[n]=this.o(e[n]);return e}getMin(e){const r=this.get("array"),n=this.getCount(),s=this.getElementSize();for(let a=0;a<s;a++)e[a]=1/0;for(let a=0;a<n*s;a+=s)for(let c=0;c<s;c++){const f=r[a+c];Number.isFinite(f)&&(e[c]=Math.min(e[c],f))}return e}getMaxNormalized(e){const r=this.getElementSize();this.getMax(e);for(let n=0;n<r;n++)e[n]=this.o(e[n]);return e}getMax(e){const r=this.get("array"),n=this.getCount(),s=this.getElementSize();for(let a=0;a<s;a++)e[a]=-1/0;for(let a=0;a<n*s;a+=s)for(let c=0;c<s;c++){const f=r[a+c];Number.isFinite(f)&&(e[c]=Math.max(e[c],f))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return Se.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=r=>Ne.decodeNormalizedInt(r,this.get("componentType")),this.i=r=>Ne.encodeNormalizedInt(r,this.get("componentType"))):(this.o=Ne.identity,this.i=Ne.identity),this}getScalar(e){const r=this.getElementSize();return this.o(this.get("array")[e*r])}setScalar(e,r){return this.get("array")[e*this.getElementSize()]=this.i(r),this}getElement(e,r){const n=this.getElementSize(),s=this.get("array");for(let a=0;a<n;a++)r[a]=this.o(s[e*n+a]);return r}setElement(e,r){const n=this.getElementSize(),s=this.get("array");for(let a=0;a<n;a++)s[e*n+a]=this.i(r[a]);return this}getSparse(){return this.get("sparse")}setSparse(e){return this.set("sparse",e)}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(r){switch(r.constructor){case Float32Array:return Se.ComponentType.FLOAT;case Uint32Array:return Se.ComponentType.UNSIGNED_INT;case Uint16Array:return Se.ComponentType.UNSIGNED_SHORT;case Uint8Array:return Se.ComponentType.UNSIGNED_BYTE;case Int16Array:return Se.ComponentType.SHORT;case Int8Array:return Se.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):Se.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}};re.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},re.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};let ja=class extends Xe{init(){this.propertyType=J.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}},Bs=class extends Xe{init(){this.propertyType=J.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}};Bs.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};let Vn=class Ba extends Xe{init(){this.propertyType=J.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:Ba.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:tt.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:tt.OTHER})}};Vn.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};let Va=class extends Xe{init(){this.propertyType=J.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}},Qr=class za extends Xe{init(){this.propertyType=J.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:za.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}};Qr.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};let $e=class extends js{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}};$e.EXTENSION_NAME=void 0;let Oe=class bs extends Xe{init(){this.propertyType=J.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:bs.WrapMode.REPEAT,wrapT:bs.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}};Oe.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},Oe.MagFilter={NEAREST:9728,LINEAR:9729},Oe.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:Tn,G:En,B:wn,A:Kh}=dt;let Er=class Ga extends Xe{init(){this.propertyType=J.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:Ga.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new Oe(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new Oe(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new Oe(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new Oe(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new Oe(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const r=this.get("baseColorFactor").slice();return r[3]=e,this.set("baseColorFactor",r)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return Ke.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const r=this.get("baseColorFactor").slice();return this.set("baseColorFactor",Ke.hexToFactor(e,r))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:Tn|En|wn|Kh,isColor:!0})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return Ke.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const r=this.get("emissiveFactor").slice();return this.set("emissiveFactor",Ke.hexToFactor(e,r))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:Tn|En|wn,isColor:!0})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:Tn|En|wn})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:Tn})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:En|wn})}};Er.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};let Ha=class extends Xe{init(){this.propertyType=J.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}},qa=class extends Xe{constructor(...e){super(...e),this.u=null,this.h=new Set}init(){this.propertyType=J.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,r=At){if(r===At)throw new Error("Node cannot be copied.");return super.copy(e,r)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return Ne.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const r=this.get("translation").slice(),n=this.get("rotation").slice(),s=this.get("scale").slice();return Ne.decompose(e,r,n,s),this.set("translation",r).set("rotation",n).set("scale",s)}getWorldTranslation(){const e=[0,0,0];return Ne.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return Ne.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return Ne.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let s=this;s!=null;s=s.u)e.push(s);let r;const n=e.pop().getMatrix();for(;r=e.pop();)zh(n,n,r.getMatrix());return n}addChild(e){if(e.u&&e.u.removeChild(e),e.h.size)for(const n of e.h)n.removeChild(e);this.addRef("children",e),e.u=this;const r=this[we].children;return r[r.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u?this.u:this.listParents().find(e=>e.propertyType===J.SCENE)||null}getParentNode(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const r of this.listChildren())r.traverse(e);return this}},Yr=class Wa extends Xe{init(){this.propertyType=J.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:Wa.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:tt.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:tt.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}};Yr.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};let Jh=class extends js{init(){this.propertyType=J.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:tt.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}};function We(){return We=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},We.apply(this,arguments)}let Xa=class extends Xe{init(){this.propertyType=J.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,r=At){if(r===At)throw new Error("Scene cannot be copied.");return super.copy(e,r)}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.h.add(this);const r=this[we].children;return r[r.length-1].addEventListener("dispose",()=>e.h.delete(this)),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const r of this.listChildren())r.traverse(e);return this}},Ya=class extends Xe{init(){this.propertyType=J.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:tt.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}},Ka=class extends Xe{init(){this.propertyType=J.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||xt.extensionToMimeType(Tr.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){this.set("uri",e);const r=xt.extensionToMimeType(Tr.extension(e));return r&&this.set("mimeType",r),this}getImage(){return this.get("image")}setImage(e){return this.set("image",le.assertView(e))}getSize(){const e=this.get("image");return e?xt.getSize(e,this.getMimeType()):null}},Ja=class extends Xe{init(){this.propertyType=J.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:`glTF-Transform ${$a}`,version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.l=new Set,e.addEventListener("node:create",r=>{this.g(r.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,r=At){if(r===At)throw new Error("Root cannot be copied.");this.set("asset",We({},e.get("asset"))),this.setName(e.getName()),this.setExtras(We({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?r(e.getDefaultScene()):null);for(const n of e.listRefMapKeys("extensions")){const s=e.getExtension(n);this.setExtension(n,r(s))}return this}g(e){return e instanceof Xa?this.addRef("scenes",e):e instanceof qa?this.addRef("nodes",e):e instanceof Qr?this.addRef("cameras",e):e instanceof Ya?this.addRef("skins",e):e instanceof Ha?this.addRef("meshes",e):e instanceof Er?this.addRef("materials",e):e instanceof Ka?this.addRef("textures",e):e instanceof ja?this.addRef("animations",e):e instanceof re?this.addRef("accessors",e):e instanceof Va&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.l)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}p(e){return this.l.add(e),this}m(e){return this.l.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}},Vs=class Rn{static fromGraph(e){return Rn.v.get(e)||null}constructor(){this.T=new Ph,this.S=new Ja(this.T),this.M=er.DEFAULT_INSTANCE,Rn.v.set(this.T,this)}getRoot(){return this.S}getGraph(){return this.T}getLogger(){return this.M}setLogger(e){return this.M=e,this}clone(){return new Rn().setLogger(this.M).merge(this)}merge(e){for(const a of e.getRoot().listExtensionsUsed()){const c=this.createExtension(a.constructor);a.isRequired()&&c.setRequired(!0)}const r=new Set,n=new Map;r.add(e.S),n.set(e.S,this.S);for(const a of e.T.listEdges())for(const c of[a.getParent(),a.getChild()]){if(r.has(c))continue;let f;f=c.propertyType===J.TEXTURE_INFO?c:new c.constructor(this.T),n.set(c,f),r.add(c)}const s=a=>{const c=n.get(a);if(!c)throw new Error("Could resolve property.");return c};for(const a of r){const c=n.get(a);if(!c)throw new Error("Could resolve property.");c.propertyType!==J.TEXTURE_INFO&&c.copy(a,s)}return this}async transform(...e){const r=e.map(n=>n.name);for(const n of e)await n(this,{stack:r});return this}createExtension(e){const r=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(n=>n.extensionName===r)||new e(this)}createScene(e=""){return new Xa(this.T,e)}createNode(e=""){return new qa(this.T,e)}createCamera(e=""){return new Qr(this.T,e)}createSkin(e=""){return new Ya(this.T,e)}createMesh(e=""){return new Ha(this.T,e)}createPrimitive(){return new Yr(this.T)}createPrimitiveTarget(e=""){return new Jh(this.T,e)}createMaterial(e=""){return new Er(this.T,e)}createTexture(e=""){return new Ka(this.T,e)}createAnimation(e=""){return new ja(this.T,e)}createAnimationChannel(e=""){return new Bs(this.T,e)}createAnimationSampler(e=""){return new Vn(this.T,e)}createAccessor(e="",r=null){return r||(r=this.getRoot().listBuffers()[0]),new re(this.T,e).setBuffer(r)}createBuffer(e=""){return new Va(this.T,e)}};Vs.v=new WeakMap;let Ie=class{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.I=void 0,this.document=e,e.getRoot().p(this),this.I=n=>{const s=n,a=s.target;a instanceof $e&&a.extensionName===this.extensionName&&(s.type==="node:create"&&this.N(a),s.type==="node:dispose"&&this.O(a))};const r=e.getGraph();r.addEventListener("node:create",this.I),r.addEventListener("node:dispose",this.I)}dispose(){this.document.getRoot().m(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.I),e.removeEventListener("node:dispose",this.I);for(const r of this.properties)r.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}listProperties(){return Array.from(this.properties)}N(e){return this.properties.add(e),this}O(e){return this.properties.delete(e),this}install(e,r){return this}preread(e,r){return this}prewrite(e,r){return this}};Ie.EXTENSION_NAME=void 0;let Zh=class{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,r){this.textureInfos.set(e,r),r.texCoord!==void 0&&e.setTexCoord(r.texCoord),r.extras!==void 0&&e.setExtras(r.extras);const n=this.jsonDoc.json.textures[r.index];if(n.sampler===void 0)return;const s=this.jsonDoc.json.samplers[n.sampler];s.magFilter!==void 0&&e.setMagFilter(s.magFilter),s.minFilter!==void 0&&e.setMinFilter(s.minFilter),s.wrapS!==void 0&&e.setWrapS(s.wrapS),s.wrapT!==void 0&&e.setWrapT(s.wrapT)}};const oa={logger:er.DEFAULT_INSTANCE,extensions:[],dependencies:{}};let Qh=class{static read(e,r=oa){const n=We({},oa,r),{json:s}=e,a=new Vs().setLogger(n.logger);this.validate(e,n);const c=new Zh(e),f=s.asset,h=a.getRoot().getAsset();f.copyright&&(h.copyright=f.copyright),f.extras&&(h.extras=f.extras),s.extras!==void 0&&a.getRoot().setExtras(We({},s.extras));const d=s.extensionsUsed||[],g=s.extensionsRequired||[];for(const x of n.extensions)if(d.includes(x.EXTENSION_NAME)){const _=a.createExtension(x).setRequired(g.includes(x.EXTENSION_NAME));for(const b of _.readDependencies)_.install(b,n.dependencies[b])}const T=s.buffers||[];a.getRoot().listExtensionsUsed().filter(x=>x.prereadTypes.includes(J.BUFFER)).forEach(x=>x.preread(c,J.BUFFER)),c.buffers=T.map(x=>{const _=a.createBuffer(x.name);return x.extras&&_.setExtras(x.extras),x.uri&&x.uri.indexOf("__")!==0&&_.setURI(x.uri),_}),c.bufferViewBuffers=(s.bufferViews||[]).map((x,_)=>{if(!c.bufferViews[_]){const b=e.json.buffers[x.buffer];c.bufferViews[_]=le.toView(b.uri?e.resources[b.uri]:e.resources[xr],x.byteOffset||0,x.byteLength)}return c.buffers[x.buffer]});const E=s.accessors||[];c.accessors=E.map(x=>{const _=a.createAccessor(x.name,c.bufferViewBuffers[x.bufferView]).setType(x.type);return x.extras&&_.setExtras(x.extras),x.normalized!==void 0&&_.setNormalized(x.normalized),x.bufferView===void 0||_.setArray(Mn(x,c)),_});const R=s.images||[],A=s.textures||[];a.getRoot().listExtensionsUsed().filter(x=>x.prereadTypes.includes(J.TEXTURE)).forEach(x=>x.preread(c,J.TEXTURE)),c.textures=R.map(x=>{const _=a.createTexture(x.name);if(x.extras&&_.setExtras(x.extras),x.bufferView!==void 0){const b=s.bufferViews[x.bufferView],O=e.json.buffers[b.buffer],P=b.byteOffset||0,z=(O.uri?e.resources[O.uri]:e.resources[xr]).slice(P,P+b.byteLength);_.setImage(z)}else x.uri!==void 0&&(_.setImage(e.resources[x.uri]),x.uri.indexOf("__")!==0&&_.setURI(x.uri));if(x.mimeType!==void 0)_.setMimeType(x.mimeType);else if(x.uri){const b=Tr.extension(x.uri);_.setMimeType(xt.extensionToMimeType(b))}return _}),c.materials=(s.materials||[]).map(x=>{const _=a.createMaterial(x.name);x.extras&&_.setExtras(x.extras),x.alphaMode!==void 0&&_.setAlphaMode(x.alphaMode),x.alphaCutoff!==void 0&&_.setAlphaCutoff(x.alphaCutoff),x.doubleSided!==void 0&&_.setDoubleSided(x.doubleSided);const b=x.pbrMetallicRoughness||{};if(b.baseColorFactor!==void 0&&_.setBaseColorFactor(b.baseColorFactor),x.emissiveFactor!==void 0&&_.setEmissiveFactor(x.emissiveFactor),b.metallicFactor!==void 0&&_.setMetallicFactor(b.metallicFactor),b.roughnessFactor!==void 0&&_.setRoughnessFactor(b.roughnessFactor),b.baseColorTexture!==void 0){const O=b.baseColorTexture;_.setBaseColorTexture(c.textures[A[O.index].source]),c.setTextureInfo(_.getBaseColorTextureInfo(),O)}if(x.emissiveTexture!==void 0){const O=x.emissiveTexture;_.setEmissiveTexture(c.textures[A[O.index].source]),c.setTextureInfo(_.getEmissiveTextureInfo(),O)}if(x.normalTexture!==void 0){const O=x.normalTexture;_.setNormalTexture(c.textures[A[O.index].source]),c.setTextureInfo(_.getNormalTextureInfo(),O),x.normalTexture.scale!==void 0&&_.setNormalScale(x.normalTexture.scale)}if(x.occlusionTexture!==void 0){const O=x.occlusionTexture;_.setOcclusionTexture(c.textures[A[O.index].source]),c.setTextureInfo(_.getOcclusionTextureInfo(),O),x.occlusionTexture.strength!==void 0&&_.setOcclusionStrength(x.occlusionTexture.strength)}if(b.metallicRoughnessTexture!==void 0){const O=b.metallicRoughnessTexture;_.setMetallicRoughnessTexture(c.textures[A[O.index].source]),c.setTextureInfo(_.getMetallicRoughnessTextureInfo(),O)}return _});const N=s.meshes||[];a.getRoot().listExtensionsUsed().filter(x=>x.prereadTypes.includes(J.PRIMITIVE)).forEach(x=>x.preread(c,J.PRIMITIVE)),c.meshes=N.map(x=>{const _=a.createMesh(x.name);return x.extras&&_.setExtras(x.extras),x.weights!==void 0&&_.setWeights(x.weights),(x.primitives||[]).forEach(b=>{const O=a.createPrimitive();b.extras&&O.setExtras(b.extras),b.material!==void 0&&O.setMaterial(c.materials[b.material]),b.mode!==void 0&&O.setMode(b.mode);for(const[z,L]of Object.entries(b.attributes||{}))O.setAttribute(z,c.accessors[L]);b.indices!==void 0&&O.setIndices(c.accessors[b.indices]);const P=x.extras&&x.extras.targetNames||[];(b.targets||[]).forEach((z,L)=>{const k=P[L]||L.toString(),W=a.createPrimitiveTarget(k);for(const[j,Y]of Object.entries(z))W.setAttribute(j,c.accessors[Y]);O.addTarget(W)}),_.addPrimitive(O)}),_}),c.cameras=(s.cameras||[]).map(x=>{const _=a.createCamera(x.name).setType(x.type);if(x.extras&&_.setExtras(x.extras),x.type===Qr.Type.PERSPECTIVE){const b=x.perspective;_.setYFov(b.yfov),_.setZNear(b.znear),b.zfar!==void 0&&_.setZFar(b.zfar),b.aspectRatio!==void 0&&_.setAspectRatio(b.aspectRatio)}else{const b=x.orthographic;_.setZNear(b.znear).setZFar(b.zfar).setXMag(b.xmag).setYMag(b.ymag)}return _});const m=s.nodes||[];a.getRoot().listExtensionsUsed().filter(x=>x.prereadTypes.includes(J.NODE)).forEach(x=>x.preread(c,J.NODE)),c.nodes=m.map(x=>{const _=a.createNode(x.name);if(x.extras&&_.setExtras(x.extras),x.translation!==void 0&&_.setTranslation(x.translation),x.rotation!==void 0&&_.setRotation(x.rotation),x.scale!==void 0&&_.setScale(x.scale),x.matrix!==void 0){const b=[0,0,0],O=[0,0,0,1],P=[1,1,1];Ne.decompose(x.matrix,b,O,P),_.setTranslation(b),_.setRotation(O),_.setScale(P)}return x.weights!==void 0&&_.setWeights(x.weights),_}),c.skins=(s.skins||[]).map(x=>{const _=a.createSkin(x.name);x.extras&&_.setExtras(x.extras),x.inverseBindMatrices!==void 0&&_.setInverseBindMatrices(c.accessors[x.inverseBindMatrices]),x.skeleton!==void 0&&_.setSkeleton(c.nodes[x.skeleton]);for(const b of x.joints)_.addJoint(c.nodes[b]);return _}),m.map((x,_)=>{const b=c.nodes[_];(x.children||[]).forEach(O=>b.addChild(c.nodes[O])),x.mesh!==void 0&&b.setMesh(c.meshes[x.mesh]),x.camera!==void 0&&b.setCamera(c.cameras[x.camera]),x.skin!==void 0&&b.setSkin(c.skins[x.skin])}),c.animations=(s.animations||[]).map(x=>{const _=a.createAnimation(x.name);x.extras&&_.setExtras(x.extras);const b=(x.samplers||[]).map(O=>{const P=a.createAnimationSampler().setInput(c.accessors[O.input]).setOutput(c.accessors[O.output]).setInterpolation(O.interpolation||Vn.Interpolation.LINEAR);return O.extras&&P.setExtras(O.extras),_.addSampler(P),P});return(x.channels||[]).forEach(O=>{const P=a.createAnimationChannel().setSampler(b[O.sampler]).setTargetPath(O.target.path);O.target.node!==void 0&&P.setTargetNode(c.nodes[O.target.node]),O.extras&&P.setExtras(O.extras),_.addChannel(P)}),_});const C=s.scenes||[];return a.getRoot().listExtensionsUsed().filter(x=>x.prereadTypes.includes(J.SCENE)).forEach(x=>x.preread(c,J.SCENE)),c.scenes=C.map(x=>{const _=a.createScene(x.name);return x.extras&&_.setExtras(x.extras),(x.nodes||[]).map(b=>c.nodes[b]).forEach(b=>_.addChild(b)),_}),s.scene!==void 0&&a.getRoot().setDefaultScene(c.scenes[s.scene]),a.getRoot().listExtensionsUsed().forEach(x=>x.read(c)),E.forEach((x,_)=>{const b=c.accessors[_],O=!!x.sparse,P=!x.bufferView&&!b.getArray();(O||P)&&b.setSparse(!0).setArray(function(z,L){const k=Nn[z.componentType],W=re.getElementSize(z.type);let j;j=z.bufferView!==void 0?Mn(z,L):new k(z.count*W);const Y=z.sparse;if(!Y)return j;const H=Y.count,B=We({},z,Y.indices,{count:H,type:"SCALAR"}),G=We({},z,Y.values,{count:H}),Q=Mn(B,L),oe=Mn(G,L);for(let ve=0;ve<B.count;ve++)for(let ye=0;ye<W;ye++)j[Q[ve]*W+ye]=oe[ve*W+ye];return j}(x,c))}),a}static validate(e,r){const n=e.json;if(n.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${n.asset.version}".`);if(n.extensionsRequired){for(const s of n.extensionsRequired)if(!r.extensions.find(a=>a.EXTENSION_NAME===s))throw new Error(`Missing required extension, "${s}".`)}if(n.extensionsUsed)for(const s of n.extensionsUsed)r.extensions.find(a=>a.EXTENSION_NAME===s)||r.logger.warn(`Missing optional extension, "${s}".`)}};function Mn(t,e){const r=e.bufferViews[t.bufferView],n=e.jsonDoc.json.bufferViews[t.bufferView],s=Nn[t.componentType],a=re.getElementSize(t.type),c=s.BYTES_PER_ELEMENT;if(n.byteStride!==void 0&&n.byteStride!==a*c)return function(h,d){const g=d.bufferViews[h.bufferView],T=d.jsonDoc.json.bufferViews[h.bufferView],E=Nn[h.componentType],R=re.getElementSize(h.type),A=E.BYTES_PER_ELEMENT,N=h.byteOffset||0,m=new E(h.count*R),C=new DataView(g.buffer,g.byteOffset,g.byteLength),x=T.byteStride;for(let _=0;_<h.count;_++)for(let b=0;b<R;b++){const O=N+_*x+b*A;let P;switch(h.componentType){case re.ComponentType.FLOAT:P=C.getFloat32(O,!0);break;case re.ComponentType.UNSIGNED_INT:P=C.getUint32(O,!0);break;case re.ComponentType.UNSIGNED_SHORT:P=C.getUint16(O,!0);break;case re.ComponentType.UNSIGNED_BYTE:P=C.getUint8(O);break;case re.ComponentType.SHORT:P=C.getInt16(O,!0);break;case re.ComponentType.BYTE:P=C.getInt8(O);break;default:throw new Error(`Unexpected componentType "${h.componentType}".`)}m[_*R+b]=P}return m}(t,e);const f=r.byteOffset+(t.byteOffset||0);return new s(r.buffer.slice(f,f+t.count*a*c))}var Hr;(function(t){t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(Hr||(Hr={}));let ht=class{constructor(e,r,n){this.C=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.F=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.C=e,this.jsonDoc=r,this.options=n;const s=e.getRoot(),a=s.listBuffers().length,c=s.listTextures().length;this.bufferURIGenerator=new ca(a>1,()=>n.basename||"buffer"),this.imageURIGenerator=new ca(c>1,f=>function(h,d){const g=h.getGraph().listParentEdges(d).find(T=>T.getParent()!==h.getRoot());return g?g.getName().replace(/texture$/i,""):""}(e,f)||n.basename||"texture"),this.logger=e.getLogger()}createTextureInfoDef(e,r){const n={magFilter:r.getMagFilter()||void 0,minFilter:r.getMinFilter()||void 0,wrapS:r.getWrapS(),wrapT:r.getWrapT()},s=JSON.stringify(n);this.samplerDefIndexMap.has(s)||(this.samplerDefIndexMap.set(s,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(n));const a={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(s)},c=JSON.stringify(a);this.textureDefIndexMap.has(c)||(this.textureDefIndexMap.set(c,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(a));const f={index:this.textureDefIndexMap.get(c)};return r.getTexCoord()!==0&&(f.texCoord=r.getTexCoord()),Object.keys(r.getExtras()).length>0&&(f.extras=r.getExtras()),this.textureInfoDefMap.set(r,f),f}createPropertyDef(e){const r={};return e.getName()&&(r.name=e.getName()),Object.keys(e.getExtras()).length>0&&(r.extras=e.getExtras()),r}createAccessorDef(e){const r=this.createPropertyDef(e);return r.type=e.getType(),r.componentType=e.getComponentType(),r.count=e.getCount(),this.C.getGraph().listParentEdges(e).some(n=>n.getName()==="attributes"&&n.getAttributes().key==="POSITION"||n.getName()==="input")&&(r.max=e.getMax([]).map(Math.fround),r.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(r.normalized=e.getNormalized()),r}createImageData(e,r,n){if(this.options.format===Qt.GLB)this.imageBufferViews.push(r),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:r.byteLength});else{const s=xt.mimeTypeToExtension(n.getMimeType());e.uri=this.imageURIGenerator.createURI(n,s),this.jsonDoc.resources[e.uri]=r}}getAccessorUsage(e){const r=this.F.get(e);if(r)return r;if(e.getSparse())return tt.SPARSE;for(const n of this.C.getGraph().listParentEdges(e)){const{usage:s}=n.getAttributes();if(s)return s;n.getParent().propertyType!==J.ROOT&&this.logger.warn(`Missing attribute ".usage" on edge, "${n.getName()}".`)}return tt.OTHER}addAccessorToUsageGroup(e,r){const n=this.F.get(e);if(n&&n!==r)throw new Error(`Accessor with usage "${n}" cannot be reused as "${r}".`);return this.F.set(e,r),this}listAccessorUsageGroups(){const e={};for(const[r,n]of Array.from(this.F.entries()))e[n]=e[n]||[],e[n].push(r);return e}};ht.BufferViewTarget=Hr,ht.BufferViewUsage=tt,ht.USAGE_TO_TARGET={[tt.ARRAY_BUFFER]:Hr.ARRAY_BUFFER,[tt.ELEMENT_ARRAY_BUFFER]:Hr.ELEMENT_ARRAY_BUFFER};let ca=class{constructor(e,r){this.multiple=void 0,this.basename=void 0,this.counter={},this.multiple=e,this.basename=r}createURI(e,r){if(e.getURI())return e.getURI();if(this.multiple){const n=this.basename(e);return this.counter[n]=this.counter[n]||1,`${n}_${this.counter[n]++}.${r}`}return`${this.basename(e)}.${r}`}};const{BufferViewUsage:_n}=ht,{UNSIGNED_INT:ed,UNSIGNED_SHORT:td,UNSIGNED_BYTE:rd}=re.ComponentType;let nd=class{static write(e,r){const n=e.getRoot(),s={asset:We({generator:`glTF-Transform ${$a}`},n.getAsset()),extras:We({},n.getExtras())},a={json:s,resources:{}},c=new ht(e,a,r),f=r.logger||er.DEFAULT_INSTANCE,h=new Set(r.extensions.map(m=>m.EXTENSION_NAME)),d=e.getRoot().listExtensionsUsed().filter(m=>h.has(m.extensionName)),g=e.getRoot().listExtensionsRequired().filter(m=>h.has(m.extensionName));d.length<e.getRoot().listExtensionsUsed().length&&f.warn("Some extensions were not registered for I/O, and will not be written.");for(const m of d)for(const C of m.writeDependencies)m.install(C,r.dependencies[C]);function T(m,C,x,_){const b=[];let O=0;for(const z of m){const L=c.createAccessorDef(z);L.bufferView=s.bufferViews.length;const k=z.getArray(),W=le.pad(le.toView(k));L.byteOffset=O,O+=W.byteLength,b.push(W),c.accessorIndexMap.set(z,s.accessors.length),s.accessors.push(L)}const P={buffer:C,byteOffset:x,byteLength:le.concat(b).byteLength};return _&&(P.target=_),s.bufferViews.push(P),{buffers:b,byteLength:O}}function E(m,C,x){const _=m[0].getCount();let b=0;for(const L of m){const k=c.createAccessorDef(L);k.bufferView=s.bufferViews.length,k.byteOffset=b;const W=L.getElementSize(),j=L.getComponentSize();b+=le.padNumber(W*j),c.accessorIndexMap.set(L,s.accessors.length),s.accessors.push(k)}const O=_*b,P=new ArrayBuffer(O),z=new DataView(P);for(let L=0;L<_;L++){let k=0;for(const W of m){const j=W.getElementSize(),Y=W.getComponentSize(),H=W.getComponentType(),B=W.getArray();for(let G=0;G<j;G++){const Q=L*b+k+G*Y,oe=B[L*j+G];switch(H){case re.ComponentType.FLOAT:z.setFloat32(Q,oe,!0);break;case re.ComponentType.BYTE:z.setInt8(Q,oe);break;case re.ComponentType.SHORT:z.setInt16(Q,oe,!0);break;case re.ComponentType.UNSIGNED_BYTE:z.setUint8(Q,oe);break;case re.ComponentType.UNSIGNED_SHORT:z.setUint16(Q,oe,!0);break;case re.ComponentType.UNSIGNED_INT:z.setUint32(Q,oe,!0);break;default:throw new Error("Unexpected component type: "+H)}}k+=le.padNumber(j*Y)}}return s.bufferViews.push({buffer:C,byteOffset:x,byteLength:O,byteStride:b,target:ht.BufferViewTarget.ARRAY_BUFFER}),{byteLength:O,buffers:[new Uint8Array(P)]}}function R(m,C,x){const _=[];let b=0;const O=new Map;let P=-1/0;for(const H of m){const B=c.createAccessorDef(H);s.accessors.push(B),c.accessorIndexMap.set(H,s.accessors.length-1);const G=[],Q=[],oe=[],ve=new Array(H.getElementSize()).fill(0);for(let Me=0,Pe=H.getCount();Me<Pe;Me++)if(H.getElement(Me,oe),!Ne.eq(oe,ve,0)){P=Math.max(Me,P),G.push(Me);for(let be=0;be<oe.length;be++)Q.push(oe[be])}const ye=G.length,me={accessorDef:B,count:ye};if(O.set(H,me),ye===0)continue;if(ye>H.getCount()/3){const Me=(100*G.length/H.getCount()).toFixed(1);f.warn(`Sparse accessor with many non-zero elements (${Me}%) may increase file size.`)}const Te=Nn[H.getComponentType()];me.indices=G,me.values=new Te(Q)}if(!Number.isFinite(P))return{buffers:_,byteLength:b};const z=P<255?Uint8Array:P<65535?Uint16Array:Uint32Array,L=P<255?rd:P<65535?td:ed,k={buffer:C,byteOffset:x+b,byteLength:0};for(const H of m){const B=O.get(H);if(B.count===0)continue;B.indicesByteOffset=k.byteLength;const G=le.pad(le.toView(new z(B.indices)));_.push(G),b+=G.byteLength,k.byteLength+=G.byteLength}s.bufferViews.push(k);const W=s.bufferViews.length-1,j={buffer:C,byteOffset:x+b,byteLength:0};for(const H of m){const B=O.get(H);if(B.count===0)continue;B.valuesByteOffset=j.byteLength;const G=le.pad(le.toView(B.values));_.push(G),b+=G.byteLength,j.byteLength+=G.byteLength}s.bufferViews.push(j);const Y=s.bufferViews.length-1;for(const H of m){const B=O.get(H);B.count!==0&&(B.accessorDef.sparse={count:B.count,indices:{bufferView:W,byteOffset:B.indicesByteOffset,componentType:L},values:{bufferView:Y,byteOffset:B.valuesByteOffset}})}return{buffers:_,byteLength:b}}const A=new Map;for(const m of e.getGraph().listEdges()){if(m.getParent()===n)continue;const C=m.getChild();if(C instanceof re){const x=A.get(C)||[];x.push(m),A.set(C,x)}}if(s.accessors=[],s.bufferViews=[],s.samplers=[],s.textures=[],s.images=n.listTextures().map((m,C)=>{const x=c.createPropertyDef(m);m.getMimeType()&&(x.mimeType=m.getMimeType());const _=m.getImage();return _&&c.createImageData(x,_,m),c.imageIndexMap.set(m,C),x}),d.filter(m=>m.prewriteTypes.includes(J.ACCESSOR)).forEach(m=>m.prewrite(c,J.ACCESSOR)),n.listAccessors().forEach(m=>{const C=c.accessorUsageGroupedByParent,x=c.accessorParents;if(c.accessorIndexMap.has(m))return;const _=A.get(m)||[],b=c.getAccessorUsage(m);if(c.addAccessorToUsageGroup(m,b),C.has(b)){const O=_[0].getParent(),P=x.get(O)||new Set;P.add(m),x.set(O,P)}}),d.filter(m=>m.prewriteTypes.includes(J.BUFFER)).forEach(m=>m.prewrite(c,J.BUFFER)),(n.listAccessors().length>0||n.listTextures().length>0||c.otherBufferViews.size>0)&&n.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");s.buffers=[],n.listBuffers().forEach((m,C)=>{const x=c.createPropertyDef(m),_=c.accessorUsageGroupedByParent,b=c.accessorParents,O=m.listParents().filter(j=>j instanceof re),P=new Set(O),z=[],L=s.buffers.length;let k=0;const W=c.listAccessorUsageGroups();for(const j in W)if(_.has(j))for(const Y of Array.from(b.values())){const H=Array.from(Y).filter(B=>P.has(B)).filter(B=>c.getAccessorUsage(B)===j);if(H.length)if(j!==_n.ARRAY_BUFFER||r.vertexLayout===Cn.INTERLEAVED){const B=j===_n.ARRAY_BUFFER?E(H,L,k):T(H,L,k);k+=B.byteLength,z.push(...B.buffers)}else for(const B of H){const G=E([B],L,k);k+=G.byteLength,z.push(...G.buffers)}}else{const Y=W[j].filter(G=>P.has(G));if(!Y.length)continue;const H=j===_n.ELEMENT_ARRAY_BUFFER?ht.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0,B=j===_n.SPARSE?R(Y,L,k):T(Y,L,k,H);k+=B.byteLength,z.push(...B.buffers)}if(c.imageBufferViews.length&&C===0){for(let j=0;j<c.imageBufferViews.length;j++)if(s.bufferViews[s.images[j].bufferView].byteOffset=k,k+=c.imageBufferViews[j].byteLength,z.push(c.imageBufferViews[j]),k%8){const Y=8-k%8;k+=Y,z.push(new Uint8Array(Y))}}if(c.otherBufferViews.has(m))for(const j of c.otherBufferViews.get(m))s.bufferViews.push({buffer:L,byteOffset:k,byteLength:j.byteLength}),c.otherBufferViewsIndexMap.set(j,s.bufferViews.length-1),k+=j.byteLength,z.push(j);if(k){let j;r.format===Qt.GLB?j=xr:(j=c.bufferURIGenerator.createURI(m,"bin"),x.uri=j),x.byteLength=k,a.resources[j]=le.concat(z)}s.buffers.push(x),c.bufferIndexMap.set(m,C)}),n.listAccessors().find(m=>!m.getBuffer())&&f.warn("Skipped writing one or more Accessors: no Buffer assigned."),s.materials=n.listMaterials().map((m,C)=>{const x=c.createPropertyDef(m);if(m.getAlphaMode()!==Er.AlphaMode.OPAQUE&&(x.alphaMode=m.getAlphaMode()),m.getAlphaMode()===Er.AlphaMode.MASK&&(x.alphaCutoff=m.getAlphaCutoff()),m.getDoubleSided()&&(x.doubleSided=!0),x.pbrMetallicRoughness={},Ne.eq(m.getBaseColorFactor(),[1,1,1,1])||(x.pbrMetallicRoughness.baseColorFactor=m.getBaseColorFactor()),Ne.eq(m.getEmissiveFactor(),[0,0,0])||(x.emissiveFactor=m.getEmissiveFactor()),m.getRoughnessFactor()!==1&&(x.pbrMetallicRoughness.roughnessFactor=m.getRoughnessFactor()),m.getMetallicFactor()!==1&&(x.pbrMetallicRoughness.metallicFactor=m.getMetallicFactor()),m.getBaseColorTexture()){const _=m.getBaseColorTexture(),b=m.getBaseColorTextureInfo();x.pbrMetallicRoughness.baseColorTexture=c.createTextureInfoDef(_,b)}if(m.getEmissiveTexture()){const _=m.getEmissiveTexture(),b=m.getEmissiveTextureInfo();x.emissiveTexture=c.createTextureInfoDef(_,b)}if(m.getNormalTexture()){const _=m.getNormalTexture(),b=m.getNormalTextureInfo(),O=c.createTextureInfoDef(_,b);m.getNormalScale()!==1&&(O.scale=m.getNormalScale()),x.normalTexture=O}if(m.getOcclusionTexture()){const _=m.getOcclusionTexture(),b=m.getOcclusionTextureInfo(),O=c.createTextureInfoDef(_,b);m.getOcclusionStrength()!==1&&(O.strength=m.getOcclusionStrength()),x.occlusionTexture=O}if(m.getMetallicRoughnessTexture()){const _=m.getMetallicRoughnessTexture(),b=m.getMetallicRoughnessTextureInfo();x.pbrMetallicRoughness.metallicRoughnessTexture=c.createTextureInfoDef(_,b)}return c.materialIndexMap.set(m,C),x}),s.meshes=n.listMeshes().map((m,C)=>{const x=c.createPropertyDef(m);let _=null;return x.primitives=m.listPrimitives().map(b=>{const O={attributes:{}};O.mode=b.getMode();const P=b.getMaterial();P&&(O.material=c.materialIndexMap.get(P)),Object.keys(b.getExtras()).length&&(O.extras=b.getExtras());const z=b.getIndices();z&&(O.indices=c.accessorIndexMap.get(z));for(const L of b.listSemantics())O.attributes[L]=c.accessorIndexMap.get(b.getAttribute(L));for(const L of b.listTargets()){const k={};for(const W of L.listSemantics())k[W]=c.accessorIndexMap.get(L.getAttribute(W));O.targets=O.targets||[],O.targets.push(k)}return b.listTargets().length&&!_&&(_=b.listTargets().map(L=>L.getName())),O}),m.getWeights().length&&(x.weights=m.getWeights()),_&&(x.extras=x.extras||{},x.extras.targetNames=_),c.meshIndexMap.set(m,C),x}),s.cameras=n.listCameras().map((m,C)=>{const x=c.createPropertyDef(m);if(x.type=m.getType(),x.type===Qr.Type.PERSPECTIVE){x.perspective={znear:m.getZNear(),zfar:m.getZFar(),yfov:m.getYFov()};const _=m.getAspectRatio();_!==null&&(x.perspective.aspectRatio=_)}else x.orthographic={znear:m.getZNear(),zfar:m.getZFar(),xmag:m.getXMag(),ymag:m.getYMag()};return c.cameraIndexMap.set(m,C),x}),s.nodes=n.listNodes().map((m,C)=>{const x=c.createPropertyDef(m);return Ne.eq(m.getTranslation(),[0,0,0])||(x.translation=m.getTranslation()),Ne.eq(m.getRotation(),[0,0,0,1])||(x.rotation=m.getRotation()),Ne.eq(m.getScale(),[1,1,1])||(x.scale=m.getScale()),m.getWeights().length&&(x.weights=m.getWeights()),c.nodeIndexMap.set(m,C),x}),s.skins=n.listSkins().map((m,C)=>{const x=c.createPropertyDef(m),_=m.getInverseBindMatrices();_&&(x.inverseBindMatrices=c.accessorIndexMap.get(_));const b=m.getSkeleton();return b&&(x.skeleton=c.nodeIndexMap.get(b)),x.joints=m.listJoints().map(O=>c.nodeIndexMap.get(O)),c.skinIndexMap.set(m,C),x}),n.listNodes().forEach((m,C)=>{const x=s.nodes[C],_=m.getMesh();_&&(x.mesh=c.meshIndexMap.get(_));const b=m.getCamera();b&&(x.camera=c.cameraIndexMap.get(b));const O=m.getSkin();O&&(x.skin=c.skinIndexMap.get(O)),m.listChildren().length>0&&(x.children=m.listChildren().map(P=>c.nodeIndexMap.get(P)))}),s.animations=n.listAnimations().map((m,C)=>{const x=c.createPropertyDef(m),_=new Map;return x.samplers=m.listSamplers().map((b,O)=>{const P=c.createPropertyDef(b);return P.input=c.accessorIndexMap.get(b.getInput()),P.output=c.accessorIndexMap.get(b.getOutput()),P.interpolation=b.getInterpolation(),_.set(b,O),P}),x.channels=m.listChannels().map(b=>{const O=c.createPropertyDef(b);return O.sampler=_.get(b.getSampler()),O.target={node:c.nodeIndexMap.get(b.getTargetNode()),path:b.getTargetPath()},O}),c.animationIndexMap.set(m,C),x}),s.scenes=n.listScenes().map((m,C)=>{const x=c.createPropertyDef(m);return x.nodes=m.listChildren().map(_=>c.nodeIndexMap.get(_)),c.sceneIndexMap.set(m,C),x});const N=n.getDefaultScene();return N&&(s.scene=n.listScenes().indexOf(N)),s.extensionsUsed=d.map(m=>m.extensionName),s.extensionsRequired=g.map(m=>m.extensionName),d.forEach(m=>m.write(c)),function(m){const C=[];for(const x in m){const _=m[x];(Array.isArray(_)&&_.length===0||_===null||_===""||_&&typeof _=="object"&&Object.keys(_).length===0)&&C.push(x)}for(const x of C)delete m[x]}(s),a}};var Fn;(function(t){t[t.JSON=1313821514]="JSON",t[t.BIN=5130562]="BIN"})(Fn||(Fn={}));let sd=class{constructor(){this.M=er.DEFAULT_INSTANCE,this.l=new Set,this.U={},this.P=Cn.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.M=e,this}registerExtensions(e){for(const r of e)this.l.add(r),r.register();return this}registerDependencies(e){return Object.assign(this.U,e),this}setVertexLayout(e){return this.P=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){const r=await this.readURI(e,"view");this.lastReadBytes=r.byteLength;const n=la(r)?this.L(r):{json:JSON.parse(le.decodeText(r)),resources:{}};return await this.j(n,this.dirname(e)),this.D(n),n}async readJSON(e){return e=this._(e),this.D(e),Qh.read(e,{extensions:Array.from(this.l),dependencies:this.U,logger:this.M})}async binaryToJSON(e){const r=this.L(le.assertView(e));this.D(r);const n=r.json;if(n.buffers&&n.buffers.some(s=>function(a,c){return c.uri!==void 0&&!(c.uri in a.resources)}(r,s)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(n.images&&n.images.some(s=>function(a,c){return c.uri!==void 0&&!(c.uri in a.resources)&&c.bufferView===void 0}(r,s)))throw new Error("Cannot resolve external images with binaryToJSON().");return r}async readBinary(e){return this.readJSON(await this.binaryToJSON(le.assertView(e)))}async writeJSON(e,r={}){if(r.format===Qt.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 0–1 buffers.");return nd.write(e,{format:r.format||Qt.GLTF,basename:r.basename||"",logger:this.M,vertexLayout:this.P,dependencies:We({},this.U),extensions:Array.from(this.l)})}async writeBinary(e){const{json:r,resources:n}=await this.writeJSON(e,{format:Qt.GLB}),s=new Uint32Array([1179937895,2,12]),a=JSON.stringify(r),c=le.pad(le.encodeText(a),32),f=le.toView(new Uint32Array([c.byteLength,1313821514])),h=le.concat([f,c]);s[s.length-1]+=h.byteLength;const d=Object.values(n)[0];if(!d||!d.byteLength)return le.concat([le.toView(s),h]);const g=le.pad(d,0),T=le.toView(new Uint32Array([g.byteLength,5130562])),E=le.concat([T,g]);return s[s.length-1]+=E.byteLength,le.concat([le.toView(s),h,E])}async j(e,r){var n=this;const s=[...e.json.images||[],...e.json.buffers||[]].map(async function(a){const c=a.uri;if(!c||c.match(/data:/))return Promise.resolve();e.resources[c]=await n.readURI(n.resolve(r,c),"view"),n.lastReadBytes+=e.resources[c].byteLength});await Promise.all(s)}D(e){function r(n){if(n.uri){if(n.uri in e.resources)le.assertView(e.resources[n.uri]);else if(n.uri.match(/data:/)){const s=`__${Xh()}.${Tr.extension(n.uri)}`;e.resources[s]=le.createBufferFromDataURI(n.uri),n.uri=s}}}(e.json.images||[]).forEach(n=>{if(n.bufferView===void 0&&n.uri===void 0)throw new Error("Missing resource URI or buffer view.");r(n)}),(e.json.buffers||[]).forEach(r)}_(e){const{images:r,buffers:n}=e.json;return e={json:We({},e.json),resources:We({},e.resources)},r&&(e.json.images=r.map(s=>We({},s))),n&&(e.json.buffers=n.map(s=>We({},s))),e}L(e){if(!la(e))throw new Error("Invalid glTF 2.0 binary.");const r=new Uint32Array(e.buffer,e.byteOffset+12,2);if(r[1]!==Fn.JSON)throw new Error("Missing required GLB JSON chunk.");const n=r[0],s=le.decodeText(le.toView(e,20,n)),a=JSON.parse(s),c=20+n;if(e.byteLength<=c)return{json:a,resources:{}};const f=new Uint32Array(e.buffer,e.byteOffset+c,2);if(f[1]!==Fn.BIN)throw new Error("Expected GLB BIN in second chunk.");const h=le.toView(e,c+8,f[0]);return{json:a,resources:{[xr]:h}}}};function la(t){if(t.byteLength<3*Uint32Array.BYTES_PER_ELEMENT)return!1;const e=new Uint32Array(t.buffer,t.byteOffset,3);return e[0]===1179937895&&e[1]===2}let id=class extends sd{constructor(e=Gr.DEFAULT_INIT){super(),this.J=void 0,this.J=e}async readURI(e,r){const n=await fetch(e,this.J);switch(r){case"view":return new Uint8Array(await n.arrayBuffer());case"text":return n.text()}}resolve(e,r){return Gr.resolve(e,r)}dirname(e){return Gr.dirname(e)}};const ad=0,od=0,cd=0,ld=2,fd=0,ud=163,hd=166,dd=0,pd=2,gd=1,md=64,vd=0;class yd{constructor(){this.vkFormat=vd,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=ad,this.levels=[],this.dataFormatDescriptor=[{vendorId:cd,descriptorType:od,descriptorBlockSize:0,versionNumber:ld,colorModel:fd,colorPrimaries:gd,transferFunction:pd,flags:dd,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Fr{constructor(e,r,n,s){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+r,n),this._littleEndian=s,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian),r=this._dataView.getUint32(this._offset+4,this._littleEndian),n=e+2**32*r;return this._offset+=8,n}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){const r=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,r}_skip(e){return this._offset+=e,this}_scan(e,r=0){const n=this._offset;let s=0;for(;this._dataView.getUint8(this._offset)!==r&&s<e;)s++,this._offset++;return s<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,s)}}const He=[171,75,84,88,32,50,48,187,13,10,26,10];function fa(t){return typeof TextDecoder<"u"?new TextDecoder().decode(t):Buffer.from(t).toString("utf8")}function gs(t){const e=new Uint8Array(t.buffer,t.byteOffset,He.length);if(e[0]!==He[0]||e[1]!==He[1]||e[2]!==He[2]||e[3]!==He[3]||e[4]!==He[4]||e[5]!==He[5]||e[6]!==He[6]||e[7]!==He[7]||e[8]!==He[8]||e[9]!==He[9]||e[10]!==He[10]||e[11]!==He[11])throw new Error("Missing KTX 2.0 identifier.");const r=new yd,n=17*Uint32Array.BYTES_PER_ELEMENT,s=new Fr(t,He.length,n,!0);r.vkFormat=s._nextUint32(),r.typeSize=s._nextUint32(),r.pixelWidth=s._nextUint32(),r.pixelHeight=s._nextUint32(),r.pixelDepth=s._nextUint32(),r.layerCount=s._nextUint32(),r.faceCount=s._nextUint32();const a=s._nextUint32();r.supercompressionScheme=s._nextUint32();const c=s._nextUint32(),f=s._nextUint32(),h=s._nextUint32(),d=s._nextUint32(),g=s._nextUint64(),T=s._nextUint64(),E=a*3*8,R=new Fr(t,He.length+n,E,!0);for(let me=0;me<a;me++)r.levels.push({levelData:new Uint8Array(t.buffer,t.byteOffset+R._nextUint64(),R._nextUint64()),uncompressedByteLength:R._nextUint64()});const A=new Fr(t,c,f,!0),N={vendorId:A._skip(4)._nextUint16(),descriptorType:A._nextUint16(),versionNumber:A._nextUint16(),descriptorBlockSize:A._nextUint16(),colorModel:A._nextUint8(),colorPrimaries:A._nextUint8(),transferFunction:A._nextUint8(),flags:A._nextUint8(),texelBlockDimension:[A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8()],bytesPlane:[A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8()],samples:[]},m=6,C=4,x=(N.descriptorBlockSize/4-m)/C;for(let me=0;me<x;me++){const Te={bitOffset:A._nextUint16(),bitLength:A._nextUint8(),channelType:A._nextUint8(),samplePosition:[A._nextUint8(),A._nextUint8(),A._nextUint8(),A._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};Te.channelType&md?(Te.sampleLower=A._nextInt32(),Te.sampleUpper=A._nextInt32()):(Te.sampleLower=A._nextUint32(),Te.sampleUpper=A._nextUint32()),N.samples[me]=Te}r.dataFormatDescriptor.length=0,r.dataFormatDescriptor.push(N);const _=new Fr(t,h,d,!0);for(;_._offset<d;){const me=_._nextUint32(),Te=_._scan(me),Me=fa(Te);if(r.keyValue[Me]=_._nextUint8Array(me-Te.byteLength-1),Me.match(/^ktx/i)){const be=fa(r.keyValue[Me]);r.keyValue[Me]=be.substring(0,be.lastIndexOf("\0"))}const Pe=me%4?4-me%4:0;_._skip(Pe)}if(T<=0)return r;const b=new Fr(t,g,T,!0),O=b._nextUint16(),P=b._nextUint16(),z=b._nextUint32(),L=b._nextUint32(),k=b._nextUint32(),W=b._nextUint32(),j=[];for(let me=0;me<a;me++)j.push({imageFlags:b._nextUint32(),rgbSliceByteOffset:b._nextUint32(),rgbSliceByteLength:b._nextUint32(),alphaSliceByteOffset:b._nextUint32(),alphaSliceByteLength:b._nextUint32()});const Y=g+b._offset,H=Y+z,B=H+L,G=B+k,Q=new Uint8Array(t.buffer,t.byteOffset+Y,z),oe=new Uint8Array(t.buffer,t.byteOffset+H,L),ve=new Uint8Array(t.buffer,t.byteOffset+B,k),ye=new Uint8Array(t.buffer,t.byteOffset+G,W);return r.globalData={endpointCount:O,selectorCount:P,imageDescs:j,endpointsData:Q,selectorsData:oe,tablesData:ve,extendedData:ye},r}const zs="EXT_mesh_gpu_instancing",As="EXT_meshopt_compression",Za="KHR_draco_mesh_compression",Gs="KHR_lights_punctual",Hs="KHR_materials_anisotropy",qs="KHR_materials_clearcoat",Ws="KHR_materials_emissive_strength",Xs="KHR_materials_ior",Ys="KHR_materials_iridescence",Ks="KHR_materials_pbrSpecularGlossiness",Js="KHR_materials_sheen",Zs="KHR_materials_specular",Qs="KHR_materials_transmission",ei="KHR_materials_unlit",ti="KHR_materials_volume",sr="KHR_materials_variants",ri="KHR_texture_transform",Dn="KHR_xmp_json_ld",Ss="INSTANCE_ATTRIBUTE";class Qa extends $e{init(){this.extensionName=zs,this.propertyType="InstancedMesh",this.parentTypes=[J.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,r){return this.setRefMap("attributes",e,r,{usage:Ss})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}Qa.EXTENSION_NAME=zs;const Ut=zs;class eo extends Ie{constructor(...e){super(...e),this.extensionName=Ut,this.provideTypes=[J.NODE],this.prewriteTypes=[J.ACCESSOR]}createInstancedMesh(){return new Qa(this.document.getGraph())}read(e){return(e.jsonDoc.json.nodes||[]).forEach((r,n)=>{if(!r.extensions||!r.extensions[Ut])return;const s=r.extensions[Ut],a=this.createInstancedMesh();for(const c in s.attributes)a.setAttribute(c,e.accessors[s.attributes[c]]);e.nodes[n].setExtension(Ut,a)}),this}prewrite(e){e.accessorUsageGroupedByParent.add(Ss);for(const r of this.properties)for(const n of r.listAttributes())e.addAccessorToUsageGroup(n,Ss);return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listNodes().forEach(n=>{const s=n.getExtension(Ut);if(s){const a=e.nodeIndexMap.get(n),c=r.json.nodes[a],f={attributes:{}};s.listSemantics().forEach(h=>{const d=s.getAttribute(h);f.attributes[h]=e.accessorIndexMap.get(d)}),c.extensions=c.extensions||{},c.extensions[Ut]=f}}),this}}function bt(){return bt=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},bt.apply(this,arguments)}var Kr,mr,De;eo.EXTENSION_NAME=Ut,function(t){t.QUANTIZE="quantize",t.FILTER="filter"}(Kr||(Kr={})),function(t){t.ATTRIBUTES="ATTRIBUTES",t.TRIANGLES="TRIANGLES",t.INDICES="INDICES"}(mr||(mr={})),function(t){t.NONE="NONE",t.OCTAHEDRAL="OCTAHEDRAL",t.QUATERNION="QUATERNION",t.EXPONENTIAL="EXPONENTIAL"}(De||(De={}));const{BYTE:xd,SHORT:ua,FLOAT:Td}=re.ComponentType,{encodeNormalizedInt:ha,decodeNormalizedInt:ms}=Ne;function Ed(t,e,r,n){const{filter:s,bits:a}=n,c={array:t.getArray(),byteStride:t.getElementSize()*t.getComponentSize(),componentType:t.getComponentType(),normalized:t.getNormalized()};if(r!==mr.ATTRIBUTES)return c;if(s!==De.NONE){let f=t.getNormalized()?function(h){const d=h.getComponentType(),g=h.getArray(),T=new Float32Array(g.length);for(let E=0;E<g.length;E++)T[E]=ms(g[E],d);return T}(t):new Float32Array(c.array);switch(s){case De.EXPONENTIAL:c.byteStride=4*t.getElementSize(),c.componentType=Td,c.normalized=!1,c.array=e.encodeFilterExp(f,t.getCount(),c.byteStride,a);break;case De.OCTAHEDRAL:c.byteStride=a>8?8:4,c.componentType=a>8?ua:xd,c.normalized=!0,f=t.getElementSize()===3?function(h){const d=new Float32Array(4*h.length/3);for(let g=0,T=h.length/3;g<T;g++)d[4*g]=h[3*g],d[4*g+1]=h[3*g+1],d[4*g+2]=h[3*g+2];return d}(f):f,c.array=e.encodeFilterOct(f,t.getCount(),c.byteStride,a);break;case De.QUATERNION:c.byteStride=8,c.componentType=ua,c.normalized=!0,c.array=e.encodeFilterQuat(f,t.getCount(),c.byteStride,a);break;default:throw new Error("Invalid filter.")}c.min=t.getMin([]),c.max=t.getMax([]),t.getNormalized()&&(c.min=c.min.map(h=>ms(h,t.getComponentType())),c.max=c.max.map(h=>ms(h,t.getComponentType()))),c.normalized&&(c.min=c.min.map(h=>ha(h,c.componentType)),c.max=c.max.map(h=>ha(h,c.componentType)))}else c.byteStride%4&&(c.array=function(f,h){const d=le.padNumber(f.BYTES_PER_ELEMENT*h)/f.BYTES_PER_ELEMENT,g=new f.constructor(f.length/h*d);for(let T=0;T*h<f.length;T++)for(let E=0;E<h;E++)g[T*d+E]=f[T*h+E];return g}(c.array,t.getElementSize()),c.byteStride=c.array.byteLength/t.getCount());return c}function wd(t,e){return e===ht.BufferViewUsage.ELEMENT_ARRAY_BUFFER?t.listParents().some(r=>r instanceof Yr&&r.getMode()===Yr.Mode.TRIANGLES)?mr.TRIANGLES:mr.INDICES:mr.ATTRIBUTES}function Md(t,e){const r=e.getGraph().listParentEdges(t).filter(n=>!(n.getParent()instanceof Ja));for(const n of r){const s=n.getName(),a=n.getAttributes().key||"",c=n.getParent().propertyType===J.PRIMITIVE_TARGET;if(s==="indices")return{filter:De.NONE};if(s==="attributes"){if(a==="POSITION")return{filter:De.NONE};if(a==="TEXCOORD_0")return{filter:De.NONE};if(a.startsWith("JOINTS_"))return{filter:De.NONE};if(a.startsWith("WEIGHTS_"))return{filter:De.NONE};if(a==="NORMAL"||a==="TANGENT")return c?{filter:De.NONE}:{filter:De.OCTAHEDRAL,bits:8}}if(s==="output"){const f=to(t);return f==="rotation"?{filter:De.QUATERNION,bits:16}:f==="translation"||f==="scale"?{filter:De.EXPONENTIAL,bits:12}:{filter:De.NONE}}if(s==="input")return{filter:De.NONE};if(s==="inverseBindMatrices")return{filter:De.NONE}}return{filter:De.NONE}}function to(t){for(const e of t.listParents())if(e instanceof Vn){for(const r of e.listParents())if(r instanceof Bs)return r.getTargetPath()}return null}const qe=As,da={method:Kr.QUANTIZE};class Is extends Ie{constructor(...e){super(...e),this.extensionName=qe,this.prereadTypes=[J.BUFFER,J.PRIMITIVE],this.prewriteTypes=[J.BUFFER,J.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=da,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,r){return e==="meshopt.decoder"&&(this._decoder=r),e==="meshopt.encoder"&&(this._encoder=r),this}setEncoderOptions(e){return this._encoderOptions=bt({},da,e),this}preread(e,r){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${qe}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${qe}]: Missing WASM support.`)}return r===J.BUFFER?this._prereadBuffers(e):r===J.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const r=e.jsonDoc;(r.json.bufferViews||[]).forEach((n,s)=>{if(!n.extensions||!n.extensions[qe])return;const a=n.extensions[qe],c=a.byteOffset||0,f=a.byteLength||0,h=a.count,d=a.byteStride,g=new Uint8Array(h*d),T=r.json.buffers[a.buffer],E=le.toView(T.uri?r.resources[T.uri]:r.resources[xr],c,f);this._decoder.decodeGltfBuffer(g,h,d,E,a.mode,a.filter),e.bufferViews[s]=g})}_prereadPrimitives(e){const r=e.jsonDoc;(r.json.bufferViews||[]).forEach(n=>{var s;n.extensions&&n.extensions[qe]&&(s=r.json.buffers[n.buffer]).extensions&&s.extensions[As]&&s.extensions[As].fallback&&this._decoderFallbackBufferMap.set(e.buffers[n.buffer],e.buffers[n.extensions[qe].buffer])})}read(e){if(!this.isRequired())return this;for(const[r,n]of this._decoderFallbackBufferMap){for(const s of r.listParents())s instanceof re&&s.swap(r,n);r.dispose()}return this}prewrite(e,r){return r===J.ACCESSOR?this._prewriteAccessors(e):r===J.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const r=e.jsonDoc.json,n=this._encoder,s=this._encoderOptions,a=this.document.createBuffer(),c=this.document.getRoot().listBuffers().indexOf(a);this._encoderFallbackBuffer=a,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const f of this.document.getRoot().listAccessors()){if(to(f)==="weights"||f.getSparse())continue;const h=e.getAccessorUsage(f),d=wd(f,h),g=s.method===Kr.FILTER?Md(f,this.document):{filter:De.NONE},T=Ed(f,n,d,g),{array:E,byteStride:R}=T,A=f.getBuffer();if(!A)throw new Error(`${qe}: Missing buffer for accessor.`);const N=this.document.getRoot().listBuffers().indexOf(A),m=[h,d,g.filter,R,N].join(":");let C=this._encoderBufferViews[m],x=this._encoderBufferViewData[m],_=this._encoderBufferViewAccessors[m];C&&x||(_=this._encoderBufferViewAccessors[m]=[],x=this._encoderBufferViewData[m]=[],C=this._encoderBufferViews[m]={buffer:c,target:ht.USAGE_TO_TARGET[h],byteOffset:0,byteLength:0,byteStride:h===ht.BufferViewUsage.ARRAY_BUFFER?R:void 0,extensions:{[qe]:{buffer:N,byteOffset:0,byteLength:0,mode:d,filter:g.filter!==De.NONE?g.filter:void 0,byteStride:R,count:0}}});const b=e.createAccessorDef(f);b.componentType=T.componentType,b.normalized=T.normalized,b.byteOffset=C.byteLength,b.min&&T.min&&(b.min=T.min),b.max&&T.max&&(b.max=T.max),e.accessorIndexMap.set(f,r.accessors.length),r.accessors.push(b),_.push(b),x.push(new Uint8Array(E.buffer,E.byteOffset,E.byteLength)),C.byteLength+=E.byteLength,C.extensions.EXT_meshopt_compression.count+=f.getCount()}}_prewriteBuffers(e){const r=this._encoder;for(const n in this._encoderBufferViews){const s=this._encoderBufferViews[n],a=this._encoderBufferViewData[n],c=this.document.getRoot().listBuffers()[s.extensions[qe].buffer],f=e.otherBufferViews.get(c)||[],{count:h,byteStride:d,mode:g}=s.extensions[qe],T=le.concat(a),E=r.encodeGltfBuffer(T,h,d,g),R=le.pad(E);s.extensions[qe].byteLength=E.byteLength,a.length=0,a.push(R),f.push(R),e.otherBufferViews.set(c,f)}}write(e){let r=0;for(const c in this._encoderBufferViews){const f=this._encoderBufferViews[c],h=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[c][0]),d=this._encoderBufferViewAccessors[c];for(const E of d)E.bufferView=h;const g=e.jsonDoc.json.bufferViews[h],T=g.byteOffset||0;Object.assign(g,f),g.byteOffset=r,g.extensions[qe].byteOffset=T,r+=le.padNumber(f.byteLength)}const n=this._encoderFallbackBuffer,s=e.bufferIndexMap.get(n),a=e.jsonDoc.json.buffers[s];return a.byteLength=r,a.extensions={[qe]:{fallback:!0}},n.dispose(),this}}Is.EXTENSION_NAME=qe,Is.EncoderMethod=Kr;const jr="EXT_texture_avif";class _d{match(e){return e.length>=12&&le.decodeText(e.slice(4,12))==="ftypavif"}getSize(e){if(!this.match(e))return null;const r=new DataView(e.buffer,e.byteOffset,e.byteLength);let n=pa(r,0);if(!n)return null;let s=n.end;for(;n=pa(r,s);)if(n.type==="meta")s=n.start+4;else if(n.type==="iprp"||n.type==="ipco")s=n.start;else{if(n.type==="ispe")return[r.getUint32(n.start+4),r.getUint32(n.start+8)];if(n.type==="mdat")break;s=n.end}return null}getChannels(e){return 4}}class ro extends Ie{constructor(...e){super(...e),this.extensionName=jr,this.prereadTypes=[J.TEXTURE]}static register(){xt.registerFormat("image/avif",new _d)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(r=>{r.extensions&&r.extensions[jr]&&(r.source=r.extensions[jr].source)}),this}read(e){return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/avif"){const s=e.imageIndexMap.get(n);(r.json.textures||[]).forEach(a=>{a.source===s&&(a.extensions=a.extensions||{},a.extensions[jr]={source:a.source},delete a.source)})}}),this}}function pa(t,e){if(t.byteLength<4+e)return null;const r=t.getUint32(e);return t.byteLength<r+e||r<8?null:{type:le.decodeText(new Uint8Array(t.buffer,t.byteOffset+e+4,4)),start:e+8,end:e+r}}ro.EXTENSION_NAME=jr;const Br="EXT_texture_webp";class Rd{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const r=le.decodeText(e.slice(0,4)),n=le.decodeText(e.slice(8,12));if(r!=="RIFF"||n!=="WEBP")return null;const s=new DataView(e.buffer,e.byteOffset);let a=12;for(;a<s.byteLength;){const c=le.decodeText(new Uint8Array([s.getUint8(a),s.getUint8(a+1),s.getUint8(a+2),s.getUint8(a+3)])),f=s.getUint32(a+4,!0);if(c==="VP8 ")return[16383&s.getInt16(a+14,!0),16383&s.getInt16(a+16,!0)];if(c==="VP8L"){const h=s.getUint8(a+9),d=s.getUint8(a+10),g=s.getUint8(a+11);return[1+((63&d)<<8|h),1+((15&s.getUint8(a+12))<<10|g<<2|(192&d)>>6)]}a+=8+f+f%2}return null}getChannels(e){return 4}}class no extends Ie{constructor(...e){super(...e),this.extensionName=Br,this.prereadTypes=[J.TEXTURE]}static register(){xt.registerFormat("image/webp",new Rd)}preread(e){return(e.jsonDoc.json.textures||[]).forEach(r=>{r.extensions&&r.extensions[Br]&&(r.source=r.extensions[Br].source)}),this}read(e){return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/webp"){const s=e.imageIndexMap.get(n);(r.json.textures||[]).forEach(a=>{a.source===s&&(a.extensions=a.extensions||{},a.extensions[Br]={source:a.source},delete a.source)})}}),this}}no.EXTENSION_NAME=Br;const ga=Za;let Le,so,io,it;function bd(t,e){const r=new Le.DecoderBuffer;try{if(r.Init(e,e.length),t.GetEncodedGeometryType(r)!==Le.TRIANGULAR_MESH)throw new Error(`[${ga}] Unknown geometry type.`);const n=new Le.Mesh;if(!t.DecodeBufferToMesh(r,n).ok()||n.ptr===0)throw new Error(`[${ga}] Decoding failure.`);return n}finally{Le.destroy(r)}}function Ad(t,e){const r=3*e.num_faces();let n,s;if(e.num_points()<=65534){const a=r*Uint16Array.BYTES_PER_ELEMENT;n=Le._malloc(a),t.GetTrianglesUInt16Array(e,a,n),s=new Uint16Array(Le.HEAPU16.buffer,n,r).slice()}else{const a=r*Uint32Array.BYTES_PER_ELEMENT;n=Le._malloc(a),t.GetTrianglesUInt32Array(e,a,n),s=new Uint32Array(Le.HEAPU32.buffer,n,r).slice()}return Le._free(n),s}function Sd(t,e,r,n){const s=io[n.componentType],a=so[n.componentType],c=r.num_components(),f=e.num_points()*c,h=f*a.BYTES_PER_ELEMENT,d=Le._malloc(h);t.GetAttributeDataArrayForAllPoints(e,r,s,h,d);const g=new a(Le.HEAPF32.buffer,d,f).slice();return Le._free(d),g}var Jr,at;(function(t){t[t.EDGEBREAKER=1]="EDGEBREAKER",t[t.SEQUENTIAL=0]="SEQUENTIAL"})(Jr||(Jr={})),function(t){t.POSITION="POSITION",t.NORMAL="NORMAL",t.COLOR="COLOR",t.TEX_COORD="TEX_COORD",t.GENERIC="GENERIC"}(at||(at={}));const ao={[at.POSITION]:14,[at.NORMAL]:10,[at.COLOR]:8,[at.TEX_COORD]:12,[at.GENERIC]:12},ma={decodeSpeed:5,encodeSpeed:5,method:Jr.EDGEBREAKER,quantizationBits:ao,quantizationVolume:"mesh"};function Id(t,e=ma){const r=bt({},ma,e);r.quantizationBits=bt({},ao,e.quantizationBits);const n=new it.MeshBuilder,s=new it.Mesh,a=new it.ExpertEncoder(s),c={},f=new it.DracoInt8Array,h=t.listTargets().length>0;let d=!1;for(const N of t.listSemantics()){const m=t.getAttribute(N);if(m.getSparse()){d=!0;continue}const C=Cd(N),x=Nd(n,m.getComponentType(),s,it[C],m.getCount(),m.getElementSize(),m.getArray());if(x===-1)throw new Error(`Error compressing "${N}" attribute.`);if(c[N]=x,r.quantizationVolume==="mesh"||N!=="POSITION")a.SetAttributeQuantization(x,r.quantizationBits[C]);else{if(typeof r.quantizationVolume!="object")throw new Error("Invalid quantization volume state.");{const{quantizationVolume:_}=r,b=Math.max(_.max[0]-_.min[0],_.max[1]-_.min[1],_.max[2]-_.min[2]);a.SetAttributeExplicitQuantization(x,r.quantizationBits[C],m.getElementSize(),_.min,b)}}}const g=t.getIndices();if(!g)throw new Cs("Primitive must have indices.");n.AddFacesToMesh(s,g.getCount()/3,g.getArray()),a.SetSpeedOptions(r.encodeSpeed,r.decodeSpeed),a.SetTrackEncodedProperties(!0),a.SetEncodingMethod(r.method===Jr.SEQUENTIAL||h||d?it.MESH_SEQUENTIAL_ENCODING:it.MESH_EDGEBREAKER_ENCODING);const T=a.EncodeToDracoBuffer(!(h||d),f);if(T<=0)throw new Cs("Error applying Draco compression.");const E=new Uint8Array(T);for(let N=0;N<T;++N)E[N]=f.GetValue(N);const R=a.GetNumberOfEncodedPoints(),A=3*a.GetNumberOfEncodedFaces();return it.destroy(f),it.destroy(s),it.destroy(n),it.destroy(a),{numVertices:R,numIndices:A,data:E,attributeIDs:c}}function Cd(t){return t==="POSITION"?at.POSITION:t==="NORMAL"?at.NORMAL:t.startsWith("COLOR_")?at.COLOR:t.startsWith("TEXCOORD_")?at.TEX_COORD:at.GENERIC}function Nd(t,e,r,n,s,a,c){switch(e){case re.ComponentType.UNSIGNED_BYTE:return t.AddUInt8Attribute(r,n,s,a,c);case re.ComponentType.BYTE:return t.AddInt8Attribute(r,n,s,a,c);case re.ComponentType.UNSIGNED_SHORT:return t.AddUInt16Attribute(r,n,s,a,c);case re.ComponentType.SHORT:return t.AddInt16Attribute(r,n,s,a,c);case re.ComponentType.UNSIGNED_INT:return t.AddUInt32Attribute(r,n,s,a,c);case re.ComponentType.FLOAT:return t.AddFloatAttribute(r,n,s,a,c);default:throw new Error(`Unexpected component type, "${e}".`)}}class Cs extends Error{}const Fe=Za;class Ns extends Ie{constructor(...e){super(...e),this.extensionName=Fe,this.prereadTypes=[J.PRIMITIVE],this.prewriteTypes=[J.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,r){return e==="draco3d.decoder"&&(this._decoderModule=r,Le=this._decoderModule,so={[re.ComponentType.FLOAT]:Float32Array,[re.ComponentType.UNSIGNED_INT]:Uint32Array,[re.ComponentType.UNSIGNED_SHORT]:Uint16Array,[re.ComponentType.UNSIGNED_BYTE]:Uint8Array,[re.ComponentType.SHORT]:Int16Array,[re.ComponentType.BYTE]:Int8Array},io={[re.ComponentType.FLOAT]:Le.DT_FLOAT32,[re.ComponentType.UNSIGNED_INT]:Le.DT_UINT32,[re.ComponentType.UNSIGNED_SHORT]:Le.DT_UINT16,[re.ComponentType.UNSIGNED_BYTE]:Le.DT_UINT8,[re.ComponentType.SHORT]:Le.DT_INT16,[re.ComponentType.BYTE]:Le.DT_INT8}),e==="draco3d.encoder"&&(this._encoderModule=r,it=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${Fe}] Please install extension dependency, "draco3d.decoder".`);const r=this.document.getLogger(),n=e.jsonDoc,s=new Map;try{const a=n.json.meshes||[];for(const c of a)for(const f of c.primitives){if(!f.extensions||!f.extensions[Fe])continue;const h=f.extensions[Fe];let[d,g]=s.get(h.bufferView)||[];if(!g||!d){const T=n.json.bufferViews[h.bufferView],E=n.json.buffers[T.buffer],R=le.toView(E.uri?n.resources[E.uri]:n.resources[xr],T.byteOffset||0,T.byteLength);d=new this._decoderModule.Decoder,g=bd(d,R),s.set(h.bufferView,[d,g]),r.debug(`[${Fe}] Decompressed ${R.byteLength} bytes.`)}for(const T in f.attributes){const E=e.jsonDoc.json.accessors[f.attributes[T]],R=d.GetAttributeByUniqueId(g,h.attributes[T]),A=Sd(d,g,R,E);e.accessors[f.attributes[T]].setArray(A)}f.indices!==void 0&&e.accessors[f.indices].setArray(Ad(d,g))}}finally{for(const[a,c]of Array.from(s.values()))this._decoderModule.destroy(a),this._decoderModule.destroy(c)}return this}read(e){return this}prewrite(e,r){if(!this._encoderModule)throw new Error(`[${Fe}] Please install extension dependency, "draco3d.encoder".`);const n=this.document.getLogger();n.debug(`[${Fe}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const s=function(f){const h=f.getLogger(),d=new Set,g=new Set;for(const m of f.getRoot().listMeshes())for(const C of m.listPrimitives())C.getIndices()?C.getMode()!==Yr.Mode.TRIANGLES?(g.add(C),h.warn(`[${Fe}] Skipping Draco compression on non-TRIANGLES primitive.`)):d.add(C):(g.add(C),h.warn(`[${Fe}] Skipping Draco compression on non-indexed primitive.`));const T=f.getRoot().listAccessors(),E=new Map;for(let m=0;m<T.length;m++)E.set(T[m],m);const R=new Map,A=new Set,N=new Map;for(const m of Array.from(d)){let C=va(m,E);if(A.has(C))N.set(m,C);else{if(R.has(m.getIndices())){const x=m.getIndices(),_=x.clone();E.set(_,f.getRoot().listAccessors().length-1),m.swap(x,_)}for(const x of m.listAttributes())if(R.has(x)){const _=x.clone();E.set(_,f.getRoot().listAccessors().length-1),m.swap(x,_)}C=va(m,E),A.add(C),N.set(m,C),R.set(m.getIndices(),C);for(const x of m.listAttributes())R.set(x,C)}}for(const m of Array.from(R.keys())){const C=new Set(m.listParents().map(x=>x.propertyType));if(C.size!==2||!C.has(J.PRIMITIVE)||!C.has(J.ROOT))throw new Error(`[${Fe}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const m of Array.from(d)){const C=N.get(m),x=m.getIndices();if(R.get(x)!==C||m.listAttributes().some(_=>R.get(_)!==C))throw new Error(`[${Fe}] Draco primitives must share all, or no, accessors.`)}for(const m of Array.from(g)){const C=m.getIndices();if(R.has(C)||m.listAttributes().some(x=>R.has(x)))throw new Error(`[${Fe}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return N}(this.document),a=new Map;let c="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?n.warn(`[${Fe}]: quantizationVolume=scene requires exactly 1 scene.`):c=jh(this.document.getRoot().listScenes().pop()));for(const f of Array.from(s.keys())){const h=s.get(f);if(!h)throw new Error("Unexpected primitive.");if(a.has(h)){a.set(h,a.get(h));continue}const d=f.getIndices(),g=e.jsonDoc.json.accessors;let T;try{T=Id(f,bt({},this._encoderOptions,{quantizationVolume:c}))}catch(A){if(A instanceof Cs){n.warn(`[${Fe}]: ${A.message} Skipping primitive compression.`);continue}throw A}a.set(h,T);const E=e.createAccessorDef(d);E.count=T.numIndices,e.accessorIndexMap.set(d,g.length),g.push(E);for(const A of f.listSemantics()){const N=f.getAttribute(A);if(T.attributeIDs[A]===void 0)continue;const m=e.createAccessorDef(N);m.count=T.numVertices,e.accessorIndexMap.set(N,g.length),g.push(m)}const R=f.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(R)||e.otherBufferViews.set(R,[]),e.otherBufferViews.get(R).push(T.data)}return n.debug(`[${Fe}] Compressed ${s.size} primitives.`),e.extensionData[Fe]={primitiveHashMap:s,primitiveEncodingMap:a},this}write(e){const r=e.extensionData[Fe];for(const n of this.document.getRoot().listMeshes()){const s=e.jsonDoc.json.meshes[e.meshIndexMap.get(n)];for(let a=0;a<n.listPrimitives().length;a++){const c=n.listPrimitives()[a],f=s.primitives[a],h=r.primitiveHashMap.get(c);if(!h)continue;const d=r.primitiveEncodingMap.get(h);d&&(f.extensions=f.extensions||{},f.extensions[Fe]={bufferView:e.otherBufferViewsIndexMap.get(d.data),attributes:d.attributeIDs})}}if(!r.primitiveHashMap.size){const n=e.jsonDoc.json;n.extensionsUsed=(n.extensionsUsed||[]).filter(s=>s!==Fe),n.extensionsRequired=(n.extensionsRequired||[]).filter(s=>s!==Fe)}return this}}function va(t,e){const r=[],n=t.getIndices();r.push(e.get(n));for(const s of t.listAttributes())r.push(e.get(s));return r.sort().join("|")}Ns.EXTENSION_NAME=Fe,Ns.EncoderMethod=Jr;class wr extends $e{init(){this.extensionName=Gs,this.propertyType="Light",this.parentTypes=[J.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:wr.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return Ke.factorToHex(this.getColor())}setColorHex(e){const r=this.getColor().slice();return Ke.hexToFactor(e,r),this.setColor(r)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}wr.EXTENSION_NAME=Gs,wr.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const mt=Gs;class oo extends Ie{constructor(...e){super(...e),this.extensionName=mt}createLight(e=""){return new wr(this.document.getGraph(),e)}read(e){const r=e.jsonDoc;if(!r.json.extensions||!r.json.extensions[mt])return this;const n=(r.json.extensions[mt].lights||[]).map(s=>{var a,c;const f=this.createLight().setName(s.name||"").setType(s.type);return s.color!==void 0&&f.setColor(s.color),s.intensity!==void 0&&f.setIntensity(s.intensity),s.range!==void 0&&f.setRange(s.range),((a=s.spot)==null?void 0:a.innerConeAngle)!==void 0&&f.setInnerConeAngle(s.spot.innerConeAngle),((c=s.spot)==null?void 0:c.outerConeAngle)!==void 0&&f.setOuterConeAngle(s.spot.outerConeAngle),f});return r.json.nodes.forEach((s,a)=>{s.extensions&&s.extensions[mt]&&e.nodes[a].setExtension(mt,n[s.extensions[mt].light])}),this}write(e){const r=e.jsonDoc;if(this.properties.size===0)return this;const n=[],s=new Map;for(const a of this.properties){const c=a,f={type:c.getType()};Ne.eq(c.getColor(),[1,1,1])||(f.color=c.getColor()),c.getIntensity()!==1&&(f.intensity=c.getIntensity()),c.getRange()!=null&&(f.range=c.getRange()),c.getName()&&(f.name=c.getName()),c.getType()===wr.Type.SPOT&&(f.spot={innerConeAngle:c.getInnerConeAngle(),outerConeAngle:c.getOuterConeAngle()}),n.push(f),s.set(c,n.length-1)}return this.document.getRoot().listNodes().forEach(a=>{const c=a.getExtension(mt);if(c){const f=e.nodeIndexMap.get(a),h=r.json.nodes[f];h.extensions=h.extensions||{},h.extensions[mt]={light:s.get(c)}}}),r.json.extensions=r.json.extensions||{},r.json.extensions[mt]={lights:n},this}}oo.EXTENSION_NAME=mt;const{R:Od,G:Fd,B:Dd}=dt;class co extends $e{init(){this.extensionName=Hs,this.propertyType="Anisotropy",this.parentTypes=[J.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{anisotropyStrength:0,anisotropyRotation:0,anisotropyTexture:null,anisotropyTextureInfo:new Oe(this.graph,"anisotropyTextureInfo")})}getAnisotropyStrength(){return this.get("anisotropyStrength")}setAnisotropyStrength(e){return this.set("anisotropyStrength",e)}getAnisotropyRotation(){return this.get("anisotropyRotation")}setAnisotropyRotation(e){return this.set("anisotropyRotation",e)}getAnisotropyTexture(){return this.getRef("anisotropyTexture")}getAnisotropyTextureInfo(){return this.getRef("anisotropyTexture")?this.getRef("anisotropyTextureInfo"):null}setAnisotropyTexture(e){return this.setRef("anisotropyTexture",e,{channels:Od|Fd|Dd})}}co.EXTENSION_NAME=Hs;const Lt=Hs;class lo extends Ie{constructor(...e){super(...e),this.extensionName=Lt}createAnisotropy(){return new co(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[Lt]){const c=this.createAnisotropy();e.materials[a].setExtension(Lt,c);const f=s.extensions[Lt];if(f.anisotropyStrength!==void 0&&c.setAnisotropyStrength(f.anisotropyStrength),f.anisotropyRotation!==void 0&&c.setAnisotropyRotation(f.anisotropyRotation),f.anisotropyTexture!==void 0){const h=f.anisotropyTexture;c.setAnisotropyTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getAnisotropyTextureInfo(),h)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Lt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const f=c.extensions[Lt]={};if(s.getAnisotropyStrength()>0&&(f.anisotropyStrength=s.getAnisotropyStrength()),s.getAnisotropyRotation()!==0&&(f.anisotropyRotation=s.getAnisotropyRotation()),s.getAnisotropyTexture()){const h=s.getAnisotropyTexture(),d=s.getAnisotropyTextureInfo();f.anisotropyTexture=e.createTextureInfoDef(h,d)}}}),this}}lo.EXTENSION_NAME=Lt;const{R:ya,G:xa,B:$d}=dt;class fo extends $e{init(){this.extensionName=qs,this.propertyType="Clearcoat",this.parentTypes=[J.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new Oe(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new Oe(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new Oe(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:ya})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:xa})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:ya|xa|$d})}}fo.EXTENSION_NAME=qs;const jt=qs;class uo extends Ie{constructor(...e){super(...e),this.extensionName=jt}createClearcoat(){return new fo(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[jt]){const c=this.createClearcoat();e.materials[a].setExtension(jt,c);const f=s.extensions[jt];if(f.clearcoatFactor!==void 0&&c.setClearcoatFactor(f.clearcoatFactor),f.clearcoatRoughnessFactor!==void 0&&c.setClearcoatRoughnessFactor(f.clearcoatRoughnessFactor),f.clearcoatTexture!==void 0){const h=f.clearcoatTexture;c.setClearcoatTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getClearcoatTextureInfo(),h)}if(f.clearcoatRoughnessTexture!==void 0){const h=f.clearcoatRoughnessTexture;c.setClearcoatRoughnessTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getClearcoatRoughnessTextureInfo(),h)}if(f.clearcoatNormalTexture!==void 0){const h=f.clearcoatNormalTexture;c.setClearcoatNormalTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getClearcoatNormalTextureInfo(),h),h.scale!==void 0&&c.setClearcoatNormalScale(h.scale)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(jt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const f=c.extensions[jt]={clearcoatFactor:s.getClearcoatFactor(),clearcoatRoughnessFactor:s.getClearcoatRoughnessFactor()};if(s.getClearcoatTexture()){const h=s.getClearcoatTexture(),d=s.getClearcoatTextureInfo();f.clearcoatTexture=e.createTextureInfoDef(h,d)}if(s.getClearcoatRoughnessTexture()){const h=s.getClearcoatRoughnessTexture(),d=s.getClearcoatRoughnessTextureInfo();f.clearcoatRoughnessTexture=e.createTextureInfoDef(h,d)}if(s.getClearcoatNormalTexture()){const h=s.getClearcoatNormalTexture(),d=s.getClearcoatNormalTextureInfo();f.clearcoatNormalTexture=e.createTextureInfoDef(h,d),s.getClearcoatNormalScale()!==1&&(f.clearcoatNormalTexture.scale=s.getClearcoatNormalScale())}}}),this}}uo.EXTENSION_NAME=jt;class ho extends $e{init(){this.extensionName=Ws,this.propertyType="EmissiveStrength",this.parentTypes=[J.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}ho.EXTENSION_NAME=Ws;const Bt=Ws;class po extends Ie{constructor(...e){super(...e),this.extensionName=Bt}createEmissiveStrength(){return new ho(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((r,n)=>{if(r.extensions&&r.extensions[Bt]){const s=this.createEmissiveStrength();e.materials[n].setExtension(Bt,s);const a=r.extensions[Bt];a.emissiveStrength!==void 0&&s.setEmissiveStrength(a.emissiveStrength)}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Bt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{},c.extensions[Bt]={emissiveStrength:s.getEmissiveStrength()}}}),this}}po.EXTENSION_NAME=Bt;class go extends $e{init(){this.extensionName=Xs,this.propertyType="IOR",this.parentTypes=[J.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:1.5})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}go.EXTENSION_NAME=Xs;const Vt=Xs;class mo extends Ie{constructor(...e){super(...e),this.extensionName=Vt}createIOR(){return new go(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((r,n)=>{if(r.extensions&&r.extensions[Vt]){const s=this.createIOR();e.materials[n].setExtension(Vt,s);const a=r.extensions[Vt];a.ior!==void 0&&s.setIOR(a.ior)}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Vt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{},c.extensions[Vt]={ior:s.getIOR()}}}),this}}mo.EXTENSION_NAME=Vt;const{R:Pd,G:kd}=dt;class vo extends $e{init(){this.extensionName=Ys,this.propertyType="Iridescence",this.parentTypes=[J.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new Oe(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new Oe(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:Pd})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:kd})}}vo.EXTENSION_NAME=Ys;const zt=Ys;class yo extends Ie{constructor(...e){super(...e),this.extensionName=zt}createIridescence(){return new vo(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[zt]){const c=this.createIridescence();e.materials[a].setExtension(zt,c);const f=s.extensions[zt];if(f.iridescenceFactor!==void 0&&c.setIridescenceFactor(f.iridescenceFactor),f.iridescenceIor!==void 0&&c.setIridescenceIOR(f.iridescenceIor),f.iridescenceThicknessMinimum!==void 0&&c.setIridescenceThicknessMinimum(f.iridescenceThicknessMinimum),f.iridescenceThicknessMaximum!==void 0&&c.setIridescenceThicknessMaximum(f.iridescenceThicknessMaximum),f.iridescenceTexture!==void 0){const h=f.iridescenceTexture;c.setIridescenceTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getIridescenceTextureInfo(),h)}if(f.iridescenceThicknessTexture!==void 0){const h=f.iridescenceThicknessTexture;c.setIridescenceThicknessTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getIridescenceThicknessTextureInfo(),h)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(zt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const f=c.extensions[zt]={};if(s.getIridescenceFactor()>0&&(f.iridescenceFactor=s.getIridescenceFactor()),s.getIridescenceIOR()!==1.3&&(f.iridescenceIor=s.getIridescenceIOR()),s.getIridescenceThicknessMinimum()!==100&&(f.iridescenceThicknessMinimum=s.getIridescenceThicknessMinimum()),s.getIridescenceThicknessMaximum()!==400&&(f.iridescenceThicknessMaximum=s.getIridescenceThicknessMaximum()),s.getIridescenceTexture()){const h=s.getIridescenceTexture(),d=s.getIridescenceTextureInfo();f.iridescenceTexture=e.createTextureInfoDef(h,d)}if(s.getIridescenceThicknessTexture()){const h=s.getIridescenceThicknessTexture(),d=s.getIridescenceThicknessTextureInfo();f.iridescenceThicknessTexture=e.createTextureInfoDef(h,d)}}}),this}}yo.EXTENSION_NAME=zt;const{R:Ta,G:Ea,B:wa,A:Ma}=dt;class xo extends $e{init(){this.extensionName=Ks,this.propertyType="PBRSpecularGlossiness",this.parentTypes=[J.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new Oe(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new Oe(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return Ke.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const r=this.getDiffuseFactor().slice();return this.setDiffuseFactor(Ke.hexToFactor(e,r))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:Ta|Ea|wa|Ma,isColor:!0})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:Ta|Ea|wa|Ma})}}xo.EXTENSION_NAME=Ks;const Gt=Ks;class To extends Ie{constructor(...e){super(...e),this.extensionName=Gt}createPBRSpecularGlossiness(){return new xo(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[Gt]){const c=this.createPBRSpecularGlossiness();e.materials[a].setExtension(Gt,c);const f=s.extensions[Gt];if(f.diffuseFactor!==void 0&&c.setDiffuseFactor(f.diffuseFactor),f.specularFactor!==void 0&&c.setSpecularFactor(f.specularFactor),f.glossinessFactor!==void 0&&c.setGlossinessFactor(f.glossinessFactor),f.diffuseTexture!==void 0){const h=f.diffuseTexture;c.setDiffuseTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getDiffuseTextureInfo(),h)}if(f.specularGlossinessTexture!==void 0){const h=f.specularGlossinessTexture;c.setSpecularGlossinessTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getSpecularGlossinessTextureInfo(),h)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Gt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const f=c.extensions[Gt]={diffuseFactor:s.getDiffuseFactor(),specularFactor:s.getSpecularFactor(),glossinessFactor:s.getGlossinessFactor()};if(s.getDiffuseTexture()){const h=s.getDiffuseTexture(),d=s.getDiffuseTextureInfo();f.diffuseTexture=e.createTextureInfoDef(h,d)}if(s.getSpecularGlossinessTexture()){const h=s.getSpecularGlossinessTexture(),d=s.getSpecularGlossinessTextureInfo();f.specularGlossinessTexture=e.createTextureInfoDef(h,d)}}}),this}}To.EXTENSION_NAME=Gt;const{R:Ud,G:Ld,B:jd,A:Bd}=dt;class Eo extends $e{init(){this.extensionName=Js,this.propertyType="Sheen",this.parentTypes=[J.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new Oe(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new Oe(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return Ke.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const r=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",Ke.hexToFactor(e,r))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:Ud|Ld|jd,isColor:!0})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:Bd})}}Eo.EXTENSION_NAME=Js;const Ht=Js;class wo extends Ie{constructor(...e){super(...e),this.extensionName=Ht}createSheen(){return new Eo(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[Ht]){const c=this.createSheen();e.materials[a].setExtension(Ht,c);const f=s.extensions[Ht];if(f.sheenColorFactor!==void 0&&c.setSheenColorFactor(f.sheenColorFactor),f.sheenRoughnessFactor!==void 0&&c.setSheenRoughnessFactor(f.sheenRoughnessFactor),f.sheenColorTexture!==void 0){const h=f.sheenColorTexture;c.setSheenColorTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getSheenColorTextureInfo(),h)}if(f.sheenRoughnessTexture!==void 0){const h=f.sheenRoughnessTexture;c.setSheenRoughnessTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getSheenRoughnessTextureInfo(),h)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Ht);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const f=c.extensions[Ht]={sheenColorFactor:s.getSheenColorFactor(),sheenRoughnessFactor:s.getSheenRoughnessFactor()};if(s.getSheenColorTexture()){const h=s.getSheenColorTexture(),d=s.getSheenColorTextureInfo();f.sheenColorTexture=e.createTextureInfoDef(h,d)}if(s.getSheenRoughnessTexture()){const h=s.getSheenRoughnessTexture(),d=s.getSheenRoughnessTextureInfo();f.sheenRoughnessTexture=e.createTextureInfoDef(h,d)}}}),this}}wo.EXTENSION_NAME=Ht;const{R:Vd,G:zd,B:Gd,A:Hd}=dt;class Mo extends $e{init(){this.extensionName=Zs,this.propertyType="Specular",this.parentTypes=[J.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new Oe(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new Oe(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return Ke.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const r=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",Ke.hexToFactor(e,r))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:Hd})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:Vd|zd|Gd,isColor:!0})}}Mo.EXTENSION_NAME=Zs;const qt=Zs;class _o extends Ie{constructor(...e){super(...e),this.extensionName=qt}createSpecular(){return new Mo(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[qt]){const c=this.createSpecular();e.materials[a].setExtension(qt,c);const f=s.extensions[qt];if(f.specularFactor!==void 0&&c.setSpecularFactor(f.specularFactor),f.specularColorFactor!==void 0&&c.setSpecularColorFactor(f.specularColorFactor),f.specularTexture!==void 0){const h=f.specularTexture;c.setSpecularTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getSpecularTextureInfo(),h)}if(f.specularColorTexture!==void 0){const h=f.specularColorTexture;c.setSpecularColorTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getSpecularColorTextureInfo(),h)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(qt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const f=c.extensions[qt]={};if(s.getSpecularFactor()!==1&&(f.specularFactor=s.getSpecularFactor()),Ne.eq(s.getSpecularColorFactor(),[1,1,1])||(f.specularColorFactor=s.getSpecularColorFactor()),s.getSpecularTexture()){const h=s.getSpecularTexture(),d=s.getSpecularTextureInfo();f.specularTexture=e.createTextureInfoDef(h,d)}if(s.getSpecularColorTexture()){const h=s.getSpecularColorTexture(),d=s.getSpecularColorTextureInfo();f.specularColorTexture=e.createTextureInfoDef(h,d)}}}),this}}_o.EXTENSION_NAME=qt;const{R:qd}=dt;class Ro extends $e{init(){this.extensionName=Qs,this.propertyType="Transmission",this.parentTypes=[J.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new Oe(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:qd})}}Ro.EXTENSION_NAME=Qs;const Wt=Qs;class bo extends Ie{constructor(...e){super(...e),this.extensionName=Wt}createTransmission(){return new Ro(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[Wt]){const c=this.createTransmission();e.materials[a].setExtension(Wt,c);const f=s.extensions[Wt];if(f.transmissionFactor!==void 0&&c.setTransmissionFactor(f.transmissionFactor),f.transmissionTexture!==void 0){const h=f.transmissionTexture;c.setTransmissionTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getTransmissionTextureInfo(),h)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Wt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const f=c.extensions[Wt]={transmissionFactor:s.getTransmissionFactor()};if(s.getTransmissionTexture()){const h=s.getTransmissionTexture(),d=s.getTransmissionTextureInfo();f.transmissionTexture=e.createTextureInfoDef(h,d)}}}),this}}bo.EXTENSION_NAME=Wt;class Ao extends $e{init(){this.extensionName=ei,this.propertyType="Unlit",this.parentTypes=[J.MATERIAL]}}Ao.EXTENSION_NAME=ei;const dr=ei;class ni extends Ie{constructor(...e){super(...e),this.extensionName=dr}createUnlit(){return new Ao(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((r,n)=>{r.extensions&&r.extensions[dr]&&e.materials[n].setExtension(dr,this.createUnlit())}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{if(n.getExtension(dr)){const s=e.materialIndexMap.get(n),a=r.json.materials[s];a.extensions=a.extensions||{},a.extensions[dr]={}}}),this}}ni.EXTENSION_NAME=dr;class So extends $e{init(){this.extensionName=sr,this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}So.EXTENSION_NAME=sr;class Io extends $e{init(){this.extensionName=sr,this.propertyType="MappingList",this.parentTypes=[J.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}Io.EXTENSION_NAME=sr;class Os extends $e{init(){this.extensionName=sr,this.propertyType="Variant",this.parentTypes=["MappingList"]}}Os.EXTENSION_NAME=sr;const vt=sr;class Co extends Ie{constructor(...e){super(...e),this.extensionName=vt}createMappingList(){return new Io(this.document.getGraph())}createVariant(e=""){return new Os(this.document.getGraph(),e)}createMapping(){return new So(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof Os)}read(e){const r=e.jsonDoc;if(!r.json.extensions||!r.json.extensions[vt])return this;const n=(r.json.extensions[vt].variants||[]).map(s=>this.createVariant().setName(s.name||""));return(r.json.meshes||[]).forEach((s,a)=>{const c=e.meshes[a];(s.primitives||[]).forEach((f,h)=>{if(!f.extensions||!f.extensions[vt])return;const d=this.createMappingList(),g=f.extensions[vt];for(const T of g.mappings){const E=this.createMapping();T.material!==void 0&&E.setMaterial(e.materials[T.material]);for(const R of T.variants||[])E.addVariant(n[R]);d.addMapping(E)}c.listPrimitives()[h].setExtension(vt,d)})}),this}write(e){const r=e.jsonDoc,n=this.listVariants();if(!n.length)return this;const s=[],a=new Map;for(const c of n)a.set(c,s.length),s.push(e.createPropertyDef(c));for(const c of this.document.getRoot().listMeshes()){const f=e.meshIndexMap.get(c);c.listPrimitives().forEach((h,d)=>{const g=h.getExtension(vt);if(!g)return;const T=e.jsonDoc.json.meshes[f].primitives[d],E=g.listMappings().map(R=>{const A=e.createPropertyDef(R),N=R.getMaterial();return N&&(A.material=e.materialIndexMap.get(N)),A.variants=R.listVariants().map(m=>a.get(m)),A});T.extensions=T.extensions||{},T.extensions[vt]={mappings:E}})}return r.json.extensions=r.json.extensions||{},r.json.extensions[vt]={variants:s},this}}Co.EXTENSION_NAME=vt;const{G:Wd}=dt;class No extends $e{init(){this.extensionName=ti,this.propertyType="Volume",this.parentTypes=[J.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new Oe(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:Wd})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return Ke.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const r=this.getAttenuationColor().slice();return this.set("attenuationColor",Ke.hexToFactor(e,r))}}No.EXTENSION_NAME=ti;const Xt=ti;class Oo extends Ie{constructor(...e){super(...e),this.extensionName=Xt}createVolume(){return new No(this.document.getGraph())}read(e){const r=e.jsonDoc,n=r.json.textures||[];return(r.json.materials||[]).forEach((s,a)=>{if(s.extensions&&s.extensions[Xt]){const c=this.createVolume();e.materials[a].setExtension(Xt,c);const f=s.extensions[Xt];if(f.thicknessFactor!==void 0&&c.setThicknessFactor(f.thicknessFactor),f.attenuationDistance!==void 0&&c.setAttenuationDistance(f.attenuationDistance),f.attenuationColor!==void 0&&c.setAttenuationColor(f.attenuationColor),f.thicknessTexture!==void 0){const h=f.thicknessTexture;c.setThicknessTexture(e.textures[n[h.index].source]),e.setTextureInfo(c.getThicknessTextureInfo(),h)}}}),this}write(e){const r=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const s=n.getExtension(Xt);if(s){const a=e.materialIndexMap.get(n),c=r.json.materials[a];c.extensions=c.extensions||{};const f=c.extensions[Xt]={};if(s.getThicknessFactor()>0&&(f.thicknessFactor=s.getThicknessFactor()),Number.isFinite(s.getAttenuationDistance())&&(f.attenuationDistance=s.getAttenuationDistance()),Ne.eq(s.getAttenuationColor(),[1,1,1])||(f.attenuationColor=s.getAttenuationColor()),s.getThicknessTexture()){const h=s.getThicknessTexture(),d=s.getThicknessTextureInfo();f.thicknessTexture=e.createTextureInfoDef(h,d)}}}),this}}Oo.EXTENSION_NAME=Xt;const Fo="KHR_mesh_quantization";class Do extends Ie{constructor(...e){super(...e),this.extensionName=Fo}read(e){return this}write(e){return this}}Do.EXTENSION_NAME=Fo;const Vr="KHR_texture_basisu";class Xd{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const r=gs(e);return[r.pixelWidth,r.pixelHeight]}getChannels(e){const r=gs(e).dataFormatDescriptor[0];if(r.colorModel===ud)return r.samples.length===2&&(15&r.samples[1].channelType)==15?4:3;if(r.colorModel===hd)return(15&r.samples[0].channelType)==3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${r.colorModel}".`)}getVRAMByteLength(e){const r=gs(e),n=this.getChannels(e)>3;let s=0;for(let a=0;a<r.levels.length;a++){const c=r.levels[a];s+=c.uncompressedByteLength?c.uncompressedByteLength:Math.max(1,Math.floor(r.pixelWidth/Math.pow(2,a)))/4*(Math.max(1,Math.floor(r.pixelHeight/Math.pow(2,a)))/4)*(n?16:8)}return s}}class $o extends Ie{constructor(...e){super(...e),this.extensionName=Vr,this.prereadTypes=[J.TEXTURE]}static register(){xt.registerFormat("image/ktx2",new Xd)}preread(e){return e.jsonDoc.json.textures.forEach(r=>{r.extensions&&r.extensions[Vr]&&(r.source=r.extensions[Vr].source)}),this}read(e){return this}write(e){const r=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/ktx2"){const s=e.imageIndexMap.get(n);r.json.textures.forEach(a=>{a.source===s&&(a.extensions=a.extensions||{},a.extensions[Vr]={source:a.source},delete a.source)})}}),this}}$o.EXTENSION_NAME=Vr;class Po extends $e{init(){this.extensionName=ri,this.propertyType="Transform",this.parentTypes=[J.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}Po.EXTENSION_NAME=ri;const Yt=ri;class ko extends Ie{constructor(...e){super(...e),this.extensionName=Yt}createTransform(){return new Po(this.document.getGraph())}read(e){for(const[r,n]of Array.from(e.textureInfos.entries())){if(!n.extensions||!n.extensions[Yt])continue;const s=this.createTransform(),a=n.extensions[Yt];a.offset!==void 0&&s.setOffset(a.offset),a.rotation!==void 0&&s.setRotation(a.rotation),a.scale!==void 0&&s.setScale(a.scale),a.texCoord!==void 0&&s.setTexCoord(a.texCoord),r.setExtension(Yt,s)}return this}write(e){const r=Array.from(e.textureInfoDefMap.entries());for(const[n,s]of r){const a=n.getExtension(Yt);if(!a)continue;s.extensions=s.extensions||{};const c={},f=Ne.eq;f(a.getOffset(),[0,0])||(c.offset=a.getOffset()),a.getRotation()!==0&&(c.rotation=a.getRotation()),f(a.getScale(),[1,1])||(c.scale=a.getScale()),a.getTexCoord()!=null&&(c.texCoord=a.getTexCoord()),s.extensions[Yt]=c}return this}}ko.EXTENSION_NAME=Yt;const Yd=[J.ROOT,J.SCENE,J.NODE,J.MESH,J.MATERIAL,J.TEXTURE,J.ANIMATION];class Uo extends $e{init(){this.extensionName=Dn,this.propertyType="Packet",this.parentTypes=Yd}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",bt({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const r=this.get("properties");return e in r?r[e]:null}setProperty(e,r){this._assertContext(e);const n=bt({},this.get("properties"));return r?n[e]=r:delete n[e],this.set("properties",n)}toJSONLD(){return bt({"@context":vs(this.get("context"))},vs(this.get("properties")))}fromJSONLD(e){const r=(e=vs(e))["@context"];return r&&this.set("context",r),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`${Dn}: Missing context for term, "${e}".`)}}function vs(t){return JSON.parse(JSON.stringify(t))}Uo.EXTENSION_NAME=Dn;const Rt=Dn;class Lo extends Ie{constructor(...e){super(...e),this.extensionName=Rt}createPacket(){return new Uo(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var r;const n=(r=e.jsonDoc.json.extensions)==null?void 0:r[Rt];if(!n||!n.packets)return this;const s=e.jsonDoc.json,a=this.document.getRoot(),c=n.packets.map(d=>this.createPacket().fromJSONLD(d)),f=[[s.asset],s.scenes,s.nodes,s.meshes,s.materials,s.images,s.animations],h=[[a],a.listScenes(),a.listNodes(),a.listMeshes(),a.listMaterials(),a.listTextures(),a.listAnimations()];for(let d=0;d<f.length;d++){const g=f[d]||[];for(let T=0;T<g.length;T++){const E=g[T];E.extensions&&E.extensions[Rt]&&h[d][T].setExtension(Rt,c[E.extensions[Rt].packet])}}return this}write(e){const{json:r}=e.jsonDoc,n=[];for(const s of this.properties){n.push(s.toJSONLD());for(const a of s.listParents()){let c;switch(a.propertyType){case J.ROOT:c=r.asset;break;case J.SCENE:c=r.scenes[e.sceneIndexMap.get(a)];break;case J.NODE:c=r.nodes[e.nodeIndexMap.get(a)];break;case J.MESH:c=r.meshes[e.meshIndexMap.get(a)];break;case J.MATERIAL:c=r.materials[e.materialIndexMap.get(a)];break;case J.TEXTURE:c=r.images[e.imageIndexMap.get(a)];break;case J.ANIMATION:c=r.animations[e.animationIndexMap.get(a)];break;default:c=null,this.document.getLogger().warn(`[${Rt}]: Unsupported parent property, "${a.propertyType}"`)}c&&(c.extensions=c.extensions||{},c.extensions[Rt]={packet:n.length-1})}}return n.length>0&&(r.extensions=r.extensions||{},r.extensions[Rt]={packets:n}),this}}Lo.EXTENSION_NAME=Rt;const jo=[Ns,oo,lo,uo,po,mo,yo,To,_o,wo,bo,ni,Co,Oo,Do,$o,ko,Lo];[...jo];const Bo=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],Vo=t=>{let e="";for(let r=0;r<16;r++)r%4!=3&&(r>0&&(e+=" "),e+=t[r]||0);return e},Kd=(t=1,e=Bo)=>`    <item objectid="${t}" transform="${Vo(e)}" />
`,_a=t=>t?t.toISOString().substring(0,10):"";function Jd(t,{unit:e="millimeter",title:r="jscad model",author:n="",description:s="",application:a="jscad",creationDate:c=new Date,license:f="",modificationDate:h}={}){t.push(`<?xml version="1.0" encoding="UTF-8"?>
<model unit="${e}" xml:lang="en-US" xmlns="http://schemas.microsoft.com/3dmanufacturing/core/2015/02" xmlns:slic3rpe="http://schemas.slic3r.org/3mf/2017/06">
  <metadata name="slic3rpe:Version3mf">1</metadata>
  <metadata name="Title">${r}</metadata>
  <metadata name="Designer">${n}</metadata>
  <metadata name="Description">${s||r}</metadata>
  <metadata name="Copyright"></metadata>
  <metadata name="LicenseTerms">${f}</metadata>
  <metadata name="Rating"></metadata>
  <metadata name="CreationDate">${_a(c)}</metadata>
  <metadata name="ModificationDate">${_a(h||c)}</metadata>
  <metadata name="Application">${a}</metadata>
   `)}function Zd(t,e,r,n){t.push(`<object id="${e}" type="model"${n==null?"":' name="'+n+'"'}>
`),t.push(` <components>
`),r.forEach(({objectID:s,transform:a})=>{Qd(t,s,a)}),t.push(` </components>
`),t.push(`</object>
`)}const Qd=(t,e=1,r=Bo)=>{t.push(`    <component objectid="${e}" transform="${Vo(r)}" />
`)};function ep(t,e,r,n,s,a){t.push(`  <object id="${e}" type="model"${a?' name="'+a+'"':""}>
   <mesh>
    <vertices>
`);for(let c=0;c<r.length;c+=3)t.push(`     <vertex x="${r[c].toPrecision(s)}" y="${r[c+1].toPrecision(s)}" z="${r[c+2].toPrecision(s)}" />
`);t.push(`    </vertices>
    <triangles>
`);for(let c=0;c<n.length;c+=3)t.push(`     <triangle v1="${n[c]}" v2="${n[c+1]}" v3="${n[c+2]}" />
`);return t.push(`    </triangles>
   </mesh>
  </object>
`),t}const Ra={name:"[Content_Types].xml",content:`<?xml version="1.0" encoding="UTF-8"?>
<Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types">
<Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml" />
<Default Extension="model" ContentType="application/vnd.ms-package.3dmanufacturing-3dmodel+xml" />
<Default Extension="png" ContentType="image/png" />
</Types>`};function tp({meshes:t=[],components:e=[],items:r=[],precision:n=17,header:s}){const a=[];return Jd(a,s),a.push(`  <resources>
`),r.length==0&&console.error("3MF empty build! Include items or simple."),t.forEach(({id:c,vertices:f,indices:h,name:d})=>ep(a,c,f,h,n,d)),e.forEach(({id:c,children:f,name:h})=>{Zd(a,c,f,h)}),a.push(`  </resources>
`),a.push(`<build>
`),r.forEach(({objectID:c,transform:f})=>{a.push(Kd(c,f))}),a.push(`</build>
`),a.push(`</model>
`),a.join("")}class rp{constructor(){this.idSeq=0,this.lines=['<?xml version="1.0" encoding="UTF-8"?>','<Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships">']}get name(){return"_rels/.rels"}addRel(e,r){this.lines.push(`  <Relationship Target="${e}" Id="rel-${++this.idSeq}" Type="${r}" />`)}add3dModel(e){this.addRel(e,"http://schemas.microsoft.com/3dmanufacturing/2013/01/3dmodel")}addThumbnail(e){this.addRel(e,"http://schemas.openxmlformats.org/package/2006/relationships/metadata/thumbnail")}get content(){return this.lines.join(`
`)+`
</Relationships>`}}var ze=Uint8Array,et=Uint16Array,si=Int32Array,ii=new ze([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ai=new ze([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ba=new ze([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),zo=function(t,e){for(var r=new et(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var s=new si(r[30]),n=1;n<30;++n)for(var a=r[n];a<r[n+1];++a)s[a]=a-r[n]<<5|n;return{b:r,r:s}},Go=zo(ii,2),np=Go.b,Fs=Go.r;np[28]=258,Fs[258]=28;var sp=zo(ai,0),Aa=sp.r,Ds=new et(32768);for(var Re=0;Re<32768;++Re){var Ot=(Re&43690)>>1|(Re&21845)<<1;Ot=(Ot&52428)>>2|(Ot&13107)<<2,Ot=(Ot&61680)>>4|(Ot&3855)<<4,Ds[Re]=((Ot&65280)>>8|(Ot&255)<<8)>>1}var qr=function(t,e,r){for(var n=t.length,s=0,a=new et(e);s<n;++s)t[s]&&++a[t[s]-1];var c=new et(e);for(s=1;s<e;++s)c[s]=c[s-1]+a[s-1]<<1;var f;if(r){f=new et(1<<e);var h=15-e;for(s=0;s<n;++s)if(t[s])for(var d=s<<4|t[s],g=e-t[s],T=c[t[s]-1]++<<g,E=T|(1<<g)-1;T<=E;++T)f[Ds[T]>>h]=d}else for(f=new et(n),s=0;s<n;++s)t[s]&&(f[s]=Ds[c[t[s]-1]++]>>15-t[s]);return f},rr=new ze(288);for(var Re=0;Re<144;++Re)rr[Re]=8;for(var Re=144;Re<256;++Re)rr[Re]=9;for(var Re=256;Re<280;++Re)rr[Re]=7;for(var Re=280;Re<288;++Re)rr[Re]=8;var $n=new ze(32);for(var Re=0;Re<32;++Re)$n[Re]=5;var ip=qr(rr,9,0),ap=qr($n,5,0),Ho=function(t){return(t+7)/8|0},qo=function(t,e,r){(e==null||e<0)&&(e=0),(r==null||r>t.length)&&(r=t.length);var n=new ze(r-e);return n.set(t.subarray(e,r)),n},op=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],zn=function(t,e,r){var n=new Error(e||op[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,zn),!r)throw n;return n},_t=function(t,e,r){r<<=e&7;var n=e/8|0;t[n]|=r,t[n+1]|=r>>8},Dr=function(t,e,r){r<<=e&7;var n=e/8|0;t[n]|=r,t[n+1]|=r>>8,t[n+2]|=r>>16},ys=function(t,e){for(var r=[],n=0;n<t.length;++n)t[n]&&r.push({s:n,f:t[n]});var s=r.length,a=r.slice();if(!s)return{t:Xo,l:0};if(s==1){var c=new ze(r[0].s+1);return c[r[0].s]=1,{t:c,l:1}}r.sort(function(O,P){return O.f-P.f}),r.push({s:-1,f:25001});var f=r[0],h=r[1],d=0,g=1,T=2;for(r[0]={s:-1,f:f.f+h.f,l:f,r:h};g!=s-1;)f=r[r[d].f<r[T].f?d++:T++],h=r[d!=g&&r[d].f<r[T].f?d++:T++],r[g++]={s:-1,f:f.f+h.f,l:f,r:h};for(var E=a[0].s,n=1;n<s;++n)a[n].s>E&&(E=a[n].s);var R=new et(E+1),A=$s(r[g-1],R,0);if(A>e){var n=0,N=0,m=A-e,C=1<<m;for(a.sort(function(P,z){return R[z.s]-R[P.s]||P.f-z.f});n<s;++n){var x=a[n].s;if(R[x]>e)N+=C-(1<<A-R[x]),R[x]=e;else break}for(N>>=m;N>0;){var _=a[n].s;R[_]<e?N-=1<<e-R[_]++-1:++n}for(;n>=0&&N;--n){var b=a[n].s;R[b]==e&&(--R[b],++N)}A=e}return{t:new ze(R),l:A}},$s=function(t,e,r){return t.s==-1?Math.max($s(t.l,e,r+1),$s(t.r,e,r+1)):e[t.s]=r},Sa=function(t){for(var e=t.length;e&&!t[--e];);for(var r=new et(++e),n=0,s=t[0],a=1,c=function(h){r[n++]=h},f=1;f<=e;++f)if(t[f]==s&&f!=e)++a;else{if(!s&&a>2){for(;a>138;a-=138)c(32754);a>2&&(c(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(c(s),--a;a>6;a-=6)c(8304);a>2&&(c(a-3<<5|8208),a=0)}for(;a--;)c(s);a=1,s=t[f]}return{c:r.subarray(0,n),n:e}},$r=function(t,e){for(var r=0,n=0;n<e.length;++n)r+=t[n]*e[n];return r},Wo=function(t,e,r){var n=r.length,s=Ho(e+2);t[s]=n&255,t[s+1]=n>>8,t[s+2]=t[s]^255,t[s+3]=t[s+1]^255;for(var a=0;a<n;++a)t[s+a+4]=r[a];return(s+4+n)*8},Ia=function(t,e,r,n,s,a,c,f,h,d,g){_t(e,g++,r),++s[256];for(var T=ys(s,15),E=T.t,R=T.l,A=ys(a,15),N=A.t,m=A.l,C=Sa(E),x=C.c,_=C.n,b=Sa(N),O=b.c,P=b.n,z=new et(19),L=0;L<x.length;++L)++z[x[L]&31];for(var L=0;L<O.length;++L)++z[O[L]&31];for(var k=ys(z,7),W=k.t,j=k.l,Y=19;Y>4&&!W[ba[Y-1]];--Y);var H=d+5<<3,B=$r(s,rr)+$r(a,$n)+c,G=$r(s,E)+$r(a,N)+c+14+3*Y+$r(z,W)+2*z[16]+3*z[17]+7*z[18];if(h>=0&&H<=B&&H<=G)return Wo(e,g,t.subarray(h,h+d));var Q,oe,ve,ye;if(_t(e,g,1+(G<B)),g+=2,G<B){Q=qr(E,R,0),oe=E,ve=qr(N,m,0),ye=N;var me=qr(W,j,0);_t(e,g,_-257),_t(e,g+5,P-1),_t(e,g+10,Y-4),g+=14;for(var L=0;L<Y;++L)_t(e,g+3*L,W[ba[L]]);g+=3*Y;for(var Te=[x,O],Me=0;Me<2;++Me)for(var Pe=Te[Me],L=0;L<Pe.length;++L){var be=Pe[L]&31;_t(e,g,me[be]),g+=W[be],be>15&&(_t(e,g,Pe[L]>>5&127),g+=Pe[L]>>12)}}else Q=ip,oe=rr,ve=ap,ye=$n;for(var L=0;L<f;++L){var Ce=n[L];if(Ce>255){var be=Ce>>18&31;Dr(e,g,Q[be+257]),g+=oe[be+257],be>7&&(_t(e,g,Ce>>23&31),g+=ii[be]);var Ze=Ce&31;Dr(e,g,ve[Ze]),g+=ye[Ze],Ze>3&&(Dr(e,g,Ce>>5&8191),g+=ai[Ze])}else Dr(e,g,Q[Ce]),g+=oe[Ce]}return Dr(e,g,Q[256]),g+oe[256]},cp=new si([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Xo=new ze(0),lp=function(t,e,r,n,s,a){var c=a.z||t.length,f=new ze(n+c+5*(1+Math.ceil(c/7e3))+s),h=f.subarray(n,f.length-s),d=a.l,g=(a.r||0)&7;if(e){g&&(h[0]=a.r>>3);for(var T=cp[e-1],E=T>>13,R=T&8191,A=(1<<r)-1,N=a.p||new et(32768),m=a.h||new et(A+1),C=Math.ceil(r/3),x=2*C,_=function(ir){return(t[ir]^t[ir+1]<<C^t[ir+2]<<x)&A},b=new si(25e3),O=new et(288),P=new et(32),z=0,L=0,k=a.i||0,W=0,j=a.w||0,Y=0;k+2<c;++k){var H=_(k),B=k&32767,G=m[H];if(N[B]=G,m[H]=B,j<=k){var Q=c-k;if((z>7e3||W>24576)&&(Q>423||!d)){g=Ia(t,h,0,b,O,P,L,W,Y,k-Y,g),W=z=L=0,Y=k;for(var oe=0;oe<286;++oe)O[oe]=0;for(var oe=0;oe<30;++oe)P[oe]=0}var ve=2,ye=0,me=R,Te=B-G&32767;if(Q>2&&H==_(k-Te))for(var Me=Math.min(E,Q)-1,Pe=Math.min(32767,k),be=Math.min(258,Q);Te<=Pe&&--me&&B!=G;){if(t[k+ve]==t[k+ve-Te]){for(var Ce=0;Ce<be&&t[k+Ce]==t[k+Ce-Te];++Ce);if(Ce>ve){if(ve=Ce,ye=Te,Ce>Me)break;for(var Ze=Math.min(Te,Ce-2),ot=0,oe=0;oe<Ze;++oe){var St=k-Te+oe&32767,Ae=N[St],It=St-Ae&32767;It>ot&&(ot=It,G=St)}}}B=G,G=N[B],Te+=B-G&32767}if(ye){b[W++]=268435456|Fs[ve]<<18|Aa[ye];var Ye=Fs[ve]&31,rt=Aa[ye]&31;L+=ii[Ye]+ai[rt],++O[257+Ye],++P[rt],j=k+ve,++z}else b[W++]=t[k],++O[t[k]]}}for(k=Math.max(k,j);k<c;++k)b[W++]=t[k],++O[t[k]];g=Ia(t,h,d,b,O,P,L,W,Y,k-Y,g),d||(a.r=g&7|h[g/8|0]<<3,g-=7,a.h=m,a.p=N,a.i=k,a.w=j)}else{for(var k=a.w||0;k<c+d;k+=65535){var ct=k+65535;ct>=c&&(h[g/8|0]=d,ct=c),g=Wo(h,g+1,t.subarray(k,ct))}a.i=c}return qo(f,0,n+Ho(g)+s)},fp=function(){for(var t=new Int32Array(256),e=0;e<256;++e){for(var r=e,n=9;--n;)r=(r&1&&-306674912)^r>>>1;t[e]=r}return t}(),up=function(){var t=-1;return{p:function(e){for(var r=t,n=0;n<e.length;++n)r=fp[r&255^e[n]]^r>>>8;t=r},d:function(){return~t}}},hp=function(t,e,r,n,s){if(!s&&(s={l:1},e.dictionary)){var a=e.dictionary.subarray(-32768),c=new ze(a.length+t.length);c.set(a),c.set(t,a.length),t=c,s.w=a.length}return lp(t,e.level==null?6:e.level,e.mem==null?Math.ceil(Math.max(8,Math.min(13,Math.log(t.length)))*1.5):12+e.mem,r,n,s)},Yo=function(t,e){var r={};for(var n in t)r[n]=t[n];for(var n in e)r[n]=e[n];return r},Ve=function(t,e,r){for(;r;++e)t[e]=r,r>>>=8};function dp(t,e){return hp(t,e||{},0,0)}var Ko=function(t,e,r,n){for(var s in t){var a=t[s],c=e+s,f=n;Array.isArray(a)&&(f=Yo(n,a[1]),a=a[0]),a instanceof ze?r[c]=[a,f]:(r[c+="/"]=[new ze(0),f],Ko(a,c,r,n))}},Ca=typeof TextEncoder<"u"&&new TextEncoder,pp=typeof TextDecoder<"u"&&new TextDecoder,gp=0;try{pp.decode(Xo,{stream:!0}),gp=1}catch{}function Wr(t,e){if(e){for(var r=new ze(t.length),n=0;n<t.length;++n)r[n]=t.charCodeAt(n);return r}if(Ca)return Ca.encode(t);for(var s=t.length,a=new ze(t.length+(t.length>>1)),c=0,f=function(g){a[c++]=g},n=0;n<s;++n){if(c+5>a.length){var h=new ze(c+8+(s-n<<1));h.set(a),a=h}var d=t.charCodeAt(n);d<128||e?f(d):d<2048?(f(192|d>>6),f(128|d&63)):d>55295&&d<57344?(d=65536+(d&1047552)|t.charCodeAt(++n)&1023,f(240|d>>18),f(128|d>>12&63),f(128|d>>6&63),f(128|d&63)):(f(224|d>>12),f(128|d>>6&63),f(128|d&63))}return qo(a,0,c)}var Ps=function(t){var e=0;if(t)for(var r in t){var n=t[r].length;n>65535&&zn(9),e+=n+4}return e},Na=function(t,e,r,n,s,a,c,f){var h=n.length,d=r.extra,g=f&&f.length,T=Ps(d);Ve(t,e,c!=null?33639248:67324752),e+=4,c!=null&&(t[e++]=20,t[e++]=r.os),t[e]=20,e+=2,t[e++]=r.flag<<1|(a<0&&8),t[e++]=s&&8,t[e++]=r.compression&255,t[e++]=r.compression>>8;var E=new Date(r.mtime==null?Date.now():r.mtime),R=E.getFullYear()-1980;if((R<0||R>119)&&zn(10),Ve(t,e,R<<25|E.getMonth()+1<<21|E.getDate()<<16|E.getHours()<<11|E.getMinutes()<<5|E.getSeconds()>>1),e+=4,a!=-1&&(Ve(t,e,r.crc),Ve(t,e+4,a<0?-a-2:a),Ve(t,e+8,r.size)),Ve(t,e+12,h),Ve(t,e+14,T),e+=16,c!=null&&(Ve(t,e,g),Ve(t,e+6,r.attrs),Ve(t,e+10,c),e+=14),t.set(n,e),e+=h,T)for(var A in d){var N=d[A],m=N.length;Ve(t,e,+A),Ve(t,e+2,m),t.set(N,e+4),e+=4+m}return g&&(t.set(f,e),e+=g),e},mp=function(t,e,r,n,s){Ve(t,e,101010256),Ve(t,e+8,r),Ve(t,e+10,r),Ve(t,e+12,n),Ve(t,e+16,s)};function vp(t,e){e||(e={});var r={},n=[];Ko(t,"",r,e);var s=0,a=0;for(var c in r){var f=r[c],h=f[0],d=f[1],g=d.level==0?0:8,T=Wr(c),E=T.length,R=d.comment,A=R&&Wr(R),N=A&&A.length,m=Ps(d.extra);E>65535&&zn(11);var C=g?dp(h,d):h,x=C.length,_=up();_.p(h),n.push(Yo(d,{size:h.length,crc:_.d(),c:C,f:T,m:A,u:E!=c.length||A&&R.length!=N,o:s,compression:g})),s+=30+E+m+x,a+=76+2*(E+m)+(N||0)+x}for(var b=new ze(a+22),O=s,P=a-s,z=0;z<n.length;++z){var T=n[z];Na(b,T.o,T,T.f,T.u,T.c.length);var L=30+T.f.length+Ps(T.extra);b.set(T.c,T.o+L),Na(b,s,T,T.f,T.u,T.c.length,T.o,T.m),s+=16+L+(T.m?T.m.length:0)}return mp(b,s,n.length,P,O),b}var te=1e-6,de=typeof Float32Array<"u"?Float32Array:Array,ut=Math.random;function Jo(t){de=t}var yp=Math.PI/180;function xp(t){return t*yp}function Tp(t,e){return Math.abs(t-e)<=te*Math.max(1,Math.abs(t),Math.abs(e))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Ep=Object.freeze({__proto__:null,get ARRAY_TYPE(){return de},EPSILON:te,RANDOM:ut,equals:Tp,setMatrixArrayType:Jo,toRadian:xp});function wp(){var t=new de(4);return de!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function Mp(t){var e=new de(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function _p(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Rp(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function bp(t,e,r,n){var s=new de(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=n,s}function Ap(t,e,r,n,s){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t}function Sp(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function Ip(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=r*a-s*n;return c?(c=1/c,t[0]=a*c,t[1]=-n*c,t[2]=-s*c,t[3]=r*c,t):null}function Cp(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t}function Np(t){return t[0]*t[3]-t[2]*t[1]}function Zo(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=r[0],h=r[1],d=r[2],g=r[3];return t[0]=n*f+a*h,t[1]=s*f+c*h,t[2]=n*d+a*g,t[3]=s*d+c*g,t}function Op(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=Math.sin(r),h=Math.cos(r);return t[0]=n*h+a*f,t[1]=s*h+c*f,t[2]=n*-f+a*h,t[3]=s*-f+c*h,t}function Fp(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=r[0],h=r[1];return t[0]=n*f,t[1]=s*f,t[2]=a*h,t[3]=c*h,t}function Dp(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t}function $p(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function Pp(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function kp(t){return Math.hypot(t[0],t[1],t[2],t[3])}function Up(t,e,r,n){return t[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-t[2]*r[1],[t,e,r]}function Lp(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function Qo(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function jp(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Bp(t,e){var r=t[0],n=t[1],s=t[2],a=t[3],c=e[0],f=e[1],h=e[2],d=e[3];return Math.abs(r-c)<=te*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-f)<=te*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(s-h)<=te*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(a-d)<=te*Math.max(1,Math.abs(a),Math.abs(d))}function Vp(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function zp(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}var Gp=Zo,Hp=Qo,qp=Object.freeze({__proto__:null,LDU:Up,add:Lp,adjoint:Cp,clone:Mp,copy:_p,create:wp,determinant:Np,equals:Bp,exactEquals:jp,frob:kp,fromRotation:Dp,fromScaling:$p,fromValues:bp,identity:Rp,invert:Ip,mul:Gp,multiply:Zo,multiplyScalar:Vp,multiplyScalarAndAdd:zp,rotate:Op,scale:Fp,set:Ap,str:Pp,sub:Hp,subtract:Qo,transpose:Sp});function Wp(){var t=new de(6);return de!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function Xp(t){var e=new de(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Yp(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Kp(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function Jp(t,e,r,n,s,a){var c=new de(6);return c[0]=t,c[1]=e,c[2]=r,c[3]=n,c[4]=s,c[5]=a,c}function Zp(t,e,r,n,s,a,c){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=a,t[5]=c,t}function Qp(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],f=e[5],h=r*a-n*s;return h?(h=1/h,t[0]=a*h,t[1]=-n*h,t[2]=-s*h,t[3]=r*h,t[4]=(s*f-a*c)*h,t[5]=(n*c-r*f)*h,t):null}function eg(t){return t[0]*t[3]-t[1]*t[2]}function ec(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=r[0],g=r[1],T=r[2],E=r[3],R=r[4],A=r[5];return t[0]=n*d+a*g,t[1]=s*d+c*g,t[2]=n*T+a*E,t[3]=s*T+c*E,t[4]=n*R+a*A+f,t[5]=s*R+c*A+h,t}function tg(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=Math.sin(r),g=Math.cos(r);return t[0]=n*g+a*d,t[1]=s*g+c*d,t[2]=n*-d+a*g,t[3]=s*-d+c*g,t[4]=f,t[5]=h,t}function rg(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=r[0],g=r[1];return t[0]=n*d,t[1]=s*d,t[2]=a*g,t[3]=c*g,t[4]=f,t[5]=h,t}function ng(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=r[0],g=r[1];return t[0]=n,t[1]=s,t[2]=a,t[3]=c,t[4]=n*d+a*g+f,t[5]=s*d+c*g+h,t}function sg(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t[4]=0,t[5]=0,t}function ig(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function ag(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function og(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function cg(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)}function lg(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t}function tc(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}function fg(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t}function ug(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t}function hg(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function dg(t,e){var r=t[0],n=t[1],s=t[2],a=t[3],c=t[4],f=t[5],h=e[0],d=e[1],g=e[2],T=e[3],E=e[4],R=e[5];return Math.abs(r-h)<=te*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(n-d)<=te*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(s-g)<=te*Math.max(1,Math.abs(s),Math.abs(g))&&Math.abs(a-T)<=te*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(c-E)<=te*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(f-R)<=te*Math.max(1,Math.abs(f),Math.abs(R))}var pg=ec,gg=tc,mg=Object.freeze({__proto__:null,add:lg,clone:Xp,copy:Yp,create:Wp,determinant:eg,equals:dg,exactEquals:hg,frob:cg,fromRotation:sg,fromScaling:ig,fromTranslation:ag,fromValues:Jp,identity:Kp,invert:Qp,mul:pg,multiply:ec,multiplyScalar:fg,multiplyScalarAndAdd:ug,rotate:tg,scale:rg,set:Zp,str:og,sub:gg,subtract:tc,translate:ng});function rc(){var t=new de(9);return de!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function vg(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function yg(t){var e=new de(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function xg(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Tg(t,e,r,n,s,a,c,f,h){var d=new de(9);return d[0]=t,d[1]=e,d[2]=r,d[3]=n,d[4]=s,d[5]=a,d[6]=c,d[7]=f,d[8]=h,d}function Eg(t,e,r,n,s,a,c,f,h,d){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=a,t[5]=c,t[6]=f,t[7]=h,t[8]=d,t}function wg(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Mg(t,e){if(t===e){var r=e[1],n=e[2],s=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=s}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function _g(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],f=e[5],h=e[6],d=e[7],g=e[8],T=g*c-f*d,E=-g*a+f*h,R=d*a-c*h,A=r*T+n*E+s*R;return A?(A=1/A,t[0]=T*A,t[1]=(-g*n+s*d)*A,t[2]=(f*n-s*c)*A,t[3]=E*A,t[4]=(g*r-s*h)*A,t[5]=(-f*r+s*a)*A,t[6]=R*A,t[7]=(-d*r+n*h)*A,t[8]=(c*r-n*a)*A,t):null}function Rg(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],f=e[5],h=e[6],d=e[7],g=e[8];return t[0]=c*g-f*d,t[1]=s*d-n*g,t[2]=n*f-s*c,t[3]=f*h-a*g,t[4]=r*g-s*h,t[5]=s*a-r*f,t[6]=a*d-c*h,t[7]=n*h-r*d,t[8]=r*c-n*a,t}function bg(t){var e=t[0],r=t[1],n=t[2],s=t[3],a=t[4],c=t[5],f=t[6],h=t[7],d=t[8];return e*(d*a-c*h)+r*(-d*s+c*f)+n*(h*s-a*f)}function nc(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],T=e[8],E=r[0],R=r[1],A=r[2],N=r[3],m=r[4],C=r[5],x=r[6],_=r[7],b=r[8];return t[0]=E*n+R*c+A*d,t[1]=E*s+R*f+A*g,t[2]=E*a+R*h+A*T,t[3]=N*n+m*c+C*d,t[4]=N*s+m*f+C*g,t[5]=N*a+m*h+C*T,t[6]=x*n+_*c+b*d,t[7]=x*s+_*f+b*g,t[8]=x*a+_*h+b*T,t}function Ag(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],T=e[8],E=r[0],R=r[1];return t[0]=n,t[1]=s,t[2]=a,t[3]=c,t[4]=f,t[5]=h,t[6]=E*n+R*c+d,t[7]=E*s+R*f+g,t[8]=E*a+R*h+T,t}function Sg(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],T=e[8],E=Math.sin(r),R=Math.cos(r);return t[0]=R*n+E*c,t[1]=R*s+E*f,t[2]=R*a+E*h,t[3]=R*c-E*n,t[4]=R*f-E*s,t[5]=R*h-E*a,t[6]=d,t[7]=g,t[8]=T,t}function Ig(t,e,r){var n=r[0],s=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=s*e[3],t[4]=s*e[4],t[5]=s*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Cg(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function Ng(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Og(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Fg(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function Dg(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=r+r,f=n+n,h=s+s,d=r*c,g=n*c,T=n*f,E=s*c,R=s*f,A=s*h,N=a*c,m=a*f,C=a*h;return t[0]=1-T-A,t[3]=g-C,t[6]=E+m,t[1]=g+C,t[4]=1-d-A,t[7]=R-N,t[2]=E-m,t[5]=R+N,t[8]=1-d-T,t}function $g(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],f=e[5],h=e[6],d=e[7],g=e[8],T=e[9],E=e[10],R=e[11],A=e[12],N=e[13],m=e[14],C=e[15],x=r*f-n*c,_=r*h-s*c,b=r*d-a*c,O=n*h-s*f,P=n*d-a*f,z=s*d-a*h,L=g*N-T*A,k=g*m-E*A,W=g*C-R*A,j=T*m-E*N,Y=T*C-R*N,H=E*C-R*m,B=x*H-_*Y+b*j+O*W-P*k+z*L;return B?(B=1/B,t[0]=(f*H-h*Y+d*j)*B,t[1]=(h*W-c*H-d*k)*B,t[2]=(c*Y-f*W+d*L)*B,t[3]=(s*Y-n*H-a*j)*B,t[4]=(r*H-s*W+a*k)*B,t[5]=(n*W-r*Y-a*L)*B,t[6]=(N*z-m*P+C*O)*B,t[7]=(m*b-A*z-C*_)*B,t[8]=(A*P-N*b+C*x)*B,t):null}function Pg(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function kg(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function Ug(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function Lg(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t}function sc(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}function jg(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t}function Bg(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t}function Vg(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function zg(t,e){var r=t[0],n=t[1],s=t[2],a=t[3],c=t[4],f=t[5],h=t[6],d=t[7],g=t[8],T=e[0],E=e[1],R=e[2],A=e[3],N=e[4],m=e[5],C=e[6],x=e[7],_=e[8];return Math.abs(r-T)<=te*Math.max(1,Math.abs(r),Math.abs(T))&&Math.abs(n-E)<=te*Math.max(1,Math.abs(n),Math.abs(E))&&Math.abs(s-R)<=te*Math.max(1,Math.abs(s),Math.abs(R))&&Math.abs(a-A)<=te*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(c-N)<=te*Math.max(1,Math.abs(c),Math.abs(N))&&Math.abs(f-m)<=te*Math.max(1,Math.abs(f),Math.abs(m))&&Math.abs(h-C)<=te*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(d-x)<=te*Math.max(1,Math.abs(d),Math.abs(x))&&Math.abs(g-_)<=te*Math.max(1,Math.abs(g),Math.abs(_))}var Gg=nc,Hg=sc,qg=Object.freeze({__proto__:null,add:Lg,adjoint:Rg,clone:yg,copy:xg,create:rc,determinant:bg,equals:zg,exactEquals:Vg,frob:Ug,fromMat2d:Fg,fromMat4:vg,fromQuat:Dg,fromRotation:Ng,fromScaling:Og,fromTranslation:Cg,fromValues:Tg,identity:wg,invert:_g,mul:Gg,multiply:nc,multiplyScalar:jg,multiplyScalarAndAdd:Bg,normalFromMat4:$g,projection:Pg,rotate:Sg,scale:Ig,set:Eg,str:kg,sub:Hg,subtract:sc,translate:Ag,transpose:Mg});function Wg(){var t=new de(16);return de!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Xg(t){var e=new de(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Yg(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Kg(t,e,r,n,s,a,c,f,h,d,g,T,E,R,A,N){var m=new de(16);return m[0]=t,m[1]=e,m[2]=r,m[3]=n,m[4]=s,m[5]=a,m[6]=c,m[7]=f,m[8]=h,m[9]=d,m[10]=g,m[11]=T,m[12]=E,m[13]=R,m[14]=A,m[15]=N,m}function Jg(t,e,r,n,s,a,c,f,h,d,g,T,E,R,A,N,m){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=a,t[5]=c,t[6]=f,t[7]=h,t[8]=d,t[9]=g,t[10]=T,t[11]=E,t[12]=R,t[13]=A,t[14]=N,t[15]=m,t}function ic(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Zg(t,e){if(t===e){var r=e[1],n=e[2],s=e[3],a=e[6],c=e[7],f=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=a,t[11]=e[14],t[12]=s,t[13]=c,t[14]=f}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Qg(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],f=e[5],h=e[6],d=e[7],g=e[8],T=e[9],E=e[10],R=e[11],A=e[12],N=e[13],m=e[14],C=e[15],x=r*f-n*c,_=r*h-s*c,b=r*d-a*c,O=n*h-s*f,P=n*d-a*f,z=s*d-a*h,L=g*N-T*A,k=g*m-E*A,W=g*C-R*A,j=T*m-E*N,Y=T*C-R*N,H=E*C-R*m,B=x*H-_*Y+b*j+O*W-P*k+z*L;return B?(B=1/B,t[0]=(f*H-h*Y+d*j)*B,t[1]=(s*Y-n*H-a*j)*B,t[2]=(N*z-m*P+C*O)*B,t[3]=(E*P-T*z-R*O)*B,t[4]=(h*W-c*H-d*k)*B,t[5]=(r*H-s*W+a*k)*B,t[6]=(m*b-A*z-C*_)*B,t[7]=(g*z-E*b+R*_)*B,t[8]=(c*Y-f*W+d*L)*B,t[9]=(n*W-r*Y-a*L)*B,t[10]=(A*P-N*b+C*x)*B,t[11]=(T*b-g*P-R*x)*B,t[12]=(f*k-c*j-h*L)*B,t[13]=(r*j-n*k+s*L)*B,t[14]=(N*_-A*O-m*x)*B,t[15]=(g*O-T*_+E*x)*B,t):null}function e1(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=e[4],f=e[5],h=e[6],d=e[7],g=e[8],T=e[9],E=e[10],R=e[11],A=e[12],N=e[13],m=e[14],C=e[15];return t[0]=f*(E*C-R*m)-T*(h*C-d*m)+N*(h*R-d*E),t[1]=-(n*(E*C-R*m)-T*(s*C-a*m)+N*(s*R-a*E)),t[2]=n*(h*C-d*m)-f*(s*C-a*m)+N*(s*d-a*h),t[3]=-(n*(h*R-d*E)-f*(s*R-a*E)+T*(s*d-a*h)),t[4]=-(c*(E*C-R*m)-g*(h*C-d*m)+A*(h*R-d*E)),t[5]=r*(E*C-R*m)-g*(s*C-a*m)+A*(s*R-a*E),t[6]=-(r*(h*C-d*m)-c*(s*C-a*m)+A*(s*d-a*h)),t[7]=r*(h*R-d*E)-c*(s*R-a*E)+g*(s*d-a*h),t[8]=c*(T*C-R*N)-g*(f*C-d*N)+A*(f*R-d*T),t[9]=-(r*(T*C-R*N)-g*(n*C-a*N)+A*(n*R-a*T)),t[10]=r*(f*C-d*N)-c*(n*C-a*N)+A*(n*d-a*f),t[11]=-(r*(f*R-d*T)-c*(n*R-a*T)+g*(n*d-a*f)),t[12]=-(c*(T*m-E*N)-g*(f*m-h*N)+A*(f*E-h*T)),t[13]=r*(T*m-E*N)-g*(n*m-s*N)+A*(n*E-s*T),t[14]=-(r*(f*m-h*N)-c*(n*m-s*N)+A*(n*h-s*f)),t[15]=r*(f*E-h*T)-c*(n*E-s*T)+g*(n*h-s*f),t}function t1(t){var e=t[0],r=t[1],n=t[2],s=t[3],a=t[4],c=t[5],f=t[6],h=t[7],d=t[8],g=t[9],T=t[10],E=t[11],R=t[12],A=t[13],N=t[14],m=t[15],C=e*c-r*a,x=e*f-n*a,_=e*h-s*a,b=r*f-n*c,O=r*h-s*c,P=n*h-s*f,z=d*A-g*R,L=d*N-T*R,k=d*m-E*R,W=g*N-T*A,j=g*m-E*A,Y=T*m-E*N;return C*Y-x*j+_*W+b*k-O*L+P*z}function ac(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],T=e[8],E=e[9],R=e[10],A=e[11],N=e[12],m=e[13],C=e[14],x=e[15],_=r[0],b=r[1],O=r[2],P=r[3];return t[0]=_*n+b*f+O*T+P*N,t[1]=_*s+b*h+O*E+P*m,t[2]=_*a+b*d+O*R+P*C,t[3]=_*c+b*g+O*A+P*x,_=r[4],b=r[5],O=r[6],P=r[7],t[4]=_*n+b*f+O*T+P*N,t[5]=_*s+b*h+O*E+P*m,t[6]=_*a+b*d+O*R+P*C,t[7]=_*c+b*g+O*A+P*x,_=r[8],b=r[9],O=r[10],P=r[11],t[8]=_*n+b*f+O*T+P*N,t[9]=_*s+b*h+O*E+P*m,t[10]=_*a+b*d+O*R+P*C,t[11]=_*c+b*g+O*A+P*x,_=r[12],b=r[13],O=r[14],P=r[15],t[12]=_*n+b*f+O*T+P*N,t[13]=_*s+b*h+O*E+P*m,t[14]=_*a+b*d+O*R+P*C,t[15]=_*c+b*g+O*A+P*x,t}function r1(t,e,r){var n=r[0],s=r[1],a=r[2],c,f,h,d,g,T,E,R,A,N,m,C;return e===t?(t[12]=e[0]*n+e[4]*s+e[8]*a+e[12],t[13]=e[1]*n+e[5]*s+e[9]*a+e[13],t[14]=e[2]*n+e[6]*s+e[10]*a+e[14],t[15]=e[3]*n+e[7]*s+e[11]*a+e[15]):(c=e[0],f=e[1],h=e[2],d=e[3],g=e[4],T=e[5],E=e[6],R=e[7],A=e[8],N=e[9],m=e[10],C=e[11],t[0]=c,t[1]=f,t[2]=h,t[3]=d,t[4]=g,t[5]=T,t[6]=E,t[7]=R,t[8]=A,t[9]=N,t[10]=m,t[11]=C,t[12]=c*n+g*s+A*a+e[12],t[13]=f*n+T*s+N*a+e[13],t[14]=h*n+E*s+m*a+e[14],t[15]=d*n+R*s+C*a+e[15]),t}function n1(t,e,r){var n=r[0],s=r[1],a=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function s1(t,e,r,n){var s=n[0],a=n[1],c=n[2],f=Math.hypot(s,a,c),h,d,g,T,E,R,A,N,m,C,x,_,b,O,P,z,L,k,W,j,Y,H,B,G;return f<te?null:(f=1/f,s*=f,a*=f,c*=f,h=Math.sin(r),d=Math.cos(r),g=1-d,T=e[0],E=e[1],R=e[2],A=e[3],N=e[4],m=e[5],C=e[6],x=e[7],_=e[8],b=e[9],O=e[10],P=e[11],z=s*s*g+d,L=a*s*g+c*h,k=c*s*g-a*h,W=s*a*g-c*h,j=a*a*g+d,Y=c*a*g+s*h,H=s*c*g+a*h,B=a*c*g-s*h,G=c*c*g+d,t[0]=T*z+N*L+_*k,t[1]=E*z+m*L+b*k,t[2]=R*z+C*L+O*k,t[3]=A*z+x*L+P*k,t[4]=T*W+N*j+_*Y,t[5]=E*W+m*j+b*Y,t[6]=R*W+C*j+O*Y,t[7]=A*W+x*j+P*Y,t[8]=T*H+N*B+_*G,t[9]=E*H+m*B+b*G,t[10]=R*H+C*B+O*G,t[11]=A*H+x*B+P*G,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function i1(t,e,r){var n=Math.sin(r),s=Math.cos(r),a=e[4],c=e[5],f=e[6],h=e[7],d=e[8],g=e[9],T=e[10],E=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*s+d*n,t[5]=c*s+g*n,t[6]=f*s+T*n,t[7]=h*s+E*n,t[8]=d*s-a*n,t[9]=g*s-c*n,t[10]=T*s-f*n,t[11]=E*s-h*n,t}function a1(t,e,r){var n=Math.sin(r),s=Math.cos(r),a=e[0],c=e[1],f=e[2],h=e[3],d=e[8],g=e[9],T=e[10],E=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*s-d*n,t[1]=c*s-g*n,t[2]=f*s-T*n,t[3]=h*s-E*n,t[8]=a*n+d*s,t[9]=c*n+g*s,t[10]=f*n+T*s,t[11]=h*n+E*s,t}function o1(t,e,r){var n=Math.sin(r),s=Math.cos(r),a=e[0],c=e[1],f=e[2],h=e[3],d=e[4],g=e[5],T=e[6],E=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*s+d*n,t[1]=c*s+g*n,t[2]=f*s+T*n,t[3]=h*s+E*n,t[4]=d*s-a*n,t[5]=g*s-c*n,t[6]=T*s-f*n,t[7]=E*s-h*n,t}function c1(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function l1(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function f1(t,e,r){var n=r[0],s=r[1],a=r[2],c=Math.hypot(n,s,a),f,h,d;return c<te?null:(c=1/c,n*=c,s*=c,a*=c,f=Math.sin(e),h=Math.cos(e),d=1-h,t[0]=n*n*d+h,t[1]=s*n*d+a*f,t[2]=a*n*d-s*f,t[3]=0,t[4]=n*s*d-a*f,t[5]=s*s*d+h,t[6]=a*s*d+n*f,t[7]=0,t[8]=n*a*d+s*f,t[9]=s*a*d-n*f,t[10]=a*a*d+h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function u1(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function h1(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function d1(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function oc(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=n+n,h=s+s,d=a+a,g=n*f,T=n*h,E=n*d,R=s*h,A=s*d,N=a*d,m=c*f,C=c*h,x=c*d;return t[0]=1-(R+N),t[1]=T+x,t[2]=E-C,t[3]=0,t[4]=T-x,t[5]=1-(g+N),t[6]=A+m,t[7]=0,t[8]=E+C,t[9]=A-m,t[10]=1-(g+R),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function p1(t,e){var r=new de(3),n=-e[0],s=-e[1],a=-e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],T=n*n+s*s+a*a+c*c;return T>0?(r[0]=(f*c+g*n+h*a-d*s)*2/T,r[1]=(h*c+g*s+d*n-f*a)*2/T,r[2]=(d*c+g*a+f*s-h*n)*2/T):(r[0]=(f*c+g*n+h*a-d*s)*2,r[1]=(h*c+g*s+d*n-f*a)*2,r[2]=(d*c+g*a+f*s-h*n)*2),oc(t,e,r),t}function cc(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function lc(t,e){var r=e[0],n=e[1],s=e[2],a=e[4],c=e[5],f=e[6],h=e[8],d=e[9],g=e[10];return t[0]=Math.hypot(r,n,s),t[1]=Math.hypot(a,c,f),t[2]=Math.hypot(h,d,g),t}function fc(t,e){var r=new de(3);lc(r,e);var n=1/r[0],s=1/r[1],a=1/r[2],c=e[0]*n,f=e[1]*s,h=e[2]*a,d=e[4]*n,g=e[5]*s,T=e[6]*a,E=e[8]*n,R=e[9]*s,A=e[10]*a,N=c+g+A,m=0;return N>0?(m=Math.sqrt(N+1)*2,t[3]=.25*m,t[0]=(T-R)/m,t[1]=(E-h)/m,t[2]=(f-d)/m):c>g&&c>A?(m=Math.sqrt(1+c-g-A)*2,t[3]=(T-R)/m,t[0]=.25*m,t[1]=(f+d)/m,t[2]=(E+h)/m):g>A?(m=Math.sqrt(1+g-c-A)*2,t[3]=(E-h)/m,t[0]=(f+d)/m,t[1]=.25*m,t[2]=(T+R)/m):(m=Math.sqrt(1+A-c-g)*2,t[3]=(f-d)/m,t[0]=(E+h)/m,t[1]=(T+R)/m,t[2]=.25*m),t}function g1(t,e,r,n){var s=e[0],a=e[1],c=e[2],f=e[3],h=s+s,d=a+a,g=c+c,T=s*h,E=s*d,R=s*g,A=a*d,N=a*g,m=c*g,C=f*h,x=f*d,_=f*g,b=n[0],O=n[1],P=n[2];return t[0]=(1-(A+m))*b,t[1]=(E+_)*b,t[2]=(R-x)*b,t[3]=0,t[4]=(E-_)*O,t[5]=(1-(T+m))*O,t[6]=(N+C)*O,t[7]=0,t[8]=(R+x)*P,t[9]=(N-C)*P,t[10]=(1-(T+A))*P,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function m1(t,e,r,n,s){var a=e[0],c=e[1],f=e[2],h=e[3],d=a+a,g=c+c,T=f+f,E=a*d,R=a*g,A=a*T,N=c*g,m=c*T,C=f*T,x=h*d,_=h*g,b=h*T,O=n[0],P=n[1],z=n[2],L=s[0],k=s[1],W=s[2],j=(1-(N+C))*O,Y=(R+b)*O,H=(A-_)*O,B=(R-b)*P,G=(1-(E+C))*P,Q=(m+x)*P,oe=(A+_)*z,ve=(m-x)*z,ye=(1-(E+N))*z;return t[0]=j,t[1]=Y,t[2]=H,t[3]=0,t[4]=B,t[5]=G,t[6]=Q,t[7]=0,t[8]=oe,t[9]=ve,t[10]=ye,t[11]=0,t[12]=r[0]+L-(j*L+B*k+oe*W),t[13]=r[1]+k-(Y*L+G*k+ve*W),t[14]=r[2]+W-(H*L+Q*k+ye*W),t[15]=1,t}function v1(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=r+r,f=n+n,h=s+s,d=r*c,g=n*c,T=n*f,E=s*c,R=s*f,A=s*h,N=a*c,m=a*f,C=a*h;return t[0]=1-T-A,t[1]=g+C,t[2]=E-m,t[3]=0,t[4]=g-C,t[5]=1-d-A,t[6]=R+N,t[7]=0,t[8]=E+m,t[9]=R-N,t[10]=1-d-T,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function y1(t,e,r,n,s,a,c){var f=1/(r-e),h=1/(s-n),d=1/(a-c);return t[0]=a*2*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a*2*h,t[6]=0,t[7]=0,t[8]=(r+e)*f,t[9]=(s+n)*h,t[10]=(c+a)*d,t[11]=-1,t[12]=0,t[13]=0,t[14]=c*a*2*d,t[15]=0,t}function uc(t,e,r,n,s){var a=1/Math.tan(e/2),c;return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(c=1/(n-s),t[10]=(s+n)*c,t[14]=2*s*n*c):(t[10]=-1,t[14]=-2*n),t}var x1=uc;function T1(t,e,r,n,s){var a=1/Math.tan(e/2),c;return t[0]=a/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(c=1/(n-s),t[10]=s*c,t[14]=s*n*c):(t[10]=-1,t[14]=-n),t}function E1(t,e,r,n){var s=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),c=Math.tan(e.leftDegrees*Math.PI/180),f=Math.tan(e.rightDegrees*Math.PI/180),h=2/(c+f),d=2/(s+a);return t[0]=h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=d,t[6]=0,t[7]=0,t[8]=-((c-f)*h*.5),t[9]=(s-a)*d*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t}function hc(t,e,r,n,s,a,c){var f=1/(e-r),h=1/(n-s),d=1/(a-c);return t[0]=-2*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*d,t[11]=0,t[12]=(e+r)*f,t[13]=(s+n)*h,t[14]=(c+a)*d,t[15]=1,t}var w1=hc;function M1(t,e,r,n,s,a,c){var f=1/(e-r),h=1/(n-s),d=1/(a-c);return t[0]=-2*f,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=d,t[11]=0,t[12]=(e+r)*f,t[13]=(s+n)*h,t[14]=a*d,t[15]=1,t}function _1(t,e,r,n){var s,a,c,f,h,d,g,T,E,R,A=e[0],N=e[1],m=e[2],C=n[0],x=n[1],_=n[2],b=r[0],O=r[1],P=r[2];return Math.abs(A-b)<te&&Math.abs(N-O)<te&&Math.abs(m-P)<te?ic(t):(g=A-b,T=N-O,E=m-P,R=1/Math.hypot(g,T,E),g*=R,T*=R,E*=R,s=x*E-_*T,a=_*g-C*E,c=C*T-x*g,R=Math.hypot(s,a,c),R?(R=1/R,s*=R,a*=R,c*=R):(s=0,a=0,c=0),f=T*c-E*a,h=E*s-g*c,d=g*a-T*s,R=Math.hypot(f,h,d),R?(R=1/R,f*=R,h*=R,d*=R):(f=0,h=0,d=0),t[0]=s,t[1]=f,t[2]=g,t[3]=0,t[4]=a,t[5]=h,t[6]=T,t[7]=0,t[8]=c,t[9]=d,t[10]=E,t[11]=0,t[12]=-(s*A+a*N+c*m),t[13]=-(f*A+h*N+d*m),t[14]=-(g*A+T*N+E*m),t[15]=1,t)}function R1(t,e,r,n){var s=e[0],a=e[1],c=e[2],f=n[0],h=n[1],d=n[2],g=s-r[0],T=a-r[1],E=c-r[2],R=g*g+T*T+E*E;R>0&&(R=1/Math.sqrt(R),g*=R,T*=R,E*=R);var A=h*E-d*T,N=d*g-f*E,m=f*T-h*g;return R=A*A+N*N+m*m,R>0&&(R=1/Math.sqrt(R),A*=R,N*=R,m*=R),t[0]=A,t[1]=N,t[2]=m,t[3]=0,t[4]=T*m-E*N,t[5]=E*A-g*m,t[6]=g*N-T*A,t[7]=0,t[8]=g,t[9]=T,t[10]=E,t[11]=0,t[12]=s,t[13]=a,t[14]=c,t[15]=1,t}function b1(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function A1(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function S1(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t}function dc(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}function I1(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t}function C1(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t}function N1(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function O1(t,e){var r=t[0],n=t[1],s=t[2],a=t[3],c=t[4],f=t[5],h=t[6],d=t[7],g=t[8],T=t[9],E=t[10],R=t[11],A=t[12],N=t[13],m=t[14],C=t[15],x=e[0],_=e[1],b=e[2],O=e[3],P=e[4],z=e[5],L=e[6],k=e[7],W=e[8],j=e[9],Y=e[10],H=e[11],B=e[12],G=e[13],Q=e[14],oe=e[15];return Math.abs(r-x)<=te*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(n-_)<=te*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(s-b)<=te*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(a-O)<=te*Math.max(1,Math.abs(a),Math.abs(O))&&Math.abs(c-P)<=te*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(f-z)<=te*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(h-L)<=te*Math.max(1,Math.abs(h),Math.abs(L))&&Math.abs(d-k)<=te*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(g-W)<=te*Math.max(1,Math.abs(g),Math.abs(W))&&Math.abs(T-j)<=te*Math.max(1,Math.abs(T),Math.abs(j))&&Math.abs(E-Y)<=te*Math.max(1,Math.abs(E),Math.abs(Y))&&Math.abs(R-H)<=te*Math.max(1,Math.abs(R),Math.abs(H))&&Math.abs(A-B)<=te*Math.max(1,Math.abs(A),Math.abs(B))&&Math.abs(N-G)<=te*Math.max(1,Math.abs(N),Math.abs(G))&&Math.abs(m-Q)<=te*Math.max(1,Math.abs(m),Math.abs(Q))&&Math.abs(C-oe)<=te*Math.max(1,Math.abs(C),Math.abs(oe))}var F1=ac,D1=dc,$1=Object.freeze({__proto__:null,add:S1,adjoint:e1,clone:Xg,copy:Yg,create:Wg,determinant:t1,equals:O1,exactEquals:N1,frob:A1,fromQuat:v1,fromQuat2:p1,fromRotation:f1,fromRotationTranslation:oc,fromRotationTranslationScale:g1,fromRotationTranslationScaleOrigin:m1,fromScaling:l1,fromTranslation:c1,fromValues:Kg,fromXRotation:u1,fromYRotation:h1,fromZRotation:d1,frustum:y1,getRotation:fc,getScaling:lc,getTranslation:cc,identity:ic,invert:Qg,lookAt:_1,mul:F1,multiply:ac,multiplyScalar:I1,multiplyScalarAndAdd:C1,ortho:w1,orthoNO:hc,orthoZO:M1,perspective:x1,perspectiveFromFieldOfView:E1,perspectiveNO:uc,perspectiveZO:T1,rotate:s1,rotateX:i1,rotateY:a1,rotateZ:o1,scale:n1,set:Jg,str:b1,sub:D1,subtract:dc,targetTo:R1,translate:r1,transpose:Zg});function oi(){var t=new de(3);return de!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function P1(t){var e=new de(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function pc(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function ks(t,e,r){var n=new de(3);return n[0]=t,n[1]=e,n[2]=r,n}function k1(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function U1(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t}function L1(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function gc(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function mc(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function vc(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function j1(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function B1(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function V1(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t}function z1(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function G1(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function H1(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function q1(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t}function yc(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2];return Math.hypot(r,n,s)}function xc(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2];return r*r+n*n+s*s}function Tc(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function W1(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function X1(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Ec(t,e){var r=e[0],n=e[1],s=e[2],a=r*r+n*n+s*s;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function ci(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function bn(t,e,r){var n=e[0],s=e[1],a=e[2],c=r[0],f=r[1],h=r[2];return t[0]=s*h-a*f,t[1]=a*c-n*h,t[2]=n*f-s*c,t}function Y1(t,e,r,n){var s=e[0],a=e[1],c=e[2];return t[0]=s+n*(r[0]-s),t[1]=a+n*(r[1]-a),t[2]=c+n*(r[2]-c),t}function K1(t,e,r,n,s,a){var c=a*a,f=c*(2*a-3)+1,h=c*(a-2)+a,d=c*(a-1),g=c*(3-2*a);return t[0]=e[0]*f+r[0]*h+n[0]*d+s[0]*g,t[1]=e[1]*f+r[1]*h+n[1]*d+s[1]*g,t[2]=e[2]*f+r[2]*h+n[2]*d+s[2]*g,t}function J1(t,e,r,n,s,a){var c=1-a,f=c*c,h=a*a,d=f*c,g=3*a*f,T=3*h*c,E=h*a;return t[0]=e[0]*d+r[0]*g+n[0]*T+s[0]*E,t[1]=e[1]*d+r[1]*g+n[1]*T+s[1]*E,t[2]=e[2]*d+r[2]*g+n[2]*T+s[2]*E,t}function Z1(t,e){e=e||1;var r=ut()*2*Math.PI,n=ut()*2-1,s=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*s,t[1]=Math.sin(r)*s,t[2]=n*e,t}function Q1(t,e,r){var n=e[0],s=e[1],a=e[2],c=r[3]*n+r[7]*s+r[11]*a+r[15];return c=c||1,t[0]=(r[0]*n+r[4]*s+r[8]*a+r[12])/c,t[1]=(r[1]*n+r[5]*s+r[9]*a+r[13])/c,t[2]=(r[2]*n+r[6]*s+r[10]*a+r[14])/c,t}function e0(t,e,r){var n=e[0],s=e[1],a=e[2];return t[0]=n*r[0]+s*r[3]+a*r[6],t[1]=n*r[1]+s*r[4]+a*r[7],t[2]=n*r[2]+s*r[5]+a*r[8],t}function t0(t,e,r){var n=r[0],s=r[1],a=r[2],c=r[3],f=e[0],h=e[1],d=e[2],g=s*d-a*h,T=a*f-n*d,E=n*h-s*f,R=s*E-a*T,A=a*g-n*E,N=n*T-s*g,m=c*2;return g*=m,T*=m,E*=m,R*=2,A*=2,N*=2,t[0]=f+g+R,t[1]=h+T+A,t[2]=d+E+N,t}function r0(t,e,r,n){var s=[],a=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],a[0]=s[0],a[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),a[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t}function n0(t,e,r,n){var s=[],a=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],a[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),a[1]=s[1],a[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t}function s0(t,e,r,n){var s=[],a=[];return s[0]=e[0]-r[0],s[1]=e[1]-r[1],s[2]=e[2]-r[2],a[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),a[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),a[2]=s[2],t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t}function i0(t,e){var r=t[0],n=t[1],s=t[2],a=e[0],c=e[1],f=e[2],h=Math.sqrt(r*r+n*n+s*s),d=Math.sqrt(a*a+c*c+f*f),g=h*d,T=g&&ci(t,e)/g;return Math.acos(Math.min(Math.max(T,-1),1))}function a0(t){return t[0]=0,t[1]=0,t[2]=0,t}function o0(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function c0(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function l0(t,e){var r=t[0],n=t[1],s=t[2],a=e[0],c=e[1],f=e[2];return Math.abs(r-a)<=te*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-c)<=te*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(s-f)<=te*Math.max(1,Math.abs(s),Math.abs(f))}var f0=gc,u0=mc,h0=vc,d0=yc,p0=xc,wc=pc,g0=Tc,m0=function(){var t=oi();return function(e,r,n,s,a,c){var f,h;for(r||(r=3),n||(n=0),s?h=Math.min(s*r+n,e.length):h=e.length,f=n;f<h;f+=r)t[0]=e[f],t[1]=e[f+1],t[2]=e[f+2],a(t,t,c),e[f]=t[0],e[f+1]=t[1],e[f+2]=t[2];return e}}(),v0=Object.freeze({__proto__:null,add:L1,angle:i0,bezier:J1,ceil:j1,clone:P1,copy:k1,create:oi,cross:bn,dist:d0,distance:yc,div:h0,divide:vc,dot:ci,equals:l0,exactEquals:c0,floor:B1,forEach:m0,fromValues:ks,hermite:K1,inverse:X1,len:wc,length:pc,lerp:Y1,max:z1,min:V1,mul:u0,multiply:mc,negate:W1,normalize:Ec,random:Z1,rotateX:r0,rotateY:n0,rotateZ:s0,round:G1,scale:H1,scaleAndAdd:q1,set:U1,sqrDist:p0,sqrLen:g0,squaredDistance:xc,squaredLength:Tc,str:o0,sub:f0,subtract:gc,transformMat3:e0,transformMat4:Q1,transformQuat:t0,zero:a0});function Mc(){var t=new de(4);return de!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function _c(t){var e=new de(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Rc(t,e,r,n){var s=new de(4);return s[0]=t,s[1]=e,s[2]=r,s[3]=n,s}function bc(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Ac(t,e,r,n,s){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t}function Sc(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function Ic(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Cc(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function Nc(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function y0(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function x0(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function T0(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t}function E0(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t}function w0(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function Oc(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function M0(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t}function Fc(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2],a=e[3]-t[3];return Math.hypot(r,n,s,a)}function Dc(t,e){var r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2],a=e[3]-t[3];return r*r+n*n+s*s+a*a}function li(t){var e=t[0],r=t[1],n=t[2],s=t[3];return Math.hypot(e,r,n,s)}function fi(t){var e=t[0],r=t[1],n=t[2],s=t[3];return e*e+r*r+n*n+s*s}function _0(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function R0(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function $c(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=r*r+n*n+s*s+a*a;return c>0&&(c=1/Math.sqrt(c)),t[0]=r*c,t[1]=n*c,t[2]=s*c,t[3]=a*c,t}function Pc(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function b0(t,e,r,n){var s=r[0]*n[1]-r[1]*n[0],a=r[0]*n[2]-r[2]*n[0],c=r[0]*n[3]-r[3]*n[0],f=r[1]*n[2]-r[2]*n[1],h=r[1]*n[3]-r[3]*n[1],d=r[2]*n[3]-r[3]*n[2],g=e[0],T=e[1],E=e[2],R=e[3];return t[0]=T*d-E*h+R*f,t[1]=-(g*d)+E*c-R*a,t[2]=g*h-T*c+R*s,t[3]=-(g*f)+T*a-E*s,t}function kc(t,e,r,n){var s=e[0],a=e[1],c=e[2],f=e[3];return t[0]=s+n*(r[0]-s),t[1]=a+n*(r[1]-a),t[2]=c+n*(r[2]-c),t[3]=f+n*(r[3]-f),t}function A0(t,e){e=e||1;var r,n,s,a,c,f;do r=ut()*2-1,n=ut()*2-1,c=r*r+n*n;while(c>=1);do s=ut()*2-1,a=ut()*2-1,f=s*s+a*a;while(f>=1);var h=Math.sqrt((1-c)/f);return t[0]=e*r,t[1]=e*n,t[2]=e*s*h,t[3]=e*a*h,t}function S0(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3];return t[0]=r[0]*n+r[4]*s+r[8]*a+r[12]*c,t[1]=r[1]*n+r[5]*s+r[9]*a+r[13]*c,t[2]=r[2]*n+r[6]*s+r[10]*a+r[14]*c,t[3]=r[3]*n+r[7]*s+r[11]*a+r[15]*c,t}function I0(t,e,r){var n=e[0],s=e[1],a=e[2],c=r[0],f=r[1],h=r[2],d=r[3],g=d*n+f*a-h*s,T=d*s+h*n-c*a,E=d*a+c*s-f*n,R=-c*n-f*s-h*a;return t[0]=g*d+R*-c+T*-h-E*-f,t[1]=T*d+R*-f+E*-c-g*-h,t[2]=E*d+R*-h+g*-f-T*-c,t[3]=e[3],t}function C0(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function N0(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Uc(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Lc(t,e){var r=t[0],n=t[1],s=t[2],a=t[3],c=e[0],f=e[1],h=e[2],d=e[3];return Math.abs(r-c)<=te*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-f)<=te*Math.max(1,Math.abs(n),Math.abs(f))&&Math.abs(s-h)<=te*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(a-d)<=te*Math.max(1,Math.abs(a),Math.abs(d))}var O0=Ic,F0=Cc,D0=Nc,$0=Fc,P0=Dc,k0=li,U0=fi,L0=function(){var t=Mc();return function(e,r,n,s,a,c){var f,h;for(r||(r=4),n||(n=0),s?h=Math.min(s*r+n,e.length):h=e.length,f=n;f<h;f+=r)t[0]=e[f],t[1]=e[f+1],t[2]=e[f+2],t[3]=e[f+3],a(t,t,c),e[f]=t[0],e[f+1]=t[1],e[f+2]=t[2],e[f+3]=t[3];return e}}(),j0=Object.freeze({__proto__:null,add:Sc,ceil:y0,clone:_c,copy:bc,create:Mc,cross:b0,dist:$0,distance:Fc,div:D0,divide:Nc,dot:Pc,equals:Lc,exactEquals:Uc,floor:x0,forEach:L0,fromValues:Rc,inverse:R0,len:k0,length:li,lerp:kc,max:E0,min:T0,mul:F0,multiply:Cc,negate:_0,normalize:$c,random:A0,round:w0,scale:Oc,scaleAndAdd:M0,set:Ac,sqrDist:P0,sqrLen:U0,squaredDistance:Dc,squaredLength:fi,str:N0,sub:O0,subtract:Ic,transformMat4:S0,transformQuat:I0,zero:C0});function Pn(){var t=new de(4);return de!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function B0(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function jc(t,e,r){r=r*.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function V0(t,e){var r=Math.acos(e[3])*2,n=Math.sin(r/2);return n>te?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r}function z0(t,e){var r=hi(t,e);return Math.acos(2*r*r-1)}function Bc(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=r[0],h=r[1],d=r[2],g=r[3];return t[0]=n*g+c*f+s*d-a*h,t[1]=s*g+c*h+a*f-n*d,t[2]=a*g+c*d+n*h-s*f,t[3]=c*g-n*f-s*h-a*d,t}function Vc(t,e,r){r*=.5;var n=e[0],s=e[1],a=e[2],c=e[3],f=Math.sin(r),h=Math.cos(r);return t[0]=n*h+c*f,t[1]=s*h+a*f,t[2]=a*h-s*f,t[3]=c*h-n*f,t}function zc(t,e,r){r*=.5;var n=e[0],s=e[1],a=e[2],c=e[3],f=Math.sin(r),h=Math.cos(r);return t[0]=n*h-a*f,t[1]=s*h+c*f,t[2]=a*h+n*f,t[3]=c*h-s*f,t}function Gc(t,e,r){r*=.5;var n=e[0],s=e[1],a=e[2],c=e[3],f=Math.sin(r),h=Math.cos(r);return t[0]=n*h+s*f,t[1]=s*h-n*f,t[2]=a*h+c*f,t[3]=c*h-a*f,t}function G0(t,e){var r=e[0],n=e[1],s=e[2];return t[0]=r,t[1]=n,t[2]=s,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-s*s)),t}function Hc(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=Math.sqrt(r*r+n*n+s*s),f=Math.exp(a),h=c>0?f*Math.sin(c)/c:0;return t[0]=r*h,t[1]=n*h,t[2]=s*h,t[3]=f*Math.cos(c),t}function qc(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=Math.sqrt(r*r+n*n+s*s),f=c>0?Math.atan2(c,a)/c:0;return t[0]=r*f,t[1]=n*f,t[2]=s*f,t[3]=.5*Math.log(r*r+n*n+s*s+a*a),t}function H0(t,e,r){return qc(t,e),Xc(t,t,r),Hc(t,t),t}function An(t,e,r,n){var s=e[0],a=e[1],c=e[2],f=e[3],h=r[0],d=r[1],g=r[2],T=r[3],E,R,A,N,m;return R=s*h+a*d+c*g+f*T,R<0&&(R=-R,h=-h,d=-d,g=-g,T=-T),1-R>te?(E=Math.acos(R),A=Math.sin(E),N=Math.sin((1-n)*E)/A,m=Math.sin(n*E)/A):(N=1-n,m=n),t[0]=N*s+m*h,t[1]=N*a+m*d,t[2]=N*c+m*g,t[3]=N*f+m*T,t}function q0(t){var e=ut(),r=ut(),n=ut(),s=Math.sqrt(1-e),a=Math.sqrt(e);return t[0]=s*Math.sin(2*Math.PI*r),t[1]=s*Math.cos(2*Math.PI*r),t[2]=a*Math.sin(2*Math.PI*n),t[3]=a*Math.cos(2*Math.PI*n),t}function W0(t,e){var r=e[0],n=e[1],s=e[2],a=e[3],c=r*r+n*n+s*s+a*a,f=c?1/c:0;return t[0]=-r*f,t[1]=-n*f,t[2]=-s*f,t[3]=a*f,t}function X0(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Wc(t,e){var r=e[0]+e[4]+e[8],n;if(r>0)n=Math.sqrt(r+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);var a=(s+1)%3,c=(s+2)%3;n=Math.sqrt(e[s*3+s]-e[a*3+a]-e[c*3+c]+1),t[s]=.5*n,n=.5/n,t[3]=(e[a*3+c]-e[c*3+a])*n,t[a]=(e[a*3+s]+e[s*3+a])*n,t[c]=(e[c*3+s]+e[s*3+c])*n}return t}function Y0(t,e,r,n){var s=.5*Math.PI/180;e*=s,r*=s,n*=s;var a=Math.sin(e),c=Math.cos(e),f=Math.sin(r),h=Math.cos(r),d=Math.sin(n),g=Math.cos(n);return t[0]=a*h*g-c*f*d,t[1]=c*f*g+a*h*d,t[2]=c*h*d-a*f*g,t[3]=c*h*g+a*f*d,t}function K0(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var J0=_c,Z0=Rc,ui=bc,Q0=Ac,em=Sc,tm=Bc,Xc=Oc,hi=Pc,rm=kc,di=li,nm=di,pi=fi,sm=pi,gi=$c,im=Uc,am=Lc,om=function(){var t=oi(),e=ks(1,0,0),r=ks(0,1,0);return function(n,s,a){var c=ci(s,a);return c<-.999999?(bn(t,e,s),wc(t)<1e-6&&bn(t,r,s),Ec(t,t),jc(n,t,Math.PI),n):c>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):(bn(t,s,a),n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=1+c,gi(n,n))}}(),cm=function(){var t=Pn(),e=Pn();return function(r,n,s,a,c,f){return An(t,n,c,f),An(e,s,a,f),An(r,t,e,2*f*(1-f)),r}}(),lm=function(){var t=rc();return function(e,r,n,s){return t[0]=n[0],t[3]=n[1],t[6]=n[2],t[1]=s[0],t[4]=s[1],t[7]=s[2],t[2]=-r[0],t[5]=-r[1],t[8]=-r[2],gi(e,Wc(e,t))}}(),fm=Object.freeze({__proto__:null,add:em,calculateW:G0,clone:J0,conjugate:X0,copy:ui,create:Pn,dot:hi,equals:am,exactEquals:im,exp:Hc,fromEuler:Y0,fromMat3:Wc,fromValues:Z0,getAngle:z0,getAxisAngle:V0,identity:B0,invert:W0,len:nm,length:di,lerp:rm,ln:qc,mul:tm,multiply:Bc,normalize:gi,pow:H0,random:q0,rotateX:Vc,rotateY:zc,rotateZ:Gc,rotationTo:om,scale:Xc,set:Q0,setAxes:lm,setAxisAngle:jc,slerp:An,sqlerp:cm,sqrLen:sm,squaredLength:pi,str:K0});function um(){var t=new de(8);return de!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function hm(t){var e=new de(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function dm(t,e,r,n,s,a,c,f){var h=new de(8);return h[0]=t,h[1]=e,h[2]=r,h[3]=n,h[4]=s,h[5]=a,h[6]=c,h[7]=f,h}function pm(t,e,r,n,s,a,c){var f=new de(8);f[0]=t,f[1]=e,f[2]=r,f[3]=n;var h=s*.5,d=a*.5,g=c*.5;return f[4]=h*n+d*r-g*e,f[5]=d*n+g*t-h*r,f[6]=g*n+h*e-d*t,f[7]=-h*t-d*e-g*r,f}function Yc(t,e,r){var n=r[0]*.5,s=r[1]*.5,a=r[2]*.5,c=e[0],f=e[1],h=e[2],d=e[3];return t[0]=c,t[1]=f,t[2]=h,t[3]=d,t[4]=n*d+s*h-a*f,t[5]=s*d+a*c-n*h,t[6]=a*d+n*f-s*c,t[7]=-n*c-s*f-a*h,t}function gm(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0]*.5,t[5]=e[1]*.5,t[6]=e[2]*.5,t[7]=0,t}function mm(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function vm(t,e){var r=Pn();fc(r,e);var n=new de(3);return cc(n,e),Yc(t,r,n),t}function Kc(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function ym(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function xm(t,e,r,n,s,a,c,f,h){return t[0]=e,t[1]=r,t[2]=n,t[3]=s,t[4]=a,t[5]=c,t[6]=f,t[7]=h,t}var Tm=ui;function Em(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}var wm=ui;function Mm(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function _m(t,e){var r=e[4],n=e[5],s=e[6],a=e[7],c=-e[0],f=-e[1],h=-e[2],d=e[3];return t[0]=(r*d+a*c+n*h-s*f)*2,t[1]=(n*d+a*f+s*c-r*h)*2,t[2]=(s*d+a*h+r*f-n*c)*2,t}function Rm(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=r[0]*.5,h=r[1]*.5,d=r[2]*.5,g=e[4],T=e[5],E=e[6],R=e[7];return t[0]=n,t[1]=s,t[2]=a,t[3]=c,t[4]=c*f+s*d-a*h+g,t[5]=c*h+a*f-n*d+T,t[6]=c*d+n*h-s*f+E,t[7]=-n*f-s*h-a*d+R,t}function bm(t,e,r){var n=-e[0],s=-e[1],a=-e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],T=f*c+g*n+h*a-d*s,E=h*c+g*s+d*n-f*a,R=d*c+g*a+f*s-h*n,A=g*c-f*n-h*s-d*a;return Vc(t,e,r),n=t[0],s=t[1],a=t[2],c=t[3],t[4]=T*c+A*n+E*a-R*s,t[5]=E*c+A*s+R*n-T*a,t[6]=R*c+A*a+T*s-E*n,t[7]=A*c-T*n-E*s-R*a,t}function Am(t,e,r){var n=-e[0],s=-e[1],a=-e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],T=f*c+g*n+h*a-d*s,E=h*c+g*s+d*n-f*a,R=d*c+g*a+f*s-h*n,A=g*c-f*n-h*s-d*a;return zc(t,e,r),n=t[0],s=t[1],a=t[2],c=t[3],t[4]=T*c+A*n+E*a-R*s,t[5]=E*c+A*s+R*n-T*a,t[6]=R*c+A*a+T*s-E*n,t[7]=A*c-T*n-E*s-R*a,t}function Sm(t,e,r){var n=-e[0],s=-e[1],a=-e[2],c=e[3],f=e[4],h=e[5],d=e[6],g=e[7],T=f*c+g*n+h*a-d*s,E=h*c+g*s+d*n-f*a,R=d*c+g*a+f*s-h*n,A=g*c-f*n-h*s-d*a;return Gc(t,e,r),n=t[0],s=t[1],a=t[2],c=t[3],t[4]=T*c+A*n+E*a-R*s,t[5]=E*c+A*s+R*n-T*a,t[6]=R*c+A*a+T*s-E*n,t[7]=A*c-T*n-E*s-R*a,t}function Im(t,e,r){var n=r[0],s=r[1],a=r[2],c=r[3],f=e[0],h=e[1],d=e[2],g=e[3];return t[0]=f*c+g*n+h*a-d*s,t[1]=h*c+g*s+d*n-f*a,t[2]=d*c+g*a+f*s-h*n,t[3]=g*c-f*n-h*s-d*a,f=e[4],h=e[5],d=e[6],g=e[7],t[4]=f*c+g*n+h*a-d*s,t[5]=h*c+g*s+d*n-f*a,t[6]=d*c+g*a+f*s-h*n,t[7]=g*c-f*n-h*s-d*a,t}function Cm(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=r[0],h=r[1],d=r[2],g=r[3];return t[0]=n*g+c*f+s*d-a*h,t[1]=s*g+c*h+a*f-n*d,t[2]=a*g+c*d+n*h-s*f,t[3]=c*g-n*f-s*h-a*d,f=r[4],h=r[5],d=r[6],g=r[7],t[4]=n*g+c*f+s*d-a*h,t[5]=s*g+c*h+a*f-n*d,t[6]=a*g+c*d+n*h-s*f,t[7]=c*g-n*f-s*h-a*d,t}function Nm(t,e,r,n){if(Math.abs(n)<te)return Kc(t,e);var s=Math.hypot(r[0],r[1],r[2]);n=n*.5;var a=Math.sin(n),c=a*r[0]/s,f=a*r[1]/s,h=a*r[2]/s,d=Math.cos(n),g=e[0],T=e[1],E=e[2],R=e[3];t[0]=g*d+R*c+T*h-E*f,t[1]=T*d+R*f+E*c-g*h,t[2]=E*d+R*h+g*f-T*c,t[3]=R*d-g*c-T*f-E*h;var A=e[4],N=e[5],m=e[6],C=e[7];return t[4]=A*d+C*c+N*h-m*f,t[5]=N*d+C*f+m*c-A*h,t[6]=m*d+C*h+A*f-N*c,t[7]=C*d-A*c-N*f-m*h,t}function Om(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t}function Jc(t,e,r){var n=e[0],s=e[1],a=e[2],c=e[3],f=r[4],h=r[5],d=r[6],g=r[7],T=e[4],E=e[5],R=e[6],A=e[7],N=r[0],m=r[1],C=r[2],x=r[3];return t[0]=n*x+c*N+s*C-a*m,t[1]=s*x+c*m+a*N-n*C,t[2]=a*x+c*C+n*m-s*N,t[3]=c*x-n*N-s*m-a*C,t[4]=n*g+c*f+s*d-a*h+T*x+A*N+E*C-R*m,t[5]=s*g+c*h+a*f-n*d+E*x+A*m+R*N-T*C,t[6]=a*g+c*d+n*h-s*f+R*x+A*C+T*m-E*N,t[7]=c*g-n*f-s*h-a*d+A*x-T*N-E*m-R*C,t}var Fm=Jc;function Dm(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t}var Zc=hi;function $m(t,e,r,n){var s=1-n;return Zc(e,r)<0&&(n=-n),t[0]=e[0]*s+r[0]*n,t[1]=e[1]*s+r[1]*n,t[2]=e[2]*s+r[2]*n,t[3]=e[3]*s+r[3]*n,t[4]=e[4]*s+r[4]*n,t[5]=e[5]*s+r[5]*n,t[6]=e[6]*s+r[6]*n,t[7]=e[7]*s+r[7]*n,t}function Pm(t,e){var r=Gn(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t}function km(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t}var Qc=di,Um=Qc,Gn=pi,Lm=Gn;function jm(t,e){var r=Gn(e);if(r>0){r=Math.sqrt(r);var n=e[0]/r,s=e[1]/r,a=e[2]/r,c=e[3]/r,f=e[4],h=e[5],d=e[6],g=e[7],T=n*f+s*h+a*d+c*g;t[0]=n,t[1]=s,t[2]=a,t[3]=c,t[4]=(f-n*T)/r,t[5]=(h-s*T)/r,t[6]=(d-a*T)/r,t[7]=(g-c*T)/r}return t}function Bm(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function Vm(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]}function zm(t,e){var r=t[0],n=t[1],s=t[2],a=t[3],c=t[4],f=t[5],h=t[6],d=t[7],g=e[0],T=e[1],E=e[2],R=e[3],A=e[4],N=e[5],m=e[6],C=e[7];return Math.abs(r-g)<=te*Math.max(1,Math.abs(r),Math.abs(g))&&Math.abs(n-T)<=te*Math.max(1,Math.abs(n),Math.abs(T))&&Math.abs(s-E)<=te*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(a-R)<=te*Math.max(1,Math.abs(a),Math.abs(R))&&Math.abs(c-A)<=te*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(f-N)<=te*Math.max(1,Math.abs(f),Math.abs(N))&&Math.abs(h-m)<=te*Math.max(1,Math.abs(h),Math.abs(m))&&Math.abs(d-C)<=te*Math.max(1,Math.abs(d),Math.abs(C))}var Gm=Object.freeze({__proto__:null,add:Om,clone:hm,conjugate:km,copy:Kc,create:um,dot:Zc,equals:zm,exactEquals:Vm,fromMat4:vm,fromRotation:mm,fromRotationTranslation:Yc,fromRotationTranslationValues:pm,fromTranslation:gm,fromValues:dm,getDual:Em,getReal:Tm,getTranslation:_m,identity:ym,invert:Pm,len:Um,length:Qc,lerp:$m,mul:Fm,multiply:Jc,normalize:jm,rotateAroundAxis:Nm,rotateByQuatAppend:Im,rotateByQuatPrepend:Cm,rotateX:bm,rotateY:Am,rotateZ:Sm,scale:Dm,set:xm,setDual:Mm,setReal:wm,sqrLen:Lm,squaredLength:Gn,str:Bm,translate:Rm});function el(){var t=new de(2);return de!=Float32Array&&(t[0]=0,t[1]=0),t}function Hm(t){var e=new de(2);return e[0]=t[0],e[1]=t[1],e}function qm(t,e){var r=new de(2);return r[0]=t,r[1]=e,r}function Wm(t,e){return t[0]=e[0],t[1]=e[1],t}function Xm(t,e,r){return t[0]=e,t[1]=r,t}function Ym(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function tl(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function rl(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function nl(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function Km(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function Jm(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function Zm(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t}function Qm(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t}function ev(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function tv(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t}function rv(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t}function sl(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.hypot(r,n)}function il(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n}function al(t){var e=t[0],r=t[1];return Math.hypot(e,r)}function ol(t){var e=t[0],r=t[1];return e*e+r*r}function nv(t,e){return t[0]=-e[0],t[1]=-e[1],t}function sv(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function iv(t,e){var r=e[0],n=e[1],s=r*r+n*n;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t}function av(t,e){return t[0]*e[0]+t[1]*e[1]}function ov(t,e,r){var n=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=n,t}function cv(t,e,r,n){var s=e[0],a=e[1];return t[0]=s+n*(r[0]-s),t[1]=a+n*(r[1]-a),t}function lv(t,e){e=e||1;var r=ut()*2*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t}function fv(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[2]*s,t[1]=r[1]*n+r[3]*s,t}function uv(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[2]*s+r[4],t[1]=r[1]*n+r[3]*s+r[5],t}function hv(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[3]*s+r[6],t[1]=r[1]*n+r[4]*s+r[7],t}function dv(t,e,r){var n=e[0],s=e[1];return t[0]=r[0]*n+r[4]*s+r[12],t[1]=r[1]*n+r[5]*s+r[13],t}function pv(t,e,r,n){var s=e[0]-r[0],a=e[1]-r[1],c=Math.sin(n),f=Math.cos(n);return t[0]=s*f-a*c+r[0],t[1]=s*c+a*f+r[1],t}function gv(t,e){var r=t[0],n=t[1],s=e[0],a=e[1],c=Math.sqrt(r*r+n*n)*Math.sqrt(s*s+a*a),f=c&&(r*s+n*a)/c;return Math.acos(Math.min(Math.max(f,-1),1))}function mv(t){return t[0]=0,t[1]=0,t}function vv(t){return"vec2("+t[0]+", "+t[1]+")"}function yv(t,e){return t[0]===e[0]&&t[1]===e[1]}function xv(t,e){var r=t[0],n=t[1],s=e[0],a=e[1];return Math.abs(r-s)<=te*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-a)<=te*Math.max(1,Math.abs(n),Math.abs(a))}var Tv=al,Ev=tl,wv=rl,Mv=nl,_v=sl,Rv=il,bv=ol,Av=function(){var t=el();return function(e,r,n,s,a,c){var f,h;for(r||(r=2),n||(n=0),s?h=Math.min(s*r+n,e.length):h=e.length,f=n;f<h;f+=r)t[0]=e[f],t[1]=e[f+1],a(t,t,c),e[f]=t[0],e[f+1]=t[1];return e}}(),Sv=Object.freeze({__proto__:null,add:Ym,angle:gv,ceil:Km,clone:Hm,copy:Wm,create:el,cross:ov,dist:_v,distance:sl,div:Mv,divide:nl,dot:av,equals:xv,exactEquals:yv,floor:Jm,forEach:Av,fromValues:qm,inverse:sv,len:Tv,length:al,lerp:cv,max:Qm,min:Zm,mul:wv,multiply:rl,negate:nv,normalize:iv,random:lv,rotate:pv,round:ev,scale:tv,scaleAndAdd:rv,set:Xm,sqrDist:Rv,sqrLen:bv,squaredDistance:il,squaredLength:ol,str:vv,sub:Ev,subtract:tl,transformMat2:fv,transformMat2d:uv,transformMat3:hv,transformMat4:dv,zero:mv}),cl=Object.freeze({__proto__:null,glMatrix:Ep,mat2:qp,mat2d:mg,mat3:qg,mat4:$1,quat:fm,quat2:Gm,vec2:Sv,vec3:v0,vec4:j0}),Iv=(()=>{var t=import.meta.url;return async function(e={}){var r=e,n,s;r.ready=new Promise((i,o)=>{n=i,s=o});var a=!1;r.setup=function(){if(a)return;a=!0;function i(I,S,$=U=>U){if(S)for(let U of S)I.push_back($(U));return I}function o(I,S=$=>$){const $=[],U=I.size();for(let Z=0;Z<U;Z++)$.push(S(I.get(Z)));return $}function l(I,S=$=>$){const $=[],U=I.size();for(let Z=0;Z<U;Z++){const pe=I.get(Z),ne=pe.size(),st=[];for(let Ge=0;Ge<ne;Ge++)st.push(S(pe.get(Ge)));$.push(st)}return $}function u(I){return I[0].length<3&&(I=[I]),i(new r.Vector2_vec2,I,S=>i(new r.Vector_vec2,S,$=>$ instanceof Array?{x:$[0],y:$[1]}:$))}function p(I){for(let S=0;S<I.size();S++)I.get(S).delete();I.delete()}function v(I){return I[0]instanceof Array?{x:I[0][0],y:I[0][1]}:typeof I[0]=="number"?{x:I[0]||0,y:I[1]||0}:I[0]}function w(I){return I[0]instanceof Array?{x:I[0][0],y:I[0][1],z:I[0][2]}:typeof I[0]=="number"?{x:I[0]||0,y:I[1]||0,z:I[2]||0}:I[0]}function M(I){return I=="EvenOdd"?0:I=="NonZero"?1:I=="Negative"?3:2}function F(I){return I=="Round"?1:I=="Miter"?2:0}const D=r.CrossSection;function V(I,S="Positive"){if(I instanceof D)return I;{const $=u(I),U=new D($,M(S));return p($),U}}r.CrossSection.prototype.translate=function(...I){return this._Translate(v(I))},r.CrossSection.prototype.scale=function(I){return typeof I=="number"?this._Scale({x:I,y:I}):this._Scale(v([I]))},r.CrossSection.prototype.mirror=function(I){return this._Mirror(v([I]))},r.CrossSection.prototype.warp=function(I){const S=Cr(function(U){const Z=lt(U,"float"),pe=lt(U+4,"float"),ne=[Z,pe];I(ne),or(U,ne[0],"float"),or(U+4,ne[1],"float")},"vi"),$=this._Warp(S);return Nr(S),$},r.CrossSection.prototype.decompose=function(){const I=this._Decompose(),S=o(I);return I.delete(),S},r.CrossSection.prototype.bounds=function(){const I=this._Bounds();return{min:["x","y"].map(S=>I.min[S]),max:["x","y"].map(S=>I.max[S])}},r.CrossSection.prototype.offset=function(I,S="Square",$=2,U=0){return this._Offset(I,F(S),$,U)},r.CrossSection.prototype.extrude=function(I,S=0,$=0,U=[1,1],Z=!1){U=v([U]);const pe=r._Extrude(this,I,S,$,U);return Z?pe.translate([0,0,-I/2]):pe},r.CrossSection.prototype.revolve=function(I=0,S=360){return r._Revolve(this,I,S)},r.CrossSection.prototype.add=function(I){return this._add(V(I))},r.CrossSection.prototype.subtract=function(I){return this._subtract(V(I))},r.CrossSection.prototype.intersect=function(I){return this._intersect(V(I))},r.CrossSection.prototype.toPolygons=function(){const I=this._ToPolygons(),S=l(I);return I.delete(),S},r.Manifold.prototype.warp=function(I){const S=Cr(function(Z){const pe=lt(Z,"float"),ne=lt(Z+4,"float"),st=lt(Z+8,"float"),Ge=[pe,ne,st];I(Ge),or(Z,Ge[0],"float"),or(Z+4,Ge[1],"float"),or(Z+8,Ge[2],"float")},"vi"),$=this._Warp(S);Nr(S);const U=$.status();if(U.value!==0)throw new r.ManifoldError(U.value);return $},r.Manifold.prototype.setProperties=function(I,S){const $=this.numProp(),U=Cr(function(pe,ne,st){const Ge=[];for(let Ue=0;Ue<I;++Ue)Ge[Ue]=lt(pe+4*Ue,"float");const ur=[];for(let Ue=0;Ue<3;++Ue)ur[Ue]=lt(ne+4*Ue,"float");const hr=[];for(let Ue=0;Ue<$;++Ue)hr[Ue]=lt(st+4*Ue,"float");S(Ge,ur,hr);for(let Ue=0;Ue<I;++Ue)or(pe+4*Ue,Ge[Ue],"float")},"viii"),Z=this._SetProperties(I,U);return Nr(U),Z},r.Manifold.prototype.translate=function(...I){return this._Translate(w(I))},r.Manifold.prototype.rotate=function(I){return this._Rotate(...I)},r.Manifold.prototype.scale=function(I){return typeof I=="number"?this._Scale({x:I,y:I,z:I}):this._Scale(w([I]))},r.Manifold.prototype.mirror=function(I){return this._Mirror(w([I]))},r.Manifold.prototype.trimByPlane=function(I,S=0){return this._TrimByPlane(w([I]),S)},r.Manifold.prototype.split=function(I){const S=this._split(I),$=o(S);return S.delete(),$},r.Manifold.prototype.splitByPlane=function(I,S=0){const $=this._splitByPlane(w([I]),S),U=o($);return $.delete(),U},r.Manifold.prototype.decompose=function(){const I=this._Decompose(),S=o(I);return I.delete(),S},r.Manifold.prototype.fracture=function(I,S){if(I instanceof Array){let $=new r.Vector_dvec3,U=new r.Vector_f64;for(const ne of I)ne instanceof Array&&typeof ne[0]=="number"&&ne.length>=3?($.push_back({x:ne[0],y:ne[1],z:ne[2]}),ne.length>=4&&U.push_back(ne[3])):ne.x?$.push_back(ne):he($,ne);if(S instanceof Array&&S.length==I.length)for(const ne of S)typeof ne=="number"&&U.push_back(ne);else if(U.size()==0)for(const ne of I)U.push_back(1);const Z=this._Fracture($,U);$.delete(),U.delete();const pe=o(Z);return Z.delete(),pe}},r.Manifold.prototype.convexDecomposition=function(){const I=this._ConvexDecomposition(),S=o(I);return I.delete(),S},r.Manifold.prototype.boundingBox=function(){const I=this._boundingBox();return{min:["x","y","z"].map(S=>I.min[S]),max:["x","y","z"].map(S=>I.max[S])}};class K{constructor({numProp:S=3,triVerts:$=new Uint32Array,vertProperties:U=new Float32Array,mergeFromVert:Z,mergeToVert:pe,runIndex:ne,runOriginalID:st,faceID:Ge,halfedgeTangent:ur,runTransform:hr}={}){this.numProp=S,this.triVerts=$,this.vertProperties=U,this.mergeFromVert=Z,this.mergeToVert=pe,this.runIndex=ne,this.runOriginalID=st,this.faceID=Ge,this.halfedgeTangent=ur,this.runTransform=hr}get numTri(){return this.triVerts.length/3}get numVert(){return this.vertProperties.length/this.numProp}get numRun(){return this.runOriginalID.length}merge(){const{changed:S,mesh:$}=r._Merge(this);return Object.assign(this,{...$}),S}verts(S){return this.triVerts.subarray(3*S,3*(S+1))}position(S){return this.vertProperties.subarray(numProp*S,numProp*S+3)}extras(S){return this.vertProperties.subarray(numProp*S+3,numProp*(S+1))}tangent(S){return this.halfedgeTangent.subarray(4*S,4*(S+1))}transform(S){const $=new Array(16);for(const U of[0,1,2,3])for(const Z of[0,1,2])$[4*U+Z]=this.runTransform[12*S+3*U+Z];return $[15]=1,$}}r.Mesh=K,r.Manifold.prototype.getMesh=function(I=[0,0,0]){return I instanceof Array&&(I={0:I[0],1:I[1],2:I[2]}),new K(this._GetMeshJS(I))},r.ManifoldError=function(S,...$){let U="Unknown error";switch(S){case r.status.NonFiniteVertex.value:U="Non-finite vertex";break;case r.status.NotManifold.value:U="Not manifold";break;case r.status.VertexOutOfBounds.value:U="Vertex index out of bounds";break;case r.status.PropertiesWrongLength.value:U="Properties have wrong length";break;case r.status.MissingPositionProperties.value:U="Less than three properties";break;case r.status.MergeVectorsDifferentLengths.value:U="Merge vectors have different lengths";break;case r.status.MergeIndexOutOfBounds.value:U="Merge index out of bounds";break;case r.status.TransformWrongLength.value:U="Transform vector has wrong length";break;case r.status.RunIndexWrongLength.value:U="Run index vector has wrong length";break;case r.status.FaceIDWrongLength.value:U="Face ID vector has wrong length";case r.status.InvalidConstruction.value:U="Manifold constructed with invalid parameters"}const Z=Error.apply(this,[U,...$]);Z.name=this.name="ManifoldError",this.message=Z.message,this.stack=Z.stack,this.code=S},r.ManifoldError.prototype=Object.create(Error.prototype,{constructor:{value:r.ManifoldError,writable:!0,configurable:!0}}),r.CrossSection=function(I,S="Positive"){const $=u(I),U=new D($,M(S));return p($),U},r.CrossSection.ofPolygons=function(I,S="Positive"){return new r.CrossSection(I,S)},r.CrossSection.square=function(...I){let S;I.length==0?S={x:1,y:1}:typeof I[0]=="number"?S={x:I[0],y:I[0]}:S=v(I);const $=I[1]||!1;return r._Square(S,$)},r.CrossSection.circle=function(I,S=0){return r._Circle(I,S)};function q(I){return function(...S){S.length==1&&(S=S[0]);const $=new r.Vector_crossSection;for(const Z of S)$.push_back(V(Z));const U=r["_crossSection"+I]($);return $.delete(),U}}r.CrossSection.compose=q("Compose"),r.CrossSection.union=q("UnionN"),r.CrossSection.difference=q("DifferenceN"),r.CrossSection.intersection=q("IntersectionN");function X(I,S){i(I,S,$=>$ instanceof Array?{x:$[0],y:$[1]}:$)}r.CrossSection.hull=function(...I){I.length==1&&(I=I[0]);let S=new r.Vector_vec2;for(const U of I)if(U instanceof D)r._crossSectionCollectVertices(S,U);else if(U instanceof Array&&U.length==2&&typeof U[0]=="number")S.push_back({x:U[0],y:U[1]});else if(U.x)S.push_back(U);else{const pe=U[0].length==2&&typeof U[0][0]=="number"||U[0].x?[U]:U;for(const ne of pe)X(S,ne)}const $=r._crossSectionHullPoints(S);return S.delete(),$},r.CrossSection.prototype=Object.create(D.prototype),Object.defineProperty(r.CrossSection,Symbol.hasInstance,{get:()=>I=>I instanceof D});const ee=r.Manifold;r.Manifold=function(I){const S=new ee(I),$=S.status();if($.value!==0)throw new r.ManifoldError($.value);return S},r.Manifold.ofMesh=function(I){return new r.Manifold(I)},r.Manifold.tetrahedron=function(){return r._Tetrahedron()},r.Manifold.cube=function(...I){let S;I.length==0?S={x:1,y:1,z:1}:typeof I[0]=="number"?S={x:I[0],y:I[0],z:I[0]}:S=w(I);const $=I[1]||!1;return r._Cube(S,$)},r.Manifold.cylinder=function(I,S,$=-1,U=0,Z=!1){return r._Cylinder(I,S,$,U,Z)},r.Manifold.sphere=function(I,S=0){return r._Sphere(I,S)},r.Manifold.smooth=function(I,S=[]){const $=new r.Vector_smoothness;i($,S);const U=r._Smooth(I,$);return $.delete(),U},r.Manifold.extrude=function(I,S,$=0,U=0,Z=[1,1],pe=!1){return(I instanceof D?I:r.CrossSection(I,"Positive")).extrude(S,$,U,Z,pe)},r.Manifold.revolve=function(I,S=0,$=360){return(I instanceof D?I:r.CrossSection(I,"Positive")).revolve(S,$)},r.Manifold.reserveIDs=function(I){return r._ReserveIDs(I)},r.Manifold.compose=function(I){const S=new r.Vector_manifold;i(S,I);const $=r._manifoldCompose(S);return S.delete(),$};function ue(I){return function(...S){S.length==1&&(S=S[0]);const $=new r.Vector_manifold;for(const Z of S)$.push_back(Z);const U=r["_manifold"+I+"N"]($);return $.delete(),U}}r.Manifold.union=ue("Union"),r.Manifold.difference=ue("Difference"),r.Manifold.intersection=ue("Intersection"),r.Manifold.levelSet=function(I,S,$,U=0){const Z={min:{x:S.min[0],y:S.min[1],z:S.min[2]},max:{x:S.max[0],y:S.max[1],z:S.max[2]}},pe=Cr(function(st){const Ge=lt(st,"float"),ur=lt(st+4,"float"),hr=lt(st+8,"float");return I([Ge,ur,hr])},"fi"),ne=r._LevelSet(pe,Z,$,U);return Nr(pe),ne};function he(I,S){i(I,S,$=>$ instanceof Array?{x:$[0],y:$[1],z:$[2]}:$)}r.Manifold.hull=function(...I){I.length==1&&(I=I[0]);let S=new r.Vector_vec3;for(const U of I)U instanceof ee?r._manifoldCollectVertices(S,U):U instanceof Array&&U.length==3&&typeof U[0]=="number"?S.push_back({x:U[0],y:U[1],z:U[2]}):U.x?S.push_back(U):he(S,U);const $=r._manifoldHullPoints(S);return S.delete(),$},r.Manifold.prototype=Object.create(ee.prototype),Object.defineProperty(r.Manifold,Symbol.hasInstance,{get:()=>I=>I instanceof ee}),r.triangulate=function(I,S=-1){const $=u(I),U=o(r._Triangulate($,S),Z=>[Z[0],Z[1],Z[2]]);return p($),U}};var c=Object.assign({},r),f="./this.program",h=(i,o)=>{throw o},d=typeof window=="object",g=typeof importScripts=="function",T=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",E="";function R(i){return r.locateFile?r.locateFile(i,E):E+i}var A,N,m;if(T){const{createRequire:i}=await import("./__vite-browser-external-4ed993c7.js");var C=i(import.meta.url),x=C("fs"),_=C("path");g?E=_.dirname(E)+"/":E=C("url").fileURLToPath(new URL("./",self.location)),A=(o,l)=>(o=en(o)?new URL(o):_.normalize(o),x.readFileSync(o,l?void 0:"utf8")),m=o=>{var l=A(o,!0);return l.buffer||(l=new Uint8Array(l)),l},N=(o,l,u,p=!0)=>{o=en(o)?new URL(o):_.normalize(o),x.readFile(o,p?void 0:"utf8",(v,w)=>{v?u(v):l(p?w.buffer:w)})},!r.thisProgram&&process.argv.length>1&&(f=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),h=(o,l)=>{throw process.exitCode=o,l},r.inspect=()=>"[Emscripten Module object]"}else(d||g)&&(g?E=self.location.href:typeof document<"u"&&document.currentScript&&(E=document.currentScript.src),t&&(E=t),E.indexOf("blob:")!==0?E=E.substr(0,E.replace(/[?#].*/,"").lastIndexOf("/")+1):E="",A=i=>{var o=new XMLHttpRequest;return o.open("GET",i,!1),o.send(null),o.responseText},g&&(m=i=>{var o=new XMLHttpRequest;return o.open("GET",i,!1),o.responseType="arraybuffer",o.send(null),new Uint8Array(o.response)}),N=(i,o,l)=>{var u=new XMLHttpRequest;u.open("GET",i,!0),u.responseType="arraybuffer",u.onload=()=>{if(u.status==200||u.status==0&&u.response){o(u.response);return}l()},u.onerror=l,u.send(null)});var b=r.print||console.log.bind(console),O=r.printErr||console.error.bind(console);Object.assign(r,c),c=null,r.arguments&&r.arguments,r.thisProgram&&(f=r.thisProgram),r.quit&&(h=r.quit);var P;r.wasmBinary&&(P=r.wasmBinary);var z=r.noExitRuntime||!0;typeof WebAssembly!="object"&&Qe("no native wasm support detected");var L,k=!1;function W(i,o){i||Qe(o)}var j,Y,H,B,G,Q,oe,ve;function ye(){var i=L.buffer;r.HEAP8=j=new Int8Array(i),r.HEAP16=H=new Int16Array(i),r.HEAPU8=Y=new Uint8Array(i),r.HEAPU16=B=new Uint16Array(i),r.HEAP32=G=new Int32Array(i),r.HEAPU32=Q=new Uint32Array(i),r.HEAPF32=oe=new Float32Array(i),r.HEAPF64=ve=new Float64Array(i)}var me,Te=[],Me=[],Pe=[],be=0;function Ce(){return z||be>0}function Ze(){if(r.preRun)for(typeof r.preRun=="function"&&(r.preRun=[r.preRun]);r.preRun.length;)Ae(r.preRun.shift());qn(Te)}function ot(){!r.noFSInit&&!y.init.initialized&&y.init(),y.ignorePermissions=!1,qn(Me)}function St(){if(r.postRun)for(typeof r.postRun=="function"&&(r.postRun=[r.postRun]);r.postRun.length;)Ye(r.postRun.shift());qn(Pe)}function Ae(i){Te.unshift(i)}function It(i){Me.unshift(i)}function Ye(i){Pe.unshift(i)}var rt=0,ct=null;function ir(i){return i}function Mr(i){rt++,r.monitorRunDependencies&&r.monitorRunDependencies(rt)}function ar(i){if(rt--,r.monitorRunDependencies&&r.monitorRunDependencies(rt),rt==0&&ct){var o=ct;ct=null,o()}}function Qe(i){r.onAbort&&r.onAbort(i),i="Aborted("+i+")",O(i),k=!0,i+=". Build with -sASSERTIONS for more info.";var o=new WebAssembly.RuntimeError(i);throw s(o),o}var yl="data:application/octet-stream;base64,";function xi(i){return i.startsWith(yl)}function en(i){return i.startsWith("file://")}var Ft;r.locateFile?(Ft="manifold.wasm",xi(Ft)||(Ft=R(Ft))):Ft=new URL("/assets/manifold-3a0c2769.wasm",self.location).href;function Ti(i){if(i==Ft&&P)return new Uint8Array(P);if(m)return m(i);throw"both async and sync fetching of the wasm failed"}function xl(i){if(!P&&(d||g)){if(typeof fetch=="function"&&!en(i))return fetch(i,{credentials:"same-origin"}).then(o=>{if(!o.ok)throw"failed to load wasm binary file at '"+i+"'";return o.arrayBuffer()}).catch(()=>Ti(i));if(N)return new Promise((o,l)=>{N(i,u=>o(new Uint8Array(u)),l)})}return Promise.resolve().then(()=>Ti(i))}function Ei(i,o,l){return xl(i).then(u=>WebAssembly.instantiate(u,o)).then(u=>u).then(l,u=>{O(`failed to asynchronously prepare wasm: ${u}`),Qe(u)})}function Tl(i,o,l,u){return!i&&typeof WebAssembly.instantiateStreaming=="function"&&!xi(o)&&!en(o)&&!T&&typeof fetch=="function"?fetch(o,{credentials:"same-origin"}).then(p=>{var v=WebAssembly.instantiateStreaming(p,l);return v.then(u,function(w){return O(`wasm streaming compile failed: ${w}`),O("falling back to ArrayBuffer instantiation"),Ei(o,l,u)})}):Ei(o,l,u)}function El(){var i={a:ju};function o(u,p){var v=u.exports;return _e=v,L=_e.Ua,ye(),me=_e.Wa,It(_e.Va),ar(),v}Mr();function l(u){o(u.instance)}if(r.instantiateWasm)try{return r.instantiateWasm(i,o)}catch(u){O(`Module.instantiateWasm callback failed with error: ${u}`),s(u)}return Tl(P,Ft,i,l).catch(s),{}}var ge,je;function wl(i){this.name="ExitStatus",this.message=`Program terminated with exit(${i})`,this.status=i}var qn=i=>{for(;i.length>0;)i.shift()(r)};function lt(i,o="i8"){switch(o.endsWith("*")&&(o="*"),o){case"i1":return j[i>>0];case"i8":return j[i>>0];case"i16":return H[i>>1];case"i32":return G[i>>2];case"i64":Qe("to do getValue(i64) use WASM_BIGINT");case"float":return oe[i>>2];case"double":return ve[i>>3];case"*":return Q[i>>2];default:Qe(`invalid type for getValue: ${o}`)}}function or(i,o,l="i8"){switch(l.endsWith("*")&&(l="*"),l){case"i1":j[i>>0]=o;break;case"i8":j[i>>0]=o;break;case"i16":H[i>>1]=o;break;case"i32":G[i>>2]=o;break;case"i64":Qe("to do setValue(i64) use WASM_BIGINT");case"float":oe[i>>2]=o;break;case"double":ve[i>>3]=o;break;case"*":Q[i>>2]=o;break;default:Qe(`invalid type for setValue: ${l}`)}}var tn=[],rn=0,Ml=i=>{var o=new Wn(i);return o.get_caught()||(o.set_caught(!0),rn--),o.set_rethrown(!1),tn.push(o),Xi(o.excPtr),o.get_exception_ptr()},Tt=0,_l=()=>{se(0,0);var i=tn.pop();Wi(i.excPtr),Tt=0};function Wn(i){this.excPtr=i,this.ptr=i-24,this.set_type=function(o){Q[this.ptr+4>>2]=o},this.get_type=function(){return Q[this.ptr+4>>2]},this.set_destructor=function(o){Q[this.ptr+8>>2]=o},this.get_destructor=function(){return Q[this.ptr+8>>2]},this.set_caught=function(o){o=o?1:0,j[this.ptr+12>>0]=o},this.get_caught=function(){return j[this.ptr+12>>0]!=0},this.set_rethrown=function(o){o=o?1:0,j[this.ptr+13>>0]=o},this.get_rethrown=function(){return j[this.ptr+13>>0]!=0},this.init=function(o,l){this.set_adjusted_ptr(0),this.set_type(o),this.set_destructor(l)},this.set_adjusted_ptr=function(o){Q[this.ptr+16>>2]=o},this.get_adjusted_ptr=function(){return Q[this.ptr+16>>2]},this.get_exception_ptr=function(){var o=Ki(this.get_type());if(o)return Q[this.excPtr>>2];var l=this.get_adjusted_ptr();return l!==0?l:this.excPtr}}var Rl=i=>{throw Tt||(Tt=i),Tt},wi=i=>{var o=Tt;if(!o)return Or(0),0;var l=new Wn(o);l.set_adjusted_ptr(o);var u=l.get_type();if(!u)return Or(0),o;for(var p in i){var v=i[p];if(v===0||v===u)break;var w=l.ptr+16;if(Yi(v,u,w))return Or(v),o}return Or(u),o},bl=()=>wi([]),Al=i=>wi([i]),Sl=()=>{var i=tn.pop();i||Qe("no exception to throw");var o=i.excPtr;throw i.get_rethrown()||(tn.push(i),i.set_rethrown(!0),i.set_caught(!1),rn++),Tt=o,Tt},Il=(i,o,l)=>{var u=new Wn(i);throw u.init(o,l),Tt=i,rn++,Tt},Cl=()=>rn,nn={},Xn=i=>{for(;i.length;){var o=i.pop(),l=i.pop();l(o)}};function Yn(i){return this.fromWireType(G[i>>2])}var cr={},Dt={},sn={},Mi=void 0,an=i=>{throw new Mi(i)},$t=(i,o,l)=>{i.forEach(function(M){sn[M]=o});function u(M){var F=l(M);F.length!==i.length&&an("Mismatched type converter count");for(var D=0;D<i.length;++D)pt(i[D],F[D])}var p=new Array(o.length),v=[],w=0;o.forEach((M,F)=>{Dt.hasOwnProperty(M)?p[F]=Dt[M]:(v.push(M),cr.hasOwnProperty(M)||(cr[M]=[]),cr[M].push(()=>{p[F]=Dt[M],++w,w===v.length&&u(p)}))}),v.length===0&&u(p)},Nl=i=>{var o=nn[i];delete nn[i];var l=o.rawConstructor,u=o.rawDestructor,p=o.fields,v=p.map(w=>w.getterReturnType).concat(p.map(w=>w.setterArgumentType));$t([i],v,w=>{var M={};return p.forEach((F,D)=>{var V=F.fieldName,K=w[D],q=F.getter,X=F.getterContext,ee=w[D+p.length],ue=F.setter,he=F.setterContext;M[V]={read:I=>K.fromWireType(q(X,I)),write:(I,S)=>{var $=[];ue(he,I,ee.toWireType($,S)),Xn($)}}}),[{name:o.name,fromWireType:F=>{var D={};for(var V in M)D[V]=M[V].read(F);return u(F),D},toWireType:(F,D)=>{for(var V in M)if(!(V in D))throw new TypeError(`Missing field: "${V}"`);var K=l();for(V in M)M[V].write(K,D[V]);return F!==null&&F.push(u,K),K},argPackAdvance:gt,readValueFromPointer:Yn,destructorFunction:u}]})},Ol=(i,o,l,u,p)=>{},Fl=()=>{for(var i=new Array(256),o=0;o<256;++o)i[o]=String.fromCharCode(o);_i=i},_i=void 0,Be=i=>{for(var o="",l=i;Y[l];)o+=_i[Y[l++]];return o},lr=void 0,xe=i=>{throw new lr(i)};function Dl(i,o,l={}){var u=o.name;if(i||xe(`type "${u}" must have a positive integer typeid pointer`),Dt.hasOwnProperty(i)){if(l.ignoreDuplicateRegistrations)return;xe(`Cannot register type '${u}' twice`)}if(Dt[i]=o,delete sn[i],cr.hasOwnProperty(i)){var p=cr[i];delete cr[i],p.forEach(v=>v())}}function pt(i,o,l={}){if(!("argPackAdvance"in o))throw new TypeError("registerType registeredInstance requires argPackAdvance");return Dl(i,o,l)}var gt=8,$l=(i,o,l,u)=>{o=Be(o),pt(i,{name:o,fromWireType:function(p){return!!p},toWireType:function(p,v){return v?l:u},argPackAdvance:gt,readValueFromPointer:function(p){return this.fromWireType(Y[p])},destructorFunction:null})};function Pl(i){if(!(this instanceof Ct)||!(i instanceof Ct))return!1;for(var o=this.$$.ptrType.registeredClass,l=this.$$.ptr,u=i.$$.ptrType.registeredClass,p=i.$$.ptr;o.baseClass;)l=o.upcast(l),o=o.baseClass;for(;u.baseClass;)p=u.upcast(p),u=u.baseClass;return o===u&&l===p}var kl=i=>({count:i.count,deleteScheduled:i.deleteScheduled,preservePointerOnDelete:i.preservePointerOnDelete,ptr:i.ptr,ptrType:i.ptrType,smartPtr:i.smartPtr,smartPtrType:i.smartPtrType}),Kn=i=>{function o(l){return l.$$.ptrType.registeredClass.name}xe(o(i)+" instance already deleted")},Jn=!1,Ri=i=>{},Ul=i=>{i.smartPtr?i.smartPtrType.rawDestructor(i.smartPtr):i.ptrType.registeredClass.rawDestructor(i.ptr)},bi=i=>{i.count.value-=1;var o=i.count.value===0;o&&Ul(i)},Ai=(i,o,l)=>{if(o===l)return i;if(l.baseClass===void 0)return null;var u=Ai(i,o,l.baseClass);return u===null?null:l.downcast(u)},Si={},Ll=()=>Object.keys(br).length,jl=()=>{var i=[];for(var o in br)br.hasOwnProperty(o)&&i.push(br[o]);return i},_r=[],Zn=()=>{for(;_r.length;){var i=_r.pop();i.$$.deleteScheduled=!1,i.delete()}},Rr=void 0,Bl=i=>{Rr=i,_r.length&&Rr&&Rr(Zn)},Vl=()=>{r.getInheritedInstanceCount=Ll,r.getLiveInheritedInstances=jl,r.flushPendingDeletes=Zn,r.setDelayFunction=Bl},br={},zl=(i,o)=>{for(o===void 0&&xe("ptr should not be undefined");i.baseClass;)o=i.upcast(o),i=i.baseClass;return o},Gl=(i,o)=>(o=zl(i,o),br[o]),on=(i,o)=>{(!o.ptrType||!o.ptr)&&an("makeClassHandle requires ptr and ptrType");var l=!!o.smartPtrType,u=!!o.smartPtr;return l!==u&&an("Both smartPtrType and smartPtr must be specified"),o.count={value:1},Ar(Object.create(i,{$$:{value:o}}))};function Hl(i){var o=this.getPointee(i);if(!o)return this.destructor(i),null;var l=Gl(this.registeredClass,o);if(l!==void 0){if(l.$$.count.value===0)return l.$$.ptr=o,l.$$.smartPtr=i,l.clone();var u=l.clone();return this.destructor(i),u}function p(){return this.isSmartPointer?on(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:o,smartPtrType:this,smartPtr:i}):on(this.registeredClass.instancePrototype,{ptrType:this,ptr:i})}var v=this.registeredClass.getActualType(o),w=Si[v];if(!w)return p.call(this);var M;this.isConst?M=w.constPointerType:M=w.pointerType;var F=Ai(o,this.registeredClass,M.registeredClass);return F===null?p.call(this):this.isSmartPointer?on(M.registeredClass.instancePrototype,{ptrType:M,ptr:F,smartPtrType:this,smartPtr:i}):on(M.registeredClass.instancePrototype,{ptrType:M,ptr:F})}var Ar=i=>typeof FinalizationRegistry>"u"?(Ar=o=>o,i):(Jn=new FinalizationRegistry(o=>{bi(o.$$)}),Ar=o=>{var l=o.$$,u=!!l.smartPtr;if(u){var p={$$:l};Jn.register(o,p,o)}return o},Ri=o=>Jn.unregister(o),Ar(i));function ql(){if(this.$$.ptr||Kn(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var i=Ar(Object.create(Object.getPrototypeOf(this),{$$:{value:kl(this.$$)}}));return i.$$.count.value+=1,i.$$.deleteScheduled=!1,i}function Wl(){this.$$.ptr||Kn(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&xe("Object already scheduled for deletion"),Ri(this),bi(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Xl(){return!this.$$.ptr}function Yl(){return this.$$.ptr||Kn(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&xe("Object already scheduled for deletion"),_r.push(this),_r.length===1&&Rr&&Rr(Zn),this.$$.deleteScheduled=!0,this}var Kl=()=>{Ct.prototype.isAliasOf=Pl,Ct.prototype.clone=ql,Ct.prototype.delete=Wl,Ct.prototype.isDeleted=Xl,Ct.prototype.deleteLater=Yl};function Ct(){}var Jl=48,Zl=57,cn=i=>{if(i===void 0)return"_unknown";i=i.replace(/[^a-zA-Z0-9_]/g,"$");var o=i.charCodeAt(0);return o>=Jl&&o<=Zl?`_${i}`:i};function ln(i,o){return i=cn(i),{[i]:function(){return o.apply(this,arguments)}}[i]}var Ii=(i,o,l)=>{if(i[o].overloadTable===void 0){var u=i[o];i[o]=function(){return i[o].overloadTable.hasOwnProperty(arguments.length)||xe(`Function '${l}' called with an invalid number of arguments (${arguments.length}) - expects one of (${i[o].overloadTable})!`),i[o].overloadTable[arguments.length].apply(this,arguments)},i[o].overloadTable=[],i[o].overloadTable[u.argCount]=u}},Qn=(i,o,l)=>{r.hasOwnProperty(i)?((l===void 0||r[i].overloadTable!==void 0&&r[i].overloadTable[l]!==void 0)&&xe(`Cannot register public name '${i}' twice`),Ii(r,i,i),r.hasOwnProperty(l)&&xe(`Cannot register multiple overloads of a function with the same number of arguments (${l})!`),r[i].overloadTable[l]=o):(r[i]=o,l!==void 0&&(r[i].numArguments=l))};function Ql(i,o,l,u,p,v,w,M){this.name=i,this.constructor=o,this.instancePrototype=l,this.rawDestructor=u,this.baseClass=p,this.getActualType=v,this.upcast=w,this.downcast=M,this.pureVirtualFunctions=[]}var es=(i,o,l)=>{for(;o!==l;)o.upcast||xe(`Expected null or instance of ${l.name}, got an instance of ${o.name}`),i=o.upcast(i),o=o.baseClass;return i};function ef(i,o){if(o===null)return this.isReference&&xe(`null is not a valid ${this.name}`),0;o.$$||xe(`Cannot pass "${ss(o)}" as a ${this.name}`),o.$$.ptr||xe(`Cannot pass deleted object as a pointer of type ${this.name}`);var l=o.$$.ptrType.registeredClass,u=es(o.$$.ptr,l,this.registeredClass);return u}function tf(i,o){var l;if(o===null)return this.isReference&&xe(`null is not a valid ${this.name}`),this.isSmartPointer?(l=this.rawConstructor(),i!==null&&i.push(this.rawDestructor,l),l):0;o.$$||xe(`Cannot pass "${ss(o)}" as a ${this.name}`),o.$$.ptr||xe(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.isConst&&o.$$.ptrType.isConst&&xe(`Cannot convert argument of type ${o.$$.smartPtrType?o.$$.smartPtrType.name:o.$$.ptrType.name} to parameter type ${this.name}`);var u=o.$$.ptrType.registeredClass;if(l=es(o.$$.ptr,u,this.registeredClass),this.isSmartPointer)switch(o.$$.smartPtr===void 0&&xe("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:o.$$.smartPtrType===this?l=o.$$.smartPtr:xe(`Cannot convert argument of type ${o.$$.smartPtrType?o.$$.smartPtrType.name:o.$$.ptrType.name} to parameter type ${this.name}`);break;case 1:l=o.$$.smartPtr;break;case 2:if(o.$$.smartPtrType===this)l=o.$$.smartPtr;else{var p=o.clone();l=this.rawShare(l,ke.toHandle(()=>p.delete())),i!==null&&i.push(this.rawDestructor,l)}break;default:xe("Unsupporting sharing policy")}return l}function rf(i,o){if(o===null)return this.isReference&&xe(`null is not a valid ${this.name}`),0;o.$$||xe(`Cannot pass "${ss(o)}" as a ${this.name}`),o.$$.ptr||xe(`Cannot pass deleted object as a pointer of type ${this.name}`),o.$$.ptrType.isConst&&xe(`Cannot convert argument of type ${o.$$.ptrType.name} to parameter type ${this.name}`);var l=o.$$.ptrType.registeredClass,u=es(o.$$.ptr,l,this.registeredClass);return u}function Ci(i){return this.fromWireType(Q[i>>2])}function nf(i){return this.rawGetPointee&&(i=this.rawGetPointee(i)),i}function sf(i){this.rawDestructor&&this.rawDestructor(i)}var af=i=>{i!==null&&i.delete()},of=()=>{Et.prototype.getPointee=nf,Et.prototype.destructor=sf,Et.prototype.argPackAdvance=gt,Et.prototype.readValueFromPointer=Ci,Et.prototype.deleteObject=af,Et.prototype.fromWireType=Hl};function Et(i,o,l,u,p,v,w,M,F,D,V){this.name=i,this.registeredClass=o,this.isReference=l,this.isConst=u,this.isSmartPointer=p,this.pointeeType=v,this.sharingPolicy=w,this.rawGetPointee=M,this.rawConstructor=F,this.rawShare=D,this.rawDestructor=V,!p&&o.baseClass===void 0?u?(this.toWireType=ef,this.destructorFunction=null):(this.toWireType=rf,this.destructorFunction=null):this.toWireType=tf}var Ni=(i,o,l)=>{r.hasOwnProperty(i)||an("Replacing nonexistant public symbol"),r[i].overloadTable!==void 0&&l!==void 0?r[i].overloadTable[l]=o:(r[i]=o,r[i].argCount=l)},cf=(i,o,l)=>{var u=r["dynCall_"+i];return l&&l.length?u.apply(null,[o].concat(l)):u.call(null,o)},Sr=[],ce=i=>{var o=Sr[i];return o||(i>=Sr.length&&(Sr.length=i+1),Sr[i]=o=me.get(i)),o},lf=(i,o,l)=>{if(i.includes("j"))return cf(i,o,l);var u=ce(o).apply(null,l);return u},ff=(i,o)=>{var l=[];return function(){return l.length=0,Object.assign(l,arguments),lf(i,o,l)}},ft=(i,o)=>{i=Be(i);function l(){return i.includes("j")?ff(i,o):ce(o)}var u=l();return typeof u!="function"&&xe(`unknown function pointer with signature ${i}: ${o}`),u},uf=(i,o)=>{var l=ln(o,function(u){this.name=o,this.message=u;var p=new Error(u).stack;p!==void 0&&(this.stack=this.toString()+`
`+p.replace(/^Error(:[^\n]*)?\n/,""))});return l.prototype=Object.create(i.prototype),l.prototype.constructor=l,l.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},l},Oi=void 0,Fi=i=>{var o=qi(i),l=Be(o);return Mt(o),l},fn=(i,o)=>{var l=[],u={};function p(v){if(!u[v]&&!Dt[v]){if(sn[v]){sn[v].forEach(p);return}l.push(v),u[v]=!0}}throw o.forEach(p),new Oi(`${i}: `+l.map(Fi).join([", "]))},hf=(i,o,l,u,p,v,w,M,F,D,V,K,q)=>{V=Be(V),v=ft(p,v),M&&(M=ft(w,M)),D&&(D=ft(F,D)),q=ft(K,q);var X=cn(V);Qn(X,function(){fn(`Cannot construct ${V} due to unbound types`,[u])}),$t([i,o,l],u?[u]:[],function(ee){ee=ee[0];var ue,he;u?(ue=ee.registeredClass,he=ue.instancePrototype):he=Ct.prototype;var I=ln(X,function(){if(Object.getPrototypeOf(this)!==S)throw new lr("Use 'new' to construct "+V);if($.constructor_body===void 0)throw new lr(V+" has no accessible constructor");var ne=$.constructor_body[arguments.length];if(ne===void 0)throw new lr(`Tried to invoke ctor of ${V} with invalid number of parameters (${arguments.length}) - expected (${Object.keys($.constructor_body).toString()}) parameters instead!`);return ne.apply(this,arguments)}),S=Object.create(he,{constructor:{value:I}});I.prototype=S;var $=new Ql(V,I,S,q,ue,v,M,D);$.baseClass&&($.baseClass.__derivedClasses===void 0&&($.baseClass.__derivedClasses=[]),$.baseClass.__derivedClasses.push($));var U=new Et(V,$,!0,!1,!1),Z=new Et(V+"*",$,!1,!1,!1),pe=new Et(V+" const*",$,!1,!0,!1);return Si[i]={pointerType:Z,constPointerType:pe},Ni(X,I),[U,Z,pe]})},ts=(i,o)=>{for(var l=[],u=0;u<i;u++)l.push(Q[o+u*4>>2]);return l};function Di(i,o){if(!(i instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof i} which is not a function`);var l=ln(i.name||"unknownFunctionName",function(){});l.prototype=i.prototype;var u=new l,p=i.apply(u,o);return p instanceof Object?p:u}function rs(i,o,l,u,p,v){var w=o.length;w<2&&xe("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var M=o[1]!==null&&l!==null,F=!1,D=1;D<o.length;++D)if(o[D]!==null&&o[D].destructorFunction===void 0){F=!0;break}for(var V=o[0].name!=="void",K="",q="",D=0;D<w-2;++D)K+=(D!==0?", ":"")+"arg"+D,q+=(D!==0?", ":"")+"arg"+D+"Wired";var X=`
        return function ${cn(i)}(${K}) {
        if (arguments.length !== ${w-2}) {
          throwBindingError('function ${i} called with ' + arguments.length + ' arguments, expected ${w-2}');
        }`;F&&(X+=`var destructors = [];
`);var ee=F?"destructors":"null",ue=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],he=[xe,u,p,Xn,o[0],o[1]];M&&(X+="var thisWired = classParam.toWireType("+ee+`, this);
`);for(var D=0;D<w-2;++D)X+="var arg"+D+"Wired = argType"+D+".toWireType("+ee+", arg"+D+"); // "+o[D+2].name+`
`,ue.push("argType"+D),he.push(o[D+2]);if(M&&(q="thisWired"+(q.length>0?", ":"")+q),X+=(V||v?"var rv = ":"")+"invoker(fn"+(q.length>0?", ":"")+q+`);
`,F)X+=`runDestructors(destructors);
`;else for(var D=M?1:2;D<o.length;++D){var I=D===1?"thisWired":"arg"+(D-2)+"Wired";o[D].destructorFunction!==null&&(X+=I+"_dtor("+I+"); // "+o[D].name+`
`,ue.push(I+"_dtor"),he.push(o[D].destructorFunction))}return V&&(X+=`var ret = retType.fromWireType(rv);
return ret;
`),X+=`}
`,ue.push(X),Di(Function,ue).apply(null,he)}var df=(i,o,l,u,p,v)=>{var w=ts(o,l);p=ft(u,p),$t([],[i],function(M){M=M[0];var F=`constructor ${M.name}`;if(M.registeredClass.constructor_body===void 0&&(M.registeredClass.constructor_body=[]),M.registeredClass.constructor_body[o-1]!==void 0)throw new lr(`Cannot register multiple constructors with identical number of parameters (${o-1}) for class '${M.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return M.registeredClass.constructor_body[o-1]=()=>{fn(`Cannot construct ${M.name} due to unbound types`,w)},$t([],w,D=>(D.splice(1,0,null),M.registeredClass.constructor_body[o-1]=rs(F,D,null,p,v),[])),[]})},pf=(i,o,l,u,p,v,w,M,F)=>{var D=ts(l,u);o=Be(o),v=ft(p,v),$t([],[i],function(V){V=V[0];var K=`${V.name}.${o}`;o.startsWith("@@")&&(o=Symbol[o.substring(2)]),M&&V.registeredClass.pureVirtualFunctions.push(o);function q(){fn(`Cannot call ${K} due to unbound types`,D)}var X=V.registeredClass.instancePrototype,ee=X[o];return ee===void 0||ee.overloadTable===void 0&&ee.className!==V.name&&ee.argCount===l-2?(q.argCount=l-2,q.className=V.name,X[o]=q):(Ii(X,o,K),X[o].overloadTable[l-2]=q),$t([],D,function(ue){var he=rs(K,ue,V,v,w,F);return X[o].overloadTable===void 0?(he.argCount=l-2,X[o]=he):X[o].overloadTable[l-2]=he,[]}),[]})};function gf(){Object.assign($i.prototype,{get(i){return this.allocated[i]},has(i){return this.allocated[i]!==void 0},allocate(i){var o=this.freelist.pop()||this.allocated.length;return this.allocated[o]=i,o},free(i){this.allocated[i]=void 0,this.freelist.push(i)}})}function $i(){this.allocated=[void 0],this.freelist=[]}var nt=new $i,ns=i=>{i>=nt.reserved&&--nt.get(i).refcount===0&&nt.free(i)},mf=()=>{for(var i=0,o=nt.reserved;o<nt.allocated.length;++o)nt.allocated[o]!==void 0&&++i;return i},vf=()=>{nt.allocated.push({value:void 0},{value:null},{value:!0},{value:!1}),nt.reserved=nt.allocated.length,r.count_emval_handles=mf},ke={toValue:i=>(i||xe("Cannot use deleted val. handle = "+i),nt.get(i).value),toHandle:i=>{switch(i){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return nt.allocate({refcount:1,value:i})}}},yf=(i,o)=>{o=Be(o),pt(i,{name:o,fromWireType:l=>{var u=ke.toValue(l);return ns(l),u},toWireType:(l,u)=>ke.toHandle(u),argPackAdvance:gt,readValueFromPointer:Yn,destructorFunction:null})},xf=(i,o,l)=>{switch(o){case 1:return l?function(u){return this.fromWireType(j[u>>0])}:function(u){return this.fromWireType(Y[u>>0])};case 2:return l?function(u){return this.fromWireType(H[u>>1])}:function(u){return this.fromWireType(B[u>>1])};case 4:return l?function(u){return this.fromWireType(G[u>>2])}:function(u){return this.fromWireType(Q[u>>2])};default:throw new TypeError(`invalid integer width (${o}): ${i}`)}},Tf=(i,o,l,u)=>{o=Be(o);function p(){}p.values={},pt(i,{name:o,constructor:p,fromWireType:function(v){return this.constructor.values[v]},toWireType:(v,w)=>w.value,argPackAdvance:gt,readValueFromPointer:xf(o,l,u),destructorFunction:null}),Qn(o,p)},un=(i,o)=>{var l=Dt[i];return l===void 0&&xe(o+" has unknown type "+Fi(i)),l},Ef=(i,o,l)=>{var u=un(i,"enum");o=Be(o);var p=u.constructor,v=Object.create(u.constructor.prototype,{value:{value:l},constructor:{value:ln(`${u.name}_${o}`,function(){})}});p.values[l]=v,p[o]=v},ss=i=>{if(i===null)return"null";var o=typeof i;return o==="object"||o==="array"||o==="function"?i.toString():""+i},wf=(i,o)=>{switch(o){case 4:return function(l){return this.fromWireType(oe[l>>2])};case 8:return function(l){return this.fromWireType(ve[l>>3])};default:throw new TypeError(`invalid float width (${o}): ${i}`)}},Mf=(i,o,l)=>{o=Be(o),pt(i,{name:o,fromWireType:u=>u,toWireType:(u,p)=>p,argPackAdvance:gt,readValueFromPointer:wf(o,l),destructorFunction:null})},_f=(i,o,l,u,p,v,w)=>{var M=ts(o,l);i=Be(i),p=ft(u,p),Qn(i,function(){fn(`Cannot call ${i} due to unbound types`,M)},o-1),$t([],M,function(F){var D=[F[0],null].concat(F.slice(1));return Ni(i,rs(i,D,null,p,v,w),o-1),[]})},Rf=(i,o,l)=>{switch(o){case 1:return l?u=>j[u>>0]:u=>Y[u>>0];case 2:return l?u=>H[u>>1]:u=>B[u>>1];case 4:return l?u=>G[u>>2]:u=>Q[u>>2];default:throw new TypeError(`invalid integer width (${o}): ${i}`)}},bf=(i,o,l,u,p)=>{o=Be(o);var v=V=>V;if(u===0){var w=32-8*l;v=V=>V<<w>>>w}var M=o.includes("unsigned"),F=(V,K)=>{},D;M?D=function(V,K){return F(K,this.name),K>>>0}:D=function(V,K){return F(K,this.name),K},pt(i,{name:o,fromWireType:v,toWireType:D,argPackAdvance:gt,readValueFromPointer:Rf(o,l,u!==0),destructorFunction:null})},Af=(i,o,l)=>{var u=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],p=u[o];function v(w){var M=Q[w>>2],F=Q[w+4>>2];return new p(j.buffer,F,M)}l=Be(l),pt(i,{name:l,fromWireType:v,argPackAdvance:gt,readValueFromPointer:v},{ignoreDuplicateRegistrations:!0})},is=(i,o,l,u)=>{if(!(u>0))return 0;for(var p=l,v=l+u-1,w=0;w<i.length;++w){var M=i.charCodeAt(w);if(M>=55296&&M<=57343){var F=i.charCodeAt(++w);M=65536+((M&1023)<<10)|F&1023}if(M<=127){if(l>=v)break;o[l++]=M}else if(M<=2047){if(l+1>=v)break;o[l++]=192|M>>6,o[l++]=128|M&63}else if(M<=65535){if(l+2>=v)break;o[l++]=224|M>>12,o[l++]=128|M>>6&63,o[l++]=128|M&63}else{if(l+3>=v)break;o[l++]=240|M>>18,o[l++]=128|M>>12&63,o[l++]=128|M>>6&63,o[l++]=128|M&63}}return o[l]=0,l-p},Sf=(i,o,l)=>is(i,Y,o,l),as=i=>{for(var o=0,l=0;l<i.length;++l){var u=i.charCodeAt(l);u<=127?o++:u<=2047?o+=2:u>=55296&&u<=57343?(o+=4,++l):o+=3}return o},Pi=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,fr=(i,o,l)=>{for(var u=o+l,p=o;i[p]&&!(p>=u);)++p;if(p-o>16&&i.buffer&&Pi)return Pi.decode(i.subarray(o,p));for(var v="";o<p;){var w=i[o++];if(!(w&128)){v+=String.fromCharCode(w);continue}var M=i[o++]&63;if((w&224)==192){v+=String.fromCharCode((w&31)<<6|M);continue}var F=i[o++]&63;if((w&240)==224?w=(w&15)<<12|M<<6|F:w=(w&7)<<18|M<<12|F<<6|i[o++]&63,w<65536)v+=String.fromCharCode(w);else{var D=w-65536;v+=String.fromCharCode(55296|D>>10,56320|D&1023)}}return v},hn=(i,o)=>i?fr(Y,i,o):"",If=(i,o)=>{o=Be(o);var l=o==="std::string";pt(i,{name:o,fromWireType:u=>{var p=Q[u>>2],v=u+4,w;if(l)for(var M=v,F=0;F<=p;++F){var D=v+F;if(F==p||Y[D]==0){var V=D-M,K=hn(M,V);w===void 0?w=K:(w+=String.fromCharCode(0),w+=K),M=D+1}}else{for(var q=new Array(p),F=0;F<p;++F)q[F]=String.fromCharCode(Y[v+F]);w=q.join("")}return Mt(u),w},toWireType:(u,p)=>{p instanceof ArrayBuffer&&(p=new Uint8Array(p));var v,w=typeof p=="string";w||p instanceof Uint8Array||p instanceof Uint8ClampedArray||p instanceof Int8Array||xe("Cannot pass non-string to std::string"),l&&w?v=as(p):v=p.length;var M=hs(4+v+1),F=M+4;if(Q[M>>2]=v,l&&w)Sf(p,F,v+1);else if(w)for(var D=0;D<v;++D){var V=p.charCodeAt(D);V>255&&(Mt(F),xe("String has UTF-16 code units that do not fit in 8 bits")),Y[F+D]=V}else for(var D=0;D<v;++D)Y[F+D]=p[D];return u!==null&&u.push(Mt,M),M},argPackAdvance:gt,readValueFromPointer:Ci,destructorFunction:u=>Mt(u)})},ki=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Cf=(i,o)=>{for(var l=i,u=l>>1,p=u+o/2;!(u>=p)&&B[u];)++u;if(l=u<<1,l-i>32&&ki)return ki.decode(Y.subarray(i,l));for(var v="",w=0;!(w>=o/2);++w){var M=H[i+w*2>>1];if(M==0)break;v+=String.fromCharCode(M)}return v},Nf=(i,o,l)=>{if(l===void 0&&(l=2147483647),l<2)return 0;l-=2;for(var u=o,p=l<i.length*2?l/2:i.length,v=0;v<p;++v){var w=i.charCodeAt(v);H[o>>1]=w,o+=2}return H[o>>1]=0,o-u},Of=i=>i.length*2,Ff=(i,o)=>{for(var l=0,u="";!(l>=o/4);){var p=G[i+l*4>>2];if(p==0)break;if(++l,p>=65536){var v=p-65536;u+=String.fromCharCode(55296|v>>10,56320|v&1023)}else u+=String.fromCharCode(p)}return u},Df=(i,o,l)=>{if(l===void 0&&(l=2147483647),l<4)return 0;for(var u=o,p=u+l-4,v=0;v<i.length;++v){var w=i.charCodeAt(v);if(w>=55296&&w<=57343){var M=i.charCodeAt(++v);w=65536+((w&1023)<<10)|M&1023}if(G[o>>2]=w,o+=4,o+4>p)break}return G[o>>2]=0,o-u},$f=i=>{for(var o=0,l=0;l<i.length;++l){var u=i.charCodeAt(l);u>=55296&&u<=57343&&++l,o+=4}return o},Pf=(i,o,l)=>{l=Be(l);var u,p,v,w,M;o===2?(u=Cf,p=Nf,w=Of,v=()=>B,M=1):o===4&&(u=Ff,p=Df,w=$f,v=()=>Q,M=2),pt(i,{name:l,fromWireType:F=>{for(var D=Q[F>>2],V=v(),K,q=F+4,X=0;X<=D;++X){var ee=F+4+X*o;if(X==D||V[ee>>M]==0){var ue=ee-q,he=u(q,ue);K===void 0?K=he:(K+=String.fromCharCode(0),K+=he),q=ee+o}}return Mt(F),K},toWireType:(F,D)=>{typeof D!="string"&&xe(`Cannot pass non-string to C++ string type ${l}`);var V=w(D),K=hs(4+V+o);return Q[K>>2]=V>>M,p(D,K+4,V+o),F!==null&&F.push(Mt,K),K},argPackAdvance:gt,readValueFromPointer:Yn,destructorFunction:F=>Mt(F)})},kf=(i,o,l,u,p,v)=>{nn[i]={name:Be(o),rawConstructor:ft(l,u),rawDestructor:ft(p,v),fields:[]}},Uf=(i,o,l,u,p,v,w,M,F,D)=>{nn[i].fields.push({fieldName:Be(o),getterReturnType:l,getter:ft(u,p),getterContext:v,setterArgumentType:w,setter:ft(M,F),setterContext:D})},Lf=(i,o)=>{o=Be(o),pt(i,{isVoid:!0,name:o,argPackAdvance:0,fromWireType:()=>{},toWireType:(l,u)=>{}})},jf=(i,o,l)=>{i=ke.toValue(i),o=un(o,"emval::as");var u=[],p=ke.toHandle(u);return Q[l>>2]=p,o.toWireType(u,i)},Bf=i=>{var o=[];return Q[i>>2]=ke.toHandle(o),o},Vf={},os=i=>{var o=Vf[i];return o===void 0?Be(i):o},dn=[],zf=(i,o,l,u,p)=>(i=dn[i],o=ke.toValue(o),l=os(l),i(o,l,Bf(u),p)),Gf=(i,o,l,u)=>{i=dn[i],o=ke.toValue(o),l=os(l),i(o,l,null,u)},Hf=(i,o)=>(i=ke.toValue(i),o=ke.toValue(o),i==o),qf=i=>{var o=dn.length;return dn.push(i),o},Wf=(i,o)=>{for(var l=new Array(i),u=0;u<i;++u)l[u]=un(Q[o+u*4>>2],"parameter "+u);return l},Ui=[],Xf=(i,o)=>{var l=Wf(i,o),u=l[0],p=u.name+"_$"+l.slice(1).map(function(ee){return ee.name}).join("_")+"$",v=Ui[p];if(v!==void 0)return v;for(var w=["retType"],M=[u],F="",D=0;D<i-1;++D)F+=(D!==0?", ":"")+"arg"+D,w.push("argType"+D),M.push(l[1+D]);for(var V=cn("methodCaller_"+p),K="return function "+V+`(handle, name, destructors, args) {
`,q=0,D=0;D<i-1;++D)K+="    var arg"+D+" = argType"+D+".readValueFromPointer(args"+(q?"+"+q:"")+`);
`,q+=l[D+1].argPackAdvance;K+="    var rv = handle[name]("+F+`);
`;for(var D=0;D<i-1;++D)l[D+1].deleteObject&&(K+="    argType"+D+".deleteObject(arg"+D+`);
`);u.isVoid||(K+=`    return retType.toWireType(destructors, rv);
`),K+=`};
`,w.push(K);var X=Di(Function,w).apply(null,M);return v=qf(X),Ui[p]=v,v},Yf=(i,o)=>(i=ke.toValue(i),o=ke.toValue(o),ke.toHandle(i[o])),Kf=i=>{i>4&&(nt.get(i).refcount+=1)},Jf=i=>ke.toHandle(os(i)),Zf=()=>ke.toHandle({}),Qf=i=>{var o=ke.toValue(i);Xn(o),ns(i)},eu=(i,o,l)=>{i=ke.toValue(i),o=ke.toValue(o),l=ke.toValue(l),i[o]=l},tu=(i,o)=>{i=un(i,"_emval_take_value");var l=i.readValueFromPointer(o);return ke.toHandle(l)},ru=()=>{Qe("")},nu=(i,o,l)=>Y.copyWithin(i,o,o+l),su=()=>2147483648,iu=i=>{var o=L.buffer,l=(i-o.byteLength+65535)/65536;try{return L.grow(l),ye(),1}catch{}},au=i=>{var o=Y.length;i>>>=0;var l=su();if(i>l)return!1;for(var u=(F,D)=>F+(D-F%D)%D,p=1;p<=4;p*=2){var v=o*(1+.2/p);v=Math.min(v,i+100663296);var w=Math.min(l,u(Math.max(i,v),65536)),M=iu(w);if(M)return!0}return!1},cs={},ou=()=>f||"./this.program",Ir=()=>{if(!Ir.strings){var i=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",o={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:i,_:ou()};for(var l in cs)cs[l]===void 0?delete o[l]:o[l]=cs[l];var u=[];for(var l in o)u.push(`${l}=${o[l]}`);Ir.strings=u}return Ir.strings},cu=(i,o)=>{for(var l=0;l<i.length;++l)j[o++>>0]=i.charCodeAt(l);j[o>>0]=0},Ee={isAbs:i=>i.charAt(0)==="/",splitPath:i=>{var o=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return o.exec(i).slice(1)},normalizeArray:(i,o)=>{for(var l=0,u=i.length-1;u>=0;u--){var p=i[u];p==="."?i.splice(u,1):p===".."?(i.splice(u,1),l++):l&&(i.splice(u,1),l--)}if(o)for(;l;l--)i.unshift("..");return i},normalize:i=>{var o=Ee.isAbs(i),l=i.substr(-1)==="/";return i=Ee.normalizeArray(i.split("/").filter(u=>!!u),!o).join("/"),!i&&!o&&(i="."),i&&l&&(i+="/"),(o?"/":"")+i},dirname:i=>{var o=Ee.splitPath(i),l=o[0],u=o[1];return!l&&!u?".":(u&&(u=u.substr(0,u.length-1)),l+u)},basename:i=>{if(i==="/")return"/";i=Ee.normalize(i),i=i.replace(/\/$/,"");var o=i.lastIndexOf("/");return o===-1?i:i.substr(o+1)},join:function(){var i=Array.prototype.slice.call(arguments);return Ee.normalize(i.join("/"))},join2:(i,o)=>Ee.normalize(i+"/"+o)},lu=()=>{if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function")return u=>crypto.getRandomValues(u);if(T)try{var i=C("crypto"),o=i.randomFillSync;if(o)return u=>i.randomFillSync(u);var l=i.randomBytes;return u=>(u.set(l(u.byteLength)),u)}catch{}Qe("initRandomDevice")},Li=i=>(Li=lu())(i),wt={resolve:function(){for(var i="",o=!1,l=arguments.length-1;l>=-1&&!o;l--){var u=l>=0?arguments[l]:y.cwd();if(typeof u!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!u)return"";i=u+"/"+i,o=Ee.isAbs(u)}return i=Ee.normalizeArray(i.split("/").filter(p=>!!p),!o).join("/"),(o?"/":"")+i||"."},relative:(i,o)=>{i=wt.resolve(i).substr(1),o=wt.resolve(o).substr(1);function l(D){for(var V=0;V<D.length&&D[V]==="";V++);for(var K=D.length-1;K>=0&&D[K]==="";K--);return V>K?[]:D.slice(V,K-V+1)}for(var u=l(i.split("/")),p=l(o.split("/")),v=Math.min(u.length,p.length),w=v,M=0;M<v;M++)if(u[M]!==p[M]){w=M;break}for(var F=[],M=w;M<u.length;M++)F.push("..");return F=F.concat(p.slice(w)),F.join("/")}},ls=[];function pn(i,o,l){var u=l>0?l:as(i)+1,p=new Array(u),v=is(i,p,0,p.length);return o&&(p.length=v),p}var fu=()=>{if(!ls.length){var i=null;if(T){var o=256,l=Buffer.alloc(o),u=0,p=process.stdin.fd;try{u=x.readSync(p,l)}catch(v){if(v.toString().includes("EOF"))u=0;else throw v}u>0?i=l.slice(0,u).toString("utf-8"):i=null}else typeof window<"u"&&typeof window.prompt=="function"?(i=window.prompt("Input: "),i!==null&&(i+=`
`)):typeof readline=="function"&&(i=readline(),i!==null&&(i+=`
`));if(!i)return null;ls=pn(i,!0)}return ls.shift()},Pt={ttys:[],init(){},shutdown(){},register(i,o){Pt.ttys[i]={input:[],output:[],ops:o},y.registerDevice(i,Pt.stream_ops)},stream_ops:{open(i){var o=Pt.ttys[i.node.rdev];if(!o)throw new y.ErrnoError(43);i.tty=o,i.seekable=!1},close(i){i.tty.ops.fsync(i.tty)},fsync(i){i.tty.ops.fsync(i.tty)},read(i,o,l,u,p){if(!i.tty||!i.tty.ops.get_char)throw new y.ErrnoError(60);for(var v=0,w=0;w<u;w++){var M;try{M=i.tty.ops.get_char(i.tty)}catch{throw new y.ErrnoError(29)}if(M===void 0&&v===0)throw new y.ErrnoError(6);if(M==null)break;v++,o[l+w]=M}return v&&(i.node.timestamp=Date.now()),v},write(i,o,l,u,p){if(!i.tty||!i.tty.ops.put_char)throw new y.ErrnoError(60);try{for(var v=0;v<u;v++)i.tty.ops.put_char(i.tty,o[l+v])}catch{throw new y.ErrnoError(29)}return u&&(i.node.timestamp=Date.now()),v}},default_tty_ops:{get_char(i){return fu()},put_char(i,o){o===null||o===10?(b(fr(i.output,0)),i.output=[]):o!=0&&i.output.push(o)},fsync(i){i.output&&i.output.length>0&&(b(fr(i.output,0)),i.output=[])},ioctl_tcgets(i){return{c_iflag:25856,c_oflag:5,c_cflag:191,c_lflag:35387,c_cc:[3,28,127,21,4,0,1,0,17,19,26,0,18,15,23,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},ioctl_tcsets(i,o,l){return 0},ioctl_tiocgwinsz(i){return[24,80]}},default_tty1_ops:{put_char(i,o){o===null||o===10?(O(fr(i.output,0)),i.output=[]):o!=0&&i.output.push(o)},fsync(i){i.output&&i.output.length>0&&(O(fr(i.output,0)),i.output=[])}}},ji=i=>{Qe()},fe={ops_table:null,mount(i){return fe.createNode(null,"/",16895,0)},createNode(i,o,l,u){if(y.isBlkdev(l)||y.isFIFO(l))throw new y.ErrnoError(63);fe.ops_table||(fe.ops_table={dir:{node:{getattr:fe.node_ops.getattr,setattr:fe.node_ops.setattr,lookup:fe.node_ops.lookup,mknod:fe.node_ops.mknod,rename:fe.node_ops.rename,unlink:fe.node_ops.unlink,rmdir:fe.node_ops.rmdir,readdir:fe.node_ops.readdir,symlink:fe.node_ops.symlink},stream:{llseek:fe.stream_ops.llseek}},file:{node:{getattr:fe.node_ops.getattr,setattr:fe.node_ops.setattr},stream:{llseek:fe.stream_ops.llseek,read:fe.stream_ops.read,write:fe.stream_ops.write,allocate:fe.stream_ops.allocate,mmap:fe.stream_ops.mmap,msync:fe.stream_ops.msync}},link:{node:{getattr:fe.node_ops.getattr,setattr:fe.node_ops.setattr,readlink:fe.node_ops.readlink},stream:{}},chrdev:{node:{getattr:fe.node_ops.getattr,setattr:fe.node_ops.setattr},stream:y.chrdev_stream_ops}});var p=y.createNode(i,o,l,u);return y.isDir(p.mode)?(p.node_ops=fe.ops_table.dir.node,p.stream_ops=fe.ops_table.dir.stream,p.contents={}):y.isFile(p.mode)?(p.node_ops=fe.ops_table.file.node,p.stream_ops=fe.ops_table.file.stream,p.usedBytes=0,p.contents=null):y.isLink(p.mode)?(p.node_ops=fe.ops_table.link.node,p.stream_ops=fe.ops_table.link.stream):y.isChrdev(p.mode)&&(p.node_ops=fe.ops_table.chrdev.node,p.stream_ops=fe.ops_table.chrdev.stream),p.timestamp=Date.now(),i&&(i.contents[o]=p,i.timestamp=p.timestamp),p},getFileDataAsTypedArray(i){return i.contents?i.contents.subarray?i.contents.subarray(0,i.usedBytes):new Uint8Array(i.contents):new Uint8Array(0)},expandFileStorage(i,o){var l=i.contents?i.contents.length:0;if(!(l>=o)){var u=1024*1024;o=Math.max(o,l*(l<u?2:1.125)>>>0),l!=0&&(o=Math.max(o,256));var p=i.contents;i.contents=new Uint8Array(o),i.usedBytes>0&&i.contents.set(p.subarray(0,i.usedBytes),0)}},resizeFileStorage(i,o){if(i.usedBytes!=o)if(o==0)i.contents=null,i.usedBytes=0;else{var l=i.contents;i.contents=new Uint8Array(o),l&&i.contents.set(l.subarray(0,Math.min(o,i.usedBytes))),i.usedBytes=o}},node_ops:{getattr(i){var o={};return o.dev=y.isChrdev(i.mode)?i.id:1,o.ino=i.id,o.mode=i.mode,o.nlink=1,o.uid=0,o.gid=0,o.rdev=i.rdev,y.isDir(i.mode)?o.size=4096:y.isFile(i.mode)?o.size=i.usedBytes:y.isLink(i.mode)?o.size=i.link.length:o.size=0,o.atime=new Date(i.timestamp),o.mtime=new Date(i.timestamp),o.ctime=new Date(i.timestamp),o.blksize=4096,o.blocks=Math.ceil(o.size/o.blksize),o},setattr(i,o){o.mode!==void 0&&(i.mode=o.mode),o.timestamp!==void 0&&(i.timestamp=o.timestamp),o.size!==void 0&&fe.resizeFileStorage(i,o.size)},lookup(i,o){throw y.genericErrors[44]},mknod(i,o,l,u){return fe.createNode(i,o,l,u)},rename(i,o,l){if(y.isDir(i.mode)){var u;try{u=y.lookupNode(o,l)}catch{}if(u)for(var p in u.contents)throw new y.ErrnoError(55)}delete i.parent.contents[i.name],i.parent.timestamp=Date.now(),i.name=l,o.contents[l]=i,o.timestamp=i.parent.timestamp,i.parent=o},unlink(i,o){delete i.contents[o],i.timestamp=Date.now()},rmdir(i,o){var l=y.lookupNode(i,o);for(var u in l.contents)throw new y.ErrnoError(55);delete i.contents[o],i.timestamp=Date.now()},readdir(i){var o=[".",".."];for(var l in i.contents)i.contents.hasOwnProperty(l)&&o.push(l);return o},symlink(i,o,l){var u=fe.createNode(i,o,41471,0);return u.link=l,u},readlink(i){if(!y.isLink(i.mode))throw new y.ErrnoError(28);return i.link}},stream_ops:{read(i,o,l,u,p){var v=i.node.contents;if(p>=i.node.usedBytes)return 0;var w=Math.min(i.node.usedBytes-p,u);if(w>8&&v.subarray)o.set(v.subarray(p,p+w),l);else for(var M=0;M<w;M++)o[l+M]=v[p+M];return w},write(i,o,l,u,p,v){if(o.buffer===j.buffer&&(v=!1),!u)return 0;var w=i.node;if(w.timestamp=Date.now(),o.subarray&&(!w.contents||w.contents.subarray)){if(v)return w.contents=o.subarray(l,l+u),w.usedBytes=u,u;if(w.usedBytes===0&&p===0)return w.contents=o.slice(l,l+u),w.usedBytes=u,u;if(p+u<=w.usedBytes)return w.contents.set(o.subarray(l,l+u),p),u}if(fe.expandFileStorage(w,p+u),w.contents.subarray&&o.subarray)w.contents.set(o.subarray(l,l+u),p);else for(var M=0;M<u;M++)w.contents[p+M]=o[l+M];return w.usedBytes=Math.max(w.usedBytes,p+u),u},llseek(i,o,l){var u=o;if(l===1?u+=i.position:l===2&&y.isFile(i.node.mode)&&(u+=i.node.usedBytes),u<0)throw new y.ErrnoError(28);return u},allocate(i,o,l){fe.expandFileStorage(i.node,o+l),i.node.usedBytes=Math.max(i.node.usedBytes,o+l)},mmap(i,o,l,u,p){if(!y.isFile(i.node.mode))throw new y.ErrnoError(43);var v,w,M=i.node.contents;if(!(p&2)&&M.buffer===j.buffer)w=!1,v=M.byteOffset;else{if((l>0||l+o<M.length)&&(M.subarray?M=M.subarray(l,l+o):M=Array.prototype.slice.call(M,l,l+o)),w=!0,v=ji(),!v)throw new y.ErrnoError(48);j.set(M,v)}return{ptr:v,allocated:w}},msync(i,o,l,u,p){return fe.stream_ops.write(i,o,0,u,l,!1),0}}},uu=(i,o,l,u)=>{var p=u?"":`al ${i}`;N(i,v=>{W(v,`Loading data file "${i}" failed (no arrayBuffer).`),o(new Uint8Array(v)),p&&ar()},v=>{if(l)l();else throw`Loading data file "${i}" failed.`}),p&&Mr()},hu=r.preloadPlugins||[],du=(i,o,l,u)=>{typeof Browser<"u"&&Browser.init();var p=!1;return hu.forEach(v=>{p||v.canHandle(o)&&(v.handle(i,o,l,u),p=!0)}),p},pu=(i,o,l,u,p,v,w,M,F,D)=>{var V=o?wt.resolve(Ee.join2(i,o)):i;function K(q){function X(ee){D&&D(),M||y.createDataFile(i,o,ee,u,p,F),v&&v(),ar()}du(q,V,X,()=>{w&&w(),ar()})||X(q)}Mr(),typeof l=="string"?uu(l,q=>K(q),w):K(l)},gu=i=>{var o={r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},l=o[i];if(typeof l>"u")throw new Error(`Unknown file open mode: ${i}`);return l},fs=(i,o)=>{var l=0;return i&&(l|=365),o&&(l|=146),l},y={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath(i,o={}){if(i=wt.resolve(i),!i)return{path:"",node:null};var l={follow_mount:!0,recurse_count:0};if(o=Object.assign(l,o),o.recurse_count>8)throw new y.ErrnoError(32);for(var u=i.split("/").filter(K=>!!K),p=y.root,v="/",w=0;w<u.length;w++){var M=w===u.length-1;if(M&&o.parent)break;if(p=y.lookupNode(p,u[w]),v=Ee.join2(v,u[w]),y.isMountpoint(p)&&(!M||M&&o.follow_mount)&&(p=p.mounted.root),!M||o.follow)for(var F=0;y.isLink(p.mode);){var D=y.readlink(v);v=wt.resolve(Ee.dirname(v),D);var V=y.lookupPath(v,{recurse_count:o.recurse_count+1});if(p=V.node,F++>40)throw new y.ErrnoError(32)}}return{path:v,node:p}},getPath(i){for(var o;;){if(y.isRoot(i)){var l=i.mount.mountpoint;return o?l[l.length-1]!=="/"?`${l}/${o}`:l+o:l}o=o?`${i.name}/${o}`:i.name,i=i.parent}},hashName(i,o){for(var l=0,u=0;u<o.length;u++)l=(l<<5)-l+o.charCodeAt(u)|0;return(i+l>>>0)%y.nameTable.length},hashAddNode(i){var o=y.hashName(i.parent.id,i.name);i.name_next=y.nameTable[o],y.nameTable[o]=i},hashRemoveNode(i){var o=y.hashName(i.parent.id,i.name);if(y.nameTable[o]===i)y.nameTable[o]=i.name_next;else for(var l=y.nameTable[o];l;){if(l.name_next===i){l.name_next=i.name_next;break}l=l.name_next}},lookupNode(i,o){var l=y.mayLookup(i);if(l)throw new y.ErrnoError(l,i);for(var u=y.hashName(i.id,o),p=y.nameTable[u];p;p=p.name_next){var v=p.name;if(p.parent.id===i.id&&v===o)return p}return y.lookup(i,o)},createNode(i,o,l,u){var p=new y.FSNode(i,o,l,u);return y.hashAddNode(p),p},destroyNode(i){y.hashRemoveNode(i)},isRoot(i){return i===i.parent},isMountpoint(i){return!!i.mounted},isFile(i){return(i&61440)===32768},isDir(i){return(i&61440)===16384},isLink(i){return(i&61440)===40960},isChrdev(i){return(i&61440)===8192},isBlkdev(i){return(i&61440)===24576},isFIFO(i){return(i&61440)===4096},isSocket(i){return(i&49152)===49152},flagsToPermissionString(i){var o=["r","w","rw"][i&3];return i&512&&(o+="w"),o},nodePermissions(i,o){return y.ignorePermissions?0:o.includes("r")&&!(i.mode&292)||o.includes("w")&&!(i.mode&146)||o.includes("x")&&!(i.mode&73)?2:0},mayLookup(i){var o=y.nodePermissions(i,"x");return o||(i.node_ops.lookup?0:2)},mayCreate(i,o){try{var l=y.lookupNode(i,o);return 20}catch{}return y.nodePermissions(i,"wx")},mayDelete(i,o,l){var u;try{u=y.lookupNode(i,o)}catch(v){return v.errno}var p=y.nodePermissions(i,"wx");if(p)return p;if(l){if(!y.isDir(u.mode))return 54;if(y.isRoot(u)||y.getPath(u)===y.cwd())return 10}else if(y.isDir(u.mode))return 31;return 0},mayOpen(i,o){return i?y.isLink(i.mode)?32:y.isDir(i.mode)&&(y.flagsToPermissionString(o)!=="r"||o&512)?31:y.nodePermissions(i,y.flagsToPermissionString(o)):44},MAX_OPEN_FDS:4096,nextfd(){for(var i=0;i<=y.MAX_OPEN_FDS;i++)if(!y.streams[i])return i;throw new y.ErrnoError(33)},getStreamChecked(i){var o=y.getStream(i);if(!o)throw new y.ErrnoError(8);return o},getStream:i=>y.streams[i],createStream(i,o=-1){return y.FSStream||(y.FSStream=function(){this.shared={}},y.FSStream.prototype={},Object.defineProperties(y.FSStream.prototype,{object:{get(){return this.node},set(l){this.node=l}},isRead:{get(){return(this.flags&2097155)!==1}},isWrite:{get(){return(this.flags&2097155)!==0}},isAppend:{get(){return this.flags&1024}},flags:{get(){return this.shared.flags},set(l){this.shared.flags=l}},position:{get(){return this.shared.position},set(l){this.shared.position=l}}})),i=Object.assign(new y.FSStream,i),o==-1&&(o=y.nextfd()),i.fd=o,y.streams[o]=i,i},closeStream(i){y.streams[i]=null},chrdev_stream_ops:{open(i){var o=y.getDevice(i.node.rdev);i.stream_ops=o.stream_ops,i.stream_ops.open&&i.stream_ops.open(i)},llseek(){throw new y.ErrnoError(70)}},major:i=>i>>8,minor:i=>i&255,makedev:(i,o)=>i<<8|o,registerDevice(i,o){y.devices[i]={stream_ops:o}},getDevice:i=>y.devices[i],getMounts(i){for(var o=[],l=[i];l.length;){var u=l.pop();o.push(u),l.push.apply(l,u.mounts)}return o},syncfs(i,o){typeof i=="function"&&(o=i,i=!1),y.syncFSRequests++,y.syncFSRequests>1&&O(`warning: ${y.syncFSRequests} FS.syncfs operations in flight at once, probably just doing extra work`);var l=y.getMounts(y.root.mount),u=0;function p(w){return y.syncFSRequests--,o(w)}function v(w){if(w)return v.errored?void 0:(v.errored=!0,p(w));++u>=l.length&&p(null)}l.forEach(w=>{if(!w.type.syncfs)return v(null);w.type.syncfs(w,i,v)})},mount(i,o,l){var u=l==="/",p=!l,v;if(u&&y.root)throw new y.ErrnoError(10);if(!u&&!p){var w=y.lookupPath(l,{follow_mount:!1});if(l=w.path,v=w.node,y.isMountpoint(v))throw new y.ErrnoError(10);if(!y.isDir(v.mode))throw new y.ErrnoError(54)}var M={type:i,opts:o,mountpoint:l,mounts:[]},F=i.mount(M);return F.mount=M,M.root=F,u?y.root=F:v&&(v.mounted=M,v.mount&&v.mount.mounts.push(M)),F},unmount(i){var o=y.lookupPath(i,{follow_mount:!1});if(!y.isMountpoint(o.node))throw new y.ErrnoError(28);var l=o.node,u=l.mounted,p=y.getMounts(u);Object.keys(y.nameTable).forEach(w=>{for(var M=y.nameTable[w];M;){var F=M.name_next;p.includes(M.mount)&&y.destroyNode(M),M=F}}),l.mounted=null;var v=l.mount.mounts.indexOf(u);l.mount.mounts.splice(v,1)},lookup(i,o){return i.node_ops.lookup(i,o)},mknod(i,o,l){var u=y.lookupPath(i,{parent:!0}),p=u.node,v=Ee.basename(i);if(!v||v==="."||v==="..")throw new y.ErrnoError(28);var w=y.mayCreate(p,v);if(w)throw new y.ErrnoError(w);if(!p.node_ops.mknod)throw new y.ErrnoError(63);return p.node_ops.mknod(p,v,o,l)},create(i,o){return o=o!==void 0?o:438,o&=4095,o|=32768,y.mknod(i,o,0)},mkdir(i,o){return o=o!==void 0?o:511,o&=1023,o|=16384,y.mknod(i,o,0)},mkdirTree(i,o){for(var l=i.split("/"),u="",p=0;p<l.length;++p)if(l[p]){u+="/"+l[p];try{y.mkdir(u,o)}catch(v){if(v.errno!=20)throw v}}},mkdev(i,o,l){return typeof l>"u"&&(l=o,o=438),o|=8192,y.mknod(i,o,l)},symlink(i,o){if(!wt.resolve(i))throw new y.ErrnoError(44);var l=y.lookupPath(o,{parent:!0}),u=l.node;if(!u)throw new y.ErrnoError(44);var p=Ee.basename(o),v=y.mayCreate(u,p);if(v)throw new y.ErrnoError(v);if(!u.node_ops.symlink)throw new y.ErrnoError(63);return u.node_ops.symlink(u,p,i)},rename(i,o){var l=Ee.dirname(i),u=Ee.dirname(o),p=Ee.basename(i),v=Ee.basename(o),w,M,F;if(w=y.lookupPath(i,{parent:!0}),M=w.node,w=y.lookupPath(o,{parent:!0}),F=w.node,!M||!F)throw new y.ErrnoError(44);if(M.mount!==F.mount)throw new y.ErrnoError(75);var D=y.lookupNode(M,p),V=wt.relative(i,u);if(V.charAt(0)!==".")throw new y.ErrnoError(28);if(V=wt.relative(o,l),V.charAt(0)!==".")throw new y.ErrnoError(55);var K;try{K=y.lookupNode(F,v)}catch{}if(D!==K){var q=y.isDir(D.mode),X=y.mayDelete(M,p,q);if(X)throw new y.ErrnoError(X);if(X=K?y.mayDelete(F,v,q):y.mayCreate(F,v),X)throw new y.ErrnoError(X);if(!M.node_ops.rename)throw new y.ErrnoError(63);if(y.isMountpoint(D)||K&&y.isMountpoint(K))throw new y.ErrnoError(10);if(F!==M&&(X=y.nodePermissions(M,"w"),X))throw new y.ErrnoError(X);y.hashRemoveNode(D);try{M.node_ops.rename(D,F,v)}catch(ee){throw ee}finally{y.hashAddNode(D)}}},rmdir(i){var o=y.lookupPath(i,{parent:!0}),l=o.node,u=Ee.basename(i),p=y.lookupNode(l,u),v=y.mayDelete(l,u,!0);if(v)throw new y.ErrnoError(v);if(!l.node_ops.rmdir)throw new y.ErrnoError(63);if(y.isMountpoint(p))throw new y.ErrnoError(10);l.node_ops.rmdir(l,u),y.destroyNode(p)},readdir(i){var o=y.lookupPath(i,{follow:!0}),l=o.node;if(!l.node_ops.readdir)throw new y.ErrnoError(54);return l.node_ops.readdir(l)},unlink(i){var o=y.lookupPath(i,{parent:!0}),l=o.node;if(!l)throw new y.ErrnoError(44);var u=Ee.basename(i),p=y.lookupNode(l,u),v=y.mayDelete(l,u,!1);if(v)throw new y.ErrnoError(v);if(!l.node_ops.unlink)throw new y.ErrnoError(63);if(y.isMountpoint(p))throw new y.ErrnoError(10);l.node_ops.unlink(l,u),y.destroyNode(p)},readlink(i){var o=y.lookupPath(i),l=o.node;if(!l)throw new y.ErrnoError(44);if(!l.node_ops.readlink)throw new y.ErrnoError(28);return wt.resolve(y.getPath(l.parent),l.node_ops.readlink(l))},stat(i,o){var l=y.lookupPath(i,{follow:!o}),u=l.node;if(!u)throw new y.ErrnoError(44);if(!u.node_ops.getattr)throw new y.ErrnoError(63);return u.node_ops.getattr(u)},lstat(i){return y.stat(i,!0)},chmod(i,o,l){var u;if(typeof i=="string"){var p=y.lookupPath(i,{follow:!l});u=p.node}else u=i;if(!u.node_ops.setattr)throw new y.ErrnoError(63);u.node_ops.setattr(u,{mode:o&4095|u.mode&-4096,timestamp:Date.now()})},lchmod(i,o){y.chmod(i,o,!0)},fchmod(i,o){var l=y.getStreamChecked(i);y.chmod(l.node,o)},chown(i,o,l,u){var p;if(typeof i=="string"){var v=y.lookupPath(i,{follow:!u});p=v.node}else p=i;if(!p.node_ops.setattr)throw new y.ErrnoError(63);p.node_ops.setattr(p,{timestamp:Date.now()})},lchown(i,o,l){y.chown(i,o,l,!0)},fchown(i,o,l){var u=y.getStreamChecked(i);y.chown(u.node,o,l)},truncate(i,o){if(o<0)throw new y.ErrnoError(28);var l;if(typeof i=="string"){var u=y.lookupPath(i,{follow:!0});l=u.node}else l=i;if(!l.node_ops.setattr)throw new y.ErrnoError(63);if(y.isDir(l.mode))throw new y.ErrnoError(31);if(!y.isFile(l.mode))throw new y.ErrnoError(28);var p=y.nodePermissions(l,"w");if(p)throw new y.ErrnoError(p);l.node_ops.setattr(l,{size:o,timestamp:Date.now()})},ftruncate(i,o){var l=y.getStreamChecked(i);if(!(l.flags&2097155))throw new y.ErrnoError(28);y.truncate(l.node,o)},utime(i,o,l){var u=y.lookupPath(i,{follow:!0}),p=u.node;p.node_ops.setattr(p,{timestamp:Math.max(o,l)})},open(i,o,l){if(i==="")throw new y.ErrnoError(44);o=typeof o=="string"?gu(o):o,l=typeof l>"u"?438:l,o&64?l=l&4095|32768:l=0;var u;if(typeof i=="object")u=i;else{i=Ee.normalize(i);try{var p=y.lookupPath(i,{follow:!(o&131072)});u=p.node}catch{}}var v=!1;if(o&64)if(u){if(o&128)throw new y.ErrnoError(20)}else u=y.mknod(i,l,0),v=!0;if(!u)throw new y.ErrnoError(44);if(y.isChrdev(u.mode)&&(o&=-513),o&65536&&!y.isDir(u.mode))throw new y.ErrnoError(54);if(!v){var w=y.mayOpen(u,o);if(w)throw new y.ErrnoError(w)}o&512&&!v&&y.truncate(u,0),o&=-131713;var M=y.createStream({node:u,path:y.getPath(u),flags:o,seekable:!0,position:0,stream_ops:u.stream_ops,ungotten:[],error:!1});return M.stream_ops.open&&M.stream_ops.open(M),r.logReadFiles&&!(o&1)&&(y.readFiles||(y.readFiles={}),i in y.readFiles||(y.readFiles[i]=1)),M},close(i){if(y.isClosed(i))throw new y.ErrnoError(8);i.getdents&&(i.getdents=null);try{i.stream_ops.close&&i.stream_ops.close(i)}catch(o){throw o}finally{y.closeStream(i.fd)}i.fd=null},isClosed(i){return i.fd===null},llseek(i,o,l){if(y.isClosed(i))throw new y.ErrnoError(8);if(!i.seekable||!i.stream_ops.llseek)throw new y.ErrnoError(70);if(l!=0&&l!=1&&l!=2)throw new y.ErrnoError(28);return i.position=i.stream_ops.llseek(i,o,l),i.ungotten=[],i.position},read(i,o,l,u,p){if(u<0||p<0)throw new y.ErrnoError(28);if(y.isClosed(i))throw new y.ErrnoError(8);if((i.flags&2097155)===1)throw new y.ErrnoError(8);if(y.isDir(i.node.mode))throw new y.ErrnoError(31);if(!i.stream_ops.read)throw new y.ErrnoError(28);var v=typeof p<"u";if(!v)p=i.position;else if(!i.seekable)throw new y.ErrnoError(70);var w=i.stream_ops.read(i,o,l,u,p);return v||(i.position+=w),w},write(i,o,l,u,p,v){if(u<0||p<0)throw new y.ErrnoError(28);if(y.isClosed(i))throw new y.ErrnoError(8);if(!(i.flags&2097155))throw new y.ErrnoError(8);if(y.isDir(i.node.mode))throw new y.ErrnoError(31);if(!i.stream_ops.write)throw new y.ErrnoError(28);i.seekable&&i.flags&1024&&y.llseek(i,0,2);var w=typeof p<"u";if(!w)p=i.position;else if(!i.seekable)throw new y.ErrnoError(70);var M=i.stream_ops.write(i,o,l,u,p,v);return w||(i.position+=M),M},allocate(i,o,l){if(y.isClosed(i))throw new y.ErrnoError(8);if(o<0||l<=0)throw new y.ErrnoError(28);if(!(i.flags&2097155))throw new y.ErrnoError(8);if(!y.isFile(i.node.mode)&&!y.isDir(i.node.mode))throw new y.ErrnoError(43);if(!i.stream_ops.allocate)throw new y.ErrnoError(138);i.stream_ops.allocate(i,o,l)},mmap(i,o,l,u,p){if(u&2&&!(p&2)&&(i.flags&2097155)!==2)throw new y.ErrnoError(2);if((i.flags&2097155)===1)throw new y.ErrnoError(2);if(!i.stream_ops.mmap)throw new y.ErrnoError(43);return i.stream_ops.mmap(i,o,l,u,p)},msync(i,o,l,u,p){return i.stream_ops.msync?i.stream_ops.msync(i,o,l,u,p):0},munmap:i=>0,ioctl(i,o,l){if(!i.stream_ops.ioctl)throw new y.ErrnoError(59);return i.stream_ops.ioctl(i,o,l)},readFile(i,o={}){if(o.flags=o.flags||0,o.encoding=o.encoding||"binary",o.encoding!=="utf8"&&o.encoding!=="binary")throw new Error(`Invalid encoding type "${o.encoding}"`);var l,u=y.open(i,o.flags),p=y.stat(i),v=p.size,w=new Uint8Array(v);return y.read(u,w,0,v,0),o.encoding==="utf8"?l=fr(w,0):o.encoding==="binary"&&(l=w),y.close(u),l},writeFile(i,o,l={}){l.flags=l.flags||577;var u=y.open(i,l.flags,l.mode);if(typeof o=="string"){var p=new Uint8Array(as(o)+1),v=is(o,p,0,p.length);y.write(u,p,0,v,void 0,l.canOwn)}else if(ArrayBuffer.isView(o))y.write(u,o,0,o.byteLength,void 0,l.canOwn);else throw new Error("Unsupported data type");y.close(u)},cwd:()=>y.currentPath,chdir(i){var o=y.lookupPath(i,{follow:!0});if(o.node===null)throw new y.ErrnoError(44);if(!y.isDir(o.node.mode))throw new y.ErrnoError(54);var l=y.nodePermissions(o.node,"x");if(l)throw new y.ErrnoError(l);y.currentPath=o.path},createDefaultDirectories(){y.mkdir("/tmp"),y.mkdir("/home"),y.mkdir("/home/web_user")},createDefaultDevices(){y.mkdir("/dev"),y.registerDevice(y.makedev(1,3),{read:()=>0,write:(u,p,v,w,M)=>w}),y.mkdev("/dev/null",y.makedev(1,3)),Pt.register(y.makedev(5,0),Pt.default_tty_ops),Pt.register(y.makedev(6,0),Pt.default_tty1_ops),y.mkdev("/dev/tty",y.makedev(5,0)),y.mkdev("/dev/tty1",y.makedev(6,0));var i=new Uint8Array(1024),o=0,l=()=>(o===0&&(o=Li(i).byteLength),i[--o]);y.createDevice("/dev","random",l),y.createDevice("/dev","urandom",l),y.mkdir("/dev/shm"),y.mkdir("/dev/shm/tmp")},createSpecialDirectories(){y.mkdir("/proc");var i=y.mkdir("/proc/self");y.mkdir("/proc/self/fd"),y.mount({mount(){var o=y.createNode(i,"fd",16895,73);return o.node_ops={lookup(l,u){var p=+u,v=y.getStreamChecked(p),w={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>v.path}};return w.parent=w,w}},o}},{},"/proc/self/fd")},createStandardStreams(){r.stdin?y.createDevice("/dev","stdin",r.stdin):y.symlink("/dev/tty","/dev/stdin"),r.stdout?y.createDevice("/dev","stdout",null,r.stdout):y.symlink("/dev/tty","/dev/stdout"),r.stderr?y.createDevice("/dev","stderr",null,r.stderr):y.symlink("/dev/tty1","/dev/stderr"),y.open("/dev/stdin",0),y.open("/dev/stdout",1),y.open("/dev/stderr",1)},ensureErrnoError(){y.ErrnoError||(y.ErrnoError=function(o,l){this.name="ErrnoError",this.node=l,this.setErrno=function(u){this.errno=u},this.setErrno(o),this.message="FS error"},y.ErrnoError.prototype=new Error,y.ErrnoError.prototype.constructor=y.ErrnoError,[44].forEach(i=>{y.genericErrors[i]=new y.ErrnoError(i),y.genericErrors[i].stack="<generic error, no stack>"}))},staticInit(){y.ensureErrnoError(),y.nameTable=new Array(4096),y.mount(fe,{},"/"),y.createDefaultDirectories(),y.createDefaultDevices(),y.createSpecialDirectories(),y.filesystems={MEMFS:fe}},init(i,o,l){y.init.initialized=!0,y.ensureErrnoError(),r.stdin=i||r.stdin,r.stdout=o||r.stdout,r.stderr=l||r.stderr,y.createStandardStreams()},quit(){y.init.initialized=!1;for(var i=0;i<y.streams.length;i++){var o=y.streams[i];o&&y.close(o)}},findObject(i,o){var l=y.analyzePath(i,o);return l.exists?l.object:null},analyzePath(i,o){try{var l=y.lookupPath(i,{follow:!o});i=l.path}catch{}var u={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var l=y.lookupPath(i,{parent:!0});u.parentExists=!0,u.parentPath=l.path,u.parentObject=l.node,u.name=Ee.basename(i),l=y.lookupPath(i,{follow:!o}),u.exists=!0,u.path=l.path,u.object=l.node,u.name=l.node.name,u.isRoot=l.path==="/"}catch(p){u.error=p.errno}return u},createPath(i,o,l,u){i=typeof i=="string"?i:y.getPath(i);for(var p=o.split("/").reverse();p.length;){var v=p.pop();if(v){var w=Ee.join2(i,v);try{y.mkdir(w)}catch{}i=w}}return w},createFile(i,o,l,u,p){var v=Ee.join2(typeof i=="string"?i:y.getPath(i),o),w=fs(u,p);return y.create(v,w)},createDataFile(i,o,l,u,p,v){var w=o;i&&(i=typeof i=="string"?i:y.getPath(i),w=o?Ee.join2(i,o):i);var M=fs(u,p),F=y.create(w,M);if(l){if(typeof l=="string"){for(var D=new Array(l.length),V=0,K=l.length;V<K;++V)D[V]=l.charCodeAt(V);l=D}y.chmod(F,M|146);var q=y.open(F,577);y.write(q,l,0,l.length,0,v),y.close(q),y.chmod(F,M)}return F},createDevice(i,o,l,u){var p=Ee.join2(typeof i=="string"?i:y.getPath(i),o),v=fs(!!l,!!u);y.createDevice.major||(y.createDevice.major=64);var w=y.makedev(y.createDevice.major++,0);return y.registerDevice(w,{open(M){M.seekable=!1},close(M){u&&u.buffer&&u.buffer.length&&u(10)},read(M,F,D,V,K){for(var q=0,X=0;X<V;X++){var ee;try{ee=l()}catch{throw new y.ErrnoError(29)}if(ee===void 0&&q===0)throw new y.ErrnoError(6);if(ee==null)break;q++,F[D+X]=ee}return q&&(M.node.timestamp=Date.now()),q},write(M,F,D,V,K){for(var q=0;q<V;q++)try{u(F[D+q])}catch{throw new y.ErrnoError(29)}return V&&(M.node.timestamp=Date.now()),q}}),y.mkdev(p,v,w)},forceLoadFile(i){if(i.isDevice||i.isFolder||i.link||i.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(A)try{i.contents=pn(A(i.url),!0),i.usedBytes=i.contents.length}catch{throw new y.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile(i,o,l,u,p){function v(){this.lengthKnown=!1,this.chunks=[]}if(v.prototype.get=function(X){if(!(X>this.length-1||X<0)){var ee=X%this.chunkSize,ue=X/this.chunkSize|0;return this.getter(ue)[ee]}},v.prototype.setDataGetter=function(X){this.getter=X},v.prototype.cacheLength=function(){var X=new XMLHttpRequest;if(X.open("HEAD",l,!1),X.send(null),!(X.status>=200&&X.status<300||X.status===304))throw new Error("Couldn't load "+l+". Status: "+X.status);var ee=Number(X.getResponseHeader("Content-length")),ue,he=(ue=X.getResponseHeader("Accept-Ranges"))&&ue==="bytes",I=(ue=X.getResponseHeader("Content-Encoding"))&&ue==="gzip",S=1024*1024;he||(S=ee);var $=(Z,pe)=>{if(Z>pe)throw new Error("invalid range ("+Z+", "+pe+") or no bytes requested!");if(pe>ee-1)throw new Error("only "+ee+" bytes available! programmer error!");var ne=new XMLHttpRequest;if(ne.open("GET",l,!1),ee!==S&&ne.setRequestHeader("Range","bytes="+Z+"-"+pe),ne.responseType="arraybuffer",ne.overrideMimeType&&ne.overrideMimeType("text/plain; charset=x-user-defined"),ne.send(null),!(ne.status>=200&&ne.status<300||ne.status===304))throw new Error("Couldn't load "+l+". Status: "+ne.status);return ne.response!==void 0?new Uint8Array(ne.response||[]):pn(ne.responseText||"",!0)},U=this;U.setDataGetter(Z=>{var pe=Z*S,ne=(Z+1)*S-1;if(ne=Math.min(ne,ee-1),typeof U.chunks[Z]>"u"&&(U.chunks[Z]=$(pe,ne)),typeof U.chunks[Z]>"u")throw new Error("doXHR failed!");return U.chunks[Z]}),(I||!ee)&&(S=ee=1,ee=this.getter(0).length,S=ee,b("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=ee,this._chunkSize=S,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!g)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var w=new v;Object.defineProperties(w,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var M={isDevice:!1,contents:w}}else var M={isDevice:!1,url:l};var F=y.createFile(i,o,M,u,p);M.contents?F.contents=M.contents:M.url&&(F.contents=null,F.url=M.url),Object.defineProperties(F,{usedBytes:{get:function(){return this.contents.length}}});var D={},V=Object.keys(F.stream_ops);V.forEach(q=>{var X=F.stream_ops[q];D[q]=function(){return y.forceLoadFile(F),X.apply(null,arguments)}});function K(q,X,ee,ue,he){var I=q.node.contents;if(he>=I.length)return 0;var S=Math.min(I.length-he,ue);if(I.slice)for(var $=0;$<S;$++)X[ee+$]=I[he+$];else for(var $=0;$<S;$++)X[ee+$]=I.get(he+$);return S}return D.read=(q,X,ee,ue,he)=>(y.forceLoadFile(F),K(q,X,ee,ue,he)),D.mmap=(q,X,ee,ue,he)=>{y.forceLoadFile(F);var I=ji();if(!I)throw new y.ErrnoError(48);return K(q,j,I,X,ee),{ptr:I,allocated:!0}},F.stream_ops=D,F}},Nt={DEFAULT_POLLMASK:5,calculateAt(i,o,l){if(Ee.isAbs(o))return o;var u;if(i===-100)u=y.cwd();else{var p=Nt.getStreamFromFD(i);u=p.path}if(o.length==0){if(!l)throw new y.ErrnoError(44);return u}return Ee.join2(u,o)},doStat(i,o,l){try{var u=i(o)}catch(M){if(M&&M.node&&Ee.normalize(o)!==Ee.normalize(y.getPath(M.node)))return-54;throw M}G[l>>2]=u.dev,G[l+4>>2]=u.mode,Q[l+8>>2]=u.nlink,G[l+12>>2]=u.uid,G[l+16>>2]=u.gid,G[l+20>>2]=u.rdev,je=[u.size>>>0,(ge=u.size,+Math.abs(ge)>=1?ge>0?+Math.floor(ge/4294967296)>>>0:~~+Math.ceil((ge-+(~~ge>>>0))/4294967296)>>>0:0)],G[l+24>>2]=je[0],G[l+28>>2]=je[1],G[l+32>>2]=4096,G[l+36>>2]=u.blocks;var p=u.atime.getTime(),v=u.mtime.getTime(),w=u.ctime.getTime();return je=[Math.floor(p/1e3)>>>0,(ge=Math.floor(p/1e3),+Math.abs(ge)>=1?ge>0?+Math.floor(ge/4294967296)>>>0:~~+Math.ceil((ge-+(~~ge>>>0))/4294967296)>>>0:0)],G[l+40>>2]=je[0],G[l+44>>2]=je[1],Q[l+48>>2]=p%1e3*1e3,je=[Math.floor(v/1e3)>>>0,(ge=Math.floor(v/1e3),+Math.abs(ge)>=1?ge>0?+Math.floor(ge/4294967296)>>>0:~~+Math.ceil((ge-+(~~ge>>>0))/4294967296)>>>0:0)],G[l+56>>2]=je[0],G[l+60>>2]=je[1],Q[l+64>>2]=v%1e3*1e3,je=[Math.floor(w/1e3)>>>0,(ge=Math.floor(w/1e3),+Math.abs(ge)>=1?ge>0?+Math.floor(ge/4294967296)>>>0:~~+Math.ceil((ge-+(~~ge>>>0))/4294967296)>>>0:0)],G[l+72>>2]=je[0],G[l+76>>2]=je[1],Q[l+80>>2]=w%1e3*1e3,je=[u.ino>>>0,(ge=u.ino,+Math.abs(ge)>=1?ge>0?+Math.floor(ge/4294967296)>>>0:~~+Math.ceil((ge-+(~~ge>>>0))/4294967296)>>>0:0)],G[l+88>>2]=je[0],G[l+92>>2]=je[1],0},doMsync(i,o,l,u,p){if(!y.isFile(o.node.mode))throw new y.ErrnoError(43);if(u&2)return 0;var v=Y.slice(i,i+l);y.msync(o,v,p,l,u)},varargs:void 0,get(){var i=G[Nt.varargs>>2];return Nt.varargs+=4,i},getp(){return Nt.get()},getStr(i){var o=hn(i);return o},getStreamFromFD(i){var o=y.getStreamChecked(i);return o}},mu=(i,o)=>{var l=0;return Ir().forEach((u,p)=>{var v=o+l;Q[i+p*4>>2]=v,cu(u,v),l+=u.length+1}),0},vu=(i,o)=>{var l=Ir();Q[i>>2]=l.length;var u=0;return l.forEach(p=>u+=p.length+1),Q[o>>2]=u,0},yu=i=>{Ce()||(r.onExit&&r.onExit(i),k=!0),h(i,new wl(i))},xu=(i,o)=>{yu(i)},Tu=xu;function Eu(i){try{var o=Nt.getStreamFromFD(i);return y.close(o),0}catch(l){if(typeof y>"u"||l.name!=="ErrnoError")throw l;return l.errno}}var wu=(i,o,l,u)=>{for(var p=0,v=0;v<l;v++){var w=Q[o>>2],M=Q[o+4>>2];o+=8;var F=y.read(i,j,w,M,u);if(F<0)return-1;if(p+=F,F<M)break;typeof u<"u"&&(u+=F)}return p};function Mu(i,o,l,u){try{var p=Nt.getStreamFromFD(i),v=wu(p,o,l);return Q[u>>2]=v,0}catch(w){if(typeof y>"u"||w.name!=="ErrnoError")throw w;return w.errno}}var _u=(i,o)=>o+2097152>>>0<4194305-!!i?(i>>>0)+o*4294967296:NaN;function Ru(i,o,l,u,p){var v=_u(o,l);try{if(isNaN(v))return 61;var w=Nt.getStreamFromFD(i);return y.llseek(w,v,u),je=[w.position>>>0,(ge=w.position,+Math.abs(ge)>=1?ge>0?+Math.floor(ge/4294967296)>>>0:~~+Math.ceil((ge-+(~~ge>>>0))/4294967296)>>>0:0)],G[p>>2]=je[0],G[p+4>>2]=je[1],w.getdents&&v===0&&u===0&&(w.getdents=null),0}catch(M){if(typeof y>"u"||M.name!=="ErrnoError")throw M;return M.errno}}var bu=(i,o,l,u)=>{for(var p=0,v=0;v<l;v++){var w=Q[o>>2],M=Q[o+4>>2];o+=8;var F=y.write(i,j,w,M,u);if(F<0)return-1;p+=F,typeof u<"u"&&(u+=F)}return p};function Au(i,o,l,u){try{var p=Nt.getStreamFromFD(i),v=bu(p,o,l);return Q[u>>2]=v,0}catch(w){if(typeof y>"u"||w.name!=="ErrnoError")throw w;return w.errno}}var Su=i=>i,gn=i=>i%4===0&&(i%100!==0||i%400===0),Iu=(i,o)=>{for(var l=0,u=0;u<=o;l+=i[u++]);return l},Bi=[31,29,31,30,31,30,31,31,30,31,30,31],Vi=[31,28,31,30,31,30,31,31,30,31,30,31],Cu=(i,o)=>{for(var l=new Date(i.getTime());o>0;){var u=gn(l.getFullYear()),p=l.getMonth(),v=(u?Bi:Vi)[p];if(o>v-l.getDate())o-=v-l.getDate()+1,l.setDate(1),p<11?l.setMonth(p+1):(l.setMonth(0),l.setFullYear(l.getFullYear()+1));else return l.setDate(l.getDate()+o),l}return l},Nu=(i,o)=>{j.set(i,o)},Ou=(i,o,l,u)=>{var p=Q[u+40>>2],v={tm_sec:G[u>>2],tm_min:G[u+4>>2],tm_hour:G[u+8>>2],tm_mday:G[u+12>>2],tm_mon:G[u+16>>2],tm_year:G[u+20>>2],tm_wday:G[u+24>>2],tm_yday:G[u+28>>2],tm_isdst:G[u+32>>2],tm_gmtoff:G[u+36>>2],tm_zone:p?hn(p):""},w=hn(l),M={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var F in M)w=w.replace(new RegExp(F,"g"),M[F]);var D=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],V=["January","February","March","April","May","June","July","August","September","October","November","December"];function K(S,$,U){for(var Z=typeof S=="number"?S.toString():S||"";Z.length<$;)Z=U[0]+Z;return Z}function q(S,$){return K(S,$,"0")}function X(S,$){function U(pe){return pe<0?-1:pe>0?1:0}var Z;return(Z=U(S.getFullYear()-$.getFullYear()))===0&&(Z=U(S.getMonth()-$.getMonth()))===0&&(Z=U(S.getDate()-$.getDate())),Z}function ee(S){switch(S.getDay()){case 0:return new Date(S.getFullYear()-1,11,29);case 1:return S;case 2:return new Date(S.getFullYear(),0,3);case 3:return new Date(S.getFullYear(),0,2);case 4:return new Date(S.getFullYear(),0,1);case 5:return new Date(S.getFullYear()-1,11,31);case 6:return new Date(S.getFullYear()-1,11,30)}}function ue(S){var $=Cu(new Date(S.tm_year+1900,0,1),S.tm_yday),U=new Date($.getFullYear(),0,4),Z=new Date($.getFullYear()+1,0,4),pe=ee(U),ne=ee(Z);return X(pe,$)<=0?X(ne,$)<=0?$.getFullYear()+1:$.getFullYear():$.getFullYear()-1}var he={"%a":S=>D[S.tm_wday].substring(0,3),"%A":S=>D[S.tm_wday],"%b":S=>V[S.tm_mon].substring(0,3),"%B":S=>V[S.tm_mon],"%C":S=>{var $=S.tm_year+1900;return q($/100|0,2)},"%d":S=>q(S.tm_mday,2),"%e":S=>K(S.tm_mday,2," "),"%g":S=>ue(S).toString().substring(2),"%G":S=>ue(S),"%H":S=>q(S.tm_hour,2),"%I":S=>{var $=S.tm_hour;return $==0?$=12:$>12&&($-=12),q($,2)},"%j":S=>q(S.tm_mday+Iu(gn(S.tm_year+1900)?Bi:Vi,S.tm_mon-1),3),"%m":S=>q(S.tm_mon+1,2),"%M":S=>q(S.tm_min,2),"%n":()=>`
`,"%p":S=>S.tm_hour>=0&&S.tm_hour<12?"AM":"PM","%S":S=>q(S.tm_sec,2),"%t":()=>"	","%u":S=>S.tm_wday||7,"%U":S=>{var $=S.tm_yday+7-S.tm_wday;return q(Math.floor($/7),2)},"%V":S=>{var $=Math.floor((S.tm_yday+7-(S.tm_wday+6)%7)/7);if((S.tm_wday+371-S.tm_yday-2)%7<=2&&$++,$){if($==53){var Z=(S.tm_wday+371-S.tm_yday)%7;Z!=4&&(Z!=3||!gn(S.tm_year))&&($=1)}}else{$=52;var U=(S.tm_wday+7-S.tm_yday-1)%7;(U==4||U==5&&gn(S.tm_year%400-1))&&$++}return q($,2)},"%w":S=>S.tm_wday,"%W":S=>{var $=S.tm_yday+7-(S.tm_wday+6)%7;return q(Math.floor($/7),2)},"%y":S=>(S.tm_year+1900).toString().substring(2),"%Y":S=>S.tm_year+1900,"%z":S=>{var $=S.tm_gmtoff,U=$>=0;return $=Math.abs($)/60,$=$/60*100+$%60,(U?"+":"-")+("0000"+$).slice(-4)},"%Z":S=>S.tm_zone,"%%":()=>"%"};w=w.replace(/%%/g,"\0\0");for(var F in he)w.includes(F)&&(w=w.replace(new RegExp(F,"g"),he[F](v)));w=w.replace(/\0\0/g,"%");var I=pn(w,!1);return I.length>o?0:(Nu(I,i),I.length-1)},Fu=(i,o,l,u,p)=>Ou(i,o,l,u),zi=(i,o)=>{i<128?o.push(i):o.push(i%128|128,i>>7)},Du=i=>{for(var o={i:"i32",j:"i64",f:"f32",d:"f64",p:"i32"},l={parameters:[],results:i[0]=="v"?[]:[o[i[0]]]},u=1;u<i.length;++u)l.parameters.push(o[i[u]]);return l},$u=(i,o)=>{var l=i.slice(0,1),u=i.slice(1),p={i:127,p:127,j:126,f:125,d:124};o.push(96),zi(u.length,o);for(var v=0;v<u.length;++v)o.push(p[u[v]]);l=="v"?o.push(0):o.push(1,p[l])},Pu=(i,o)=>{if(typeof WebAssembly.Function=="function")return new WebAssembly.Function(Du(o),i);var l=[1];$u(o,l);var u=[0,97,115,109,1,0,0,0,1];zi(l.length,u),u.push.apply(u,l),u.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var p=new WebAssembly.Module(new Uint8Array(u)),v=new WebAssembly.Instance(p,{e:{f:i}}),w=v.exports.f;return w},ku=(i,o)=>{if(kt)for(var l=i;l<i+o;l++){var u=ce(l);u&&kt.set(u,l)}},kt=void 0,Uu=i=>(kt||(kt=new WeakMap,ku(0,me.length)),kt.get(i)||0),us=[],Lu=()=>{if(us.length)return us.pop();try{me.grow(1)}catch(i){throw i instanceof RangeError?"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH.":i}return me.length-1},Gi=(i,o)=>{me.set(i,o),Sr[i]=me.get(i)},Cr=(i,o)=>{var l=Uu(i);if(l)return l;var u=Lu();try{Gi(u,i)}catch(v){if(!(v instanceof TypeError))throw v;var p=Pu(i,o);Gi(u,p)}return kt.set(i,u),u},Nr=i=>{kt.delete(ce(i)),us.push(i)};Mi=r.InternalError=class extends Error{constructor(o){super(o),this.name="InternalError"}},Fl(),lr=r.BindingError=class extends Error{constructor(o){super(o),this.name="BindingError"}},Kl(),Vl(),of(),Oi=r.UnboundTypeError=uf(Error,"UnboundTypeError"),gf(),vf();var Hi=function(i,o,l,u){i||(i=this),this.parent=i,this.mount=i.mount,this.mounted=null,this.id=y.nextInode++,this.name=o,this.mode=l,this.node_ops={},this.stream_ops={},this.rdev=u},mn=365,vn=146;Object.defineProperties(Hi.prototype,{read:{get:function(){return(this.mode&mn)===mn},set:function(i){i?this.mode|=mn:this.mode&=~mn}},write:{get:function(){return(this.mode&vn)===vn},set:function(i){i?this.mode|=vn:this.mode&=~vn}},isFolder:{get:function(){return y.isDir(this.mode)}},isDevice:{get:function(){return y.isChrdev(this.mode)}}}),y.FSNode=Hi,y.createPreloadedFile=pu,y.staticInit();var ju={z:Ml,G:_l,a:bl,j:Al,T:Sl,h:Il,oa:Cl,d:Rl,Ka:Nl,fa:Ol,ua:$l,x:hf,w:df,i:pf,ta:yf,R:Tf,t:Ef,W:Mf,o:_f,A:bf,s:Af,V:If,P:Pf,F:kf,La:Uf,va:Lf,Qa:jf,Fa:zf,Na:Gf,Sa:ns,Pa:Hf,Ja:Xf,Ra:Yf,Oa:Kf,I:Jf,ca:Zf,wa:Qf,Ta:eu,y:tu,O:ru,sa:nu,pa:au,ma:mu,na:vu,xa:Tu,qa:Eu,ra:Mu,ea:Ru,U:Au,Ba:xh,H:th,K:qu,C:zu,E:rh,ba:Qu,S:Ah,r:mh,c:Hu,ya:Mh,za:Eh,b:Vu,n:Ku,l:Yu,N:fh,B:Rh,Q:_h,M:Sh,da:$h,k:eh,f:Gu,Ha:oh,g:Wu,Da:vh,Y:wh,J:ah,aa:sh,Ia:ih,u:ch,Ca:yh,Ea:lh,e:Bu,X:bh,Ma:Ju,m:Xu,p:nh,Aa:Th,$:hh,D:uh,v:ph,Z:gh,q:Zu,L:Ih,_:dh,ia:Oh,ka:Ch,ja:Nh,ga:Dh,ha:Fh,Ga:Su,la:Fu},_e=El(),hs=i=>(hs=_e.Xa)(i),Mt=i=>(Mt=_e.Ya)(i),qi=i=>(qi=_e.Za)(i);r.__embind_initialize_bindings=()=>(r.__embind_initialize_bindings=_e._a)();var se=(i,o)=>(se=_e.$a)(i,o),Or=i=>(Or=_e.ab)(i),ie=()=>(ie=_e.bb)(),ae=i=>(ae=_e.cb)(i),Wi=i=>(Wi=_e.db)(i),Xi=i=>(Xi=_e.eb)(i),Yi=(i,o,l)=>(Yi=_e.fb)(i,o,l),Ki=i=>(Ki=_e.gb)(i),Ji=r.dynCall_viiji=(i,o,l,u,p,v)=>(Ji=r.dynCall_viiji=_e.hb)(i,o,l,u,p,v),Zi=r.dynCall_viijii=(i,o,l,u,p,v,w)=>(Zi=r.dynCall_viijii=_e.ib)(i,o,l,u,p,v,w),Qi=r.dynCall_viiij=(i,o,l,u,p,v)=>(Qi=r.dynCall_viiij=_e.jb)(i,o,l,u,p,v),ea=r.dynCall_vijiii=(i,o,l,u,p,v,w)=>(ea=r.dynCall_vijiii=_e.kb)(i,o,l,u,p,v,w),ta=r.dynCall_vijii=(i,o,l,u,p,v)=>(ta=r.dynCall_vijii=_e.lb)(i,o,l,u,p,v);r.dynCall_jiji=(i,o,l,u,p)=>(r.dynCall_jiji=_e.mb)(i,o,l,u,p);var ra=r.dynCall_jiiii=(i,o,l,u,p)=>(ra=r.dynCall_jiiii=_e.nb)(i,o,l,u,p);r.dynCall_iiiiij=(i,o,l,u,p,v,w)=>(r.dynCall_iiiiij=_e.ob)(i,o,l,u,p,v,w),r.dynCall_iiiiijj=(i,o,l,u,p,v,w,M,F)=>(r.dynCall_iiiiijj=_e.pb)(i,o,l,u,p,v,w,M,F),r.dynCall_iiiiiijj=(i,o,l,u,p,v,w,M,F,D)=>(r.dynCall_iiiiiijj=_e.qb)(i,o,l,u,p,v,w,M,F,D);function Bu(i,o,l,u){var p=ie();try{ce(i)(o,l,u)}catch(v){if(ae(p),v!==v+0)throw v;se(1,0)}}function Vu(i,o,l){var u=ie();try{return ce(i)(o,l)}catch(p){if(ae(u),p!==p+0)throw p;se(1,0)}}function zu(i,o,l,u,p,v){var w=ie();try{return ce(i)(o,l,u,p,v)}catch(M){if(ae(w),M!==M+0)throw M;se(1,0)}}function Gu(i,o){var l=ie();try{ce(i)(o)}catch(u){if(ae(l),u!==u+0)throw u;se(1,0)}}function Hu(i,o){var l=ie();try{return ce(i)(o)}catch(u){if(ae(l),u!==u+0)throw u;se(1,0)}}function qu(i,o,l,u){var p=ie();try{return ce(i)(o,l,u)}catch(v){if(ae(p),v!==v+0)throw v;se(1,0)}}function Wu(i,o,l){var u=ie();try{ce(i)(o,l)}catch(p){if(ae(u),p!==p+0)throw p;se(1,0)}}function Xu(i,o,l,u,p){var v=ie();try{ce(i)(o,l,u,p)}catch(w){if(ae(v),w!==w+0)throw w;se(1,0)}}function Yu(i,o,l,u,p){var v=ie();try{return ce(i)(o,l,u,p)}catch(w){if(ae(v),w!==w+0)throw w;se(1,0)}}function Ku(i,o,l,u){var p=ie();try{return ce(i)(o,l,u)}catch(v){if(ae(p),v!==v+0)throw v;se(1,0)}}function Ju(i,o,l,u,p,v,w){var M=ie();try{ce(i)(o,l,u,p,v,w)}catch(F){if(ae(M),F!==F+0)throw F;se(1,0)}}function Zu(i,o,l,u,p,v,w,M,F,D,V){var K=ie();try{ce(i)(o,l,u,p,v,w,M,F,D,V)}catch(q){if(ae(K),q!==q+0)throw q;se(1,0)}}function Qu(i,o,l){var u=ie();try{return ce(i)(o,l)}catch(p){if(ae(u),p!==p+0)throw p;se(1,0)}}function eh(i){var o=ie();try{ce(i)()}catch(l){if(ae(o),l!==l+0)throw l;se(1,0)}}function th(i,o,l){var u=ie();try{return ce(i)(o,l)}catch(p){if(ae(u),p!==p+0)throw p;se(1,0)}}function rh(i,o){var l=ie();try{return ce(i)(o)}catch(u){if(ae(l),u!==u+0)throw u;se(1,0)}}function nh(i,o,l,u,p,v){var w=ie();try{ce(i)(o,l,u,p,v)}catch(M){if(ae(w),M!==M+0)throw M;se(1,0)}}function sh(i,o,l,u,p){var v=ie();try{ce(i)(o,l,u,p)}catch(w){if(ae(v),w!==w+0)throw w;se(1,0)}}function ih(i,o,l,u,p,v,w,M,F){var D=ie();try{ce(i)(o,l,u,p,v,w,M,F)}catch(V){if(ae(D),V!==V+0)throw V;se(1,0)}}function ah(i,o,l,u,p,v){var w=ie();try{ce(i)(o,l,u,p,v)}catch(M){if(ae(w),M!==M+0)throw M;se(1,0)}}function oh(i,o,l,u){var p=ie();try{ce(i)(o,l,u)}catch(v){if(ae(p),v!==v+0)throw v;se(1,0)}}function ch(i,o,l,u){var p=ie();try{ce(i)(o,l,u)}catch(v){if(ae(p),v!==v+0)throw v;se(1,0)}}function lh(i,o,l,u,p,v,w){var M=ie();try{ce(i)(o,l,u,p,v,w)}catch(F){if(ae(M),F!==F+0)throw F;se(1,0)}}function fh(i,o,l,u,p,v){var w=ie();try{return ce(i)(o,l,u,p,v)}catch(M){if(ae(w),M!==M+0)throw M;se(1,0)}}function uh(i,o,l,u,p,v,w){var M=ie();try{ce(i)(o,l,u,p,v,w)}catch(F){if(ae(M),F!==F+0)throw F;se(1,0)}}function hh(i,o,l,u,p,v,w){var M=ie();try{ce(i)(o,l,u,p,v,w)}catch(F){if(ae(M),F!==F+0)throw F;se(1,0)}}function dh(i,o,l,u,p,v,w,M,F,D,V,K,q,X,ee,ue,he,I,S){var $=ie();try{ce(i)(o,l,u,p,v,w,M,F,D,V,K,q,X,ee,ue,he,I,S)}catch(U){if(ae($),U!==U+0)throw U;se(1,0)}}function ph(i,o,l,u,p,v,w,M){var F=ie();try{ce(i)(o,l,u,p,v,w,M)}catch(D){if(ae(F),D!==D+0)throw D;se(1,0)}}function gh(i,o,l,u,p,v,w,M,F,D){var V=ie();try{ce(i)(o,l,u,p,v,w,M,F,D)}catch(K){if(ae(V),K!==K+0)throw K;se(1,0)}}function mh(i){var o=ie();try{return ce(i)()}catch(l){if(ae(o),l!==l+0)throw l;se(1,0)}}function vh(i,o,l,u){var p=ie();try{ce(i)(o,l,u)}catch(v){if(ae(p),v!==v+0)throw v;se(1,0)}}function yh(i,o,l,u,p,v){var w=ie();try{ce(i)(o,l,u,p,v)}catch(M){if(ae(w),M!==M+0)throw M;se(1,0)}}function xh(i){var o=ie();try{return ce(i)()}catch(l){if(ae(o),l!==l+0)throw l;se(1,0)}}function Th(i,o,l,u,p,v,w){var M=ie();try{ce(i)(o,l,u,p,v,w)}catch(F){if(ae(M),F!==F+0)throw F;se(1,0)}}function Eh(i,o,l,u,p,v,w,M,F,D,V,K,q,X,ee){var ue=ie();try{return ce(i)(o,l,u,p,v,w,M,F,D,V,K,q,X,ee)}catch(he){if(ae(ue),he!==he+0)throw he;se(1,0)}}function wh(i,o,l,u,p,v,w){var M=ie();try{ce(i)(o,l,u,p,v,w)}catch(F){if(ae(M),F!==F+0)throw F;se(1,0)}}function Mh(i,o,l){var u=ie();try{return ce(i)(o,l)}catch(p){if(ae(u),p!==p+0)throw p;se(1,0)}}function _h(i,o,l,u,p,v,w,M){var F=ie();try{return ce(i)(o,l,u,p,v,w,M)}catch(D){if(ae(F),D!==D+0)throw D;se(1,0)}}function Rh(i,o,l,u,p,v,w){var M=ie();try{return ce(i)(o,l,u,p,v,w)}catch(F){if(ae(M),F!==F+0)throw F;se(1,0)}}function bh(i,o,l,u,p){var v=ie();try{ce(i)(o,l,u,p)}catch(w){if(ae(v),w!==w+0)throw w;se(1,0)}}function Ah(i,o,l,u){var p=ie();try{return ce(i)(o,l,u)}catch(v){if(ae(p),v!==v+0)throw v;se(1,0)}}function Sh(i,o,l,u,p,v,w,M,F,D,V,K){var q=ie();try{return ce(i)(o,l,u,p,v,w,M,F,D,V,K)}catch(X){if(ae(q),X!==X+0)throw X;se(1,0)}}function Ih(i,o,l,u,p,v,w,M,F,D,V,K,q,X,ee,ue){var he=ie();try{ce(i)(o,l,u,p,v,w,M,F,D,V,K,q,X,ee,ue)}catch(I){if(ae(he),I!==I+0)throw I;se(1,0)}}function Ch(i,o,l,u,p,v){var w=ie();try{Ji(i,o,l,u,p,v)}catch(M){if(ae(w),M!==M+0)throw M;se(1,0)}}function Nh(i,o,l,u,p,v,w){var M=ie();try{Zi(i,o,l,u,p,v,w)}catch(F){if(ae(M),F!==F+0)throw F;se(1,0)}}function Oh(i,o,l,u,p,v){var w=ie();try{Qi(i,o,l,u,p,v)}catch(M){if(ae(w),M!==M+0)throw M;se(1,0)}}function Fh(i,o,l,u,p,v,w){var M=ie();try{ea(i,o,l,u,p,v,w)}catch(F){if(ae(M),F!==F+0)throw F;se(1,0)}}function Dh(i,o,l,u,p,v){var w=ie();try{ta(i,o,l,u,p,v)}catch(M){if(ae(w),M!==M+0)throw M;se(1,0)}}function $h(i,o,l,u,p){var v=ie();try{return ra(i,o,l,u,p)}catch(w){if(ae(v),w!==w+0)throw w;se(1,0)}}r.addFunction=Cr,r.removeFunction=Nr;var yn;ct=function i(){yn||na(),yn||(ct=i)};function na(){if(rt>0||(Ze(),rt>0))return;function i(){yn||(yn=!0,r.calledRun=!0,!k&&(ot(),n(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),St()))}r.setStatus?(r.setStatus("Running..."),setTimeout(function(){setTimeout(function(){r.setStatus("")},1),i()},1)):i()}if(r.preInit)for(typeof r.preInit=="function"&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();return na(),e.ready}})();const yt="EXT_mesh_manifold",Oa="MERGE";class mi extends $e{static EXTENSION_NAME=yt;init(){mi.EXTENSION_NAME=yt,this.propertyType="ManifoldPrimitive",this.parentTypes=[J.MESH]}getDefaults(){return Object.assign(super.getDefaults(),{manifoldPrimitive:null,mergeIndices:null,mergeValues:null})}getMergeIndices(){return this.getRef("mergeIndices")}getMergeValues(){return this.getRef("mergeValues")}setMerge(e,r){if(e.getCount()!==r.getCount())throw new Error("merge vectors must be the same length.");return this.setRef("mergeIndices",e),this.setRef("mergeValues",r)}getRunIndex(){return this.get("runIndex")}setRunIndex(e){return this.set("runIndex",e)}setIndices(e){return this.setRef("indices",e)}getIndices(){return this.getRef("indices")}}class ll extends Ie{extensionName=yt;prewriteTypes=[J.ACCESSOR];static EXTENSION_NAME=yt;createManifoldPrimitive(){return new mi(this.document.getGraph())}read(e){const{json:r}=e.jsonDoc;return(r.meshes||[]).forEach((s,a)=>{if(!s.extensions||!s.extensions[yt])return;const c=e.meshes[a],f=this.createManifoldPrimitive();c.setExtension(yt,f);const h=s.extensions[yt];if(h.manifoldPrimitive){let d=0;const g=[];g.push(d);for(const T of c.listPrimitives()){const E=T.getIndices();if(!E){console.log("Skipping non-indexed primitive ",T.getName());continue}d+=E.getCount(),g.push(d)}f.setRunIndex(g),f.setIndices(e.accessors[h.manifoldPrimitive.indices])}h.mergeIndices!=null&&h.mergeValues!=null&&f.setMerge(e.accessors[h.mergeIndices],e.accessors[h.mergeValues])}),this}prewrite(e){return this.document.getRoot().listMeshes().forEach(r=>{const n=r.getExtension(yt);if(!n)return;const s=n.getIndices();e.addAccessorToUsageGroup(s,ht.BufferViewUsage.ELEMENT_ARRAY_BUFFER);const a=n.getMergeIndices(),c=n.getMergeValues();!a||!c||(e.addAccessorToUsageGroup(a,Oa),e.addAccessorToUsageGroup(c,Oa))}),this}write(e){const{json:r}=e.jsonDoc;return this.document.getRoot().listMeshes().forEach(n=>{const s=n.getExtension(yt);if(!s)return;const a=e.meshIndexMap.get(n),c=r.meshes[a],f=s.getRunIndex(),h=f.length-1;if(h!==c.primitives.length)throw new Error("The number of primitives must be exactly one less than the length of runIndex.");const d=e.accessorIndexMap.get(s.getMergeIndices()),g=e.accessorIndexMap.get(s.getMergeValues()),T=r.accessors[d],E=r.accessors[g],R=c.primitives[0],A={indices:e.accessorIndexMap.get(s.getIndices()),mode:R.mode,attributes:{POSITION:R.attributes.POSITION}},N=r.accessors[A.indices];if(N){T&&E&&(N.sparse={count:T.count,indices:{bufferView:T.bufferView,byteOffset:T.byteOffset,componentType:T.componentType},values:{bufferView:E.bufferView,byteOffset:E.byteOffset}});for(let m=0;m<h;++m){const C=r.accessors[c.primitives[m].indices];C.bufferView=N.bufferView,C.byteOffset=N.byteOffset+4*f[m],C.count=f[m+1]-f[m]}c.extensions=c.extensions||{},c.extensions[yt]={manifoldPrimitive:A,mergeIndices:d,mergeValues:g}}}),this}}const Pr={POSITION:{type:re.Type.VEC3,components:3},NORMAL:{type:re.Type.VEC3,components:3},TANGENT:{type:re.Type.VEC4,components:4},TEXCOORD_0:{type:re.Type.VEC2,components:2},TEXCOORD_1:{type:re.Type.VEC2,components:2},COLOR_0:{type:re.Type.VEC3,components:3},JOINTS_0:{type:re.Type.VEC4,components:4},WEIGHTS_0:{type:re.Type.VEC4,components:4},SKIP_1:{type:null,components:1},SKIP_2:{type:null,components:2},SKIP_3:{type:null,components:3},SKIP_4:{type:null,components:4}};function Cv(t){return t.registerExtensions([ll])}function Fa(t,e,r){t.getRoot().listBuffers().length===0&&t.createBuffer();const n=t.getRoot().listBuffers()[0],s=t.createExtension(ll),a=t.createMesh(),c=[],f=[],h=new Map,d=e.runIndex.length-1;let g=-1;for(let _=0;_<d;++_){const b=e.runOriginalID[_];if(b==g)continue;g=b,c.push(e.runIndex[_]);const O=t.createAccessor("primitive indices of ID "+b).setBuffer(n).setType(re.Type.SCALAR).setArray(new Uint32Array(1)),P=t.createPrimitive().setIndices(O),z=r.get(b);if(z){const{material:L,attributes:k}=z;if(k.length<1||k[0]!=="POSITION")throw new Error('First attribute must be "POSITION".');P.setMaterial(L),h.set(P,k),z.attributes.forEach((W,j)=>{if(j>=f.length)f.push(W);else{const Y=Pr[W].components,H=Pr[f[j]].components;if(Y!=H)throw new Error("Attribute sizes do not correspond: "+W+" and "+f[j]);Pr[f[j]].type==null&&(f[j]=W)}})}else h.set(P,["POSITION"]);a.addPrimitive(P)}c.push(e.runIndex[d]);const T=e.numVert,E=e.numProp;let R=0;f.forEach((_,b)=>{const O=Pr[_];if(O==null)throw new Error(_+" is not a recognized attribute.");if(O.type==null){++R;return}const P=O.components;if(R+P>E)throw new Error("Too many attribute channels.");const z=new Float32Array(P*T);for(let k=0;k<T;++k)for(let W=0;W<P;++W){let j=e.vertProperties[E*k+R+W];_=="COLOR_0"&&(j=Math.max(0,Math.min(1,j))),z[P*k+W]=j}const L=t.createAccessor(_).setBuffer(n).setType(O.type).setArray(z);for(const k of a.listPrimitives()){const W=h.get(k);W.length>b&&Pr[W[b]].type!=null&&k.setAttribute(_,L)}R+=P});const A=s.createManifoldPrimitive();a.setExtension("EXT_mesh_manifold",A);const N=t.createAccessor("manifold indices").setBuffer(n).setType(re.Type.SCALAR).setArray(e.triVerts);A.setIndices(N),A.setRunIndex(c);const m=[...Array(e.numVert).keys()],C=[],x=[];if(e.mergeFromVert&&e.mergeToVert){for(const[_,b]of e.mergeFromVert.entries())m[b]=e.mergeToVert[_];for(const[_,b]of e.triVerts.entries()){const O=m[b];b!==O&&(C.push(_),x.push(O))}}if(C.length>0){const _=t.createAccessor("merge from").setBuffer(n).setType(re.Type.SCALAR).setArray(new Uint32Array(C)),b=t.createAccessor("merge to").setBuffer(n).setType(re.Type.SCALAR).setArray(new Uint32Array(x));A.setMerge(_,b)}return a}const Je=await Iv();Je.setup();Jo(Array);const fl=Cv(new id);fl.registerExtensions(jo);const Nv=["cube","cylinder","sphere","tetrahedron","extrude","revolve","compose","union","difference","intersection","levelSet","smooth","ofMesh","hull"],Ov=["add","subtract","intersect","decompose","warp","transform","translate","rotate","scale","mirror","refine","setProperties","asOriginal","trimByPlane","split","splitByPlane","slice","project","hull","fracture","convexDecomposition"],Fv=["square","circle","union","difference","intersection","compose","ofPolygons","hull"],Dv=["add","subtract","intersect","rectClip","decompose","transform","translate","rotate","scale","mirror","simplify","offset","hull"],ul=["show","only","setMaterial"],$v=["setMinCircularAngle","setMinCircularEdgeLength","setCircularSegments","getCircularSegments","Mesh","GLTFNode","Manifold","CrossSection","setMorphStart","setMorphEnd"],Da=ul.concat($v),kn=new Array;function Hn(t,e,r){const n=Je[t],s=r?n:n.prototype;for(const a of e){const c=s[a];s[a]=function(...f){const h=c(...f);return kn.push(h),h}}}Hn("Manifold",Ov,!1);Hn("Manifold",Nv,!0);Hn("CrossSection",Dv,!1);Hn("CrossSection",Fv,!0);for(const t of ul){const e=Je[t];Je[t]=function(...r){const n=e(...r);return kn.push(n),n}}Je.cleanup=function(){for(const t of kn)if(t instanceof Array)for(const e of t)e.delete();else t.delete();kn.length=0};let vi=!1;const Un=new Map,yi=new Map,Pv=30,hl={roughness:.2,metallic:1,baseColorFactor:[1,1,0],alpha:1,unlit:!1,animationLength:1,animationMode:"loop"},kv={baseColorFactor:[1,0,0],alpha:.25,roughness:1,metallic:0},Uv={baseColorFactor:[.5,.5,.5],alpha:.25,roughness:1,metallic:0},Zt=new Array,Ln=new Map,Sn=new Map,tr=new Map,nr=new Map;let Zr=1,vr,Xr,xs,In,jn;function Lv(){vi=!1,Un.clear(),yi.clear(),Zt.length=0,Ln.clear(),Sn.clear(),tr.clear(),nr.clear(),Zr=1}class jv{_parent;manifold;translation;rotation;scale;material;name;constructor(e){this._parent=e,Zt.push(this)}clone(e){const r={...this};return r._parent=e,Zt.push(r),r}get parent(){return this._parent}}Je.GLTFNode=jv;const Kt={...hl};Je.setMaterial=(t,e)=>{const r=t.asOriginal();return Ln.set(r.originalID(),e),r};Je.setMorphStart=(t,e)=>{const r=nr.get(t);r!=null?r.start=e:nr.set(t,{start:e})};Je.setMorphEnd=(t,e)=>{const r=nr.get(t);r!=null?r.end=e:nr.set(t,{end:e})};function dl(t,e){let r=t.asOriginal();return e.set(r.originalID(),r.getMesh()),r}Je.show=t=>dl(t,Un);Je.only=t=>(vi=!0,dl(t,yi));self.postMessage(null);if(self.console){const t=self.console.log;self.console.log=function(...e){let r="";for(const n of e)n==null?r+="undefined":typeof n=="object"?r+=JSON.stringify(n,null,4):r+=n.toString();self.postMessage({log:r}),t(...e)}}function gr(...t){self.console&&self.console.log(...t)}self.onmessage=async t=>{const e=`const globalDefaults = {};
`+t.data+`
return exportModels(globalDefaults, typeof result === "undefined" ? undefined : result);
`;try{await new Function("exportModels","glMatrix","module",...Da,e)(Xv,cl,Je,...Da.map(n=>Je[n]))}catch(r){console.log(r.toString()),self.postMessage({objectURL:null})}finally{Je.cleanup(),Lv()}};function pl(t){const{quat:e}=cl,r=Math.PI/180,n=e.create();return e.rotateZ(n,n,r*t[2]),e.rotateY(n,n,r*t[1]),e.rotateX(n,n,r*t[0]),n}function Ts(t,e,r,n){const s=r[e];if(s==null)return null;if(typeof s!="function")return s;const a=Xr.getCount(),c=e=="rotation"?4:3,f=new Float32Array(c*a);for(let T=0;T<a;++T){const E=T/(a-1),R=s(Kt.animationMode!=="ping-pong"?E:(1-Math.cos(E*2*Math.PI))/2);f.set(c===4?pl(R):R,c*T)}const h=t.createAccessor(r.name+" "+e+" frames").setBuffer(t.getRoot().listBuffers()[0]).setArray(f).setType(c===4?re.Type.VEC4:re.Type.VEC3),d=t.createAnimationSampler().setInput(Xr).setOutput(h).setInterpolation("LINEAR"),g=t.createAnimationChannel().setTargetPath(e).setTargetNode(n).setSampler(d);return vr.addSampler(d),vr.addChannel(g),jn=!0,s(0)}function Bv(t,e,r){if(nr.has(r)){const n=t.createAnimationChannel().setTargetPath("weights").setTargetNode(e).setSampler(In);vr.addChannel(n),jn=!0}}function Vv(t,e){const r=[];if(e==null)return r;for(let n=0;n<t.numVert;++n)for(let s=0;s<3;++s)r[n*3+s]=t.vertProperties[n*t.numProp+s];if(e.start)for(let n=0;n<t.numVert;++n){const s=t.vertProperties,a=n*t.numProp,c=r.slice(a,a+3);e.start(c);for(let f=0;f<3;++f)s[a+f]=c[f]}return r}function zv(t,e,r,n,s){s!=null&&(r.setWeights([0]),r.listPrimitives().forEach((a,c)=>{if(s.end)for(let E=0;E<e.numVert;++E){const R=n.slice(3*E,3*(E+1));s.end(R),n.splice(3*E,3,...R)}const f=a.getAttribute("POSITION").getArray(),h=new Float32Array(f.length),d=e.runIndex[c];for(let E=0;E<h.length;++E)h[E]=n[d+E]-f[E];const g=t.createAccessor(r.getName()+" morph target").setBuffer(t.getRoot().listBuffers()[0]).setArray(h).setType(re.Type.VEC3),T=t.createPrimitiveTarget().setAttribute("POSITION",g);a.addTarget(T)}))}function Gv(t,e){const r=t.createNode(e.name),n=Ts(t,"translation",e,r);n!=null&&r.setTranslation(n);const s=Ts(t,"rotation",e,r);s!=null&&r.setRotation(pl(s));const a=Ts(t,"scale",e,r);return a!=null&&r.setScale(a),r}function gl(t){return t==null?{}:(t.material==null&&(t.material=gl(t.parent)),t.material)}function Hv(t,e={}){const r={...Kt};Object.assign(r,e);const{roughness:n,metallic:s,baseColorFactor:a,alpha:c,unlit:f}=r,h=t.createMaterial(e.name??"");if(f){const d=t.createExtension(ni).createUnlit();h.setExtension("KHR_materials_unlit",d)}return c<1&&h.setAlphaMode(Er.AlphaMode.BLEND).setDoubleSided(!0),h.setRoughnessFactor(n).setMetallicFactor(s).setBaseColorFactor([...a,c])}function Bn(t,e){return Sn.has(e)||Sn.set(e,Hv(t,e)),Sn.get(e)}function ml(t,e,r,n,s={}){const a=n.numTri();if(a==0){gr("Empty manifold, skipping.");return}gr(`Triangles: ${a.toLocaleString()}`);const c=n.boundingBox(),f=[0,0,0];for(let N=0;N<3;N++)f[N]=Math.round((c.max[N]-c.min[N])*10)/10;gr(`Bounding Box: X = ${f[0].toLocaleString()} mm, Y = ${f[1].toLocaleString()} mm, Z = ${f[2].toLocaleString()} mm`);const h=Math.round(n.getProperties().volume/10);gr(`Genus: ${n.genus().toLocaleString()}, Volume: ${(h/100).toLocaleString()} cm^3`);const d=n.getMesh(),g=new Map;for(const N of d.runOriginalID){const m=Ln.get(N)||s;g.set(N,{material:Bn(t,vi?Uv:m),attributes:["POSITION",...m.attributes??[]]})}const T=nr.get(n),E=Vv(d,T),R=Fa(t,d,g);R.setName(r.getName()),r.setMesh(R),zv(t,d,R,E,T);const A=d.numProp===3?d.vertProperties:new Float32Array(d.numVert*3);if(d.numProp>3)for(let N=0;N<d.numVert;++N)for(let m=0;m<3;++m)A[N*3+m]=d.vertProperties[N*d.numProp+m];tr.set(n,Zr),e.meshes.push({vertices:A,indices:d.triVerts,id:`${Zr++}`});for(const[N,m]of d.runOriginalID.entries()){const C=Un.has(m),x=C?Un.get(m):yi.get(m);if(x==null)continue;g.get(m).material=Bn(t,C?kv:Ln.get(m)||s);const _=t.createNode("debug").setMesh(Fa(t,x,g)).setMatrix(d.transform(N));r.addChild(_)}}function vl(t,e){t.setMesh(e.getMesh()),e.listChildren().forEach(r=>{const n=r.clone();t.addChild(n)})}function qv(t,e,r,n,s){vl(e,r);const a=t.createMesh();e.setMesh(a),r.getMesh().listPrimitives().forEach(c=>{const f=c.clone();c.getMaterial()===s&&f.setMaterial(n),a.addPrimitive(f)})}function Wv(t,e,r,n){const s=Gv(t,r),{manifold:a}=r;if(a!=null){Bv(t,s,a);const c=gl(r),f=n.get(a);if(f==null){ml(t,e,s,a,c);const h=new Map;h.set(c,s),n.set(a,h)}else{const h=f.get(c);if(h==null){const[d,g]=f.entries().next().value;qv(t,s,g,Bn(t,c),Bn(t,d)),f.set(c,s)}else vl(s,h)}}return tr.set(r,Zr),e.components.push({id:`${Zr++}`,name:r.name,children:a==null?[]:[{objectID:`${tr.get(a)}`}]}),s}async function Xv(t,e){Object.assign(Kt,hl),Object.assign(Kt,t);const r=new Vs,n=Math.sqrt(2)/2,s=1/1e3,a=r.createNode("wrapper").setRotation([-n,0,0,n]).setScale([s,s,s]);r.createScene().addChild(a),vr=r.createAnimation(""),jn=!1;const c=Math.round(Kt.animationLength*Pv)+1,f=new Float32Array(c),h=new Float32Array(c);for(let C=0;C<c;++C){const x=C/(c-1);f[C]=x*Kt.animationLength,h[C]=Kt.animationMode!=="ping-pong"?x:(1-Math.cos(x*2*Math.PI))/2}Xr=r.createAccessor("animation times").setBuffer(r.createBuffer()).setArray(f).setType(re.Type.SCALAR),xs=r.createAccessor("animation weights").setBuffer(r.getRoot().listBuffers()[0]).setArray(h).setType(re.Type.SCALAR),In=r.createAnimationSampler().setInput(Xr).setOutput(xs).setInterpolation("LINEAR"),vr.addSampler(In);const d={meshes:[],components:[],items:[],precision:7,header:{unit:"millimeter",title:"ManifoldCAD.org model",description:"ManifoldCAD.org model",application:"ManifoldCAD.org"}};if(Zt.length>0){const C=new Map,x=new Map;let _=0;for(const b of Zt)C.set(b,Wv(r,d,b,x)),b.manifold&&++_;for(const b of Zt){const O=C.get(b),P={objectID:`${tr.get(b)}`,transform:O.getMatrix()},{parent:z}=b;z==null?(a.addChild(O),d.items.push(P)):(C.get(z).addChild(O),d.components.find(k=>k.id==`${tr.get(z)}`).children.push(P))}gr("Total glTF nodes: ",Zt.length,", Total mesh references: ",_)}else{if(e==null){gr('No output because "result" is undefined and no "GLTFNode"s were created.');return}const C=r.createNode();ml(r,d,C,e),a.addChild(C),d.items.push({objectID:`${tr.get(e)}`})}jn||(Xr.dispose(),xs.dispose(),In.dispose(),vr.dispose());const g=await fl.writeBinary(r),T=new Blob([g],{type:"application/octet-stream"}),E=new rp;E.add3dModel("3D/3dmodel.model");const R=tp(d),A={};A["3D/3dmodel.model"]=Wr(R),A[Ra.name]=Wr(Ra.content),A[E.name]=Wr(E.content);const N=vp(A),m=new Blob([N],{type:"application/vnd.ms-package.3dmanufacturing-3dmodel+xml"});self.postMessage({glbURL:URL.createObjectURL(T),threeMFURL:URL.createObjectURL(m)})}
